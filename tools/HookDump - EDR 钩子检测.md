> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/0M_JO4F5nglhyr8QWbDV9Q)

*   低误报率
    
*   检查 DLL 的列表，而不仅仅是 NTDLL
    
*   在一个函数的第二或第三条指令中找到钩子
    
*   检测 WOW 系统调用存根的篡改情况
    
*   没有 ASCII 艺术
    

![](https://mmbiz.qpic.cn/mmbiz_png/aPmkR80bcV1lDPXkgWV1Yx8ryChJ2enD2FCVibhwBibTGwicfcSUG8tqnAEsf1nmaxRQmKE7GT3UJ0EyBjN5U1yiaw/640?wx_fmt=png)

        钩子扫描解决方案会简单地扫描一个加载的 DLL，在一个函数的第一个字节中寻找 jmp 指令，这导致了许多误报，例如导出的变量等。

![](https://mmbiz.qpic.cn/mmbiz_png/aPmkR80bcV1lDPXkgWV1Yx8ryChJ2enDXSoXIHiaz76jnMcKUZqQj7QOibRkOb2PeGaYQXYzUZhfQdZHMRz7CxNg/640?wx_fmt=png)

        HookDump 的误报率很低，这是通过对每个 DLL 检查加载两次来实现的，一次是使用 LoadLibrary，另一次是从磁盘上读入一个缓冲区。导出的函数在两个加载的副本中都被解决了，几个指令从两个副本中被反汇编，然后对指令进行比较。使用这种方法 HookDump 可以检测到函数的第一第二或第三条指令中的钩子。

        一些 EDR 在 PEB 模块列表中为 NTDLL 创建了一个假条目，结合页面防护 / 不执行内存访问权限和异常处理程序，可信的执行流被重定向到真正的 NTDLL，试图阻止 shellcode 通过解析出口表手动定位函数地址。HookDump 能够找到 NTDLL 的原始拷贝并检查它的钩子。

        HookDump 还可以检查多个 DLL，而不仅仅是 NTDLL，库的列表存储在源文件 LibraryList.inl 中，是通过使用 SysInternals ProcessExplorer 转储 explorer.exe 中加载的 DLL 的列表而创建的。

![](https://mmbiz.qpic.cn/mmbiz_png/aPmkR80bcV1lDPXkgWV1Yx8ryChJ2enD5ExRjhhW3bictk4ibSpQrqxpp3WUDmiaJOU5GXG7dj9nuNNEkD0jybq4g/640?wx_fmt=png)