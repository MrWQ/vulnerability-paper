> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/zcCueV5RfOiqXkh_7YnNnA)<table><tbody><tr><td width="557" valign="top" height="62"><section><strong>声明：</strong>该公众号大部分文章来自作者日常学习笔记，也有部分文章是经过作者授权和其他公众号白名单转载，未经授权，严禁转载，如需转载，联系开白。</section><section>请勿利用文章内的相关技术从事非法测试，如因此产生的一切不良后果与文章作者和本公众号无关。</section></td></tr></tbody></table>

现在只对常读和星标的公众号才展示大图推送，建议大家把潇湘信安 “设为星标”，否则可能看不到了！

**工具介绍**

bimg-shellcode-loader 是一个使用 bilibili 图片隐写功能加载 shellcode 的工具。当然你可以使用任何地方的图片。  

在调研 C2 通讯方式时，发现有一个有师傅使用了 bilbili 图片隐写功能加载 shellcode，觉得这个方法很有意思，就自己写了一个工具，添加了反沙箱功能。  

如果这个项目对你有帮助，欢迎 star。

**使用步骤**

1. 生成包含隐写信息的图片

使用 generate.go 生成包含 shellcode 的图片，生成的图片为 out_file.png。

在 generate.go 同级目录下存放 shellcode 文件，文件名为 shellcode.bin；图片为 img.png，随后用运行 generate.go 生成 out_file.png。

```
go run generate.go

```

##### 2. 上传图片到 bilibili

登陆访问创作中心，点击上传图片，把生成的图片上传上去。

```
https://member.bilibili.com/platform/upload/text/edit

```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/79gZQNibQ6uftPGer756frhSYB0QEp640xybdFtvvlX1qLlBEIJ65OhHAYFwZFCpOdgUYGZLrb8zseLDLTZvZmg/640?wx_fmt=png)

通过浏览器开发者工具，查看上传图片的请求，找到图片的返回地址，复制下来。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/79gZQNibQ6uftPGer756frhSYB0QEp640nTLTGTsVicK91s2Kfdaa9xmspgoZWZGx02Iia22ib4sa74UoRGtpqScGw/640?wx_fmt=png)

把图片地址填入到 shellcodeLoader.go 中的 imgUrl 变量中。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/79gZQNibQ6uftPGer756frhSYB0QEp640biayLHpiaicFTXDMet1mAictfhg46a10CsgibbEZrL9cY1a08kdbRx76CTg/640?wx_fmt=png)

##### 3. 编译加载器

```
CGO_ENABLED=0 GOOS=windows GOARCH=amd64 GOPRIVATE=* GOGARBLE=* garble -tiny -literals -seed=random build -ldflags  "-w -s -buildid= -H=windowsgui" -buildmode="pie"

```

**免杀效果**

只测试了 360 和微步  

![](https://mmbiz.qpic.cn/sz_mmbiz_png/79gZQNibQ6uftPGer756frhSYB0QEp640CmljAcj1uLE7fvtyWEwPGma4gOwfCtZGz3qUls9DjOgnSZRZCXPEnw/640?wx_fmt=png)

微步反沙箱，判断当前系统壁纸，如果是沙箱内的壁纸就退出。大家有遇到的沙箱或者分析机，提取壁纸的 md5 放入列表中。

```
md5List := []string{"fbfeb6772173fef2213992db05377231", "49150f7bfd879fe03a2f7d148a2514de", "fc322167eb838d9cd4ed6e8939e78d89", "178aefd8bbb4dd3ed377e790bc92a4eb", "0f8f1032e4afe1105a2e5184c61a3ce4", "da288dceaafd7c97f1b09c594eac7868"}

```

微步沙箱检测通过 0/24，并且没有检测到网络通信。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/79gZQNibQ6uftPGer756frhSYB0QEp640Q4g95ic6m7bgwOKjt6MrcB9d2xEuXGZpCE8zAjUrLhrb1UPT0YxicjWg/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/sz_mmbiz_png/79gZQNibQ6uftPGer756frhSYB0QEp640GzoxeBxQicTtzCQ6czQcDAdJUZse9KvJ5WL9eQgvniayg6Po18czLhrQ/640?wx_fmt=png)

**下载地址**

**点击下方名片进入公众号**

**回复关键字【****23****85****】获取****下载链接**

**信 安 考 证**

  

  

需要考以下各类安全证书的可以联系我，价格优惠、组团更便宜，还送【潇湘信安】知识星球 **1** 年！

<table><tbody><tr><td width="557" valign="top"><p>CISP、PTE、PTS、DSG、IRE、IRS、NISP、PMP、CCSK、CISSP、ISO27001...</p></td></tr></tbody></table>

![](https://mmbiz.qpic.cn/mmbiz_jpg/XOPdGZ2MYOeH17P4KeKnWkbLrWiaWOb0F1PCq8qME7Y67R45o7kW1iabxmbbd4yldq5cA3HsQZo2Q6lB3rYUVSUA/640?wx_fmt=jpeg)

**推 荐 阅 读**

  

  

  

[![](https://mmbiz.qpic.cn/mmbiz_png/XOPdGZ2MYOe2nibXhkXA8A79MhARiaW5Q0H2aiaR0OwyR63JAI1pRGAc7FZMgIHb9kicboQziaJkTbnlAgOvkdiaHf5g/640?wx_fmt=png)](http://mp.weixin.qq.com/s?__biz=Mzg4NTUwMzM1Ng==&mid=2247499188&idx=1&sn=9ce15a0e66b2595285e544aaa0c49c24&chksm=cfa559a7f8d2d0b162f00e0c1b02c85219f2668c282b32967b2530f15051b47b21ee2855a783&scene=21#wechat_redirect)

[![](https://mmbiz.qpic.cn/mmbiz_png/XOPdGZ2MYOe2nibXhkXA8A79MhARiaW5Q0ibIORUp7SmHhzy2uyXKsgn7YwfdjIpZDFx0vT7AJDMtqKf9l5WCzIIQ/640?wx_fmt=png)](http://mp.weixin.qq.com/s?__biz=Mzg4NTUwMzM1Ng==&mid=2247496043&idx=1&sn=4daa27ade9915de6021fea1c2a21d7bc&chksm=cfa55578f8d2dc6ef887ce27215f942ec233320fa6878bc1666ce0fecb0e7f6c7f96a3ba4e2b&scene=21#wechat_redirect)

[![](https://mmbiz.qpic.cn/mmbiz_png/XOPdGZ2MYOf8eyzKWPF5pVok5vsp74xolhlyLt6UPab7jQddW6ywSs7ibSeMAiae8TXWjHyej0rmzO5iaZCYicSgxg/640?wx_fmt=png)](http://mp.weixin.qq.com/s?__biz=Mzg4NTUwMzM1Ng==&mid=2247486327&idx=1&sn=71fc57dc96c7e3b1806993ad0a12794a&chksm=cfa6af64f8d1267259efd56edab4ad3cd43331ec53d3e029311bae1da987b2319a3cb9c0970e&scene=21#wechat_redirect)

![](https://mmbiz.qpic.cn/mmbiz_png/XOPdGZ2MYOdAPjIVeN2ZahG9ibP0Y3wlfg6BO1WO7MZfo1JeW7zDWcLSTQ5Ek8zXAia5w1nMnogpbpXP6OxXXOicA/640?wx_fmt=png)