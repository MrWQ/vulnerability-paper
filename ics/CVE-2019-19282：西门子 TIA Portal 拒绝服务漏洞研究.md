> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/ipbvjTE0moREO4uGJFbmIQ)

**![](https://mmbiz.qpic.cn/mmbiz_gif/ll2PVky3MmaYz8UWHicLDSC4e3NqcibOLicCiaYtmQm9A0Ied3OLs4Wibj6bLz8jmf0gB3k0h1aQNNVKNqjKFcZV0Mg/640?wx_fmt=gif&wxfrom=5&wx_lazy=1)**
----------------------------------------------------------------------------------------------------------------------------------------------------------------------

TIA 博途是全集成自动化软件 TIA portal 的简称，是西门子工业自动化集团发布的一款全新的全集成自动化软件。它是业内首个采用统一的工程组态和软件项目环境的自动化软件，几乎适用于所有自动化任务。

Part1

漏洞状态

<table interlaced="enabled" data-sort="sortDisabled"><tbody><tr><td valign="top" align="center" width="69.66666666666667">漏洞细节<br></td><td valign="top" align="center" width="71.66666666666667">漏洞 POC<br></td><td valign="top" align="center" width="61.66666666666667">漏洞 EXP<br></td><td valign="top" align="center" width="65.66666666666667">在野利用<br></td></tr><tr><td valign="top" align="center" width="10">有</td><td valign="top" align="center" width="71.66666666666667">有</td><td valign="top" align="center" width="61.66666666666667">有</td><td valign="top" align="center" width="65.66666666666667">无</td></tr></tbody></table>

Part2

漏洞描述

<table interlaced="enabled"><tbody><tr><td valign="middle" align="center" width="110.66666666666667">‍漏洞名称<br></td><td valign="middle" align="left" width="449"><p>西门子 TIA Portal 拒绝服务漏洞研究</p></td></tr><tr><td valign="middle" align="center" width="110.66666666666667">CVE 编号</td><td valign="top" width="449">CVE-2019-19282</td></tr><tr><td valign="middle" align="center" colspan="1" rowspan="1" width="17">漏洞类型<br></td><td valign="middle" align="left" colspan="1" rowspan="1" width="449"><section>拒绝服务</section></td></tr><tr><td valign="middle" align="center" colspan="1" rowspan="1" width="110.66666666666667">漏洞等级</td><td valign="middle" align="left" colspan="1" rowspan="1" width="449">7.5 高危 (High）</td></tr><tr><td valign="middle" align="center" colspan="1" rowspan="1" width="110.66666666666667">公开状态</td><td valign="middle" align="left" colspan="1" rowspan="1" width="449">公开</td></tr><tr><td valign="middle" align="center" colspan="1" rowspan="1" width="17">漏洞描述</td><td valign="middle" align="left" colspan="1" rowspan="1" width="449"><p>通过特制消息，启用加密通信后，具有网络访问权限的攻击者可利用此漏洞，通过造成拒绝服务条件来危害系统的可用性。成功利用该漏洞不需要系统权限和用户交互。</p></td></tr><tr><td valign="middle" align="center" colspan="1" rowspan="1">时间线<br></td><td valign="middle" align="left" colspan="1" rowspan="1"><p>2021-12-18 漏洞提交<o:p></o:p></p>2022-03-10 CVE 发布</td></tr><tr><td valign="middle" align="center" colspan="1" rowspan="1">受影响版本<br></td><td valign="middle" align="left" colspan="1" rowspan="1">OpenPCS 7 V8.1（所有版本）、OpenPCS 7 V8.2（所有版本）、OpenPCS 7 V9.0（所有版本 &lt; V9.0 Upd3）、SIMATIC BATCH V8.1（所有版本）、SIMATIC BATCH V8.2（所有版本 &lt; V8.2 Upd12）、SIMATIC BATCH V9.0（所有版本 &lt; V9.0 SP1 Upd5）、SIMATIC NET PC SOFTWARE V14（所有版本 &lt; V14 SP1 Update 14）、 SIMATIC NET PC 软件 V15（所有版本）， SIMATIC NET PC SOFTWARE V16 （所有版本 &lt; V16 Update 1）， SIMATIC PCS 7 V8.1 （所有版本）， SIMATIC PCS 7 V8.2 （所有版本）， SIMATIC PCS 7 V9.0 （V9.0 SP3 &lt; 所有版本），SIMATIC 路由控制 V8.1 （所有版本），SIMATIC 路由控制 V8.2 （所有版本），SIMATIC 路由控制 V9.0 （所有版本 &lt; V9.0 Upd4）， SIMATIC WinCC （TIA Portal） V13 （所有版本 &lt; V13 SP2）， SIMATIC WinCC （TIA Portal） V14 （所有版本 &lt; V14 SP1 Update 10）， SIMATIC WinCC （TIA Portal） V15.1 （V15.1 Update 5 &lt; 所有版本）， SIMATIC WinCC （TIA Portal） V16 （所有版本 &lt; V16 Update 1）， SIMATIC WinCC V7.3 （所有版本）， SIMATIC WinCC V7.4 （所有版本 &lt; V7.4 SP1 Update 14）， SIMATIC WinCC V7.5（V7.5 SP1 Update 1 &lt; 所有版本）</td></tr></tbody></table>

**分析环境:**
---------

Win10

TIA Portal 15.1 Update 3 

Part3

漏洞复现

1. 安装 TIA15.1 和安装 Update 3 更新

2. 查看是否开启服务进程 CCAgent.exe 和端口 8910

![](https://mmbiz.qpic.cn/mmbiz_png/ll2PVky3MmZgvPnI2ibZQG8dXgmdMFl5fcof6JV6BKKS9HRIh79ibXib4EbiaQIUOQD0qYlUUUqLEciagjet1E3mIeA/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/ll2PVky3MmZgvPnI2ibZQG8dXgmdMFl5fqxib442ohwrSdgzRZWLV34fKwQ23V06iaNznZ3QGfMIo2Tgp9YvwialMg/640?wx_fmt=png)

3. 运行测试脚本，查看进程是否崩溃

![](https://mmbiz.qpic.cn/mmbiz_png/ll2PVky3MmZgvPnI2ibZQG8dXgmdMFl5fL4OGl1Ofh7yP6TCB0VMGvZBiaYJqo4hDT2kTce4jCUsICWwSicV96vnw/640?wx_fmt=png)

4. 进程崩溃，复现成功！

![](https://mmbiz.qpic.cn/mmbiz_png/ll2PVky3MmZgvPnI2ibZQG8dXgmdMFl5f1xUBXEGHibZnBexsASO4CykwAJia3qmxPyiayX6GpnSoGpiaLByUYiaUl1g/640?wx_fmt=png)

Part4

漏洞分析

1. 这里判断是否是加密通讯，如果非加密通讯函数流程走不到崩溃的点。需要注意。

![](https://mmbiz.qpic.cn/mmbiz_png/ll2PVky3MmZgvPnI2ibZQG8dXgmdMFl5fwPsXqQf7UeMkPn3uHakfpdNm6OicHLFlibPHp9K6hpXvs5ZAgE4QHicfQ/640?wx_fmt=png)

2. 这里校验 HdrSize + BodySize 是否等于 MsgSize。如果它不相等，则被视为错误，并且不会处理消息。但是，攻击者可以在数据中自定义数据头大小和正文大小。

![](https://mmbiz.qpic.cn/mmbiz_png/ll2PVky3MmZgvPnI2ibZQG8dXgmdMFl5fUSKjXNPqFrguwj4DPDWYXrub5EVqagTt3XugqUXHbUGKR9qIeicbOeQ/640?wx_fmt=png)

3. 由于把 0xFFFF FFFF 用作有符号数，即 - 1。所以看到原本的 ecx(0x74) 加 0xFFFF FFFF 后变成 0x73 。所以通过这个校验流程。

![](https://mmbiz.qpic.cn/mmbiz_png/ll2PVky3MmZgvPnI2ibZQG8dXgmdMFl5ftRteukQBFR5zuPib02ReoFss9kEG2cZGElGwUrB39jksVWibT6vO3UkQ/640?wx_fmt=png)

4. 这个流程又把 0xFFFF FFFF 用作无符号数，导致判断超过预设缓冲区大小 0x1000，走到异常流程，导致程序崩溃。

![](https://mmbiz.qpic.cn/mmbiz_png/ll2PVky3MmZgvPnI2ibZQG8dXgmdMFl5ffIEV8XxiaJBKyDibV8MssIHQMibv1C0t3sj8tcqGdFyicfY5ssoaEtibsZA/640?wx_fmt=png)

分析完毕。

Part5

修复缓解建议

1. 软件升级到最新版本

2. 检测读取函数是否溢出

 **![](https://mmbiz.qpic.cn/mmbiz_png/ll2PVky3MmaolAkPsicNuzDOok8n4xXZIczeyb9icH1wWwdibvVxEQqY0znTbqgES8yD0bHynSX6ADlHCoBrYtqaA/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)** **获取更多情报**

  

联系我们，获取更多漏洞情报详情及处置建议，让企业远离漏洞威胁。  
电话：18511745601

邮箱：shiliangang@andisec.com

**漏洞分析回顾**  
![](https://mmbiz.qpic.cn/mmbiz_gif/ll2PVky3MmYrt8sZBqiah8aNInQspzccnPAAhd0OKLQ5Ziad4ovQEohiamyrpYjQcwVAWROpYWmMXia1YRKPiczFSQw/640?wx_fmt=gif&wxfrom=5&wx_lazy=1)[![](https://mmbiz.qpic.cn/mmbiz_jpg/ll2PVky3MmaeR3n14kDibicmFJ3Dmb2AT6CZYINllcVdueiaHMQeibk2FPNXlGzE93RQeeibtZLmPdgppzrsKsGZqpw/640?wx_fmt=jpeg)](http://mp.weixin.qq.com/s?__biz=MzU3ODQ4NjA3Mg==&mid=2247547768&idx=1&sn=4237d1026c2f785bcd54902d8e0b70ad&chksm=fd76d12fca0158392c5185c776b12cba3a91c48d034d38f3fdca4eb55efc536468c15a69feff&scene=21#wechat_redirect)[![](https://mmbiz.qpic.cn/mmbiz_jpg/ll2PVky3MmaeR3n14kDibicmFJ3Dmb2AT672NY3vRbibD0FhxRB5A6K33yf87pgLHUiciarmOYZlPSQU1rgrgxcxo5w/640?wx_fmt=jpeg)](http://mp.weixin.qq.com/s?__biz=MzU3ODQ4NjA3Mg==&mid=2247547483&idx=1&sn=7bfe44f029c24143540ec5a0125f2874&chksm=fd76d00cca01591a61af90a9749aa6089343d0e620ff7a3db0878af503d2654a587fb20cdc84&scene=21#wechat_redirect)[![](https://mmbiz.qpic.cn/mmbiz_jpg/ll2PVky3MmaeR3n14kDibicmFJ3Dmb2AT6tmTcoK8xwzxhKeZ4t7moQibWFuCiazOiaGoiae9bH8IvkvBdlVMdallB7w/640?wx_fmt=jpeg)](http://mp.weixin.qq.com/s?__biz=MzU3ODQ4NjA3Mg==&mid=2247547308&idx=1&sn=520fd5ce5cb603c164891f134487740e&chksm=fd76d3fbca015aedb1a2de017932c58436a283b866b431ea82e2a6e37b6581390e61028343d3&scene=21#wechat_redirect)[![](https://mmbiz.qpic.cn/mmbiz_jpg/ll2PVky3MmaeR3n14kDibicmFJ3Dmb2AT6ScpWn9eLGIP9UEENMxuictBYIicice9hpo78CWsSfdMkzpAFs8A5EPZxA/640?wx_fmt=jpeg)](http://mp.weixin.qq.com/s?__biz=MzU3ODQ4NjA3Mg==&mid=2247546957&idx=1&sn=bea4a4e0727d8f8db66856ebd899eb4b&chksm=fd76d21aca015b0c45c0a48f1f35aca6d7b4ed3f79a43dea7bc0c387112a2549b4c6a0ba96b9&scene=21#wechat_redirect)

  

北京安帝科技有限公司是新兴的工业网络安全能力供应商，专注于网络化、数字化、智能化背景下的工业网络安全技术、产品、服务的创新研究和实践探索，基于网络空间行为学理论及工业网络系统安全工程方法，围绕工业网络控制系统构建预防、识别、检测、保护、响应、恢复等核心能力优势，为电力、水利、石油石化、轨道交通、烟草、钢铁冶金、智能制造、矿业等关键信息基础设施行业提供安全产品、服务和综合解决方案。坚持 IT 安全与 OT 安全融合发展，坚持产品体系的自主可控，全面赋能客户构建 “业务应用紧耦合、用户行为强相关、安全风险自适应、网络弹性稳增强” 的主动防御和纵深防御相结合的安全保障体系。

![](https://mmbiz.qpic.cn/mmbiz_gif/ll2PVky3Mma4ibTfp7sC3ibt8WmetoDfiaGHEb7VOiaemeFbuCTupYgus7NTKkibwKwpsEDfzqZdXh1skHff6A6VNgA/640?wx_fmt=gif&wxfrom=5&wx_lazy=1)

**点击 “在看” 鼓励一下吧**

**![](https://mmbiz.qpic.cn/mmbiz_png/ll2PVky3MmZOFFgf4oTyfUTx7y0ZBV9yIg8qmaSwAvbjiba2KQn7VgmXYIriagc9H0hMu1u0UIZr98JYSmyG9tibg/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)**