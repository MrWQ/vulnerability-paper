> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s?__biz=MzU3ODQ4NjA3Mg==&mid=2247533982&idx=1&sn=e8125c5704b1f044d29590bc307f5d10&chksm=fd76afc9ca0126df7ab4e0786d6231c7ecfb62f1fabb4b33e1d9c5531d30d581d4a518bd7f7d&scene=21#wechat_redirect)

**![](https://mmbiz.qpic.cn/mmbiz_gif/ll2PVky3MmaYz8UWHicLDSC4e3NqcibOLicCiaYtmQm9A0Ied3OLs4Wibj6bLz8jmf0gB3k0h1aQNNVKNqjKFcZV0Mg/640?wx_fmt=gif&wxfrom=5&wx_lazy=1)**
----------------------------------------------------------------------------------------------------------------------------------------------------------------------

ScadaBR 是巴西 Sensorweb 公司的一套用于开发自动化数据采集和监控应用程序的开源软件，允许为自动化项目创建交互式屏幕。ScadaBR 可以与 OpenPLC 通信，进行数据采集与实时监控。

Part1

漏洞状态

<table interlaced="enabled" data-sort="sortDisabled"><tbody><tr><td valign="top" align="center" width="69.66666666666667">漏洞细节<br></td><td valign="top" align="center" width="71.66666666666667">漏洞 POC<br></td><td valign="top" align="center" width="61.66666666666667">漏洞 EXP<br></td><td valign="top" align="center" width="65.66666666666667">在野利用<br></td></tr><tr><td valign="top" align="center" width="10">无</td><td valign="top" align="center" width="71.66666666666667">有<br></td><td valign="top" align="center" width="61.66666666666667">有</td><td valign="top" align="center" width="65.66666666666667">无</td></tr></tbody></table>

Part2

漏洞描述

<table interlaced="enabled"><tbody><tr><td width="103" valign="middle" align="center">‍漏洞名称<br></td><td valign="middle" align="left" width="416"><p>&nbsp;&nbsp;ScadaBR 存在任意文件上传漏洞</p></td></tr><tr><td width="103" valign="middle" align="center">CVE 编号</td><td valign="top" width="416">CVE-2021-26828</td></tr><tr><td width="103" valign="middle" align="center">漏洞类型</td><td valign="top" width="416">任意文件上传</td></tr><tr><td valign="middle" align="center" colspan="1" rowspan="1">漏洞等级</td><td valign="middle" align="left" colspan="1" rowspan="1" width="416">8.8 高危（High）</td></tr><tr><td valign="middle" align="center" colspan="1" rowspan="1">漏洞描述</td><td valign="middle" align="left" colspan="1" rowspan="1" width="415">ScadaBR Linux 0.9.1 和 ScadaBR Windows 1.0/ 1.12.4CE 允许经过身份验证的远程用户通过 “view_edit.shtm” 页面上传和执行任意 JSP 文件。<br></td></tr><tr><td valign="middle" align="center" colspan="1" rowspan="1">受影响版本</td><td valign="middle" align="left" colspan="1" rowspan="1" width="415"><section></section><p>ScadaBR Linux 0.91</p><p>ScadaBR Windows 1.0</p><p>ScadaBR Windows 1.12.4CE</p><section></section></td></tr><tr><td valign="middle" align="center" colspan="1" rowspan="1">时间线</td><td valign="middle" align="left" colspan="1" rowspan="1" width="415">2021-06-11 CVE 发布</td></tr></tbody></table>

Part3

漏洞复现

### **1. 复现环境**

靶机：Win10（192.168.15.130）

软件：ScadaBR Windows 1.0

### **2. 复现步骤**

登陆 ScadaBR,，并访问 http://192.168.15.130:8080/ScadaBR/view_edit.shtm 页面。

![](https://mmbiz.qpic.cn/mmbiz_jpg/ll2PVky3MmZvve7UUxTYa458TkEwmY6DYcol9Q2lmVkiafOdCgQ08ITbic6CfzZxJBwNFkEgSOuFLxuWrxK0mxzw/640?wx_fmt=jpeg)

创建 cmd.jsp 文件。

![](https://mmbiz.qpic.cn/mmbiz_jpg/ll2PVky3MmZvve7UUxTYa458TkEwmY6DJlTE5Wj7diaccjiasIRu4M7LbQuNbtJpA2LnKyxzw6djEhJvdhXnGZsw/640?wx_fmt=jpeg)

选择 cmd.jsp 文件。

![](https://mmbiz.qpic.cn/mmbiz_jpg/ll2PVky3MmZvve7UUxTYa458TkEwmY6DTBZjDp18rSWDtZxt4ibkagoLpDwvnFzJUPDlOZb5onRvlE6rkZibS6Yw/640?wx_fmt=jpeg)

上传 cmd.jsp 文件后界面发生改变。

![](https://mmbiz.qpic.cn/mmbiz_jpg/ll2PVky3MmZvve7UUxTYa458TkEwmY6DS3B7ef7ib5AsKXl1NGpKGTDiaib04xibQ6hbJtxkY0gBr7Rw9K3Q2RfUAQ/640?wx_fmt=jpeg)

在页面代码中定位到 jsp 文件路径，此时 jsp 文件已被重命名。

![](https://mmbiz.qpic.cn/mmbiz_jpg/ll2PVky3MmZvve7UUxTYa458TkEwmY6DJKTvPSiaXia6gBAibZxSKQt3oLUBjXfxzCdPiafyYThw5kJ1Hp3loYDAEA/640?wx_fmt=jpeg)

访问 http://192.168.15.130:8080/ScadaBR/uploads/6.jsp 页面，此时页面没有报错。

![](https://mmbiz.qpic.cn/mmbiz_jpg/ll2PVky3MmZvve7UUxTYa458TkEwmY6DDcoP0DaSvWqiaKMCicYd0aZcb0Laj3ibh193fdfBgygM7BvJUr0miaKpvg/640?wx_fmt=jpeg)

访问 http://192.168.15.130:8080/ScadaBR/uploads/6.jsp?cmd=whoami，尝试添加请求参数执行命令。通过执行”whoami” 命令，可以得知当前用户为 system，漏洞复现成功。

![](https://mmbiz.qpic.cn/mmbiz_jpg/ll2PVky3MmZvve7UUxTYa458TkEwmY6Dhawkh00dtZSLWiaQSc7ZAW0g4wNgVzF28D8ibfR3TXlVYibNMDaY34W2A/640?wx_fmt=jpeg)

Part4

漏洞分析  

在 ScadaBR\webapps\ScadaBR\WEB-INF\springDispatcher-servlet.xml 文件中查询到 views.shtm 映射关系，views.shtm 被映射到 viewsController。

![](https://mmbiz.qpic.cn/mmbiz_jpg/ll2PVky3MmZvve7UUxTYa458TkEwmY6DdcxFOeibagvmpIwibeW8icTPKAZoG1uO74Z6VYSfPBTyYRq6r4AIldyWA/640?wx_fmt=jpeg)

随后在 ScadaBR\webapps\ScadaBR\WEB-INF\classes\com\serotonin\mango\web\mvc\controller 文件夹中查询到 ViewsController.class。

![](https://mmbiz.qpic.cn/mmbiz_jpg/ll2PVky3MmZvve7UUxTYa458TkEwmY6DbDGVWmypib7b94nYP4CBHhQeLNkZ0Fhqw2RLzNHalxpcOGkUnhH0ArA/640?wx_fmt=jpeg)

使用 luyten 反编译 ViewsController.class，并查询到处理文件上传的函数。

![](https://mmbiz.qpic.cn/mmbiz_jpg/ll2PVky3MmZvve7UUxTYa458TkEwmY6Dunw9sghSljiaU95YC8DFjiaV6ZfVpnhB6yVGJtSIe7hWeNxKaRA2FfFw/640?wx_fmt=jpeg)

对 onBindAndValidate 函数进行分析，发现该函数没有对上传文件的扩展名以及文件类型进行检测，从而导致攻击者可以上传任意类型文件。

Part5

缓解建议

1. 软件升级至最新版本。

2. 监控网络流量，查看是否有恶意代码的流量特征。

3. 安装主机卫士，设置 IP 白名单。

**SAFE**

**获取更多情报**

  

联系我们，获取更多漏洞情报详情及处置建议，让企业远离漏洞威胁。  
电话：18511745601

邮箱：shiliangang@andisec.com

**漏洞分析回顾**  
![](https://mmbiz.qpic.cn/mmbiz_gif/ll2PVky3MmYrt8sZBqiah8aNInQspzccnPAAhd0OKLQ5Ziad4ovQEohiamyrpYjQcwVAWROpYWmMXia1YRKPiczFSQw/640?wx_fmt=gif&wxfrom=5&wx_lazy=1)[![](https://mmbiz.qpic.cn/mmbiz_jpg/ll2PVky3MmZvve7UUxTYa458TkEwmY6DK5w0Eib20aBAF9TXhicV1IFTk3borI8Y8IibFEwBkTr6OKfaLjKJ38NlQ/640?wx_fmt=jpeg)](http://mp.weixin.qq.com/s?__biz=MzU3ODQ4NjA3Mg==&mid=2247533350&idx=1&sn=369c37a7c5ba4d4980d5363633172dbd&chksm=fd76a971ca01206763866bc2e866f279724028d4e8de248cf598ad25c789c7c7d8d24f077a05&scene=21#wechat_redirect)

[![](https://mmbiz.qpic.cn/mmbiz_jpg/ll2PVky3MmZvve7UUxTYa458TkEwmY6Dyibib7NIlYNeziaKqPiaOtR8nGxMJpYgiaR8bFHrxZJZNtb5cqD2MBIgpOw/640?wx_fmt=jpeg)](http://mp.weixin.qq.com/s?__biz=MzU3ODQ4NjA3Mg==&mid=2247533011&idx=1&sn=30d2cdb4cb614d4b556cd64effb1dc8d&chksm=fd76ab84ca012292705b092e1268ca4ae418df8d16c35d05670143bb1e1ca20ca44c1af465b0&scene=21#wechat_redirect)

[![](https://mmbiz.qpic.cn/mmbiz_jpg/ll2PVky3MmZvve7UUxTYa458TkEwmY6DIPsraVuKGnsQJfWYFEoLMmft6ibNgdeiccFhicAyfr8DBIKcEMhLHK2pQ/640?wx_fmt=jpeg)](http://mp.weixin.qq.com/s?__biz=MzU3ODQ4NjA3Mg==&mid=2247532641&idx=1&sn=194abb0d9dd334969553d80846095ccb&chksm=fd76aa36ca012320b08fab08fa7e6e469e76ed1dce61da4c5b3cca1786120880570e09d86387&scene=21#wechat_redirect)

[![](https://mmbiz.qpic.cn/mmbiz_jpg/ll2PVky3MmZvve7UUxTYa458TkEwmY6DO3AoDO6nlH2HcMc4qTPZOciat8ibz2MxqAAlgKibYhRqMrGhrPQZ5edIQ/640?wx_fmt=jpeg)](http://mp.weixin.qq.com/s?__biz=MzU3ODQ4NjA3Mg==&mid=2247532563&idx=1&sn=074c9a7ab3b51a4250c13b82c4bb74cb&chksm=fd76aa44ca012352964f1bc708f497db583c81e1022394f5605c0079a3d4168152d93e756f0d&scene=21#wechat_redirect)

  

北京安帝科技有限公司是新兴的工业网络安全能力供应商，专注于网络化、数字化、智能化背景下的工业网络安全技术、产品、服务的创新研究和实践探索，基于网络空间行为学理论及工业网络系统安全工程方法，围绕工业网络控制系统构建预防、识别、检测、保护、响应、恢复等核心能力优势，为电力、水利、石油石化、轨道交通、烟草、钢铁冶金、智能制造、矿业等关键信息基础设施行业提供安全产品、服务和综合解决方案。坚持 IT 安全与 OT 安全融合发展，坚持产品体系的自主可控，全面赋能客户构建 “业务应用紧耦合、用户行为强相关、安全风险自适应、网络弹性稳增强” 的主动防御和纵深防御相结合的安全保障体系。截至 2021 年底，公司主要产品已应用于数千家 “关基” 企业，其中工业网络安全态势感知平台已部署 4000 余家客户，虚实结合工业网络靶场服务超过 50 家客户。

![](https://mmbiz.qpic.cn/mmbiz_gif/ll2PVky3Mma4ibTfp7sC3ibt8WmetoDfiaGHEb7VOiaemeFbuCTupYgus7NTKkibwKwpsEDfzqZdXh1skHff6A6VNgA/640?wx_fmt=gif&wxfrom=5&wx_lazy=1)

**点击 “在看” 鼓励一下吧**

**![](https://mmbiz.qpic.cn/mmbiz_png/ll2PVky3MmZOFFgf4oTyfUTx7y0ZBV9yIg8qmaSwAvbjiba2KQn7VgmXYIriagc9H0hMu1u0UIZr98JYSmyG9tibg/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)**