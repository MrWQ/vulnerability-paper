> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/dmeUPuZyeDvQKVT70XWSGQ)

**上方蓝色字体关注我们，一起学安全！**

**作者：bnlbnf****@Timeline Sec  
**

**本文字数：708**

**阅读时长：2～3min**

**声明：仅供学习参考使用，请勿用作违法用途，否则后果自负**

**0x01 简介**  

  

Atlassian Confluence Server 是澳大利亚 Atlassian 公司的一套具有企业知识管理功能，并支持用于构建企业 WiKi 的协同软件的服务器版本。

**0x02 漏洞概述**  

  

**漏洞编号：CVE-2022-26138**

当 Confluence Server 或 Data Center 上的 Questions for Confluence app 启用时，它会创建一个名为 disabledsystemuser 的 Confluence 用户帐户。  

此帐户旨在帮助将数据从应用程序迁移到 Confluence Cloud 的管理员账号中。  

该帐户通过使用硬编码密码创建并添加到 confluence-users 组中，在默认情况下允许查看和编辑 Confluence 中的所有非受限页面。未经身份验证攻击者可以利用所知的硬编码密码登录 Confluence 并访问该组有权限访问的所有页面。  

**0x03 影响版本**  

  

Questions for Confluence app == 2.7.34

Questions for Confluence app == 2.7.35

Questions for Confluence app == 3.0.2  

**0x04 环境搭建**  

  

靶场下载地址：  
https://github.com/vulhub/vulhub/archive/refs/heads/master.zip

上传靶场，解压

![](https://mmbiz.qpic.cn/mmbiz_png/VfLUYJEMVsiaQqqSNvC2ic8eyTvEGwjM8ZyfFiaD1qKCQbOCPQbkpDWsuVOVvW5JYB4WnhssnUEjXqeTkR5uLFCCQ/640?wx_fmt=png)

进入漏洞目录  
cd vulhub-master/confluence/CVE-2022-26134  

启动漏洞环境

docker-compose up -d

![](https://mmbiz.qpic.cn/mmbiz_png/VfLUYJEMVsiaQqqSNvC2ic8eyTvEGwjM8ZdLDHcHZlG8IOorhibNWaADhA7h1FpebNNic7QhNcBVcsE9vUvUttqe7g/640?wx_fmt=png)

启动完成，浏览器打开 ip:8090, 需要获取一个 license

![](https://mmbiz.qpic.cn/mmbiz_png/VfLUYJEMVsiaQqqSNvC2ic8eyTvEGwjM8ZYdr82GwJWM52ib2h2VicEhs3jdlh3HfkoDibN6t8lEO4CRnzu1eH2IYCA/640?wx_fmt=png)

生成一个激活码

![](https://mmbiz.qpic.cn/mmbiz_png/VfLUYJEMVsiaQqqSNvC2ic8eyTvEGwjM8ZyZKVFZM8usGnGwfnkwFibib7ibUvJUlhOkUxYg1CarSkwHAyv4V4bQrDg/640?wx_fmt=png)

弹出一个窗口点 yes

![](https://mmbiz.qpic.cn/mmbiz_png/VfLUYJEMVsiaQqqSNvC2ic8eyTvEGwjM8ZyLELcuzzLZyg3NuD9AeSD7SsIlLDDE6QPGcgokr7gV6EIl1KlDnQDA/640?wx_fmt=png)

激活码自动生成到页面上，点击 next

![](https://mmbiz.qpic.cn/mmbiz_png/VfLUYJEMVsiaQqqSNvC2ic8eyTvEGwjM8ZxaNYeCdDgWBO7yiasGjSyYH0lpXRBGKQInJn9MEtNcIkpias4Iw4gGTQ/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/VfLUYJEMVsiaQqqSNvC2ic8eyTvEGwjM8ZiccEiaCpNOQujZibdEemNLaeVmR5FySIrKy5iabicKe8wBTV57EWeCZxbibQ/640?wx_fmt=png)

Database URL：  
jdbc:postgresql://db:5432/confluence  
username：postgres  
password：postgres  

```
https://packages.atlassian.com/maven-atlassian-external/com/atlassian/confluence/plugins/confluence-questions/3.0.2/confluence-questions-3.0.2.jar
```

环境搭建就完成了

![](https://mmbiz.qpic.cn/mmbiz_png/VfLUYJEMVsiaQqqSNvC2ic8eyTvEGwjM8ZwRfqjt7t02qx1tcbpMGgA9yxqAkJGHDRaGAsKCkevDUicDh1sHiauXEg/640?wx_fmt=png)  
然后安装产生漏洞的 jar 包  

![](https://mmbiz.qpic.cn/mmbiz_png/VfLUYJEMVsiaQqqSNvC2ic8eyTvEGwjM8ZuYBxZggLuAAYK9MAGlicLHLve9aKd6peGrocSjnarOia85PrM6zRKHzA/640?wx_fmt=png)  

![](https://mmbiz.qpic.cn/mmbiz_png/VfLUYJEMVsiaQqqSNvC2ic8eyTvEGwjM8ZaydKEgZTnavRWO4D1OXicbtBq878ugqEial9rMct5QlaqwB6NJn6zxNQ/640?wx_fmt=png)

上传应用，应用下载地址

```
https://packages.atlassian.com/maven-atlassian-external/com/atlassian/confluence/plugins/confluence-questions/3.0.2/confluence-questions-3.0.2.jar
```

![](https://mmbiz.qpic.cn/mmbiz_png/VfLUYJEMVsiaQqqSNvC2ic8eyTvEGwjM8ZVvB9QdVBVpokrQJrG8nNdlBRBKsQnTae8NN2ohple6z8cH0yO3DoSQ/640?wx_fmt=png)

然后成功上传

![](https://mmbiz.qpic.cn/mmbiz_png/VfLUYJEMVsiaQqqSNvC2ic8eyTvEGwjM8ZDQa0T8s82YZaNDXQEfVkM7dGMC7nGOzGLia9rxhVrsGoQlPbAjMTnOw/640?wx_fmt=png)  

**0x05 漏洞复现**  

  

根据这篇漏洞分析的文章，会创建一个用户

```
https://www.freebuf.com/vuls/341027.html
```

使用硬编码密码创建的账号进行登录

```
用户名：disabledsystemuser

密码：disabled1system1user6708
```

![](https://mmbiz.qpic.cn/mmbiz_png/VfLUYJEMVsiaQqqSNvC2ic8eyTvEGwjM8ZGKDfyC4lb2fKfmog8OgAQFEW2ibFLXYNOH1bRFdG57r80JGwzTC4A8g/640?wx_fmt=png)

**0x06 修复方式**  

  

参考官方公告中的修复建议：

更新 Questions for Confluence 扩展至以下安全版本:

2.7.x >= 2.7.38 (Confluence 6.13.18 到 7.16.2)

Versions >= 3.0.5 (Confluence 7.16.3 之后的版本)

![](https://mmbiz.qpic.cn/mmbiz_png/VfLUYJEMVsiaASAShFz46a4AgLIIYWJQKpGAnMJxQ4dugNhW5W8ia0SwhReTlse0vygkJ209LibhNVd93fGib77pNQ/640?wx_fmt=png)

  

![](https://mmbiz.qpic.cn/mmbiz_jpg/VfLUYJEMVshAoU3O2dkDTzN0sqCMBceq8o0lxjLtkWHanicxqtoZPFuchn87MgA603GrkicrIhB2IKxjmQicb6KTQ/640?wx_fmt=jpeg)

**阅读原文看更多复现文章**

Timeline Sec 团队  

安全路上，与你并肩前行