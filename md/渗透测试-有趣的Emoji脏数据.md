> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/OcNVMNGOuVP7BUidACJSoA)

![图片](https://mmbiz.qpic.cn/mmbiz_png/zNJ4YhKaok3WXGGiakxKvlOQZLV0DRA0Cibptxv2DC9Sxn5MZ24FrEryKEoqwL0LxgYGYB3HupicCAfYosueeazWA/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

![图片](https://mmbiz.qpic.cn/mmbiz_png/Wzg6H7uiaEUuONjaSQqwX0liaZMe7ialQk3tOTL7w9MgXuWJrhs95uprpscHr9JSmJ8H2ZAtmRETBREKhcb50sAicg/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

  

![图片](https://mmbiz.qpic.cn/mmbiz_gif/ibicicIH182el6a9EO2exy5AFj6pyO3xjLjCvXiayia3VzRoBiaPUGUibZianO7NicvwetrANBiaRAal6JYKtLxePgArcScw/640?wx_fmt=gif&wxfrom=5&wx_lazy=1)

  

![图片](https://mmbiz.qpic.cn/mmbiz_png/Z1N0HbVwRiaYV3wjJl8bEXPBWw9okzgfDRibxBvM3Ofb08BhgNtK9icic7u9siclk7vGDSria8xYtt4GF1C0CgpialYJQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

![图片](https://mmbiz.qpic.cn/mmbiz_png/XQNU4yRQkQFWGKHbJOQg3ue2dEI05MmEguiaXzdichLTxcgma0htf9HVwjchWAgFWnJGpyy9S98e7kfpX4GfTBEQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

  

**![图片](https://mmbiz.qpic.cn/mmbiz_png/ibicicIH182el7f0qibYGLgIyO0zpTSeV1I6m1WibjS1ggK9xf8lYM44SK40O6uRLTOAtiaM0xYOqZicJ2oDdiaWFianIjQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)**  

  

  

![图片](https://mmbiz.qpic.cn/mmbiz_png/64HEibicwoTVPB8smnhdVoc7JbSaYqwqvrUcgmufsMThIEejT2UyKBJha6pdibPxAIGLoTibtmG5CvC73DzZ0ubv1Q/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

![图片](https://mmbiz.qpic.cn/mmbiz_png/4R3RgYzzCgG6fvduwiaD0Uzhd9MCO2xZfIttlKGLlzCNCTnAXk4QJyeBoRuDmSMgIMrBricSrdV6F5tH6OGGj80g/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

**一****：前言🐑**

  

这段时间参加了某个流量设备的比赛，总结一下关于绕过心得，

命令执行检测通常通过响应包以及请求包来进行检测，我们通常进行漏洞验证的时候，可能会有很明显的命令执行Payload和响应包返回，导致被流量设备迅速捕获，使攻击被快速响应发现。下面几个点详细讲解这场比赛中几个绕过的点

  

![图片](https://mmbiz.qpic.cn/mmbiz_png/64HEibicwoTVPB8smnhdVoc7JbSaYqwqvrUcgmufsMThIEejT2UyKBJha6pdibPxAIGLoTibtmG5CvC73DzZ0ubv1Q/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

![图片](https://mmbiz.qpic.cn/mmbiz_png/4R3RgYzzCgG6fvduwiaD0Uzhd9MCO2xZfIttlKGLlzCNCTnAXk4QJyeBoRuDmSMgIMrBricSrdV6F5tH6OGGj80g/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

二:  命令执行🐇

  

  

这里拿一个Web应用的历史漏洞来进行绕过测试, 漏洞验证的POC为

```
/file/NDisk/get_file.php?cid=1&nid=;last;
```

![图片](https://mmbiz.qpic.cn/mmbiz_png/ibicicIH182el57b6W8wTibic4cg7J2ViblArSv5nDUtQfz4yMcSpqzkgSkfXj5nH3OibX3VO8Iic4aevOEa6ic7eY77ozg/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

  

提交的流量包，明显可见恶意请求和命令执行回显

![图片](https://mmbiz.qpic.cn/mmbiz_png/ibicicIH182el57b6W8wTibic4cg7J2ViblArSKQRtGCj7BFdMyzCnVEO3bpNKjOoFjiaOrwB6hHHXpp1AOa5JvgaZwWA/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

  

这里被检测到了恶意攻击，我们通过大量的 emoji脏数据绕过检测

![图片](https://mmbiz.qpic.cn/mmbiz_png/ibicicIH182el57b6W8wTibic4cg7J2ViblArS2eqxwvgfIbGGhnujQhHpiafGyfDHNAnumSes0Ltrjf7WZoLqKNHLWgQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

  

查看流量包, 同样命令执行成功，再次检测即可绕过

![图片](https://mmbiz.qpic.cn/mmbiz_png/ibicicIH182el57b6W8wTibic4cg7J2ViblArSXxgM8WpWZJICqwkyQNWYQVqRYRB3oc0T4khf9hauQBibS6Ff6NAKQoA/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

  

通常测试无回显命令执行我们通过写入文件的方法进行漏洞的测试, 经过测试后发现同样有拦截，例如下面的Payload

```
/cmd.php?cmd=;id>1.txt
```

我们同样更改思路，不写入文件而是写入 🐶,  而写入的文件在服务器中也可以读取，达到绕过的效果

  

![图片](https://mmbiz.qpic.cn/mmbiz_png/ibicicIH182el57b6W8wTibic4cg7J2ViblArSic1QlWDrbC6zLAgUmpIKRAgN7WEu5vkPGCrxaOIrrg7ceZBV1wJJ9VA/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

  

![图片](https://mmbiz.qpic.cn/mmbiz_png/ibicicIH182el57b6W8wTibic4cg7J2ViblArSeBW5ian4gd24wmEiaKib521VCOhvI999RFK2eTFbOogmBrkxlQp3V91FQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

  

![图片](https://mmbiz.qpic.cn/mmbiz_png/64HEibicwoTVPB8smnhdVoc7JbSaYqwqvrUcgmufsMThIEejT2UyKBJha6pdibPxAIGLoTibtmG5CvC73DzZ0ubv1Q/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

![图片](https://mmbiz.qpic.cn/mmbiz_png/4R3RgYzzCgG6fvduwiaD0Uzhd9MCO2xZfIttlKGLlzCNCTnAXk4QJyeBoRuDmSMgIMrBricSrdV6F5tH6OGGj80g/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

三:  文件上传🐋

  

  

文件上传的检测则更加的严格，例如上传 jsp文件，会先检测文件名，再检测文件内容，那我们的首要目标就是要先通过文件名的检测

  

![图片](https://mmbiz.qpic.cn/mmbiz_png/ibicicIH182el57b6W8wTibic4cg7J2ViblArS4ZiaHbibtwP06YTRxpNFMUT8CA7RZmPGYnOlsRkArfnC2Clt8roIibn6w/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

  

如上图是会被拦截的，我们同样使用脏数据 emoji来作为文件名测试绕过

![图片](https://mmbiz.qpic.cn/mmbiz_png/ibicicIH182el57b6W8wTibic4cg7J2ViblArSbSBBWOI9K56sxr6Da0iahnuWSXH124wf8N45V8Pm6Hw8OicgXwlRyJnw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

  

如上图的流量包则不会被检测了，成功上传 jsp文件且无法被检出

![图片](https://mmbiz.qpic.cn/mmbiz_png/ibicicIH182el57b6W8wTibic4cg7J2ViblArSnKicDR3ibcMABFbyicCibzZ2FO2qD8fSmWf1Kf56AAcAdQje4dI1yic4OfA/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

  

同样上传PHP文件也可以使用这个方法，下图为某OA文件上传漏洞绕过

![图片](https://mmbiz.qpic.cn/mmbiz_png/ibicicIH182el57b6W8wTibic4cg7J2ViblArS5LC4xuFkyZcKZic6NS6tXgC0rwl5jshJdVdaCAYPShnFWxiaus5FovkA/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

  

而文件上传后服务器会重新命名则是这个绕过方法的前提

  

![图片](https://mmbiz.qpic.cn/mmbiz_png/64HEibicwoTVPB8smnhdVoc7JbSaYqwqvrUcgmufsMThIEejT2UyKBJha6pdibPxAIGLoTibtmG5CvC73DzZ0ubv1Q/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

![图片](https://mmbiz.qpic.cn/mmbiz_png/4R3RgYzzCgG6fvduwiaD0Uzhd9MCO2xZfIttlKGLlzCNCTnAXk4QJyeBoRuDmSMgIMrBricSrdV6F5tH6OGGj80g/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

 四:  关于文库🦉

  

  

新的PeiQi文库大家敬请关注，更好的阅读体验，更全面的文章阅读

  

![图片](https://mmbiz.qpic.cn/mmbiz_png/ibicicIH182el57b6W8wTibic4cg7J2ViblArSVKT9lib5BtVJsYSq8sc6uMBxS0l6f98nHqhXH6EIS4ibGtX69KsbPgyg/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

![图片](https://mmbiz.qpic.cn/mmbiz_png/ibicicIH182el57b6W8wTibic4cg7J2ViblArSaibPW28U7ztswZN5LNbf1Wj1LibkRE2JLz1oDNCf20ITSoymJtsmKlPw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

![图片](https://mmbiz.qpic.cn/mmbiz_png/ibicicIH182el57b6W8wTibic4cg7J2ViblArS4STJ5RRGwfKZAv1peGD5JN4vlY5X9icMNwKJibrb7u3zzWnLHGlOjH5Q/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

  

  

最后
--

> 下面就是文库的公众号啦，更新的文章都会在第一时间推送在交流群和公众号
> 
> 想要加入交流群的师傅公众号点击交流群加我拉你啦~
> 
> 别忘了Github下载完给个小星星⭐

 ![](http://mmbiz.qpic.cn/mmbiz_png/ibicicIH182el4k7oncstuDUYBxrtzOqAW4oGso8T29V66MANjNbTib9AIdfGoxhxNMpEhYWG8x4PxK2Yfwq2j6S0w/0?wx_fmt=png) ** PeiQi文库 ** 乌拉乌拉！ 97篇原创内容   公众号

 ![](http://mmbiz.qpic.cn/mmbiz_png/4LicHRMXdTzDjy8pCtpvJKBibCLXQDm14MbdlTqXYESXADHkVpL6f81Z4TVFOGQMjBjgxPpUcYnzahRhibQUdcKzQ/0?wx_fmt=png) ** WgpSec狼组安全团队 ** WgpSec 狼组安全团队由几位热爱网络安全的年轻人一同组成过去的几年内没来得及让团队发生有效且质的变化这一次，为了我们的slogan：打造信息安全乌托邦。前进！ 126篇原创内容   公众号

  

**同时知识星球也开放运营啦，希望师傅们支持支持啦🐟**

**知识星球里会持续发布一些漏洞公开信息和技术文章~**

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

  

**由于传播、利用此文所提供的信息而造成的任何直接或者间接的后果及损失，均由使用者本人负责，文章作者不为此承担任何责任。**

  

**PeiQi文库 拥有对此文章的修改和解释权如欲转载或传播此文章，必须保证此文章的完整性，包括版权声明等全部内容。未经作者允许，不得任意修改或者增减此文章内容，不得以任何方式将其用于商业目的。**