> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/oya7ggzte7ZTOUsxO4QwrA)

前言
--

在虚拟化技术日益成熟的今天，VMware ESXi 以其卓越的性能和稳定性，成为了众多企业构建虚拟化环境的首选。然而，随着远程办公和跨地域管理的需求增加，如何高效地远程访问和管理部署在本地数据中心的 ESXi 服务器，成为了企业 IT 部门面临的重要挑战。

传统的远程访问方式往往受限于网络配置复杂、IP 地址固定以及安全性能不足等问题，难以满足现代企业对于灵活、安全、高效的远程管理需求。为了解决这一难题，我们可以借助 Cpolar 内网穿透技术，将本地 ESXi 服务器的访问能力扩展到公网，实现随时随地的远程访问和管理。

Cpolar 是一款功能强大的内网穿透工具，它通过建立加密的隧道连接，将局域网内的服务安全地暴露到公网上，无需公网 IP，也无需复杂的网络配置。通过 Cpolar，我们可以轻松地将本地 ESXi 服务器的管理接口映射到公网地址上，使得远程用户可以通过浏览器或其他管理工具，直接访问和管理 ESXi 服务器。

本文将重点介绍如何结合本地部署的 VMware ESXi 与 Cpolar 内网穿透技术，实现远程访问和管理本地 ESXi 服务器的具体步骤和配置方法。我们将从 ESXi 的安装与配置、Cpolar 的安装与隧道创建、远程访问的实现与测试等方面进行详细阐述。

**如果已经下载安装好了 ESXi , 可以直接跳到步骤 2 !**

1. 下载安装 ESXi
------------

为了方便下载, 可以选择一个第三方站点下载:https://www.pcsoft.com.cn/fmaurkq/30237711?module=soft&t=website, 这个地址将会下载一个 ESXi 7.0 的版本, 下载后解压可以看到一个 ios 的镜像文件, 这个镜像文件就是下面我们需要在 vmware 安装时候用到 的镜像文件

![](https://mmbiz.qpic.cn/sz_mmbiz_png/tSa9O9IXorwEzxxHDtG9R4NUOebAISrNOor8iaznWr9rZv8bmKF2Ack8cEC3ncqyu6sC6ia5RibdbqXLaeR2hJMBQ/640?wx_fmt=png&from=appmsg)

接下来打开 VMware, 创建一个新的虚拟机

![](https://mmbiz.qpic.cn/sz_mmbiz_png/tSa9O9IXorwEzxxHDtG9R4NUOebAISrN2JaWXI2HjCmphjWxXtsCwvqDXKPz7k9PVhciaxKzgtA5xJRVDpiau68g/640?wx_fmt=png&from=appmsg)

选择 "典型" 方式快捷安装, 然后点击下一步

![](https://mmbiz.qpic.cn/sz_mmbiz_png/tSa9O9IXorwEzxxHDtG9R4NUOebAISrNbwILchibL12Bmkc5NaJvXWUcnsY95rbayrtNBBicMjqZJCygwmvu2w2w/640?wx_fmt=png&from=appmsg)

这一步指定选择我们上面下载解压后看到的 ESXi 的 ios 镜像文件, 指定选择后, 点击下一步

![](https://mmbiz.qpic.cn/sz_mmbiz_png/tSa9O9IXorwEzxxHDtG9R4NUOebAISrNSfIsXEibecNyElrMKxiaQR5Pq6glsHw5YeJkWR6p3dBjLmGOL0ic949MA/640?wx_fmt=png&from=appmsg)

然后取个名称, 再指定安装路径, 点击下一步

![](https://mmbiz.qpic.cn/sz_mmbiz_png/tSa9O9IXorwEzxxHDtG9R4NUOebAISrNiaibCjRUNk9qVBMlO3QkM1osRZhxGKzMSicZpmaaH7mmq5GAqoJI3ISFg/640?wx_fmt=png&from=appmsg)

然后分配一个存储容量, 这个可以自己指定, 也可以默认, 然后点击下一步

![](https://mmbiz.qpic.cn/sz_mmbiz_png/tSa9O9IXorwEzxxHDtG9R4NUOebAISrNY2xHPcVP8iah6YDjwLIlZswIiarqAelxRV5cRIG4J1VcsUjM1DITqmlg/640?wx_fmt=png&from=appmsg)

然后点击完成, 虚拟机就创建好了

![](https://mmbiz.qpic.cn/sz_mmbiz_png/tSa9O9IXorwEzxxHDtG9R4NUOebAISrNVq2oFogbsd9bFAVsVMwicdJrSzCe6wwBnNyxz19icibp4JgUDPHrHM7TQ/640?wx_fmt=png&from=appmsg)

打开 VMware 主界面, 选择我们刚刚创建的 ESXi 虚拟机, 点击开启此虚拟机, 下面等待进入安装界面

![](https://mmbiz.qpic.cn/sz_mmbiz_png/tSa9O9IXorwEzxxHDtG9R4NUOebAISrNgvlxsm651LeHvcCx0Cea671pXVmLGk71AXHBlGtdfeWicvsNTMUuT8A/640?wx_fmt=png&from=appmsg)

进入安装界面后, 按 "Enter" 回车键开始安装

![](https://mmbiz.qpic.cn/sz_mmbiz_png/tSa9O9IXorwEzxxHDtG9R4NUOebAISrN3ps4tN1ggHwnaC6KjZwbC11uuDP1bBGuCtveYd0VBbvicumib1LJ1Inw/640?wx_fmt=png&from=appmsg)

然后按 "F11" 键同意协议

![](https://mmbiz.qpic.cn/sz_mmbiz_png/tSa9O9IXorwEzxxHDtG9R4NUOebAISrN8okHdicHkbiabWKsljVlVPNTHZ9eXO63rxQIoXpF4CXroiczSuozxgtaA/640?wx_fmt=png&from=appmsg)

这里会显示我们上面创建虚拟机的时候分配的存储容量大小, 再次按 "Enter" 回车键继续即可

![](https://mmbiz.qpic.cn/sz_mmbiz_png/tSa9O9IXorwEzxxHDtG9R4NUOebAISrNq7knyItziahtBa6UXnljIUcIZIqh5RaV8aKM2GibhjBjTDG99Lmt1VqQ/640?wx_fmt=png&from=appmsg)

然后选择键盘, 这里默认即可, 再次按 "Enter" 回车键继续

![](https://mmbiz.qpic.cn/sz_mmbiz_png/tSa9O9IXorwEzxxHDtG9R4NUOebAISrNyrOibpJPoxg9fNbefKmc15Z3zEz9045KmR213bLsTysSoKXEyWcz21A/640?wx_fmt=png&from=appmsg)

这里比较关键, 这里是设置登录用户的密码. root 是用户名, 下面需要设置一个密码, 输入第一遍后, 按 ↓ 键输入第二遍密码, 再次按 "Enter" 回车键继续

![](https://mmbiz.qpic.cn/sz_mmbiz_png/tSa9O9IXorwEzxxHDtG9R4NUOebAISrN6eEc2tZx8DhdPq0nxPh8y5hpkuGJiaqeAZZ5nMAKcLgLCicyfrf62ACw/640?wx_fmt=png&from=appmsg)

然后按 "F11" 键开始安装, 接下来等待安装即可

![](https://mmbiz.qpic.cn/sz_mmbiz_png/tSa9O9IXorwEzxxHDtG9R4NUOebAISrNm9zDGZxHZCoicB2fIUohJeRj9R5ibyQnXLVQBWhxA0NEh41Bty8eicZTw/640?wx_fmt=png&from=appmsg)

安装完成后, 提示需要重启, 再次按 "Enter" 回车键重启

![](https://mmbiz.qpic.cn/sz_mmbiz_png/tSa9O9IXorwEzxxHDtG9R4NUOebAISrN6bkfV9hW7BpYQj1mhPWN6ERQDwibAps6vDzVGxDgn2TLgtwC3ROXAibA/640?wx_fmt=png&from=appmsg)

重启后, 我们可以看到上面是 ESXi 的版本信息和自己处理器的信息, 还出现了访问地址,https://192.168.126.131 (具体地址以自己为准), 安装就完成了, 下面我们把这个地址输入到浏览器

![](https://mmbiz.qpic.cn/sz_mmbiz_png/tSa9O9IXorwEzxxHDtG9R4NUOebAISrNwUC7FcCKq8iblCFfvvmadeIdnibZial4SF1bsPrmFPEIGfqVxVBkItxNw/640?wx_fmt=png&from=appmsg)

输入浏览器后, 可以看到访问成功了, 如果提示不安全, 直接选继续访问即可

![](https://mmbiz.qpic.cn/sz_mmbiz_png/tSa9O9IXorwEzxxHDtG9R4NUOebAISrNw6ibYcS5X6G1DJQ1NNGPPrB1TweyZLC1icpXBpVUiagHiaQYOGP9ib5aq7w/640?wx_fmt=png&from=appmsg)

输入用户名 root, 和我们上面设置的 root 用户对应的密码

![](https://mmbiz.qpic.cn/sz_mmbiz_png/tSa9O9IXorwEzxxHDtG9R4NUOebAISrNszge6qBs7VKP3ResUzT0AvK1FDAeBo3L5A3yDzTdSzcP95lbJTicOZQ/640?wx_fmt=png&from=appmsg)

可以看到登录进去了, 本地下载 ESXi 和安装就成功了, 本地测试无误后, 下面我们进行安装 cpolar 内网穿透软件, 实现远程访问

![](https://mmbiz.qpic.cn/sz_mmbiz_png/tSa9O9IXorwEzxxHDtG9R4NUOebAISrNTjAeYheMWlIZ7JC19QvndpDUKkvVlMbJkKqAWF8icO8YD1iba0RogiaSQ/640?wx_fmt=png&from=appmsg)

2. 安装 Cpolar 工具
---------------

ESXi 是运行在 VMware 中, 所以我们需要把 Cpolar 安装在 Windows 上, 点击下面地址访问 cpolar 官网：https://www.cpolar.com/ 注册一个账号，然后下载并安装客户端.

> Cpolar 下载界面：https://www.cpolar.com/download

*   _windows 系统：在官网下载安装包后，双击安装包一路默认安装即可。_
    

cpolar 安装成功后，在浏览器上访问本地 9200 端口【http://localhost:9200】，使用 cpolar 账号登录, 即可看到 Cpolar 管理界面, 然后一切设置只需要在管理界面完成即可!

![](https://mmbiz.qpic.cn/sz_mmbiz_png/tSa9O9IXorwEzxxHDtG9R4NUOebAISrNQtovdP4O7HP32iau2ogCyCm3jRFJ6PsWVbViajqxI7lic51oWB0x2yAibw/640?wx_fmt=png&from=appmsg)

3. 配置 ESXi 公网地址
---------------

在管理界面点击左侧仪表盘的隧道管理——创建隧道，创建一个 ESXi 的公网 http 地址隧道!

*   隧道名称：可自定义命名，注意不要与已有的隧道名称重复
    
*   协议：选择 http
    
*   本地地址：https://192.168.126.131:443  (端口默认是 443,IP 地址具体以自己的为准, 这一个参数需要严格按照教程来设置, 不要漏掉 "https://")
    
*   域名类型：免费选择随机域名
    
*   地区：选择 China
    

点击`创建`(点击一次创建按钮即可, 不要重复点击!)

![](https://mmbiz.qpic.cn/sz_mmbiz_png/tSa9O9IXorwEzxxHDtG9R4NUOebAISrNicJtAx3wWSOrkIMiaMnkak0qgdFsDcAIWHO73hicUHqUM9KJ347P4CVBA/640?wx_fmt=png&from=appmsg)

隧道创建成功后，点击左侧的状态——在线隧道列表, 查看所生成的公网访问地址，有两种访问方式, 一种是 http 和 https, 我们只需要选择 https 域名访问即可

![](https://mmbiz.qpic.cn/sz_mmbiz_png/tSa9O9IXorwEzxxHDtG9R4NUOebAISrNLhkMDxiaB4hD9ofvqwWlgTvHyiaEwKGM0Am54XGrGDTeepuFCxvoW5IQ/640?wx_fmt=png&from=appmsg)

4. 远程访问 ESXi
------------

在浏览器输入上面我们创建的 Cpolar 公网 https 域名, 可以看到同样访问成功了, 输入对应的账号密码, 点击登录

![](https://mmbiz.qpic.cn/sz_mmbiz_png/tSa9O9IXorwEzxxHDtG9R4NUOebAISrNMlFwV8JqXOLJmg9IlsG3gv6SIPOTIwcGorxal6XgqAyMtEvaP1qDlA/640?wx_fmt=png&from=appmsg)

可以看到也是登录成功了, 公网远程访问设置就成功完成了, 使用该域名可以在任意设备上访问本地 ESXi 管理界面!

![](https://mmbiz.qpic.cn/sz_mmbiz_png/tSa9O9IXorwEzxxHDtG9R4NUOebAISrNkibnEVvTibEa3BoocqbfSJNLjKzecHLIVcHtSZ2P2llHbAsiciaqQ8FG1g/640?wx_fmt=png&from=appmsg)

**小结**

为了更好地演示，我们在前述过程中使用了 cpolar 生成的隧道，其公网地址是随机生成的。

这种随机地址的优势在于建立速度快，可以立即使用。然而，它的缺点是网址由随机字符生成，不太容易记忆（例如：3ad5da5.r10.cpolar.cn）。另外，这个地址在 24 小时内会发生随机变化，更适合于临时使用。

我一般会使用固定二级子域名，原因是我希望将网址发送给同事或客户时，它是一个固定、易记的公网地址（例如：esxi7test.cpolar.cn），这样更显正式，便于流交协作。

5. 固定 ESXi 公网地址
---------------

由于以上使用 Cpolar 所创建的隧道使用的是随机公网地址，24 小时内会随机变化，不利于长期远程访问。因此我们可以为其配置二级子域名，该地址为固定地址，不会随机变化【ps：cpolar.cn 已备案】

> 注意需要将 cpolar 套餐升级至基础套餐或以上，且每个套餐对应的带宽不一样。【cpolar.cn 已备案】

点击进入和登录 Cpolar 官网，点击左侧的预留，选择保留二级子域名，设置一个二级子域名名称，点击保留

![](https://mmbiz.qpic.cn/sz_mmbiz_png/tSa9O9IXorwEzxxHDtG9R4NUOebAISrNYibuCVwTIm5DOMxxMIJibGdZ74FoibSx52zkicOx1DkQcnRlQrc27CRvfQ/640?wx_fmt=png&from=appmsg)

保留成功后复制保留成功的二级子域名的名称

![](https://mmbiz.qpic.cn/sz_mmbiz_png/tSa9O9IXorwEzxxHDtG9R4NUOebAISrNB8SxNIlVz7aWxrS3R5E47dOBsRDuqiaVToNkibTpJ20lPfSAadTPLiakQ/640?wx_fmt=png&from=appmsg)

返回登录 cpolar web UI 管理界面，点击左侧仪表盘的隧道管理——隧道列表，找到所要配置的隧道，点击右侧的编辑

![](https://mmbiz.qpic.cn/sz_mmbiz_png/tSa9O9IXorwEzxxHDtG9R4NUOebAISrNCH04N4GNK3uoXP3ohBbGBHqdjB4Q4AyKj9Xp3YLLgQVRfiaCgva0fjg/640?wx_fmt=png&from=appmsg)

修改隧道信息，将保留成功的二级子域名配置到隧道中

*   域名类型：选择二级子域名
    
*   Sub Domain：填写保留成功的二级子域名
    

点击`更新`(注意, 点击一次更新即可, 不需要重复提交)

![](https://mmbiz.qpic.cn/sz_mmbiz_png/tSa9O9IXorwEzxxHDtG9R4NUOebAISrN5ibBrlyL0O0wV9NNKlfYLJjXUrBIWaJcfkicwwsD2XtAFFrNiaibFBnX6A/640?wx_fmt=png&from=appmsg)

更新完成后, 打开在线隧道列表, 此时可以看到公网地址已经发生变化, 地址二级名称变成了我们自己设置的二级子域名名称

![](https://mmbiz.qpic.cn/sz_mmbiz_png/tSa9O9IXorwEzxxHDtG9R4NUOebAISrNqJfDvibvMO6iaqz074xNFLmjlg3IqPyRmbtzricegVgYGSACXWN2Uw0SA/640?wx_fmt=png&from=appmsg)

再次打开浏览器, 输入我们固定的 cpolar 公网地址, 可以看到同样访问成功了, 如果访问慢, 可以按 F12 打开控制台刷新几次再看看!, 这样一个固定的地址就设置好了, 不用再担心地址会变化.

**如需转载，请注明出处！**

**《本地部署 Cloudreve 结合内网穿透搭建个人云盘随时访问》**

**[![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/tSa9O9IXorwEzxxHDtG9R4NUOebAISrNJxpePqsticVX4qTBektolsUE7gGJOFM6QuP1eY2JKDIJuwTD1CCFRuQ/640?wx_fmt=jpeg)](http://mp.weixin.qq.com/s?__biz=MzkwMjYwMDkxMw==&mid=2247490899&idx=1&sn=a524c51fe9f801036ec2e4118734fa91&chksm=c0a25cedf7d5d5fbd3458b9f01f058267f81e85f86e254bd76ff1bc5513a05aecf44e30375ed&scene=21#wechat_redirect)**