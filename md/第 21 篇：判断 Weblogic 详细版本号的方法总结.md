> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/z6q1sBYcHYgzvak98QQmeA)

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450ATcz6jUJnFNeOxRzVZ9Lbc0INLwTJTZT1GaNutZrfDn6csvjBoS2ox0efLUEexXqPEcVbYfbLo8w/640?wx_fmt=png)

 **Part1 前言** 
--------------

在日常的渗透测试、红队评估项目中，中间件层面的漏洞挖掘是非常重要一环，Weblogic 中间件在最近几年接连被爆出很多高危漏洞，基本上都是可以直接拿到权限的。主流的 Weblogic 漏洞包括 HTTP 协议上的 CVE-2017-10271、CVE-2019-2729 等，但是其影响 weblogic 的版本为 12.1.3 之前版本。**如果能事先判断出 weblogic 的版本号是大于 12.1.3 的，那么可以放弃测试这两种漏洞，节省很多时间**。

此外还有很多 T3 协议、IIOP 协议下的各种 Java 反序列化漏洞，但是这些反序列化漏洞利用起来非常非常麻烦，尤其是最近几年出现的漏洞很多都基于 coherence 组件，**不同版本号的 weblogic 的 coherence 组件的 SUID 都不一样**，而漏洞利用成功的前提就是漏洞利用工具的 SUID 和目标 weblogic 环境的 SUID 必须一致。

这就需要我们在渗透测试的时候，准确判断出 Weblogic 版本号，以备找到合适版本号的 coherence 组件去进行 Java 反序列化攻击。**而且在得知 weblogic 版本号之后，不符合版本号的漏洞就不用测试了，这样会节省很多时间**。接下来就给大家分享一些在各种情况下判断 Weblogic 细微版本号的方法。**再次强调一下，依据 ABC_123 测试 weblogic 漏洞的经验，在 weblogic 漏洞的探测与利用之前，需要想尽各种办法去判断 weblogic 细微版本号，这样可以节省很多时间，也可以发最少量的数据包。因为 weblogic 各种漏洞非常多，非常繁杂，而且利用成功与否受 weblogic 版本影响特别大。**

 **Part2 技术研究过程** 
------------------

*   **Weblogic 细微版本号对照表**
    

既然要判断 Weblogic 版本号，首先就要让大家了解一下 weblogic 各版本号的命名规则。不得不说，Oracle 公司的产品，在版本号的命名上、日志结构上一向弄得很复杂。

**笔者曾经遇到这么一个尴尬的事情，相信网友们也遇到过类似的情况**。在一次渗透测试报告总结会中，有技术人员找到了一个 Weblogic 反序列化漏洞，但是他给出的修复建议是，**把 Weblogic 11g 版本升级到 12c 版本**。客户那边的接口人开会时就对此提出质疑和批评：**我们公司部署的 Weblogic 中间件明明是 10.3.6 版本，是 10 版本的，你们给的修复建议居然是由 11 版本升级到 12 版本，我们没有 11 版本的 weblogic 啊？**

结果在场的项目经理和技术人员都被问懵了，被客户质疑地哑口无言，楞是没答出这个问题来，一致认为修复建议给错了，于是引起了一系列误会。后来我发了如下这张图，跟大家解释了一下，其实客户跟我们说的都没错，**Weblogic 10.3.6 版本跟 11g 版本其实是一回事，只是命名规则不同**。具体大家可以把下面这张图仔细看几遍，就自然明白了，我在这里就不过多叙述了。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450BQt1LcMSp2As68ibMiabqSMOuibgaoaxjtLwZA6rg205gpSOTc3iaia3IxqhHxupKZrsxN2ENyNRxbn7A/640?wx_fmt=png)

*   **判断是否使用了 Weblogic**
    

 **1**  **Weblogic 指纹特征判断**

判断一个网站应用是否使用了 Weblogic 中间件，可以通过查找指纹特征的方法去判断。输入一个不存在的 URL 路径，看 Web 服务是否返回如下 “**From RFC 2068Hypertext Transfer Protocol**” 关键字，即可判断出是否使用 Weblogic 中间件来。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450BQt1LcMSp2As68ibMiabqSMO0uiaiaPjtpZJOurJZtU0iaRXBibibQznB6crgZ4SDO5IXvChSVraomdejEg/640?wx_fmt=png)

使用 Burpsuite 发包返回如下：

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450BQt1LcMSp2As68ibMiabqSMOBus5s2rWL0dL4MHwQSwcblXwYFz6IL5neAS6lEeqYcSgic2kxxrSg7A/640?wx_fmt=png)

 **2   Weblogic 内置 URL 路径判断**

对于有些网站屏蔽了 404 错误回显的情况，可以通过访问 Weblogic 内置 Web 目录是否存在去间接去判断是否使用了 Weblogic 中间件。比如 **/consolehelp/、/bea_wls_internal/、/console/** 等路径是 Weblogic 专有的，再比如说可以访问 Weblogic 专有的漏洞 CVE-2017-10271、CVE-2019-2729 等对应的 URL 路径 (/wls-wsat/、/_async / 等)，但是这个方法不推荐使用，因为基本上都会被 WAF 拦截，更严重的情况是会导致封 IP，导致后续正常路径也无法判断出来，而且大多数甲方客户修复漏洞的方法，就是直接删除存在漏洞的 war 包，导致这两个路径也不存在。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450BQt1LcMSp2As68ibMiabqSMO8kyK9sSzHKgGtsHl4R29gCcnsoSX1fG1YVPDAGgkpocWMw5HAf0SLA/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450BQt1LcMSp2As68ibMiabqSMOfnCuFLfSIgpQ1ibUu1iaCIEhYyq0jBzClOTw479R8IXWYp9E46oX4NQQ/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450BQt1LcMSp2As68ibMiabqSMO4QweOCwlG0fWXguNY5ibeDMeF9S8LQHDtkdOpYuOcCiaAO174WaIR9wg/640?wx_fmt=png)

*   **判断 Weblogic 详细版本号方法**
    

 **1** **访问特定页面可显示版本号**

访问 / console / 目录，如果 console 目录应用没有删除，在页面左下角会给出一个 weblogic 的详细版本号。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450BQt1LcMSp2As68ibMiabqSMO7gPBqEBoiaZyFWEvBVuObjFOSNUqmXWjLP3dkNkVpPzCrNHO8rjYgHQ/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450BQt1LcMSp2As68ibMiabqSMOgfvxWbT6eqz176eWE8oJibEKE3T6XGzBNVOol2WPMAlicE5FoBwbuGeQ/640?wx_fmt=png)

 **2   通过 T3 协议获取**

通过 T3 协议可以直接获取 Weblogic 版本号，缺点是现在 Weblogic 的 T3 直接暴露在公网上的情况很少了，很多时候在前面会放置一个 nginx 反向代理，这种情况下，T3 识别版本号的方法就用不了了。

可以使用 nmap 去识别，具体命令如下：

nmap 192.168.237.235 -p 7130 --script="weblogic-t3-info.nse" -v -Pn -n -sV --open -T4

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450BQt1LcMSp2As68ibMiabqSMOtvSw113rD1e1n3NsKG6t0rRpSjeu4OicPlo8bZGSaK12k9tDd2fQ6eQ/640?wx_fmt=png)

也可以自己从 github 上下载一个 T3 协议的发包代码，自己修改一下，直接把 T3 协议的返回包输出，就直接可以看到版本号了。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450BQt1LcMSp2As68ibMiabqSMOtdzgrEpYCdMWvV6SkxpiaoYlX2Fe6zpSDevu9liaCesckkVYar1No1kA/640?wx_fmt=png)

 **3   CVE-2022-21371 文件包含漏洞判断**

这个漏洞是 2022 年出现的漏洞，是一个文件包含漏洞，通过这个漏洞可以跳转目录对 Weblogic 的 / WEB-INF/xml、jsp、html 文件等进行文件读取。这也是被大家忽略的一个 Nday 漏洞，**在这里，我们可以用这个漏洞，间接判断出 weblogic 的版本号**。

思路是，fast_track.html 这个文件的显示内容有个时间，每一个细微版本大致对应着一个 weblogic 的细微版本号，用来做版本识别恰到好处。

访问.//fast_track.html，如下图所示，对于 Weblogic 的 12.2.1.3.0 版本，此文件回显时间内容是 1996，2017

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450BQt1LcMSp2As68ibMiabqSMOqN8z0vI4VEp1vzhUe82cd2Hnibweohm5suXPStRM10ibI7OW3wmnkv9g/640?wx_fmt=png)

如下图所示，对于 Weblogic 的 12.1.3.0.0 版本，此文件回显的时间内容是 1996，2014

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450BQt1LcMSp2As68ibMiabqSMOmnVmEMHqcV3j9PAPaup6wLjvmmFbwNGjTw6Quc0pooy9Mq3VesbF6A/640?wx_fmt=png)

 **4   通过返回头来判断**

很早之前从 github 上的一个脚本中复制出来放在我的笔记中的，忘记具体作者是谁了。这个方法我没有具体验证过，大家测试成功后，可以在微信公众号后台给我发消息，告诉我准确度如何。

通过返回头判断 weblogic 版本号：

def check_weblogic_by_header(headers):

status,msg = False,'may be not weblogic'

if 'X-Powered-By' in headers:

m = re.findall(r'Servlet/(.+)\s+JSP/(.+)',headers['X-Powered-By'])

if m :

Servlet,JSP = m[0]

if Servlet == '2.4' and JSP == '2.0':

status = True

msg = 'weblogic 9.x'

elif Servlet == '2.5' and JSP == '2.1':

status = True

msg = 'weblogic 10.x'

elif Servlet == '3.0' and JSP == '2.2':

status = True

msg = 'weblogicc 12.x'

return status,msg

**Part3 总结** 

**1.**  nday 也是有价值的，看大家对漏洞的理解以及如何灵活运用。

**2.**  判断 weblogic 版本号方法还有很多，上述方法是我比较常用的，也给大家拓展一下思路，还有很多其它方法后续再慢慢讲。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450A5qqg2iaK6KIYYR8y6pF5Rh3JHDibOKOop204nXz618iawdRb8dABicMPtHb2PkJE8x6koJO5HyuwZJQ/640?wx_fmt=png)

专注于网络安全技术分享，包括红队、蓝队、日常渗透测试、安全体系建设等

每周一篇，99% 原创，敬请关注

![](https://mmbiz.qpic.cn/mmbiz_jpg/OAz0RNU450A5qqg2iaK6KIYYR8y6pF5Rhn137KeqqlDkuRyY4G61jATRzyOrCBts8ucxkLpMNsYutSOY7BkPziaw/640?wx_fmt=jpeg)

**往期精彩回顾**

**[第 20 篇：改造冰蝎客户端适配 JNDIExploit 的内存马](http://mp.weixin.qq.com/s?__biz=MzkzMjI1NjI3Ng==&mid=2247484370&idx=1&sn=41144e2b24cf223753b1f631b7a7269b&chksm=c25fcca9f52845bfec4aceb55bbc2e35b95605873193a0a499b9505957039619598ae458b045&scene=21#wechat_redirect)  
**

[第 19 篇：关于近期 cs 服务端被反打的原因分析](http://mp.weixin.qq.com/s?__biz=MzkzMjI1NjI3Ng==&mid=2247484349&idx=1&sn=c23223a0348336daae18acc4a4790bb8&chksm=c25fccc6f52845d03b30faae72d252256434197d1267d713e60b85810f734368f0be61e62a06&scene=21#wechat_redirect)**[](http://mp.weixin.qq.com/s?__biz=MzkzMjI1NjI3Ng==&mid=2247484349&idx=1&sn=c23223a0348336daae18acc4a4790bb8&chksm=c25fccc6f52845d03b30faae72d252256434197d1267d713e60b85810f734368f0be61e62a06&scene=21#wechat_redirect)  
**

[第 18 篇：fastjson 反序列化漏洞区分版本号的方法总结](http://mp.weixin.qq.com/s?__biz=MzkzMjI1NjI3Ng==&mid=2247484332&idx=1&sn=c787dd0985156d856aad03d56a945be4&chksm=c25fccd7f52845c1e172b864dfc219dcecc9f226fb5abc64ef31178914ad9f58b7868bf6917a&scene=21#wechat_redirect)

[第 17 篇：Shiro 反序列化在 Weblogic 下无利用链的拿权限方法](http://mp.weixin.qq.com/s?__biz=MzkzMjI1NjI3Ng==&mid=2247484319&idx=1&sn=9da36674830837aa9bcacb3fb6268fd1&chksm=c25fcce4f52845f2ac3cebaf17fd3839fdba74f536ad3da20d1b1126d8ba0e1835853990516c&scene=21#wechat_redirect)

[第 16 篇：Weblogic 2019-2729 反序列化漏洞绕防护拿权限的实战过程](http://mp.weixin.qq.com/s?__biz=MzkzMjI1NjI3Ng==&mid=2247484303&idx=1&sn=58cbb4d7f63b9276bb89eeac286d174c&chksm=c25fccf4f52845e241256c2f425003b73b6061b3d1964dcd4a184a2cda1b4d8761098227e6de&scene=21#wechat_redirect)

[第 15 篇：内网横向中 windows 各端口远程登录哈希传递的方法总结](http://mp.weixin.qq.com/s?__biz=MzkzMjI1NjI3Ng==&mid=2247484255&idx=1&sn=e233aa07fdf9de0c8a1bf56fb0954766&chksm=c25fcc24f5284532c5aa27c002d15aa6380c456e2a84299c77b8d43a41892517087258bf867d&scene=21#wechat_redirect)

[第 14 篇：Struts2 框架下 Log4j2 漏洞检测方法分析与总结](http://mp.weixin.qq.com/s?__biz=MzkzMjI1NjI3Ng==&mid=2247484207&idx=1&sn=285b54a79e48db9a05816cab2e6afc27&chksm=c25fcc54f5284542c1b9abe870e0caa9f958f4da90723bd83292deed215c63c705b7b0bbfaff&scene=21#wechat_redirect)  

[第 13 篇：coldfusion 反序列化过 waf 改 exp 拿靶标的艰难过程](http://mp.weixin.qq.com/s?__biz=MzkzMjI1NjI3Ng==&mid=2247484191&idx=1&sn=cce12f62b3cf457bc73753b77a083695&chksm=c25fcc64f528457250b11ef6804ee6138c37ed87ab988874cc84d09d04fa6ac1fd36b5e8aa4a&scene=21#wechat_redirect)  

[第 12 篇：给任意 java 程序挂 Socks5 代理方法](http://mp.weixin.qq.com/s?__biz=MzkzMjI1NjI3Ng==&mid=2247484173&idx=1&sn=e2d454d2447d119bf771a0a511fba994&chksm=c25fcc76f5284560d00355590da0147aca7b7ae2275c095424034245ef32b3d0b28e49c2dbc9&scene=21#wechat_redirect)  

[第 11 篇：盲猜包体对上传漏洞的艰难利用过程](http://mp.weixin.qq.com/s?__biz=MzkzMjI1NjI3Ng==&mid=2247484162&idx=1&sn=870596fcd1120a6d3ee9688c38aace00&chksm=c25fcc79f528456f9dc0a3b9d9cf54422696a1cd6ffd737ae2c6e33941a25c33d4f6d32fc663&scene=21#wechat_redirect)  

[第 10 篇：IIS 短文件名猜解在拿权限中的巧用](http://mp.weixin.qq.com/s?__biz=MzkzMjI1NjI3Ng==&mid=2247484145&idx=1&sn=7635430b9b759a2cacdd2c57ba330833&chksm=c25fcd8af528449c1f5c6c703e3668cf6a8dae875ee82ffa67caed66722a0751e3d80d8a6bee&scene=21#wechat_redirect)  

[第 9 篇：Shiro 反序列化数据包解密及蓝队分析工具，提供下载](http://mp.weixin.qq.com/s?__biz=MzkzMjI1NjI3Ng==&mid=2247484123&idx=1&sn=cb9c039ef92311e56e7742c7c38f6e8a&chksm=c25fcda0f52844b6088b39b769a63b2f6e7a29e8b3ab710961918218d7569089ee4e00072ad9&scene=21#wechat_redirect)  

[第 8 篇：Oracle 注入漏洞绕 waf 的新语句](http://mp.weixin.qq.com/s?__biz=MzkzMjI1NjI3Ng==&mid=2247484115&idx=1&sn=10c73343ec23f522696692293cd38852&chksm=c25fcda8f52844be2165aa6151c7ad018a4add748673d56523631529e903277633dc44d0abba&scene=21#wechat_redirect)  

[第 7 篇：MS12-020 蓝屏漏洞在实战中的巧用](http://mp.weixin.qq.com/s?__biz=MzkzMjI1NjI3Ng==&mid=2247484105&idx=1&sn=3aeafa9c172588aaaade47ccacb69370&chksm=c25fcdb2f52844a4a783fceec590c9e12eb06f62dabd7fbffb37e8da23053953a7eae296048d&scene=21#wechat_redirect)  

[第 6 篇：Weblogic 反序列化攻击不依赖日志溯源攻击时间](http://mp.weixin.qq.com/s?__biz=MzkzMjI1NjI3Ng==&mid=2247484094&idx=1&sn=527236759dc4fd228461195197492507&chksm=c25fcdc5f52844d36bffb96979116d6d3a9ae4fb1a0f320436c7275aea271588c702cea60e5c&scene=21#wechat_redirect)  

[第 5 篇：Shiro Padding Oracle 无 key 的艰难实战利用过程](http://mp.weixin.qq.com/s?__biz=MzkzMjI1NjI3Ng==&mid=2247484091&idx=1&sn=4dcce59a842f17035d0018bf650671ae&chksm=c25fcdc0f52844d608b6b87d85082b74d5e15888e76001127ff40cc407a46e5e5de446b1365e&scene=21#wechat_redirect)  

[第 4 篇：jsp 型 webshell 被删情况下如何溯源攻击时间](http://mp.weixin.qq.com/s?__biz=MzkzMjI1NjI3Ng==&mid=2247484004&idx=1&sn=50013b50e48542d156700d76ccbd2f33&chksm=c25fcd1ff528440906bb9089a807c16b747ab5a72cc0279a3c0d18a265cd76cc796df570d594&scene=21#wechat_redirect)  

[第 3 篇：银行 Java 站 SSRF"组合洞" 打法造成的严重危害](http://mp.weixin.qq.com/s?__biz=MzkzMjI1NjI3Ng==&mid=2247483984&idx=1&sn=1a018fcefe10124c1726e51a2be05ca7&chksm=c25fcd2bf528443d944a8495ca5c72d8c028fef67de217efe47a8d18b077ae24556842687407&scene=21#wechat_redirect)  

[第 2 篇：区分 Spring 与 Struts2 框架的几种新方法](http://mp.weixin.qq.com/s?__biz=MzkzMjI1NjI3Ng==&mid=2247483951&idx=1&sn=fbc1d04ef73a449238a5979a439b1f35&chksm=c25fcd54f528444219f20c2ab14c5970c243fbb10ba04b5bccc0fb0b7cc6d3f542e26f7870bf&scene=21#wechat_redirect)  

[第 1 篇：weblogic9.x 在 JDK1.5 下 T3 反序列化漏洞利用方法](http://mp.weixin.qq.com/s?__biz=MzkzMjI1NjI3Ng==&mid=2247483867&idx=1&sn=e0fcaa9f1b58c8085ccd9dc6f74ed336&chksm=c25fcea0f52847b6aeec0409e3290e023b890d603361f103315b39637f89a10dd6fe051dc724&scene=21#wechat_redirect)